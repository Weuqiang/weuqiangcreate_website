# 
## IIFE

IIFE `Jquery`

```javascript
// 
(function (window) {
    function A() {
        return 'aaa'
    }

    function B() {
        return 'bbb'
    }

    window.myModule = {A, B}
})(window)

// 
myModule.A()
```



## CommonJS

`module.exports``require`

``` js title="a.js"
function getName() {
    return 'Akara'
}
module.exports = getName
```

```js title="b.js"
const getName = require('./a')
getName() // 'Akara'
```



### require()

> https://www.ruanyifeng.com/blog/2015/05/require.html

1. 
2. Node`module.exports`
3. 
4. `new Module()``module`
5. `module``require`
6. `module.exports`

`require` `module.exports`

```javascript
const getName = require('./a')
// 
const getName = (function () {
    function getName() {
        return 'Akara'
    }

    module.exports = getName

    // module.exports
    return module.exports
})()
```



- `require``require``require``module.exports`

- `module.exports``exports``module.exports``exports`

  ``` js
  exports.hp = 100; // ok
  exports = { // wrong
    hp: 100;
  }
  ```



## UMD

*AMD**CMD**AMD* `require.js` `define` `require`

*UMD*AMDCommonJS

``` js
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD
        define(['b'], factory);
    } else if (typeof module === 'object' && module.exports) {
        // CommonJS
        module.exports = factory(require('b'));
    } else {
        // 
        root.returnExports = factory(root.b);
    }
}(this, function (b) {
    // 
    return {}
}));
```









## esModule

`package.json``type: module``.js``ES``.mjs``ES`ES6 `import` `export`



### 

``` js title="a.ja"
const A = 'akara'
export default A //  export { name as default }
export function B() { //  export { getName as getName }
    return name
}
const C = 'akara'
export { C as alias }
```

``` js title="b.js"
import A from './a.js' //  import { default as name }
import { B } from './a.js' //  import { getName as getName }
import { alias as C } from './a.js'
console.log(A, B, C)
```

`import``import`

``` js title="b.js"
import * as myModule from './a.js' 
console.log(myModule)
// [Module: null prototype] {
//     B: [Function: B],
//     alias: 'akara',
//     default: 'akara'
// }
```







## 

*esModule**CommonJS*esModule****

NodeJS*esModule*BabelBabel*esModule*esModuleCommonJS**Babel**BabelNodeJSBabelTypeScriptEsbuildNode

BabelNodeJS



### Node

NodeJSesModuleBabelNodeJSBabel

NodeJS**esModuleCommonJS`module.exports`**esModuleCommonJSesModuleCommonJS`module.exports`****

``` js
import mo, { level } from './test.cjs'

console.log(mo, level) // { hp: 100, mp: 200, level: 999 } 999
```

``` js
module.exports = {
    hp: 100,
    mp: 200
}

module.exports.level = 999;
```





### Babel

BabelesModuleCommonJS

#### 

``` js title=""
export default {
    hp: 100,
    mp: 200
}
```

``` js title=""
Object.defineProperty(exports, "__esModule", {
		value: true
});

exports.default = {
  	hp: 100,
  	mp: 200
};
```

Babel**`export default``module.exports.default`**NodeJSBabel****Babel`__esModule`esModuleCommonJS`__esModule``default`





#### 



``` js title=""
import mo from './test.js'

console.log(mo)
```

``` js title=""
var _test = _interopRequireDefault(require("./test.js"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}
console.log(_test.default);
```

Babel`__esModule`Babel`module.exports``default``__esModule`CommonJS`module.exports``export default``module.exports`

BabelBabelBabelTypeScriptESBuildBabelBabelesModuleCommonJSNode

`@babel/traverse``__esModule`esModuleCommonJS`export default``module.exports.default`esModuleNode`import traverse from "@babel/traverse"``module.exports``default`

``` js
import _traverse from "@babel/traverse";
const traverse = _traverse.default;
```









``` js
import mo, { hp } from './test.js'

console.log(mo, hp)
```

``` js title=""
var _test = _interopRequireWildcard(require("./test.js"));
function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(
    nodeInterop
  ) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}
function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }
  if (obj === null || (typeof obj !== "object" && typeof obj !== "function")) {
    return { default: obj };
  }
  var cache = _getRequireWildcardCache(nodeInterop);
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  var hasPropertyDescriptor =
    Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor
        ? Object.getOwnPropertyDescriptor(obj, key)
        : null;
      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}
console.log(_test.default, _test.hp);
```

Node







### TypeScript

`module: 'CommonJS'`TypeScript*esModule**CommonJS*TypeScriptBabel`esModuleInterop`

#### 

Babel



#### 

##### `esModuleInterop: false`

``` js title=""
import mo from './test.js'

console.log(mo)
```

``` js title=""
Object.defineProperty(exports, "__esModule", { value: true });
var test_js_1 = require("./test.js");
console.log(test_js_1.default);
```

`false``import mo from``module.exports.default`NodeJSBabel



##### `esModuleInterop: true`

``` js title=""
import mo from './test.js'

console.log(mo)
```

``` js title=""
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var test_js_1 = __importDefault(require("./test.js"));
console.log(test_js_1.default);
```

`true`TypeScriptBabel



#### 

##### Module "react" has no default export

TypeScript`esModuleInterop``import React from "react"`React`Module "react" has no default export`

ReactCommonJS`module.exports.default`TypeScript`module.exports.default`

``` js
// __esModule
exports.useRef = useRef;
exports.useState = useState;
exports.version = ReactVersion;
```

TypeScript`esModuleInterop`Babel`import React from 'react'``const React = require('react')`









## 

### CommonJS

```js title="a.js"
module.exports.a1 = 100;
const b = require("./b");

module.exports.a2 = 200;
console.log('B', b);
module.exports.a3 = 300;
```

``` js title="b.js"
module.exports.b1 = 100;
const a = require('./a');

module.exports.b2 = 200;
console.log('A', a)
module.exports.b3 = 300;
```

`node a.js`

Node`new Module()``b.js``require('./a')``module.exports`A

```
A { a1: 100 }
B { b1: 100, b2: 200, b3: 300 }
```



### esModule

A -> B -> C -> D -> A

A`import`BBA

``` js title="a.js"
import { b } from './b.js'
export const a = 100;
console.log(b)
```

``` js title="b.js"
import { a } from './a.js'

export const b = 200;
console.log(a);
```

:::danger

ReferenceError: Cannot access 'a' before initialization

:::

Webpack

:::danger

Uncaught TypeError: Cannot read properties of undefined (reading 'xxx')

:::
