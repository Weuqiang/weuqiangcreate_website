"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[84530],{80006(n,e,s){s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"\u6570\u636e\u5e93/mongodb","title":"MongoDB - \u7075\u6d3b\u7684\u6587\u6863\u6570\u636e\u5e93","description":"MongoDB\u662f\u6700\u6d41\u884c\u7684NoSQL\u6587\u6863\u6570\u636e\u5e93\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60\u7528MongoDB\u6784\u5efa\u7075\u6d3b\u7684\u5e94\u7528\u3002","source":"@site/docs/docs/\u6570\u636e\u5e93/mongodb.mdx","sourceDirName":"\u6570\u636e\u5e93","slug":"/\u6570\u636e\u5e93/mongodb","permalink":"/weuqiangcreate_website/docs/\u6570\u636e\u5e93/mongodb","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"MongoDB - \u7075\u6d3b\u7684\u6587\u6863\u6570\u636e\u5e93"},"sidebar":"tutorialSidebar","previous":{"title":"MySQL - \u4ece\u5165\u95e8\u5230\u7cbe\u901a","permalink":"/weuqiangcreate_website/docs/\u6570\u636e\u5e93/mysql"},"next":{"title":"Redis - \u9ad8\u6027\u80fd\u7f13\u5b58\u6570\u636e\u5e93","permalink":"/weuqiangcreate_website/docs/\u6570\u636e\u5e93/redis"}}');var r=s(74848),t=s(28453);const o={sidebar_position:2,title:"MongoDB - \u7075\u6d3b\u7684\u6587\u6863\u6570\u636e\u5e93"},a="MongoDB - NoSQL\u6587\u6863\u6570\u636e\u5e93",l={},d=[{value:"\u7b2c\u4e00\u90e8\u5206\uff1aMongoDB\u57fa\u7840",id:"\u7b2c\u4e00\u90e8\u5206mongodb\u57fa\u7840",level:2},{value:"\u4e3a\u4ec0\u4e48\u9009\u62e9MongoDB\uff1f",id:"\u4e3a\u4ec0\u4e48\u9009\u62e9mongodb",level:3},{value:"\u5b89\u88c5\u548c\u8fde\u63a5",id:"\u5b89\u88c5\u548c\u8fde\u63a5",level:3},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"\u7b2c\u4e8c\u90e8\u5206\uff1aCRUD\u64cd\u4f5c",id:"\u7b2c\u4e8c\u90e8\u5206crud\u64cd\u4f5c",level:2},{value:"\u63d2\u5165\u6587\u6863",id:"\u63d2\u5165\u6587\u6863",level:3},{value:"\u67e5\u8be2\u6587\u6863",id:"\u67e5\u8be2\u6587\u6863",level:3},{value:"\u66f4\u65b0\u6587\u6863",id:"\u66f4\u65b0\u6587\u6863",level:3},{value:"\u5220\u9664\u6587\u6863",id:"\u5220\u9664\u6587\u6863",level:3},{value:"\u7b2c\u4e09\u90e8\u5206\uff1a\u805a\u5408\u7ba1\u9053",id:"\u7b2c\u4e09\u90e8\u5206\u805a\u5408\u7ba1\u9053",level:2},{value:"\u805a\u5408\u57fa\u7840",id:"\u805a\u5408\u57fa\u7840",level:3},{value:"\u590d\u6742\u805a\u5408\u793a\u4f8b",id:"\u590d\u6742\u805a\u5408\u793a\u4f8b",level:3},{value:"\u7b2c\u56db\u90e8\u5206\uff1a\u7d22\u5f15\u4f18\u5316",id:"\u7b2c\u56db\u90e8\u5206\u7d22\u5f15\u4f18\u5316",level:2},{value:"\u521b\u5efa\u7d22\u5f15",id:"\u521b\u5efa\u7d22\u5f15",level:3},{value:"\u67e5\u8be2\u6027\u80fd\u5206\u6790",id:"\u67e5\u8be2\u6027\u80fd\u5206\u6790",level:3},{value:"\u7b2c\u4e94\u90e8\u5206\uff1a\u6570\u636e\u5efa\u6a21",id:"\u7b2c\u4e94\u90e8\u5206\u6570\u636e\u5efa\u6a21",level:2},{value:"\u5d4c\u5165\u5f0f\u6587\u6863 vs \u5f15\u7528",id:"\u5d4c\u5165\u5f0f\u6587\u6863-vs-\u5f15\u7528",level:3},{value:"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee",id:"\u7b2c\u516d\u90e8\u5206\u5b9e\u6218\u9879\u76ee",level:2},{value:"\u9879\u76ee\uff1a\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf",id:"\u9879\u76ee\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf",level:3},{value:"\u7b2c\u4e03\u90e8\u5206\uff1a\u9ad8\u7ea7\u7279\u6027",id:"\u7b2c\u4e03\u90e8\u5206\u9ad8\u7ea7\u7279\u6027",level:2},{value:"\u4e8b\u52a1\uff08MongoDB 4.0+\uff09",id:"\u4e8b\u52a1mongodb-40",level:3},{value:"\u53d8\u66f4\u6d41\uff08Change Streams\uff09",id:"\u53d8\u66f4\u6d41change-streams",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u7ec3\u4e60\u9898",id:"\u7ec3\u4e60\u9898",level:2}];function c(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"mongodb---nosql\u6587\u6863\u6570\u636e\u5e93",children:"MongoDB - NoSQL\u6587\u6863\u6570\u636e\u5e93"})}),"\n",(0,r.jsxs)(e.p,{children:["MongoDB\u662f\u6700\u6d41\u884c\u7684NoSQL\u6587\u6863\u6570\u636e\u5e93\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60",(0,r.jsx)(e.strong,{children:"\u7528MongoDB\u6784\u5efa\u7075\u6d3b\u7684\u5e94\u7528"}),"\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e00\u90e8\u5206mongodb\u57fa\u7840",children:"\u7b2c\u4e00\u90e8\u5206\uff1aMongoDB\u57fa\u7840"}),"\n",(0,r.jsx)(e.h3,{id:"\u4e3a\u4ec0\u4e48\u9009\u62e9mongodb",children:"\u4e3a\u4ec0\u4e48\u9009\u62e9MongoDB\uff1f"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u75db\u70b9"}),"\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \u9700\u6c42\u53d8\u66f4\uff1a\u7528\u6237\u8868\u8981\u52a0\u4e2a\u7231\u597d\u5b57\u6bb5\nALTER TABLE users ADD COLUMN hobbies TEXT;\n-- \u95ee\u9898\uff1a\u6240\u6709\u65e7\u6570\u636e\u90fd\u8981\u66f4\u65b0\uff0c\u8868\u7ed3\u6784\u56fa\u5b9a\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"MongoDB\u7684\u4f18\u52bf"}),"\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:'// \u7075\u6d3b\u7684schema\uff0c\u6bcf\u4e2a\u6587\u6863\u53ef\u4ee5\u4e0d\u540c\ndb.users.insertOne({\n    name: "Alice",\n    age: 25,\n    hobbies: ["reading", "coding"]  // \u6570\u7ec4\u5b57\u6bb5\n});\n\ndb.users.insertOne({\n    name: "Bob",\n    age: 30\n    // \u6ca1\u6709hobbies\u5b57\u6bb5\u4e5f\u53ef\u4ee5\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5b89\u88c5\u548c\u8fde\u63a5",children:"\u5b89\u88c5\u548c\u8fde\u63a5"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Docker\u65b9\u5f0f"}),"\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8MongoDB\ndocker run -d --name mongodb \\\n  -p 27017:27017 \\\n  mongo:latest\n\n# \u8fdb\u5165MongoDB Shell\ndocker exec -it mongodb mongosh\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Python\u8fde\u63a5"}),"\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from pymongo import MongoClient\n\n# \u8fde\u63a5MongoDB\nclient = MongoClient('mongodb://localhost:27017/')\n\n# \u9009\u62e9\u6570\u636e\u5e93\ndb = client['ecommerce']\n\n# \u9009\u62e9\u96c6\u5408\uff08\u76f8\u5f53\u4e8e\u8868\uff09\nusers = db['users']\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"MySQL          MongoDB\n\u6570\u636e\u5e93         \u6570\u636e\u5e93\n\u8868             \u96c6\u5408\uff08Collection\uff09\n\u884c             \u6587\u6863\uff08Document\uff09\n\u5217             \u5b57\u6bb5\uff08Field\uff09\n\u7d22\u5f15           \u7d22\u5f15\n\u8868\u8fde\u63a5         \u5d4c\u5165\u6587\u6863\u6216\u5f15\u7528\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e8c\u90e8\u5206crud\u64cd\u4f5c",children:"\u7b2c\u4e8c\u90e8\u5206\uff1aCRUD\u64cd\u4f5c"}),"\n",(0,r.jsx)(e.h3,{id:"\u63d2\u5165\u6587\u6863",children:"\u63d2\u5165\u6587\u6863"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pymongo import MongoClient\nfrom datetime import datetime\n\nclient = MongoClient(\'mongodb://localhost:27017/\')\ndb = client[\'ecommerce\']\nusers = db[\'users\']\n\n# \u63d2\u5165\u5355\u4e2a\u6587\u6863\nuser = {\n    "username": "alice",\n    "email": "alice@example.com",\n    "age": 25,\n    "gender": "F",\n    "hobbies": ["reading", "coding"],\n    "address": {\n        "city": "Beijing",\n        "street": "Chaoyang Road"\n    },\n    "created_at": datetime.now()\n}\nresult = users.insert_one(user)\nprint(f"\u63d2\u5165\u7684ID: {result.inserted_id}")\n\n# \u63d2\u5165\u591a\u4e2a\u6587\u6863\nusers_list = [\n    {"username": "bob", "age": 30, "gender": "M"},\n    {"username": "charlie", "age": 28, "gender": "M"},\n    {"username": "diana", "age": 26, "gender": "F"}\n]\nresult = users.insert_many(users_list)\nprint(f"\u63d2\u5165\u7684IDs: {result.inserted_ids}")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u67e5\u8be2\u6587\u6863",children:"\u67e5\u8be2\u6587\u6863"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u67e5\u8be2\u6240\u6709\u6587\u6863\nfor user in users.find():\n    print(user)\n\n# \u6761\u4ef6\u67e5\u8be2\n# \u7b49\u4e8e\nfor user in users.find({"age": 25}):\n    print(user)\n\n# \u5927\u4e8e\nfor user in users.find({"age": {"$gt": 25}}):\n    print(user)\n\n# \u8303\u56f4\u67e5\u8be2\nfor user in users.find({"age": {"$gte": 20, "$lte": 30}}):\n    print(user)\n\n# IN\u67e5\u8be2\nfor user in users.find({"username": {"$in": ["alice", "bob"]}}):\n    print(user)\n\n# \u6b63\u5219\u8868\u8fbe\u5f0f\nfor user in users.find({"username": {"$regex": "^a"}}):\n    print(user)\n\n# AND\u67e5\u8be2\nfor user in users.find({"age": {"$gt": 25}, "gender": "F"}):\n    print(user)\n\n# OR\u67e5\u8be2\nfor user in users.find({"$or": [{"age": {"$lt": 20}}, {"age": {"$gt": 30}}]}):\n    print(user)\n\n# \u5d4c\u5957\u6587\u6863\u67e5\u8be2\nfor user in users.find({"address.city": "Beijing"}):\n    print(user)\n\n# \u6570\u7ec4\u67e5\u8be2\nfor user in users.find({"hobbies": "coding"}):\n    print(user)\n\n# \u6570\u7ec4\u5305\u542b\u6240\u6709\u5143\u7d20\nfor user in users.find({"hobbies": {"$all": ["reading", "coding"]}}):\n    print(user)\n\n# \u6295\u5f71\uff08\u53ea\u8fd4\u56de\u6307\u5b9a\u5b57\u6bb5\uff09\nfor user in users.find({}, {"username": 1, "age": 1, "_id": 0}):\n    print(user)\n\n# \u6392\u5e8f\nfor user in users.find().sort("age", -1):  # -1\u964d\u5e8f\uff0c1\u5347\u5e8f\n    print(user)\n\n# \u9650\u5236\u7ed3\u679c\nfor user in users.find().limit(10):\n    print(user)\n\n# \u8df3\u8fc7\u7ed3\u679c\uff08\u5206\u9875\uff09\nfor user in users.find().skip(10).limit(10):\n    print(user)\n\n# \u8ba1\u6570\ncount = users.count_documents({"age": {"$gt": 25}})\nprint(f"\u5e74\u9f84\u5927\u4e8e25\u7684\u7528\u6237\u6570: {count}")\n\n# \u67e5\u8be2\u5355\u4e2a\u6587\u6863\nuser = users.find_one({"username": "alice"})\nprint(user)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u66f4\u65b0\u6587\u6863",children:"\u66f4\u65b0\u6587\u6863"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u66f4\u65b0\u5355\u4e2a\u6587\u6863\nusers.update_one(\n    {"username": "alice"},\n    {"$set": {"age": 26}}\n)\n\n# \u66f4\u65b0\u591a\u4e2a\u6587\u6863\nusers.update_many(\n    {"gender": "M"},\n    {"$set": {"updated": True}}\n)\n\n# \u589e\u52a0\u6570\u503c\nusers.update_one(\n    {"username": "alice"},\n    {"$inc": {"age": 1}}  # age\u52a01\n)\n\n# \u6570\u7ec4\u64cd\u4f5c\n# \u6dfb\u52a0\u5143\u7d20\nusers.update_one(\n    {"username": "alice"},\n    {"$push": {"hobbies": "swimming"}}\n)\n\n# \u6dfb\u52a0\u591a\u4e2a\u5143\u7d20\nusers.update_one(\n    {"username": "alice"},\n    {"$push": {"hobbies": {"$each": ["gaming", "music"]}}}\n)\n\n# \u5220\u9664\u5143\u7d20\nusers.update_one(\n    {"username": "alice"},\n    {"$pull": {"hobbies": "gaming"}}\n)\n\n# \u66f4\u65b0\u6216\u63d2\u5165\uff08upsert\uff09\nusers.update_one(\n    {"username": "eve"},\n    {"$set": {"age": 22, "gender": "F"}},\n    upsert=True\n)\n\n# \u66ff\u6362\u6574\u4e2a\u6587\u6863\nusers.replace_one(\n    {"username": "alice"},\n    {\n        "username": "alice",\n        "age": 27,\n        "email": "alice@example.com"\n    }\n)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5220\u9664\u6587\u6863",children:"\u5220\u9664\u6587\u6863"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u5220\u9664\u5355\u4e2a\u6587\u6863\nusers.delete_one({"username": "alice"})\n\n# \u5220\u9664\u591a\u4e2a\u6587\u6863\nusers.delete_many({"age": {"$lt": 18}})\n\n# \u5220\u9664\u6240\u6709\u6587\u6863\nusers.delete_many({})\n\n# \u5220\u9664\u96c6\u5408\nusers.drop()\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e09\u90e8\u5206\u805a\u5408\u7ba1\u9053",children:"\u7b2c\u4e09\u90e8\u5206\uff1a\u805a\u5408\u7ba1\u9053"}),"\n",(0,r.jsx)(e.h3,{id:"\u805a\u5408\u57fa\u7840",children:"\u805a\u5408\u57fa\u7840"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u805a\u5408\u7ba1\u9053\uff1a\u7c7b\u4f3c\u4e8eSQL\u7684GROUP BY\npipeline = [\n    # $match\uff1a\u8fc7\u6ee4\u6587\u6863\uff08WHERE\uff09\n    {"$match": {"age": {"$gte": 20}}},\n    \n    # $group\uff1a\u5206\u7ec4\u805a\u5408\uff08GROUP BY\uff09\n    {"$group": {\n        "_id": "$gender",\n        "count": {"$sum": 1},\n        "avg_age": {"$avg": "$age"},\n        "max_age": {"$max": "$age"},\n        "min_age": {"$min": "$age"}\n    }},\n    \n    # $sort\uff1a\u6392\u5e8f\uff08ORDER BY\uff09\n    {"$sort": {"count": -1}},\n    \n    # $limit\uff1a\u9650\u5236\u7ed3\u679c\n    {"$limit": 10}\n]\n\nresult = users.aggregate(pipeline)\nfor doc in result:\n    print(doc)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u590d\u6742\u805a\u5408\u793a\u4f8b",children:"\u590d\u6742\u805a\u5408\u793a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u521b\u5efa\u8ba2\u5355\u96c6\u5408\norders = db[\'orders\']\n\n# \u63d2\u5165\u6d4b\u8bd5\u6570\u636e\norders.insert_many([\n    {\n        "user_id": "user1",\n        "items": [\n            {"product": "laptop", "price": 1000, "quantity": 1},\n            {"product": "mouse", "price": 20, "quantity": 2}\n        ],\n        "total": 1040,\n        "status": "completed",\n        "created_at": datetime(2024, 1, 1)\n    },\n    {\n        "user_id": "user1",\n        "items": [\n            {"product": "keyboard", "price": 50, "quantity": 1}\n        ],\n        "total": 50,\n        "status": "completed",\n        "created_at": datetime(2024, 1, 15)\n    },\n    {\n        "user_id": "user2",\n        "items": [\n            {"product": "laptop", "price": 1000, "quantity": 1}\n        ],\n        "total": 1000,\n        "status": "pending",\n        "created_at": datetime(2024, 1, 10)\n    }\n])\n\n# \u7528\u6237\u8ba2\u5355\u7edf\u8ba1\npipeline = [\n    {"$match": {"status": "completed"}},\n    {"$group": {\n        "_id": "$user_id",\n        "order_count": {"$sum": 1},\n        "total_amount": {"$sum": "$total"},\n        "avg_amount": {"$avg": "$total"}\n    }},\n    {"$sort": {"total_amount": -1}}\n]\n\nfor doc in orders.aggregate(pipeline):\n    print(doc)\n\n# \u5546\u54c1\u9500\u552e\u7edf\u8ba1\npipeline = [\n    {"$match": {"status": "completed"}},\n    {"$unwind": "$items"},  # \u5c55\u5f00\u6570\u7ec4\n    {"$group": {\n        "_id": "$items.product",\n        "total_quantity": {"$sum": "$items.quantity"},\n        "total_revenue": {"$sum": {"$multiply": ["$items.price", "$items.quantity"]}}\n    }},\n    {"$sort": {"total_revenue": -1}}\n]\n\nfor doc in orders.aggregate(pipeline):\n    print(doc)\n\n# \u6309\u6708\u7edf\u8ba1\u9500\u552e\u989d\npipeline = [\n    {"$match": {"status": "completed"}},\n    {"$group": {\n        "_id": {\n            "year": {"$year": "$created_at"},\n            "month": {"$month": "$created_at"}\n        },\n        "total_sales": {"$sum": "$total"},\n        "order_count": {"$sum": 1}\n    }},\n    {"$sort": {"_id.year": 1, "_id.month": 1}}\n]\n\nfor doc in orders.aggregate(pipeline):\n    print(doc)\n\n# $lookup\uff1a\u5173\u8054\u67e5\u8be2\uff08\u7c7b\u4f3cJOIN\uff09\npipeline = [\n    {"$lookup": {\n        "from": "users",\n        "localField": "user_id",\n        "foreignField": "_id",\n        "as": "user_info"\n    }},\n    {"$unwind": "$user_info"},\n    {"$project": {\n        "order_id": "$_id",\n        "username": "$user_info.username",\n        "total": 1,\n        "status": 1\n    }}\n]\n\nfor doc in orders.aggregate(pipeline):\n    print(doc)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u56db\u90e8\u5206\u7d22\u5f15\u4f18\u5316",children:"\u7b2c\u56db\u90e8\u5206\uff1a\u7d22\u5f15\u4f18\u5316"}),"\n",(0,r.jsx)(e.h3,{id:"\u521b\u5efa\u7d22\u5f15",children:"\u521b\u5efa\u7d22\u5f15"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u5355\u5b57\u6bb5\u7d22\u5f15\nusers.create_index("username")\n\n# \u590d\u5408\u7d22\u5f15\nusers.create_index([("age", 1), ("gender", 1)])  # 1\u5347\u5e8f\uff0c-1\u964d\u5e8f\n\n# \u552f\u4e00\u7d22\u5f15\nusers.create_index("email", unique=True)\n\n# \u6587\u672c\u7d22\u5f15\uff08\u5168\u6587\u641c\u7d22\uff09\nusers.create_index([("bio", "text")])\n\n# \u5730\u7406\u7a7a\u95f4\u7d22\u5f15\nlocations = db[\'locations\']\nlocations.create_index([("location", "2dsphere")])\n\n# \u67e5\u770b\u7d22\u5f15\nfor index in users.list_indexes():\n    print(index)\n\n# \u5220\u9664\u7d22\u5f15\nusers.drop_index("username_1")\n\n# \u5220\u9664\u6240\u6709\u7d22\u5f15\nusers.drop_indexes()\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u67e5\u8be2\u6027\u80fd\u5206\u6790",children:"\u67e5\u8be2\u6027\u80fd\u5206\u6790"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u67e5\u770b\u6267\u884c\u8ba1\u5212\nexplain = users.find({"age": {"$gt": 25}}).explain()\nprint(explain)\n\n# \u67e5\u770b\u6267\u884c\u7edf\u8ba1\nexplain = users.find({"age": {"$gt": 25}}).explain("executionStats")\nprint(f"\u626b\u63cf\u6587\u6863\u6570: {explain[\'executionStats\'][\'totalDocsExamined\']}")\nprint(f"\u8fd4\u56de\u6587\u6863\u6570: {explain[\'executionStats\'][\'nReturned\']}")\nprint(f"\u6267\u884c\u65f6\u95f4: {explain[\'executionStats\'][\'executionTimeMillis\']}ms")\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e94\u90e8\u5206\u6570\u636e\u5efa\u6a21",children:"\u7b2c\u4e94\u90e8\u5206\uff1a\u6570\u636e\u5efa\u6a21"}),"\n",(0,r.jsx)(e.h3,{id:"\u5d4c\u5165\u5f0f\u6587\u6863-vs-\u5f15\u7528",children:"\u5d4c\u5165\u5f0f\u6587\u6863 vs \u5f15\u7528"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u5d4c\u5165\u5f0f\u6587\u6863"}),"\uff08\u9002\u5408\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u5c11\uff09\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u7528\u6237\u548c\u5730\u5740\uff08\u4e00\u5bf9\u4e00\uff09\nuser = {\n    "username": "alice",\n    "email": "alice@example.com",\n    "address": {\n        "city": "Beijing",\n        "street": "Chaoyang Road",\n        "zipcode": "100000"\n    }\n}\nusers.insert_one(user)\n\n# \u535a\u5ba2\u6587\u7ae0\u548c\u8bc4\u8bba\uff08\u4e00\u5bf9\u5c11\uff09\npost = {\n    "title": "MongoDB Tutorial",\n    "content": "...",\n    "comments": [\n        {"user": "bob", "text": "Great post!", "date": datetime.now()},\n        {"user": "charlie", "text": "Thanks!", "date": datetime.now()}\n    ]\n}\nposts = db[\'posts\']\nposts.insert_one(post)\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u5f15\u7528"}),"\uff08\u9002\u5408\u4e00\u5bf9\u591a\u3001\u591a\u5bf9\u591a\uff09\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'# \u7528\u6237\u548c\u8ba2\u5355\uff08\u4e00\u5bf9\u591a\uff09\nuser = {\n    "_id": "user1",\n    "username": "alice"\n}\nusers.insert_one(user)\n\norder = {\n    "user_id": "user1",  # \u5f15\u7528\u7528\u6237ID\n    "total": 100,\n    "items": [...]\n}\norders.insert_one(order)\n\n# \u67e5\u8be2\u65f6\u9700\u8981\u624b\u52a8\u5173\u8054\nuser = users.find_one({"_id": "user1"})\nuser_orders = list(orders.find({"user_id": user["_id"]}))\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u516d\u90e8\u5206\u5b9e\u6218\u9879\u76ee",children:"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee"}),"\n",(0,r.jsx)(e.h3,{id:"\u9879\u76ee\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf",children:"\u9879\u76ee\uff1a\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pymongo import MongoClient\nfrom datetime import datetime\nfrom bson import ObjectId\n\nclass CMS:\n    """\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf"""\n    \n    def __init__(self):\n        self.client = MongoClient(\'mongodb://localhost:27017/\')\n        self.db = self.client[\'cms\']\n        self.articles = self.db[\'articles\']\n        self.users = self.db[\'users\']\n        self.comments = self.db[\'comments\']\n        \n        # \u521b\u5efa\u7d22\u5f15\n        self.articles.create_index("title")\n        self.articles.create_index([("content", "text")])\n        self.articles.create_index("author_id")\n        self.articles.create_index("created_at")\n    \n    def create_article(self, title, content, author_id, tags=None):\n        """\u521b\u5efa\u6587\u7ae0"""\n        article = {\n            "title": title,\n            "content": content,\n            "author_id": author_id,\n            "tags": tags or [],\n            "views": 0,\n            "likes": 0,\n            "created_at": datetime.now(),\n            "updated_at": datetime.now()\n        }\n        result = self.articles.insert_one(article)\n        return result.inserted_id\n    \n    def get_article(self, article_id):\n        """\u83b7\u53d6\u6587\u7ae0"""\n        # \u589e\u52a0\u6d4f\u89c8\u91cf\n        self.articles.update_one(\n            {"_id": ObjectId(article_id)},\n            {"$inc": {"views": 1}}\n        )\n        \n        article = self.articles.find_one({"_id": ObjectId(article_id)})\n        \n        # \u83b7\u53d6\u4f5c\u8005\u4fe1\u606f\n        if article:\n            author = self.users.find_one({"_id": article["author_id"]})\n            article["author"] = author\n            \n            # \u83b7\u53d6\u8bc4\u8bba\n            comments = list(self.comments.find({"article_id": article_id}))\n            article["comments"] = comments\n        \n        return article\n    \n    def search_articles(self, keyword):\n        """\u5168\u6587\u641c\u7d22"""\n        return list(self.articles.find(\n            {"$text": {"$search": keyword}},\n            {"score": {"$meta": "textScore"}}\n        ).sort([("score", {"$meta": "textScore"})]))\n    \n    def get_popular_articles(self, limit=10):\n        """\u83b7\u53d6\u70ed\u95e8\u6587\u7ae0"""\n        return list(self.articles.find().sort("views", -1).limit(limit))\n    \n    def get_articles_by_tag(self, tag):\n        """\u6309\u6807\u7b7e\u67e5\u8be2"""\n        return list(self.articles.find({"tags": tag}))\n    \n    def add_comment(self, article_id, user_id, content):\n        """\u6dfb\u52a0\u8bc4\u8bba"""\n        comment = {\n            "article_id": article_id,\n            "user_id": user_id,\n            "content": content,\n            "created_at": datetime.now()\n        }\n        return self.comments.insert_one(comment).inserted_id\n    \n    def like_article(self, article_id):\n        """\u70b9\u8d5e\u6587\u7ae0"""\n        self.articles.update_one(\n            {"_id": ObjectId(article_id)},\n            {"$inc": {"likes": 1}}\n        )\n    \n    def get_user_articles(self, user_id):\n        """\u83b7\u53d6\u7528\u6237\u7684\u6240\u6709\u6587\u7ae0"""\n        return list(self.articles.find({"author_id": user_id}).sort("created_at", -1))\n    \n    def get_statistics(self):\n        """\u7edf\u8ba1\u4fe1\u606f"""\n        pipeline = [\n            {"$group": {\n                "_id": None,\n                "total_articles": {"$sum": 1},\n                "total_views": {"$sum": "$views"},\n                "total_likes": {"$sum": "$likes"},\n                "avg_views": {"$avg": "$views"}\n            }}\n        ]\n        return list(self.articles.aggregate(pipeline))[0]\n\n# \u4f7f\u7528\u793a\u4f8b\ncms = CMS()\n\n# \u521b\u5efa\u7528\u6237\nuser_id = cms.users.insert_one({\n    "username": "alice",\n    "email": "alice@example.com"\n}).inserted_id\n\n# \u521b\u5efa\u6587\u7ae0\narticle_id = cms.create_article(\n    title="MongoDB\u5165\u95e8\u6559\u7a0b",\n    content="MongoDB\u662f\u4e00\u4e2a\u5f3a\u5927\u7684NoSQL\u6570\u636e\u5e93...",\n    author_id=user_id,\n    tags=["mongodb", "database", "nosql"]\n)\n\n# \u83b7\u53d6\u6587\u7ae0\narticle = cms.get_article(str(article_id))\nprint(f"\u6587\u7ae0\u6807\u9898: {article[\'title\']}")\nprint(f"\u6d4f\u89c8\u91cf: {article[\'views\']}")\n\n# \u641c\u7d22\u6587\u7ae0\nresults = cms.search_articles("MongoDB")\nprint(f"\u641c\u7d22\u7ed3\u679c: {len(results)}\u7bc7")\n\n# \u6dfb\u52a0\u8bc4\u8bba\ncms.add_comment(str(article_id), user_id, "\u5f88\u597d\u7684\u6559\u7a0b\uff01")\n\n# \u70b9\u8d5e\ncms.like_article(str(article_id))\n\n# \u7edf\u8ba1\u4fe1\u606f\nstats = cms.get_statistics()\nprint(f"\u603b\u6587\u7ae0\u6570: {stats[\'total_articles\']}")\nprint(f"\u603b\u6d4f\u89c8\u91cf: {stats[\'total_views\']}")\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e03\u90e8\u5206\u9ad8\u7ea7\u7279\u6027",children:"\u7b2c\u4e03\u90e8\u5206\uff1a\u9ad8\u7ea7\u7279\u6027"}),"\n",(0,r.jsx)(e.h3,{id:"\u4e8b\u52a1mongodb-40",children:"\u4e8b\u52a1\uff08MongoDB 4.0+\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pymongo import MongoClient\n\nclient = MongoClient(\'mongodb://localhost:27017/\')\ndb = client[\'ecommerce\']\n\n# \u5f00\u59cb\u4e8b\u52a1\nwith client.start_session() as session:\n    with session.start_transaction():\n        try:\n            # \u6263\u51cf\u5e93\u5b58\n            db.products.update_one(\n                {"_id": "product1"},\n                {"$inc": {"stock": -1}},\n                session=session\n            )\n            \n            # \u521b\u5efa\u8ba2\u5355\n            db.orders.insert_one(\n                {"product_id": "product1", "quantity": 1},\n                session=session\n            )\n            \n            # \u63d0\u4ea4\u4e8b\u52a1\n            session.commit_transaction()\n        except Exception as e:\n            # \u56de\u6eda\u4e8b\u52a1\n            session.abort_transaction()\n            print(f"\u4e8b\u52a1\u5931\u8d25: {e}")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u53d8\u66f4\u6d41change-streams",children:"\u53d8\u66f4\u6d41\uff08Change Streams\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u76d1\u542c\u96c6\u5408\u53d8\u5316\nwith users.watch() as stream:\n    for change in stream:\n        print(f\"\u53d8\u66f4\u7c7b\u578b: {change['operationType']}\")\n        print(f\"\u6587\u6863: {change['fullDocument']}\")\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsx)(e.p,{children:"MongoDB\u662f\u7075\u6d3b\u7684NoSQL\u6570\u636e\u5e93\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u7075\u6d3bSchema"}),"\uff1a\u6587\u6863\u53ef\u4ee5\u6709\u4e0d\u540c\u7ed3\u6784"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5f3a\u5927\u67e5\u8be2"}),"\uff1a\u805a\u5408\u7ba1\u9053\u3001\u5168\u6587\u641c\u7d22"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6c34\u5e73\u6269\u5c55"}),"\uff1a\u5206\u7247\u96c6\u7fa4"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u9ad8\u6027\u80fd"}),"\uff1a\u5185\u5b58\u6620\u5c04\u3001\u7d22\u5f15\u4f18\u5316"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u8bb0\u4f4f\uff1a",(0,r.jsx)(e.strong,{children:"MongoDB\u9002\u5408\u5feb\u901f\u8fed\u4ee3\u3001\u7075\u6d3b\u6570\u636e\u7684\u573a\u666f"}),"\uff01"]}),"\n",(0,r.jsx)(e.h2,{id:"\u7ec3\u4e60\u9898",children:"\u7ec3\u4e60\u9898"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u8bbe\u8ba1\u4e00\u4e2a\u793e\u4ea4\u7f51\u7edc\u7684\u6570\u636e\u6a21\u578b"}),"\n",(0,r.jsx)(e.li,{children:"\u5b9e\u73b0\u590d\u6742\u7684\u805a\u5408\u67e5\u8be2"}),"\n",(0,r.jsx)(e.li,{children:"\u4f18\u5316\u67e5\u8be2\u6027\u80fd"}),"\n",(0,r.jsx)(e.li,{children:"\u642d\u5efaMongoDB\u526f\u672c\u96c6"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u4e0b\u4e00\u7ae0\uff1a",(0,r.jsx)(e.a,{href:"/weuqiangcreate_website/docs/%E6%95%B0%E6%8D%AE%E5%BA%93/redis",children:"Redis\u7f13\u5b58\u6570\u636e\u5e93"})]})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},28453(n,e,s){s.d(e,{R:()=>o,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function o(n){const e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);