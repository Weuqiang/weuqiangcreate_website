"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[16807],{42977(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"\u5927\u6570\u636e\u6280\u672f/HBase\u5217\u5f0f\u5b58\u50a8","title":"HBase - \u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2","description":"HBase\u662fHadoop\u751f\u6001\u4e2d\u7684NoSQL\u6570\u636e\u5e93\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60\u7528HBase\u5b9e\u73b0\u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2\u3002","source":"@site/docs/docs/\u5927\u6570\u636e\u6280\u672f/HBase\u5217\u5f0f\u5b58\u50a8.mdx","sourceDirName":"\u5927\u6570\u636e\u6280\u672f","slug":"/\u5927\u6570\u636e\u6280\u672f/HBase\u5217\u5f0f\u5b58\u50a8","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/HBase\u5217\u5f0f\u5b58\u50a8","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"HBase - \u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2"},"sidebar":"tutorialSidebar","previous":{"title":"Hive - SQL on Hadoop","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/Hive\u6570\u636e\u4ed3\u5e93"},"next":{"title":"\u6570\u636e\u4ed3\u5e93\u5b9e\u6218 - \u6784\u5efa\u4f01\u4e1a\u7ea7\u6570\u4ed3","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/\u6570\u636e\u4ed3\u5e93\u5b9e\u6218"}}');var i=t(74848),a=t(28453);const r={sidebar_position:6,title:"HBase - \u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2"},l="HBase - NoSQL\u5217\u5f0f\u6570\u636e\u5e93",o={},c=[{value:"\u7b2c\u4e00\u90e8\u5206\uff1a\u7406\u89e3HBase",id:"\u7b2c\u4e00\u90e8\u5206\u7406\u89e3hbase",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981HBase\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981hbase",level:3},{value:"HBase vs \u4f20\u7edf\u6570\u636e\u5e93",id:"hbase-vs-\u4f20\u7edf\u6570\u636e\u5e93",level:3},{value:"HBase\u6570\u636e\u6a21\u578b",id:"hbase\u6570\u636e\u6a21\u578b",level:3},{value:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u5feb\u901f\u5f00\u59cb",id:"\u7b2c\u4e8c\u90e8\u5206\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u4f7f\u7528Docker\u642d\u5efaHBase",id:"\u4f7f\u7528docker\u642d\u5efahbase",level:3},{value:"HBase Shell\u57fa\u672c\u64cd\u4f5c",id:"hbase-shell\u57fa\u672c\u64cd\u4f5c",level:3},{value:"\u7b2c\u4e09\u90e8\u5206\uff1aPython\u64cd\u4f5cHBase",id:"\u7b2c\u4e09\u90e8\u5206python\u64cd\u4f5chbase",level:2},{value:"\u5b89\u88c5HappyBase",id:"\u5b89\u88c5happybase",level:3},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c",level:3},{value:"\u7b2c\u56db\u90e8\u5206\uff1aRowKey\u8bbe\u8ba1",id:"\u7b2c\u56db\u90e8\u5206rowkey\u8bbe\u8ba1",level:2},{value:"RowKey\u8bbe\u8ba1\u539f\u5219",id:"rowkey\u8bbe\u8ba1\u539f\u5219",level:3},{value:"\u5b9e\u6218\uff1a\u8bbe\u8ba1\u7528\u6237\u884c\u4e3a\u8868",id:"\u5b9e\u6218\u8bbe\u8ba1\u7528\u6237\u884c\u4e3a\u8868",level:3},{value:"\u7b2c\u4e94\u90e8\u5206\uff1a\u8fc7\u6ee4\u5668",id:"\u7b2c\u4e94\u90e8\u5206\u8fc7\u6ee4\u5668",level:2},{value:"\u5e38\u7528\u8fc7\u6ee4\u5668",id:"\u5e38\u7528\u8fc7\u6ee4\u5668",level:3},{value:"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee",id:"\u7b2c\u516d\u90e8\u5206\u5b9e\u6218\u9879\u76ee",level:2},{value:"\u9879\u76ee1\uff1a\u5b9e\u65f6\u7528\u6237\u753b\u50cf\u7cfb\u7edf",id:"\u9879\u76ee1\u5b9e\u65f6\u7528\u6237\u753b\u50cf\u7cfb\u7edf",level:3},{value:"\u9879\u76ee2\uff1a\u65f6\u5e8f\u6570\u636e\u5b58\u50a8",id:"\u9879\u76ee2\u65f6\u5e8f\u6570\u636e\u5b58\u50a8",level:3},{value:"\u7b2c\u4e03\u90e8\u5206\uff1a\u6027\u80fd\u4f18\u5316",id:"\u7b2c\u4e03\u90e8\u5206\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u9884\u5206\u533a",id:"1-\u9884\u5206\u533a",level:3},{value:"2. \u6279\u91cf\u64cd\u4f5c",id:"2-\u6279\u91cf\u64cd\u4f5c",level:3},{value:"3. \u5e03\u9686\u8fc7\u6ee4\u5668",id:"3-\u5e03\u9686\u8fc7\u6ee4\u5668",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u7ec3\u4e60\u9898",id:"\u7ec3\u4e60\u9898",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hbase---nosql\u5217\u5f0f\u6570\u636e\u5e93",children:"HBase - NoSQL\u5217\u5f0f\u6570\u636e\u5e93"})}),"\n",(0,i.jsxs)(n.p,{children:["HBase\u662fHadoop\u751f\u6001\u4e2d\u7684NoSQL\u6570\u636e\u5e93\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60",(0,i.jsx)(n.strong,{children:"\u7528HBase\u5b9e\u73b0\u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2"}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e00\u90e8\u5206\u7406\u89e3hbase",children:"\u7b2c\u4e00\u90e8\u5206\uff1a\u7406\u89e3HBase"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981hbase",children:"\u4e3a\u4ec0\u4e48\u9700\u8981HBase\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95ee\u9898"}),"\uff1a\u670910\u4ebf\u6761\u7528\u6237\u6570\u636e\uff0c\u9700\u8981\u6839\u636e\u7528\u6237ID\u5feb\u901f\u67e5\u8be2\uff0cHive\u592a\u6162\u600e\u4e48\u529e\uff1f"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hive\u65b9\u5f0f"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u5168\u8868\u626b\u63cf\uff0c\u6162\uff01\nSELECT * FROM users WHERE user_id = 'user123';\n-- \u8017\u65f6\uff1a\u51e0\u5206\u949f\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"HBase\u65b9\u5f0f"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u6839\u636eRowKey\u76f4\u63a5\u5b9a\u4f4d\uff0c\u5feb\uff01\ntable.get('user123')\n# \u8017\u65f6\uff1a\u51e0\u6beb\u79d2\n"})}),"\n",(0,i.jsx)(n.h3,{id:"hbase-vs-\u4f20\u7edf\u6570\u636e\u5e93",children:"HBase vs \u4f20\u7edf\u6570\u636e\u5e93"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u7279\u6027"}),(0,i.jsx)(n.th,{children:"\u4f20\u7edf\u6570\u636e\u5e93"}),(0,i.jsx)(n.th,{children:"HBase"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u6570\u636e\u91cf"}),(0,i.jsx)(n.td,{children:"GB-TB"}),(0,i.jsx)(n.td,{children:"PB\u7ea7"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u67e5\u8be2\u65b9\u5f0f"}),(0,i.jsx)(n.td,{children:"SQL"}),(0,i.jsx)(n.td,{children:"Key-Value"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u4e8b\u52a1"}),(0,i.jsx)(n.td,{children:"ACID"}),(0,i.jsx)(n.td,{children:"\u884c\u7ea7\u539f\u5b50\u6027"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u6269\u5c55\u6027"}),(0,i.jsx)(n.td,{children:"\u5782\u76f4\u6269\u5c55"}),(0,i.jsx)(n.td,{children:"\u6c34\u5e73\u6269\u5c55"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5ef6\u8fdf"}),(0,i.jsx)(n.td,{children:"\u6beb\u79d2\u7ea7"}),(0,i.jsx)(n.td,{children:"\u6beb\u79d2\u7ea7"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"hbase\u6570\u636e\u6a21\u578b",children:"HBase\u6570\u636e\u6a21\u578b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Table: users\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  RowKey     \u2502  Column Family: info             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 user001     \u2502 name:Alice  age:25  city:Beijing \u2502\n\u2502 user002     \u2502 name:Bob    age:30  city:Shanghai\u2502\n\u2502 user003     \u2502 name:Charlie age:35 city:Shenzhen\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6838\u5fc3\u6982\u5ff5"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RowKey"}),"\uff1a\u884c\u952e\uff0c\u552f\u4e00\u6807\u8bc6\u4e00\u884c\uff0c\u6309\u5b57\u5178\u5e8f\u6392\u5e8f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Column Family"}),"\uff1a\u5217\u65cf\uff0c\u5217\u7684\u96c6\u5408"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Column"}),"\uff1a\u5217\uff0c\u683c\u5f0f\u4e3a ",(0,i.jsx)(n.code,{children:"family:qualifier"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timestamp"}),"\uff1a\u65f6\u95f4\u6233\uff0c\u652f\u6301\u591a\u7248\u672c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cell"}),"\uff1a\u5355\u5143\u683c\uff0c\u7531 ",(0,i.jsx)(n.code,{children:"{row, column, timestamp}"})," \u552f\u4e00\u786e\u5b9a"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e8c\u90e8\u5206\u5feb\u901f\u5f00\u59cb",children:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u5feb\u901f\u5f00\u59cb"}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528docker\u642d\u5efahbase",children:"\u4f7f\u7528Docker\u642d\u5efaHBase"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.yml\nversion: \'3\'\nservices:\n  hbase:\n    image: harisekhon/hbase:1.4\n    ports:\n      - "16010:16010"  # HBase Master Web UI\n      - "9090:9090"    # Thrift\n      - "9095:9095"    # REST\n      - "2181:2181"    # Zookeeper\n    environment:\n      - HBASE_CONF_hbase_rootdir=file:///hbase-data\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542f\u52a8\ndocker-compose up -d\n\n# \u8fdb\u5165HBase Shell\ndocker exec -it hbase hbase shell\n\n# \u8bbf\u95eeWeb UI\n# http://localhost:16010\n"})}),"\n",(0,i.jsx)(n.h3,{id:"hbase-shell\u57fa\u672c\u64cd\u4f5c",children:"HBase Shell\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u521b\u5efa\u8868\ncreate 'users', 'info', 'contact'\n\n# \u67e5\u770b\u8868\nlist\n\n# \u67e5\u770b\u8868\u7ed3\u6784\ndescribe 'users'\n\n# \u63d2\u5165\u6570\u636e\nput 'users', 'user001', 'info:name', 'Alice'\nput 'users', 'user001', 'info:age', '25'\nput 'users', 'user001', 'contact:email', 'alice@example.com'\n\n# \u67e5\u8be2\u6570\u636e\nget 'users', 'user001'\n\n# \u626b\u63cf\u8868\nscan 'users'\n\n# \u5220\u9664\u6570\u636e\ndelete 'users', 'user001', 'info:age'\n\n# \u5220\u9664\u884c\ndeleteall 'users', 'user001'\n\n# \u5220\u9664\u8868\ndisable 'users'\ndrop 'users'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e09\u90e8\u5206python\u64cd\u4f5chbase",children:"\u7b2c\u4e09\u90e8\u5206\uff1aPython\u64cd\u4f5cHBase"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u88c5happybase",children:"\u5b89\u88c5HappyBase"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install happybase\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u57fa\u672c\u64cd\u4f5c",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import happybase\n\n# \u8fde\u63a5HBase\nconnection = happybase.Connection('localhost', port=9090)\n\n# \u521b\u5efa\u8868\nconnection.create_table(\n    'users',\n    {\n        'info': dict(),\n        'contact': dict()\n    }\n)\n\n# \u83b7\u53d6\u8868\ntable = connection.table('users')\n\n# \u63d2\u5165\u6570\u636e\ntable.put('user001', {\n    b'info:name': b'Alice',\n    b'info:age': b'25',\n    b'info:city': b'Beijing',\n    b'contact:email': b'alice@example.com',\n    b'contact:phone': b'13800138000'\n})\n\n# \u6279\u91cf\u63d2\u5165\nwith table.batch() as batch:\n    for i in range(1000):\n        batch.put(f'user{i:06d}', {\n            b'info:name': f'User{i}'.encode(),\n            b'info:age': str(20 + i % 50).encode()\n        })\n\n# \u67e5\u8be2\u5355\u884c\nrow = table.row('user001')\nprint(row)\n# {b'info:name': b'Alice', b'info:age': b'25', ...}\n\n# \u67e5\u8be2\u6307\u5b9a\u5217\nrow = table.row('user001', columns=[b'info:name', b'info:age'])\n\n# \u626b\u63cf\u8868\nfor key, data in table.scan():\n    print(key, data)\n\n# \u5e26\u8fc7\u6ee4\u7684\u626b\u63cf\nfor key, data in table.scan(row_start='user000', row_stop='user100'):\n    print(key, data)\n\n# \u5220\u9664\u6570\u636e\ntable.delete('user001', columns=[b'info:age'])\n\n# \u5220\u9664\u884c\ntable.delete('user001')\n\n# \u5173\u95ed\u8fde\u63a5\nconnection.close()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u56db\u90e8\u5206rowkey\u8bbe\u8ba1",children:"\u7b2c\u56db\u90e8\u5206\uff1aRowKey\u8bbe\u8ba1"}),"\n",(0,i.jsx)(n.h3,{id:"rowkey\u8bbe\u8ba1\u539f\u5219",children:"RowKey\u8bbe\u8ba1\u539f\u5219"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1. \u552f\u4e00\u6027"}),"\uff1aRowKey\u5fc5\u987b\u552f\u4e00\u6807\u8bc6\u4e00\u884c"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"2. \u6563\u5217\u6027"}),"\uff1a\u907f\u514d\u70ed\u70b9\u95ee\u9898"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u274c \u574f\u7684\u8bbe\u8ba1\uff1a\u65f6\u95f4\u6233\u5f00\u5934\nrowkey = f"{timestamp}_{user_id}"\n# \u95ee\u9898\uff1a\u65b0\u6570\u636e\u90fd\u5199\u5165\u540c\u4e00\u4e2aRegion\uff0c\u70ed\u70b9\uff01\n\n# \u2705 \u597d\u7684\u8bbe\u8ba1\uff1a\u52a0\u76d0\u6216\u53cd\u8f6c\nimport hashlib\n\ndef generate_rowkey(user_id, timestamp):\n    # \u65b9\u6cd51\uff1a\u52a0\u76d0\uff08\u53d6hash\u524d\u7f00\uff09\n    salt = hashlib.md5(user_id.encode()).hexdigest()[:4]\n    return f"{salt}_{timestamp}_{user_id}"\n    \n    # \u65b9\u6cd52\uff1a\u53cd\u8f6c\u65f6\u95f4\u6233\n    reversed_ts = str(9999999999 - timestamp)\n    return f"{user_id}_{reversed_ts}"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"3. \u67e5\u8be2\u53cb\u597d"}),"\uff1a\u6839\u636e\u67e5\u8be2\u6a21\u5f0f\u8bbe\u8ba1"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u573a\u666f\uff1a\u7ecf\u5e38\u6309\u7528\u6237ID\u67e5\u8be2\nrowkey = user_id\n\n# \u573a\u666f\uff1a\u7ecf\u5e38\u6309\u7528\u6237ID+\u65f6\u95f4\u8303\u56f4\u67e5\u8be2\nrowkey = f"{user_id}_{timestamp}"\n\n# \u573a\u666f\uff1a\u7ecf\u5e38\u6309\u5730\u533a+\u65f6\u95f4\u67e5\u8be2\nrowkey = f"{region}_{timestamp}_{user_id}"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9e\u6218\u8bbe\u8ba1\u7528\u6237\u884c\u4e3a\u8868",children:"\u5b9e\u6218\uff1a\u8bbe\u8ba1\u7528\u6237\u884c\u4e3a\u8868"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import happybase\nimport time\nimport hashlib\n\nclass UserBehaviorTable:\n    \"\"\"\u7528\u6237\u884c\u4e3a\u8868\"\"\"\n    \n    def __init__(self, host='localhost'):\n        self.connection = happybase.Connection(host, port=9090)\n        self.table_name = 'user_behavior'\n        self._create_table()\n    \n    def _create_table(self):\n        \"\"\"\u521b\u5efa\u8868\"\"\"\n        if self.table_name.encode() not in self.connection.tables():\n            self.connection.create_table(\n                self.table_name,\n                {\n                    'action': dict(),  # \u884c\u4e3a\u4fe1\u606f\n                    'item': dict(),    # \u5546\u54c1\u4fe1\u606f\n                    'context': dict()  # \u4e0a\u4e0b\u6587\u4fe1\u606f\n                }\n            )\n    \n    def generate_rowkey(self, user_id, timestamp):\n        \"\"\"\u751f\u6210RowKey\uff1auser_id + \u53cd\u8f6c\u65f6\u95f4\u6233\"\"\"\n        # \u53cd\u8f6c\u65f6\u95f4\u6233\uff0c\u4f7f\u6700\u65b0\u6570\u636e\u5728\u524d\n        reversed_ts = 9999999999 - int(timestamp)\n        return f\"{user_id}_{reversed_ts:010d}\"\n    \n    def put_behavior(self, user_id, action, item_id, **kwargs):\n        \"\"\"\u8bb0\u5f55\u7528\u6237\u884c\u4e3a\"\"\"\n        table = self.connection.table(self.table_name)\n        \n        timestamp = int(time.time())\n        rowkey = self.generate_rowkey(user_id, timestamp)\n        \n        data = {\n            b'action:type': action.encode(),\n            b'action:timestamp': str(timestamp).encode(),\n            b'item:id': item_id.encode(),\n        }\n        \n        # \u6dfb\u52a0\u989d\u5916\u4fe1\u606f\n        for key, value in kwargs.items():\n            data[f'context:{key}'.encode()] = str(value).encode()\n        \n        table.put(rowkey, data)\n    \n    def get_user_behaviors(self, user_id, limit=100):\n        \"\"\"\u83b7\u53d6\u7528\u6237\u6700\u8fd1\u7684\u884c\u4e3a\"\"\"\n        table = self.connection.table(self.table_name)\n        \n        # \u626b\u63cf\u8be5\u7528\u6237\u7684\u6240\u6709\u884c\u4e3a\n        row_start = f\"{user_id}_\"\n        row_stop = f\"{user_id}_~\"\n        \n        behaviors = []\n        for key, data in table.scan(row_start=row_start, row_stop=row_stop, limit=limit):\n            behavior = {\n                'rowkey': key.decode(),\n                'action': data.get(b'action:type', b'').decode(),\n                'timestamp': data.get(b'action:timestamp', b'').decode(),\n                'item_id': data.get(b'item:id', b'').decode()\n            }\n            behaviors.append(behavior)\n        \n        return behaviors\n\n# \u4f7f\u7528\nbehavior_table = UserBehaviorTable()\n\n# \u8bb0\u5f55\u884c\u4e3a\nbehavior_table.put_behavior('user001', 'view', 'item123', page='home')\nbehavior_table.put_behavior('user001', 'click', 'item123', page='detail')\nbehavior_table.put_behavior('user001', 'cart', 'item123')\n\n# \u67e5\u8be2\u884c\u4e3a\nbehaviors = behavior_table.get_user_behaviors('user001')\nfor b in behaviors:\n    print(b)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e94\u90e8\u5206\u8fc7\u6ee4\u5668",children:"\u7b2c\u4e94\u90e8\u5206\uff1a\u8fc7\u6ee4\u5668"}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u7528\u8fc7\u6ee4\u5668",children:"\u5e38\u7528\u8fc7\u6ee4\u5668"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import happybase\n\nconnection = happybase.Connection('localhost', port=9090)\ntable = connection.table('users')\n\n# 1. \u884c\u952e\u8fc7\u6ee4\u5668\n# \u524d\u7f00\u8fc7\u6ee4\nfor key, data in table.scan(row_prefix=b'user00'):\n    print(key, data)\n\n# 2. \u5217\u8fc7\u6ee4\u5668\n# \u53ea\u8fd4\u56de\u6307\u5b9a\u5217\u65cf\nfor key, data in table.scan(columns=[b'info']):\n    print(key, data)\n\n# 3. \u503c\u8fc7\u6ee4\u5668\uff08\u9700\u8981\u4f7f\u7528Thrift2\uff09\n# \u8fd9\u91cc\u5c55\u793a\u6982\u5ff5\nfilter_string = \"SingleColumnValueFilter('info', 'age', >=, 'binary:25')\"\n\n# 4. \u65f6\u95f4\u8303\u56f4\u8fc7\u6ee4\n# \u67e5\u8be2\u6307\u5b9a\u65f6\u95f4\u8303\u56f4\u7684\u6570\u636e\nimport time\nnow = int(time.time() * 1000)\none_day_ago = now - 86400000\n\nfor key, data in table.scan(timestamp=one_day_ago):\n    print(key, data)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u516d\u90e8\u5206\u5b9e\u6218\u9879\u76ee",children:"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee"}),"\n",(0,i.jsx)(n.h3,{id:"\u9879\u76ee1\u5b9e\u65f6\u7528\u6237\u753b\u50cf\u7cfb\u7edf",children:"\u9879\u76ee1\uff1a\u5b9e\u65f6\u7528\u6237\u753b\u50cf\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import happybase\nimport json\nfrom datetime import datetime\n\nclass UserProfileSystem:\n    \"\"\"\u7528\u6237\u753b\u50cf\u7cfb\u7edf\"\"\"\n    \n    def __init__(self, host='localhost'):\n        self.connection = happybase.Connection(host, port=9090)\n        self.table_name = 'user_profile'\n        self._create_table()\n    \n    def _create_table(self):\n        \"\"\"\u521b\u5efa\u7528\u6237\u753b\u50cf\u8868\"\"\"\n        if self.table_name.encode() not in self.connection.tables():\n            self.connection.create_table(\n                self.table_name,\n                {\n                    'basic': dict(),      # \u57fa\u672c\u4fe1\u606f\n                    'behavior': dict(),   # \u884c\u4e3a\u7edf\u8ba1\n                    'preference': dict(), # \u504f\u597d\u6807\u7b7e\n                    'stats': dict()       # \u7edf\u8ba1\u4fe1\u606f\n                }\n            )\n    \n    def update_profile(self, user_id, **kwargs):\n        \"\"\"\u66f4\u65b0\u7528\u6237\u753b\u50cf\"\"\"\n        table = self.connection.table(self.table_name)\n        \n        data = {}\n        for key, value in kwargs.items():\n            family, qualifier = key.split('_', 1)\n            data[f'{family}:{qualifier}'.encode()] = str(value).encode()\n        \n        table.put(user_id, data)\n    \n    def get_profile(self, user_id):\n        \"\"\"\u83b7\u53d6\u7528\u6237\u753b\u50cf\"\"\"\n        table = self.connection.table(self.table_name)\n        row = table.row(user_id)\n        \n        profile = {}\n        for key, value in row.items():\n            key_str = key.decode()\n            profile[key_str] = value.decode()\n        \n        return profile\n    \n    def update_behavior_stats(self, user_id, action, item_category):\n        \"\"\"\u66f4\u65b0\u884c\u4e3a\u7edf\u8ba1\"\"\"\n        table = self.connection.table(self.table_name)\n        \n        # \u83b7\u53d6\u5f53\u524d\u7edf\u8ba1\n        row = table.row(user_id)\n        \n        # \u66f4\u65b0\u6d4f\u89c8\u6b21\u6570\n        view_count_key = b'behavior:view_count'\n        view_count = int(row.get(view_count_key, b'0'))\n        \n        # \u66f4\u65b0\u7c7b\u522b\u504f\u597d\n        category_key = f'preference:{item_category}'.encode()\n        category_count = int(row.get(category_key, b'0'))\n        \n        # \u5199\u56de\n        table.put(user_id, {\n            view_count_key: str(view_count + 1).encode(),\n            category_key: str(category_count + 1).encode(),\n            b'stats:last_active': datetime.now().isoformat().encode()\n        })\n    \n    def get_top_preferences(self, user_id, top_n=5):\n        \"\"\"\u83b7\u53d6\u7528\u6237Top\u504f\u597d\"\"\"\n        table = self.connection.table(self.table_name)\n        row = table.row(user_id, columns=[b'preference'])\n        \n        preferences = {}\n        for key, value in row.items():\n            category = key.decode().split(':')[1]\n            count = int(value.decode())\n            preferences[category] = count\n        \n        # \u6392\u5e8f\n        sorted_prefs = sorted(preferences.items(), key=lambda x: x[1], reverse=True)\n        return sorted_prefs[:top_n]\n\n# \u4f7f\u7528\nprofile_system = UserProfileSystem()\n\n# \u66f4\u65b0\u57fa\u672c\u4fe1\u606f\nprofile_system.update_profile(\n    'user001',\n    basic_name='Alice',\n    basic_age='25',\n    basic_city='Beijing'\n)\n\n# \u66f4\u65b0\u884c\u4e3a\u7edf\u8ba1\nprofile_system.update_behavior_stats('user001', 'view', 'electronics')\nprofile_system.update_behavior_stats('user001', 'view', 'electronics')\nprofile_system.update_behavior_stats('user001', 'view', 'books')\n\n# \u83b7\u53d6\u7528\u6237\u753b\u50cf\nprofile = profile_system.get_profile('user001')\nprint(\"\u7528\u6237\u753b\u50cf:\", profile)\n\n# \u83b7\u53d6\u504f\u597d\npreferences = profile_system.get_top_preferences('user001')\nprint(\"Top\u504f\u597d:\", preferences)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u9879\u76ee2\u65f6\u5e8f\u6570\u636e\u5b58\u50a8",children:"\u9879\u76ee2\uff1a\u65f6\u5e8f\u6570\u636e\u5b58\u50a8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import happybase\nimport time\nfrom datetime import datetime\n\nclass TimeSeriesDB:\n    """\u65f6\u5e8f\u6570\u636e\u5e93"""\n    \n    def __init__(self, host=\'localhost\'):\n        self.connection = happybase.Connection(host, port=9090)\n        self.table_name = \'metrics\'\n        self._create_table()\n    \n    def _create_table(self):\n        """\u521b\u5efa\u65f6\u5e8f\u8868"""\n        if self.table_name.encode() not in self.connection.tables():\n            self.connection.create_table(\n                self.table_name,\n                {\n                    \'data\': dict(max_versions=100)  # \u4fdd\u7559100\u4e2a\u7248\u672c\n                }\n            )\n    \n    def generate_rowkey(self, metric_name, timestamp):\n        """\u751f\u6210RowKey\uff1ametric_name + \u65f6\u95f4\u6876"""\n        # \u6309\u5c0f\u65f6\u5206\u6876\n        hour_bucket = int(timestamp / 3600) * 3600\n        return f"{metric_name}_{hour_bucket}"\n    \n    def put_metric(self, metric_name, value, timestamp=None):\n        """\u5199\u5165\u6307\u6807"""\n        if timestamp is None:\n            timestamp = int(time.time())\n        \n        table = self.connection.table(self.table_name)\n        rowkey = self.generate_rowkey(metric_name, timestamp)\n        \n        # \u4f7f\u7528timestamp\u4f5c\u4e3a\u5217\u540d\n        table.put(rowkey, {\n            f\'data:{timestamp}\'.encode(): str(value).encode()\n        })\n    \n    def get_metrics(self, metric_name, start_time, end_time):\n        """\u67e5\u8be2\u6307\u6807"""\n        table = self.connection.table(self.table_name)\n        \n        # \u8ba1\u7b97\u65f6\u95f4\u6876\u8303\u56f4\n        start_bucket = int(start_time / 3600) * 3600\n        end_bucket = int(end_time / 3600) * 3600\n        \n        metrics = []\n        \n        # \u626b\u63cf\u6240\u6709\u76f8\u5173\u7684\u65f6\u95f4\u6876\n        for bucket in range(start_bucket, end_bucket + 3600, 3600):\n            rowkey = f"{metric_name}_{bucket}"\n            \n            try:\n                row = table.row(rowkey)\n                for key, value in row.items():\n                    timestamp = int(key.decode().split(\':\')[1])\n                    if start_time <= timestamp <= end_time:\n                        metrics.append({\n                            \'timestamp\': timestamp,\n                            \'value\': float(value.decode())\n                        })\n            except:\n                continue\n        \n        # \u6309\u65f6\u95f4\u6392\u5e8f\n        metrics.sort(key=lambda x: x[\'timestamp\'])\n        return metrics\n\n# \u4f7f\u7528\ntsdb = TimeSeriesDB()\n\n# \u5199\u5165CPU\u4f7f\u7528\u7387\nfor i in range(100):\n    tsdb.put_metric(\'cpu_usage\', 50 + i % 30, int(time.time()) - 100 + i)\n\n# \u67e5\u8be2\u6700\u8fd1100\u79d2\u7684\u6570\u636e\nstart = int(time.time()) - 100\nend = int(time.time())\nmetrics = tsdb.get_metrics(\'cpu_usage\', start, end)\n\nprint(f"\u67e5\u8be2\u5230 {len(metrics)} \u4e2a\u6570\u636e\u70b9")\nfor m in metrics[:5]:\n    print(f"\u65f6\u95f4: {datetime.fromtimestamp(m[\'timestamp\'])}, \u503c: {m[\'value\']}")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e03\u90e8\u5206\u6027\u80fd\u4f18\u5316",children:"\u7b2c\u4e03\u90e8\u5206\uff1a\u6027\u80fd\u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u9884\u5206\u533a",children:"1. \u9884\u5206\u533a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u521b\u5efa\u8868\u65f6\u9884\u5206\u533a\nconnection.create_table(\n    'users',\n    {'info': dict()},\n    split_keys=[b'user100', b'user200', b'user300']\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u6279\u91cf\u64cd\u4f5c",children:"2. \u6279\u91cf\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u6279\u91cf\u5199\u5165\nwith table.batch(batch_size=1000) as batch:\n    for i in range(10000):\n        batch.put(f'key{i}', {b'cf:col': b'value'})\n\n# \u6279\u91cf\u8bfb\u53d6\nrows = table.rows([b'key1', b'key2', b'key3'])\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u5e03\u9686\u8fc7\u6ee4\u5668",children:"3. \u5e03\u9686\u8fc7\u6ee4\u5668"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u521b\u5efa\u8868\u65f6\u542f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\nconnection.create_table(\n    'users',\n    {\n        'info': dict(bloom_filter_type='ROW')\n    }\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(n.p,{children:"HBase\u662f\u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2\u5229\u5668\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6beb\u79d2\u7ea7\u67e5\u8be2"}),"\uff1a\u6839\u636eRowKey\u5feb\u901f\u5b9a\u4f4d"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6c34\u5e73\u6269\u5c55"}),"\uff1aPB\u7ea7\u6570\u636e\u5b58\u50a8"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5217\u5f0f\u5b58\u50a8"}),"\uff1a\u7075\u6d3b\u7684schema"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u591a\u7248\u672c"}),"\uff1a\u652f\u6301\u65f6\u5e8f\u6570\u636e"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8bb0\u4f4f\uff1a",(0,i.jsx)(n.strong,{children:"HBase\u9002\u5408\u5927\u91cf\u5199\u5165\u3001\u6309Key\u67e5\u8be2\u7684\u573a\u666f"}),"\uff01"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7ec3\u4e60\u9898",children:"\u7ec3\u4e60\u9898"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u8bbe\u8ba1\u4e00\u4e2a\u7269\u8054\u7f51\u6570\u636e\u5b58\u50a8\u65b9\u6848"}),"\n",(0,i.jsx)(n.li,{children:"\u5b9e\u73b0\u5206\u5e03\u5f0f\u8ba1\u6570\u5668"}),"\n",(0,i.jsx)(n.li,{children:"\u4f18\u5316\u70ed\u70b9\u95ee\u9898"}),"\n",(0,i.jsx)(n.li,{children:"\u5b9e\u73b0\u4e8c\u7ea7\u7d22\u5f15"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u4e0b\u4e00\u7ae0\uff1a\u6570\u636e\u4ed3\u5e93\u5b9e\u6218\uff08\u5373\u5c06\u63a8\u51fa\uff09"})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>l});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);