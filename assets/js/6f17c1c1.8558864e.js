"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[85459],{66007(n,e,r){r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>_});const s=JSON.parse('{"id":"\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/18\u7f51\u7edc\u7f16\u7a0b","title":"\u7f51\u7edc\u7f16\u7a0b","description":"\u6982\u8ff0","source":"@site/docs/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/18\u7f51\u7edc\u7f16\u7a0b.mdx","sourceDirName":"\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C","slug":"/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/18\u7f51\u7edc\u7f16\u7a0b","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/18\u7f51\u7edc\u7f16\u7a0b","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"\u7f51\u7edc\u7f16\u7a0b"},"sidebar":"tutorialSidebar","previous":{"title":"\u5e76\u53d1\u6267\u884c","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/17\u5e76\u53d1\u6267\u884c"},"next":{"title":"\uff08\u7f16\u5199\u4e2d\uff09\ud83d\udc0fPython\u4e0eC\u4e92\u4ea4\u4e92","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/19Python\u4e0eC\u4e92\u4ea4\u4e92"}}');var d=r(74848),i=r(28453);const t={sidebar_position:18,title:"\u7f51\u7edc\u7f16\u7a0b"},c="\u7f51\u7edc\u7f16\u7a0b",l={},_=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"Socket\u57fa\u7840",id:"socket\u57fa\u7840",level:2},{value:"Socket\u7c7b\u578b",id:"socket\u7c7b\u578b",level:3},{value:"\u7f51\u7edc\u5b57\u8282\u5e8f",id:"\u7f51\u7edc\u5b57\u8282\u5e8f",level:3},{value:"IP\u5730\u5740\u8f6c\u6362",id:"ip\u5730\u5740\u8f6c\u6362",level:3},{value:"TCP\u7f16\u7a0b",id:"tcp\u7f16\u7a0b",level:2},{value:"TCP\u670d\u52a1\u5668",id:"tcp\u670d\u52a1\u5668",level:3},{value:"TCP\u5ba2\u6237\u7aef",id:"tcp\u5ba2\u6237\u7aef",level:3},{value:"\u591a\u5ba2\u6237\u7aef\u5e76\u53d1\u670d\u52a1\u5668\uff08\u591a\u7ebf\u7a0b\uff09",id:"\u591a\u5ba2\u6237\u7aef\u5e76\u53d1\u670d\u52a1\u5668\u591a\u7ebf\u7a0b",level:3},{value:"UDP\u7f16\u7a0b",id:"udp\u7f16\u7a0b",level:2},{value:"UDP\u670d\u52a1\u5668",id:"udp\u670d\u52a1\u5668",level:3},{value:"UDP\u5ba2\u6237\u7aef",id:"udp\u5ba2\u6237\u7aef",level:3},{value:"I/O\u591a\u8def\u590d\u7528",id:"io\u591a\u8def\u590d\u7528",level:2},{value:"select",id:"select",level:3},{value:"epoll\uff08Linux\uff09",id:"epolllinux",level:3},{value:"HTTP\u670d\u52a1\u5668\u793a\u4f8b",id:"http\u670d\u52a1\u5668\u793a\u4f8b",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u8d85\u65f6\u8bbe\u7f6e",id:"\u8d85\u65f6\u8bbe\u7f6e",level:3},{value:"\u4f18\u96c5\u5173\u95ed",id:"\u4f18\u96c5\u5173\u95ed",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"1. Address already in use",id:"1-address-already-in-use",level:3},{value:"2. Broken pipe",id:"2-broken-pipe",level:3},{value:"3. \u7c98\u5305\u95ee\u9898",id:"3-\u7c98\u5305\u95ee\u9898",level:3},{value:"\u7f16\u8bd1\u548c\u8fd0\u884c",id:"\u7f16\u8bd1\u548c\u8fd0\u884c",level:2},{value:"\u76f8\u5173\u8d44\u6e90",id:"\u76f8\u5173\u8d44\u6e90",level:2}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"\u7f51\u7edc\u7f16\u7a0b",children:"\u7f51\u7edc\u7f16\u7a0b"})}),"\n",(0,d.jsx)(e.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,d.jsx)(e.p,{children:"\u7f51\u7edc\u7f16\u7a0b\u662f\u6307\u901a\u8fc7\u8ba1\u7b97\u673a\u7f51\u7edc\u8fdb\u884c\u6570\u636e\u901a\u4fe1\u7684\u7a0b\u5e8f\u8bbe\u8ba1\u3002\u5728C\u8bed\u8a00\u4e2d\uff0c\u4e3b\u8981\u901a\u8fc7Socket API\u6765\u5b9e\u73b0\u7f51\u7edc\u901a\u4fe1\u3002"}),"\n",(0,d.jsx)(e.p,{children:"Socket\uff08\u5957\u63a5\u5b57\uff09\u662f\u7f51\u7edc\u901a\u4fe1\u7684\u7aef\u70b9\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u7684\u673a\u5236\uff0c\u4f7f\u5f97\u4e0d\u540c\u4e3b\u673a\u4e0a\u7684\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"socket\u57fa\u7840",children:"Socket\u57fa\u7840"}),"\n",(0,d.jsx)(e.h3,{id:"socket\u7c7b\u578b",children:"Socket\u7c7b\u578b"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6d41\u5f0fSocket\uff08SOCK_STREAM\uff09"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u57fa\u4e8eTCP\u534f\u8bae"}),"\n",(0,d.jsx)(e.li,{children:"\u9762\u5411\u8fde\u63a5"}),"\n",(0,d.jsx)(e.li,{children:"\u53ef\u9760\u7684\u3001\u6709\u5e8f\u7684\u3001\u53cc\u5411\u7684\u5b57\u8282\u6d41\u4f20\u8f93"}),"\n",(0,d.jsx)(e.li,{children:"\u9002\u7528\u4e8e\u9700\u8981\u53ef\u9760\u4f20\u8f93\u7684\u573a\u666f"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6570\u636e\u62a5Socket\uff08SOCK_DGRAM\uff09"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u57fa\u4e8eUDP\u534f\u8bae"}),"\n",(0,d.jsx)(e.li,{children:"\u65e0\u8fde\u63a5"}),"\n",(0,d.jsx)(e.li,{children:"\u4e0d\u53ef\u9760\u7684\u6570\u636e\u62a5\u4f20\u8f93"}),"\n",(0,d.jsx)(e.li,{children:"\u9002\u7528\u4e8e\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u7684\u573a\u666f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u7f51\u7edc\u5b57\u8282\u5e8f",children:"\u7f51\u7edc\u5b57\u8282\u5e8f"}),"\n",(0,d.jsx)(e.p,{children:"\u7f51\u7edc\u4f20\u8f93\u4f7f\u7528\u5927\u7aef\u5b57\u8282\u5e8f\uff08Big-Endian\uff09\uff0c\u800c\u4e3b\u673a\u53ef\u80fd\u4f7f\u7528\u5c0f\u7aef\u5b57\u8282\u5e8f\uff08Little-Endian\uff09\u3002\u9700\u8981\u4f7f\u7528\u8f6c\u6362\u51fd\u6570\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:"#include <arpa/inet.h>\n\n// \u4e3b\u673a\u5b57\u8282\u5e8f\u8f6c\u7f51\u7edc\u5b57\u8282\u5e8f\nuint32_t htonl(uint32_t hostlong);    // 32\u4f4d\nuint16_t htons(uint16_t hostshort);   // 16\u4f4d\n\n// \u7f51\u7edc\u5b57\u8282\u5e8f\u8f6c\u4e3b\u673a\u5b57\u8282\u5e8f\nuint32_t ntohl(uint32_t netlong);     // 32\u4f4d\nuint16_t ntohs(uint16_t netshort);    // 16\u4f4d\n"})}),"\n",(0,d.jsx)(e.h3,{id:"ip\u5730\u5740\u8f6c\u6362",children:"IP\u5730\u5740\u8f6c\u6362"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <arpa/inet.h>\n\n// \u5b57\u7b26\u4e32IP\u8f6c\u4e8c\u8fdb\u5236\nint inet_pton(int af, const char *src, void *dst);\n\n// \u4e8c\u8fdb\u5236IP\u8f6c\u5b57\u7b26\u4e32\nconst char *inet_ntop(int af, const void *src, char *dst, socklen_t size);\n\n// \u793a\u4f8b\nstruct sockaddr_in addr;\ninet_pton(AF_INET, "192.168.1.1", &addr.sin_addr);\n\nchar ip_str[INET_ADDRSTRLEN];\ninet_ntop(AF_INET, &addr.sin_addr, ip_str, INET_ADDRSTRLEN);\n'})}),"\n",(0,d.jsx)(e.h2,{id:"tcp\u7f16\u7a0b",children:"TCP\u7f16\u7a0b"}),"\n",(0,d.jsx)(e.h3,{id:"tcp\u670d\u52a1\u5668",children:"TCP\u670d\u52a1\u5668"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define PORT 8080\n#define BUFFER_SIZE 1024\n\nint main() {\n    int server_fd, client_fd;\n    struct sockaddr_in server_addr, client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    char buffer[BUFFER_SIZE];\n    \n    // 1. \u521b\u5efasocket\n    server_fd = socket(AF_INET, SOCK_STREAM, 0);\n    if (server_fd < 0) {\n        perror("socket\u521b\u5efa\u5931\u8d25");\n        exit(EXIT_FAILURE);\n    }\n    \n    // \u8bbe\u7f6esocket\u9009\u9879\uff0c\u5141\u8bb8\u5730\u5740\u91cd\u7528\n    int opt = 1;\n    setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n    \n    // 2. \u7ed1\u5b9a\u5730\u5740\u548c\u7aef\u53e3\n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = INADDR_ANY;  // \u76d1\u542c\u6240\u6709\u7f51\u5361\n    server_addr.sin_port = htons(PORT);\n    \n    if (bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {\n        perror("bind\u5931\u8d25");\n        close(server_fd);\n        exit(EXIT_FAILURE);\n    }\n    \n    // 3. \u76d1\u542c\n    if (listen(server_fd, 5) < 0) {\n        perror("listen\u5931\u8d25");\n        close(server_fd);\n        exit(EXIT_FAILURE);\n    }\n    \n    printf("\u670d\u52a1\u5668\u542f\u52a8\uff0c\u76d1\u542c\u7aef\u53e3 %d...\\n", PORT);\n    \n    // 4. \u63a5\u53d7\u8fde\u63a5\n    while (1) {\n        client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_len);\n        if (client_fd < 0) {\n            perror("accept\u5931\u8d25");\n            continue;\n        }\n        \n        char client_ip[INET_ADDRSTRLEN];\n        inet_ntop(AF_INET, &client_addr.sin_addr, client_ip, INET_ADDRSTRLEN);\n        printf("\u5ba2\u6237\u7aef\u8fde\u63a5: %s:%d\\n", client_ip, ntohs(client_addr.sin_port));\n        \n        // 5. \u63a5\u6536\u548c\u53d1\u9001\u6570\u636e\n        memset(buffer, 0, BUFFER_SIZE);\n        int bytes_read = recv(client_fd, buffer, BUFFER_SIZE - 1, 0);\n        if (bytes_read > 0) {\n            printf("\u6536\u5230\u6d88\u606f: %s\\n", buffer);\n            \n            // \u56de\u663e\u6d88\u606f\n            send(client_fd, buffer, bytes_read, 0);\n        }\n        \n        // 6. \u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5\n        close(client_fd);\n    }\n    \n    // 7. \u5173\u95ed\u670d\u52a1\u5668socket\n    close(server_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"tcp\u5ba2\u6237\u7aef",children:"TCP\u5ba2\u6237\u7aef"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define SERVER_IP "127.0.0.1"\n#define PORT 8080\n#define BUFFER_SIZE 1024\n\nint main() {\n    int sock_fd;\n    struct sockaddr_in server_addr;\n    char buffer[BUFFER_SIZE];\n    \n    // 1. \u521b\u5efasocket\n    sock_fd = socket(AF_INET, SOCK_STREAM, 0);\n    if (sock_fd < 0) {\n        perror("socket\u521b\u5efa\u5931\u8d25");\n        exit(EXIT_FAILURE);\n    }\n    \n    // 2. \u8bbe\u7f6e\u670d\u52a1\u5668\u5730\u5740\n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(PORT);\n    inet_pton(AF_INET, SERVER_IP, &server_addr.sin_addr);\n    \n    // 3. \u8fde\u63a5\u670d\u52a1\u5668\n    if (connect(sock_fd, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {\n        perror("\u8fde\u63a5\u5931\u8d25");\n        close(sock_fd);\n        exit(EXIT_FAILURE);\n    }\n    \n    printf("\u5df2\u8fde\u63a5\u5230\u670d\u52a1\u5668 %s:%d\\n", SERVER_IP, PORT);\n    \n    // 4. \u53d1\u9001\u6570\u636e\n    const char* message = "Hello, Server!";\n    send(sock_fd, message, strlen(message), 0);\n    printf("\u53d1\u9001\u6d88\u606f: %s\\n", message);\n    \n    // 5. \u63a5\u6536\u6570\u636e\n    memset(buffer, 0, BUFFER_SIZE);\n    int bytes_read = recv(sock_fd, buffer, BUFFER_SIZE - 1, 0);\n    if (bytes_read > 0) {\n        printf("\u6536\u5230\u56de\u590d: %s\\n", buffer);\n    }\n    \n    // 6. \u5173\u95ed\u8fde\u63a5\n    close(sock_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u591a\u5ba2\u6237\u7aef\u5e76\u53d1\u670d\u52a1\u5668\u591a\u7ebf\u7a0b",children:"\u591a\u5ba2\u6237\u7aef\u5e76\u53d1\u670d\u52a1\u5668\uff08\u591a\u7ebf\u7a0b\uff09"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define PORT 8080\n#define BUFFER_SIZE 1024\n\nvoid* handle_client(void* arg) {\n    int client_fd = *(int*)arg;\n    free(arg);\n    \n    char buffer[BUFFER_SIZE];\n    \n    while (1) {\n        memset(buffer, 0, BUFFER_SIZE);\n        int bytes_read = recv(client_fd, buffer, BUFFER_SIZE - 1, 0);\n        \n        if (bytes_read <= 0) {\n            printf("\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\\n");\n            break;\n        }\n        \n        printf("\u6536\u5230\u6d88\u606f: %s\\n", buffer);\n        \n        // \u56de\u663e\u6d88\u606f\n        send(client_fd, buffer, bytes_read, 0);\n    }\n    \n    close(client_fd);\n    return NULL;\n}\n\nint main() {\n    int server_fd;\n    struct sockaddr_in server_addr, client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    \n    // \u521b\u5efasocket\n    server_fd = socket(AF_INET, SOCK_STREAM, 0);\n    if (server_fd < 0) {\n        perror("socket\u521b\u5efa\u5931\u8d25");\n        exit(EXIT_FAILURE);\n    }\n    \n    int opt = 1;\n    setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n    \n    // \u7ed1\u5b9a\n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = INADDR_ANY;\n    server_addr.sin_port = htons(PORT);\n    \n    if (bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {\n        perror("bind\u5931\u8d25");\n        close(server_fd);\n        exit(EXIT_FAILURE);\n    }\n    \n    // \u76d1\u542c\n    if (listen(server_fd, 10) < 0) {\n        perror("listen\u5931\u8d25");\n        close(server_fd);\n        exit(EXIT_FAILURE);\n    }\n    \n    printf("\u670d\u52a1\u5668\u542f\u52a8\uff0c\u76d1\u542c\u7aef\u53e3 %d...\\n", PORT);\n    \n    // \u63a5\u53d7\u8fde\u63a5\n    while (1) {\n        int* client_fd = malloc(sizeof(int));\n        *client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_len);\n        \n        if (*client_fd < 0) {\n            perror("accept\u5931\u8d25");\n            free(client_fd);\n            continue;\n        }\n        \n        char client_ip[INET_ADDRSTRLEN];\n        inet_ntop(AF_INET, &client_addr.sin_addr, client_ip, INET_ADDRSTRLEN);\n        printf("\u65b0\u5ba2\u6237\u7aef\u8fde\u63a5: %s:%d\\n", client_ip, ntohs(client_addr.sin_port));\n        \n        // \u521b\u5efa\u7ebf\u7a0b\u5904\u7406\u5ba2\u6237\u7aef\n        pthread_t thread;\n        pthread_create(&thread, NULL, handle_client, client_fd);\n        pthread_detach(thread);  // \u5206\u79bb\u7ebf\u7a0b\uff0c\u81ea\u52a8\u56de\u6536\u8d44\u6e90\n    }\n    \n    close(server_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"udp\u7f16\u7a0b",children:"UDP\u7f16\u7a0b"}),"\n",(0,d.jsx)(e.h3,{id:"udp\u670d\u52a1\u5668",children:"UDP\u670d\u52a1\u5668"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define PORT 8080\n#define BUFFER_SIZE 1024\n\nint main() {\n    int sock_fd;\n    struct sockaddr_in server_addr, client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    char buffer[BUFFER_SIZE];\n    \n    // 1. \u521b\u5efasocket\n    sock_fd = socket(AF_INET, SOCK_DGRAM, 0);\n    if (sock_fd < 0) {\n        perror("socket\u521b\u5efa\u5931\u8d25");\n        exit(EXIT_FAILURE);\n    }\n    \n    // 2. \u7ed1\u5b9a\u5730\u5740\u548c\u7aef\u53e3\n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = INADDR_ANY;\n    server_addr.sin_port = htons(PORT);\n    \n    if (bind(sock_fd, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {\n        perror("bind\u5931\u8d25");\n        close(sock_fd);\n        exit(EXIT_FAILURE);\n    }\n    \n    printf("UDP\u670d\u52a1\u5668\u542f\u52a8\uff0c\u76d1\u542c\u7aef\u53e3 %d...\\n", PORT);\n    \n    // 3. \u63a5\u6536\u548c\u53d1\u9001\u6570\u636e\n    while (1) {\n        memset(buffer, 0, BUFFER_SIZE);\n        \n        int bytes_read = recvfrom(sock_fd, buffer, BUFFER_SIZE - 1, 0,\n                                  (struct sockaddr*)&client_addr, &client_len);\n        \n        if (bytes_read > 0) {\n            char client_ip[INET_ADDRSTRLEN];\n            inet_ntop(AF_INET, &client_addr.sin_addr, client_ip, INET_ADDRSTRLEN);\n            printf("\u6536\u5230\u6765\u81ea %s:%d \u7684\u6d88\u606f: %s\\n", \n                   client_ip, ntohs(client_addr.sin_port), buffer);\n            \n            // \u56de\u663e\u6d88\u606f\n            sendto(sock_fd, buffer, bytes_read, 0,\n                   (struct sockaddr*)&client_addr, client_len);\n        }\n    }\n    \n    close(sock_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"udp\u5ba2\u6237\u7aef",children:"UDP\u5ba2\u6237\u7aef"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define SERVER_IP "127.0.0.1"\n#define PORT 8080\n#define BUFFER_SIZE 1024\n\nint main() {\n    int sock_fd;\n    struct sockaddr_in server_addr;\n    char buffer[BUFFER_SIZE];\n    \n    // 1. \u521b\u5efasocket\n    sock_fd = socket(AF_INET, SOCK_DGRAM, 0);\n    if (sock_fd < 0) {\n        perror("socket\u521b\u5efa\u5931\u8d25");\n        exit(EXIT_FAILURE);\n    }\n    \n    // 2. \u8bbe\u7f6e\u670d\u52a1\u5668\u5730\u5740\n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(PORT);\n    inet_pton(AF_INET, SERVER_IP, &server_addr.sin_addr);\n    \n    // 3. \u53d1\u9001\u6570\u636e\n    const char* message = "Hello, UDP Server!";\n    sendto(sock_fd, message, strlen(message), 0,\n           (struct sockaddr*)&server_addr, sizeof(server_addr));\n    printf("\u53d1\u9001\u6d88\u606f: %s\\n", message);\n    \n    // 4. \u63a5\u6536\u6570\u636e\n    memset(buffer, 0, BUFFER_SIZE);\n    socklen_t server_len = sizeof(server_addr);\n    int bytes_read = recvfrom(sock_fd, buffer, BUFFER_SIZE - 1, 0,\n                              (struct sockaddr*)&server_addr, &server_len);\n    \n    if (bytes_read > 0) {\n        printf("\u6536\u5230\u56de\u590d: %s\\n", buffer);\n    }\n    \n    close(sock_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"io\u591a\u8def\u590d\u7528",children:"I/O\u591a\u8def\u590d\u7528"}),"\n",(0,d.jsx)(e.h3,{id:"select",children:"select"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/select.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define PORT 8080\n#define BUFFER_SIZE 1024\n#define MAX_CLIENTS 10\n\nint main() {\n    int server_fd, client_fds[MAX_CLIENTS];\n    struct sockaddr_in server_addr, client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    fd_set read_fds;\n    int max_fd, activity;\n    char buffer[BUFFER_SIZE];\n    \n    // \u521d\u59cb\u5316\u5ba2\u6237\u7aef\u6570\u7ec4\n    for (int i = 0; i < MAX_CLIENTS; i++) {\n        client_fds[i] = 0;\n    }\n    \n    // \u521b\u5efa\u670d\u52a1\u5668socket\n    server_fd = socket(AF_INET, SOCK_STREAM, 0);\n    int opt = 1;\n    setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n    \n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = INADDR_ANY;\n    server_addr.sin_port = htons(PORT);\n    \n    bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr));\n    listen(server_fd, 5);\n    \n    printf("\u670d\u52a1\u5668\u542f\u52a8\uff0c\u4f7f\u7528select\u76d1\u542c\u7aef\u53e3 %d...\\n", PORT);\n    \n    while (1) {\n        // \u6e05\u7a7a\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\n        FD_ZERO(&read_fds);\n        \n        // \u6dfb\u52a0\u670d\u52a1\u5668socket\n        FD_SET(server_fd, &read_fds);\n        max_fd = server_fd;\n        \n        // \u6dfb\u52a0\u5ba2\u6237\u7aefsocket\n        for (int i = 0; i < MAX_CLIENTS; i++) {\n            int fd = client_fds[i];\n            if (fd > 0) {\n                FD_SET(fd, &read_fds);\n            }\n            if (fd > max_fd) {\n                max_fd = fd;\n            }\n        }\n        \n        // \u7b49\u5f85\u6d3b\u52a8\n        activity = select(max_fd + 1, &read_fds, NULL, NULL, NULL);\n        \n        if (activity < 0) {\n            perror("select\u9519\u8bef");\n            continue;\n        }\n        \n        // \u68c0\u67e5\u670d\u52a1\u5668socket\uff08\u65b0\u8fde\u63a5\uff09\n        if (FD_ISSET(server_fd, &read_fds)) {\n            int new_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_len);\n            \n            printf("\u65b0\u8fde\u63a5\uff0csocket fd: %d\\n", new_fd);\n            \n            // \u6dfb\u52a0\u5230\u5ba2\u6237\u7aef\u6570\u7ec4\n            for (int i = 0; i < MAX_CLIENTS; i++) {\n                if (client_fds[i] == 0) {\n                    client_fds[i] = new_fd;\n                    break;\n                }\n            }\n        }\n        \n        // \u68c0\u67e5\u5ba2\u6237\u7aefsocket\uff08\u6570\u636e\u5230\u8fbe\uff09\n        for (int i = 0; i < MAX_CLIENTS; i++) {\n            int fd = client_fds[i];\n            \n            if (FD_ISSET(fd, &read_fds)) {\n                memset(buffer, 0, BUFFER_SIZE);\n                int bytes_read = recv(fd, buffer, BUFFER_SIZE - 1, 0);\n                \n                if (bytes_read == 0) {\n                    // \u5ba2\u6237\u7aef\u65ad\u5f00\n                    printf("\u5ba2\u6237\u7aef\u65ad\u5f00\uff0csocket fd: %d\\n", fd);\n                    close(fd);\n                    client_fds[i] = 0;\n                } else {\n                    // \u56de\u663e\u6d88\u606f\n                    printf("\u6536\u5230\u6d88\u606f: %s\\n", buffer);\n                    send(fd, buffer, bytes_read, 0);\n                }\n            }\n        }\n    }\n    \n    close(server_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"epolllinux",children:"epoll\uff08Linux\uff09"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/epoll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <fcntl.h>\n\n#define PORT 8080\n#define BUFFER_SIZE 1024\n#define MAX_EVENTS 10\n\n// \u8bbe\u7f6e\u975e\u963b\u585e\nvoid set_nonblocking(int fd) {\n    int flags = fcntl(fd, F_GETFL, 0);\n    fcntl(fd, F_SETFL, flags | O_NONBLOCK);\n}\n\nint main() {\n    int server_fd, epoll_fd;\n    struct sockaddr_in server_addr, client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    struct epoll_event ev, events[MAX_EVENTS];\n    char buffer[BUFFER_SIZE];\n    \n    // \u521b\u5efa\u670d\u52a1\u5668socket\n    server_fd = socket(AF_INET, SOCK_STREAM, 0);\n    int opt = 1;\n    setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n    set_nonblocking(server_fd);\n    \n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = INADDR_ANY;\n    server_addr.sin_port = htons(PORT);\n    \n    bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr));\n    listen(server_fd, 5);\n    \n    // \u521b\u5efaepoll\u5b9e\u4f8b\n    epoll_fd = epoll_create1(0);\n    if (epoll_fd < 0) {\n        perror("epoll_create1\u5931\u8d25");\n        exit(EXIT_FAILURE);\n    }\n    \n    // \u6dfb\u52a0\u670d\u52a1\u5668socket\u5230epoll\n    ev.events = EPOLLIN;\n    ev.data.fd = server_fd;\n    epoll_ctl(epoll_fd, EPOLL_CTL_ADD, server_fd, &ev);\n    \n    printf("\u670d\u52a1\u5668\u542f\u52a8\uff0c\u4f7f\u7528epoll\u76d1\u542c\u7aef\u53e3 %d...\\n", PORT);\n    \n    while (1) {\n        int nfds = epoll_wait(epoll_fd, events, MAX_EVENTS, -1);\n        \n        for (int i = 0; i < nfds; i++) {\n            if (events[i].data.fd == server_fd) {\n                // \u65b0\u8fde\u63a5\n                int client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_len);\n                set_nonblocking(client_fd);\n                \n                printf("\u65b0\u8fde\u63a5\uff0csocket fd: %d\\n", client_fd);\n                \n                ev.events = EPOLLIN | EPOLLET;  // \u8fb9\u7f18\u89e6\u53d1\n                ev.data.fd = client_fd;\n                epoll_ctl(epoll_fd, EPOLL_CTL_ADD, client_fd, &ev);\n            } else {\n                // \u5ba2\u6237\u7aef\u6570\u636e\n                int client_fd = events[i].data.fd;\n                memset(buffer, 0, BUFFER_SIZE);\n                int bytes_read = recv(client_fd, buffer, BUFFER_SIZE - 1, 0);\n                \n                if (bytes_read <= 0) {\n                    printf("\u5ba2\u6237\u7aef\u65ad\u5f00\uff0csocket fd: %d\\n", client_fd);\n                    epoll_ctl(epoll_fd, EPOLL_CTL_DEL, client_fd, NULL);\n                    close(client_fd);\n                } else {\n                    printf("\u6536\u5230\u6d88\u606f: %s\\n", buffer);\n                    send(client_fd, buffer, bytes_read, 0);\n                }\n            }\n        }\n    }\n    \n    close(server_fd);\n    close(epoll_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"http\u670d\u52a1\u5668\u793a\u4f8b",children:"HTTP\u670d\u52a1\u5668\u793a\u4f8b"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n\n#define PORT 8080\n#define BUFFER_SIZE 4096\n\nconst char* http_response = \n    "HTTP/1.1 200 OK\\r\\n"\n    "Content-Type: text/html; charset=UTF-8\\r\\n"\n    "Connection: close\\r\\n"\n    "\\r\\n"\n    "<!DOCTYPE html>"\n    "<html>"\n    "<head><title>C HTTP Server</title></head>"\n    "<body>"\n    "<h1>Hello from C HTTP Server!</h1>"\n    "<p>\u8fd9\u662f\u4e00\u4e2a\u7528C\u8bed\u8a00\u7f16\u5199\u7684\u7b80\u5355HTTP\u670d\u52a1\u5668</p>"\n    "</body>"\n    "</html>";\n\nint main() {\n    int server_fd, client_fd;\n    struct sockaddr_in server_addr, client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    char buffer[BUFFER_SIZE];\n    \n    server_fd = socket(AF_INET, SOCK_STREAM, 0);\n    int opt = 1;\n    setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n    \n    memset(&server_addr, 0, sizeof(server_addr));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = INADDR_ANY;\n    server_addr.sin_port = htons(PORT);\n    \n    bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr));\n    listen(server_fd, 5);\n    \n    printf("HTTP\u670d\u52a1\u5668\u542f\u52a8: http://localhost:%d\\n", PORT);\n    \n    while (1) {\n        client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_len);\n        \n        memset(buffer, 0, BUFFER_SIZE);\n        recv(client_fd, buffer, BUFFER_SIZE - 1, 0);\n        \n        printf("\u6536\u5230HTTP\u8bf7\u6c42:\\n%s\\n", buffer);\n        \n        send(client_fd, http_response, strlen(http_response), 0);\n        \n        close(client_fd);\n    }\n    \n    close(server_fd);\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsx)(e.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <errno.h>\n\nint result = connect(sock_fd, (struct sockaddr*)&server_addr, sizeof(server_addr));\nif (result < 0) {\n    if (errno == ECONNREFUSED) {\n        printf("\u8fde\u63a5\u88ab\u62d2\u7edd\\n");\n    } else if (errno == ETIMEDOUT) {\n        printf("\u8fde\u63a5\u8d85\u65f6\\n");\n    } else {\n        perror("\u8fde\u63a5\u5931\u8d25");\n    }\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u8d85\u65f6\u8bbe\u7f6e",children:"\u8d85\u65f6\u8bbe\u7f6e"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:"#include <sys/time.h>\n\nstruct timeval timeout;\ntimeout.tv_sec = 5;   // 5\u79d2\ntimeout.tv_usec = 0;\n\n// \u8bbe\u7f6e\u63a5\u6536\u8d85\u65f6\nsetsockopt(sock_fd, SOL_SOCKET, SO_RCVTIMEO, &timeout, sizeof(timeout));\n\n// \u8bbe\u7f6e\u53d1\u9001\u8d85\u65f6\nsetsockopt(sock_fd, SOL_SOCKET, SO_SNDTIMEO, &timeout, sizeof(timeout));\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u4f18\u96c5\u5173\u95ed",children:"\u4f18\u96c5\u5173\u95ed"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:"// \u5173\u95ed\u5199\u7aef\uff0c\u4f46\u4ecd\u53ef\u63a5\u6536\u6570\u636e\nshutdown(sock_fd, SHUT_WR);\n\n// \u5173\u95ed\u8bfb\u7aef\uff0c\u4f46\u4ecd\u53ef\u53d1\u9001\u6570\u636e\nshutdown(sock_fd, SHUT_RD);\n\n// \u5b8c\u5168\u5173\u95ed\nshutdown(sock_fd, SHUT_RDWR);\nclose(sock_fd);\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,d.jsx)(e.h3,{id:"1-address-already-in-use",children:"1. Address already in use"}),"\n",(0,d.jsxs)(e.p,{children:["\u4f7f\u7528",(0,d.jsx)(e.code,{children:"SO_REUSEADDR"}),"\u9009\u9879\uff1a"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:"int opt = 1;\nsetsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n"})}),"\n",(0,d.jsx)(e.h3,{id:"2-broken-pipe",children:"2. Broken pipe"}),"\n",(0,d.jsx)(e.p,{children:"\u5bf9\u65b9\u5173\u95ed\u8fde\u63a5\u540e\u7ee7\u7eed\u5199\u5165\u4f1a\u4ea7\u751fSIGPIPE\u4fe1\u53f7\uff0c\u53ef\u4ee5\u5ffd\u7565\u8be5\u4fe1\u53f7\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:"#include <signal.h>\n\nsignal(SIGPIPE, SIG_IGN);\n"})}),"\n",(0,d.jsx)(e.h3,{id:"3-\u7c98\u5305\u95ee\u9898",children:"3. \u7c98\u5305\u95ee\u9898"}),"\n",(0,d.jsx)(e.p,{children:"TCP\u662f\u6d41\u5f0f\u534f\u8bae\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u534f\u8bae\u6765\u5206\u9694\u6d88\u606f\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:"// \u65b9\u68481\uff1a\u56fa\u5b9a\u957f\u5ea6\n// \u65b9\u68482\uff1a\u4f7f\u7528\u5206\u9694\u7b26\uff08\u5982\\n\uff09\n// \u65b9\u68483\uff1a\u6d88\u606f\u5934\u5305\u542b\u957f\u5ea6\u4fe1\u606f\n\nstruct message {\n    uint32_t length;  // \u6d88\u606f\u957f\u5ea6\n    char data[];      // \u6d88\u606f\u5185\u5bb9\n};\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u7f16\u8bd1\u548c\u8fd0\u884c",children:"\u7f16\u8bd1\u548c\u8fd0\u884c"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# TCP\u670d\u52a1\u5668\ngcc tcp_server.c -o tcp_server\n./tcp_server\n\n# TCP\u5ba2\u6237\u7aef\ngcc tcp_client.c -o tcp_client\n./tcp_client\n\n# \u591a\u7ebf\u7a0b\u670d\u52a1\u5668\uff08\u9700\u8981\u94fe\u63a5pthread\u5e93\uff09\ngcc multi_thread_server.c -pthread -o multi_thread_server\n./multi_thread_server\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u76f8\u5173\u8d44\u6e90",children:"\u76f8\u5173\u8d44\u6e90"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://beej.us/guide/bgnet/",children:"Beej's Guide to Network Programming"})}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://www.gnu.org/software/libc/manual/html_node/Sockets.html",children:"Linux Socket Programming"})}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/TCP/IP_Illustrated",children:"TCP/IP\u8be6\u89e3"})}),"\n"]})]})}function o(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},28453(n,e,r){r.d(e,{R:()=>t,x:()=>c});var s=r(96540);const d={},i=s.createContext(d);function t(n){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:t(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);