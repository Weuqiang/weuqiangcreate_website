---
sidebar_position: 23
title: 23Python 
---

# Python 

:::info 
 Python  Python 
:::

## sys - 

`sys` 

### 

#### sys.argv



```python
import sys

# : python script.py arg1 arg2
print(sys.argv)  # ['script.py', 'arg1', 'arg2']

# 
if len(sys.argv) > 1:
    filename = sys.argv[1]
    print(f": {filename}")
```

#### sys.path



```python
import sys

# 
print(sys.path)

# 
sys.path.append('/path/to/my/modules')

# 
sys.path.insert(0, '/path/to/priority/modules')
```

#### sys.version  sys.version_info

Python 

```python
import sys

print(sys.version)
# 3.9.7 (default, Sep 16 2021, 13:09:58)
# [GCC 7.5.0]

print(sys.version_info)
# sys.version_info(major=3, minor=9, micro=7, releaselevel='final', serial=0)

#  Python 
if sys.version_info < (3, 6):
    print(" Python 3.6 ")
    sys.exit(1)
```

#### sys.platform



```python
import sys

print(sys.platform)  # 'linux', 'darwin', 'win32' 

# 
if sys.platform == 'win32':
    print("Windows ")
elif sys.platform == 'darwin':
    print("macOS ")
elif sys.platform.startswith('linux'):
    print("Linux ")
```

#### sys.exit()



```python
import sys

def main():
    try:
        # 
        result = process_data()
        if not result:
            print("")
            sys.exit(1)  # 
    except Exception as e:
        print(f": {e}")
        sys.exit(1)
    
    sys.exit(0)  # 

if __name__ == '__main__':
    main()
```

#### sys.stdin, sys.stdout, sys.stderr



```python
import sys

# 
sys.stdout.write("Hello World\n")

# 
sys.stderr.write("Error message\n")

# 
print(":")
line = sys.stdin.readline()
print(f": {line}")

# 
import io
old_stdout = sys.stdout
sys.stdout = io.StringIO()

print("")
output = sys.stdout.getvalue()

sys.stdout = old_stdout
print(f": {output}")
```

#### sys.modules



```python
import sys

# 
print(sys.modules.keys())

# 
if 'numpy' in sys.modules:
    print("NumPy ")

# 
if 'mymodule' in sys.modules:
    del sys.modules['mymodule']
```

#### sys.getrecursionlimit()  sys.setrecursionlimit()



```python
import sys

# 
print(sys.getrecursionlimit())  #  1000

# 
sys.setrecursionlimit(2000)

# 
def factorial(n):
    if n <= 1:
        return 1
    return n * factorial(n - 1)
```

#### sys.getsizeof()



```python
import sys

# 
print(sys.getsizeof(1))           # int
print(sys.getsizeof("hello"))     # str
print(sys.getsizeof([1, 2, 3]))   # list
print(sys.getsizeof({'a': 1}))    # dict

# 
numbers = list(range(1000))
print(f": {sys.getsizeof(numbers)} ")

numbers_tuple = tuple(range(1000))
print(f": {sys.getsizeof(numbers_tuple)} ")
```

### 

#### 

```python
import sys
import time

def progress_bar(current, total, bar_length=50):
    """"""
    percent = current / total
    arrow = '=' * int(percent * bar_length)
    spaces = ' ' * (bar_length - len(arrow))
    
    sys.stdout.write(f'\r[{arrow}{spaces}] {int(percent * 100)}%')
    sys.stdout.flush()

# 
for i in range(101):
    progress_bar(i, 100)
    time.sleep(0.05)
print("\n!")
```

#### 

```python
import sys

def main():
    """"""
    if len(sys.argv) < 2:
        print(": python script.py <command> [args]")
        sys.exit(1)
    
    command = sys.argv[1]
    
    if command == 'hello':
        name = sys.argv[2] if len(sys.argv) > 2 else 'World'
        print(f"Hello, {name}!")
    elif command == 'version':
        print(f"Python {sys.version}")
    else:
        print(f": {command}")
        sys.exit(1)

if __name__ == '__main__':
    main()
```

## atexit - 

`atexit` 

### 

```python
import atexit

def cleanup():
    """"""
    print("...")
    # 

# 
atexit.register(cleanup)

# 
@atexit.register
def goodbye():
    print("!")

print("...")
#  cleanup()  goodbye()
```

### 

```python
import atexit

def save_data(filename, data):
    """"""
    print(f" {filename}")
    with open(filename, 'w') as f:
        f.write(data)

# 
data_to_save = ""
atexit.register(save_data, 'output.txt', data_to_save)

print("...")
```

### 

```python
import atexit
import tempfile
import os

class TempFileManager:
    """"""
    def __init__(self):
        self.temp_files = []
        atexit.register(self.cleanup)
    
    def create_temp_file(self):
        """"""
        fd, path = tempfile.mkstemp()
        os.close(fd)
        self.temp_files.append(path)
        return path
    
    def cleanup(self):
        """"""
        print("...")
        for path in self.temp_files:
            try:
                os.remove(path)
                print(f": {path}")
            except OSError:
                pass

# 
manager = TempFileManager()
temp_file = manager.create_temp_file()
print(f": {temp_file}")
# 
```

## traceback - 

`traceback`  Python 

### 

```python
import traceback
import sys

def function_c():
    """"""
    return 1 / 0

def function_b():
    function_c()

def function_a():
    function_b()

try:
    function_a()
except Exception as e:
    # 
    traceback.print_exc()
    
    # 
    tb_str = traceback.format_exc()
    print("\n:")
    print(tb_str)
```

### 

```python
import traceback
import sys

try:
    result = 10 / 0
except:
    # 
    exc_type, exc_value, exc_traceback = sys.exc_info()
    
    # 
    lines = traceback.format_exception(exc_type, exc_value, exc_traceback)
    print(''.join(lines))
    
    # 
    traceback.print_tb(exc_traceback)
    
    # 
    tb_list = traceback.extract_tb(exc_traceback)
    for frame in tb_list:
        print(f": {frame.filename}, : {frame.lineno}, : {frame.name}")
```

### 

```python
import traceback
import logging
from datetime import datetime

# 
logging.basicConfig(
    filename='error.log',
    level=logging.ERROR,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

def safe_execute(func, *args, **kwargs):
    """"""
    try:
        return func(*args, **kwargs)
    except Exception as e:
        # 
        error_msg = f" {func.__name__} \n"
        error_msg += f": args={args}, kwargs={kwargs}\n"
        error_msg += f": {str(e)}\n"
        error_msg += traceback.format_exc()
        
        logging.error(error_msg)
        print(f"")
        return None

# 
def risky_operation(x, y):
    return x / y

result = safe_execute(risky_operation, 10, 0)
```

## __main__ - 

`__main__` 

### 

```python
# mymodule.py

def main():
    """"""
    print("")

def helper_function():
    """"""
    print("")

# 
if __name__ == '__main__':
    main()
```

### 

```python
# calculator.py

def add(a, b):
    """"""
    return a + b

def subtract(a, b):
    """"""
    return a - b

def main():
    """"""
    import sys
    
    if len(sys.argv) != 4:
        print(": python calculator.py <num1> <op> <num2>")
        print(": python calculator.py 10 + 5")
        sys.exit(1)
    
    num1 = float(sys.argv[1])
    op = sys.argv[2]
    num2 = float(sys.argv[3])
    
    if op == '+':
        result = add(num1, num2)
    elif op == '-':
        result = subtract(num1, num2)
    else:
        print(f": {op}")
        sys.exit(1)
    
    print(f"{num1} {op} {num2} = {result}")

if __name__ == '__main__':
    main()
else:
    # 
    print("calculator ")
```

###  __main__.py

```python
# mypackage/__main__.py
#  python -m mypackage 

from . import core

def main():
    """"""
    print(" mypackage")
    core.run()

if __name__ == '__main__':
    main()
```

## warnings - 

`warnings` 

### 

```python
import warnings

def deprecated_function():
    """"""
    warnings.warn(
        "deprecated_function  new_function",
        DeprecationWarning,
        stacklevel=2
    )
    print("")

def new_function():
    """"""
    print("")

# 
deprecated_function()
```

### 

```python
import warnings

# 
warnings.filterwarnings('ignore')

# 
warnings.filterwarnings('error')

# 
warnings.filterwarnings('once')

# 
warnings.filterwarnings('always')

# 
warnings.filterwarnings('ignore', category=DeprecationWarning)

# 
warnings.filterwarnings('ignore', message='.*deprecated.*')
```

### 

```python
import warnings

class CustomWarning(UserWarning):
    """"""
    pass

def risky_operation(value):
    """"""
    if value < 0:
        warnings.warn(
            f" {value} ",
            CustomWarning
        )
    return abs(value)

# 
result = risky_operation(-5)
```

### 

```python
import warnings

def test_function():
    warnings.warn("", UserWarning)

# 
with warnings.catch_warnings():
    warnings.simplefilter("ignore")
    test_function()  # 

# 
with warnings.catch_warnings(record=True) as w:
    warnings.simplefilter("always")
    test_function()
    
    if w:
        print(f" {len(w)} ")
        for warning in w:
            print(f"  - {warning.message}")
```

## 

### 

```python
import sys
import atexit
import logging
import traceback
import warnings

class Application:
    """"""
    
    def __init__(self, name):
        self.name = name
        self.setup_logging()
        self.register_cleanup()
    
    def setup_logging(self):
        """"""
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            handlers=[
                logging.FileHandler(f'{self.name}.log'),
                logging.StreamHandler(sys.stdout)
            ]
        )
        self.logger = logging.getLogger(self.name)
    
    def register_cleanup(self):
        """"""
        atexit.register(self.cleanup)
    
    def cleanup(self):
        """"""
        self.logger.info("...")
        # 
    
    def run(self):
        """"""
        try:
            self.logger.info(f" {self.name}")
            self.main()
        except KeyboardInterrupt:
            self.logger.info("")
            sys.exit(0)
        except Exception as e:
            self.logger.error(f": {e}")
            self.logger.error(traceback.format_exc())
            sys.exit(1)
    
    def main(self):
        """"""
        raise NotImplementedError

# 
class MyApp(Application):
    def main(self):
        print("...")
        # 

if __name__ == '__main__':
    app = MyApp("MyApplication")
    app.run()
```

## 

### 1. 

```python
import sys

def parse_args():
    """"""
    if len(sys.argv) < 2:
        print(": python script.py <command> [options]")
        print(":")
        print("  start  - ")
        print("  stop   - ")
        print("  status - ")
        sys.exit(1)
    
    return sys.argv[1], sys.argv[2:]

if __name__ == '__main__':
    command, options = parse_args()
    # 
```

### 2. 

```python
import atexit
import signal
import sys

def signal_handler(signum, frame):
    """"""
    print(f"\n {signum}...")
    sys.exit(0)

def cleanup():
    """"""
    print("...")

# 
signal.signal(signal.SIGINT, signal_handler)
signal.signal(signal.SIGTERM, signal_handler)

# 
atexit.register(cleanup)
```

### 3. 

```python
import sys
import logging
import traceback

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def safe_main():
    """"""
    try:
        # 
        pass
    except Exception as e:
        logger.error(f": {e}")
        logger.debug(traceback.format_exc())
        return 1
    return 0

if __name__ == '__main__':
    sys.exit(safe_main())
```

## 

- [Python  - sys](https://docs.python.org/zh-cn/3/library/sys.html)
- [Python  - atexit](https://docs.python.org/zh-cn/3/library/atexit.html)
- [Python  - traceback](https://docs.python.org/zh-cn/3/library/traceback.html)
- [Python  - warnings](https://docs.python.org/zh-cn/3/library/warnings.html)
- [Python  - __main__](https://docs.python.org/zh-cn/3/library/__main__.html)
