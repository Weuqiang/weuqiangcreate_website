"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[92296],{28052(n,e,l){l.r(e),l.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust/advanced","title":"\u8fdb\u9636","description":"Unsafe Rust","source":"@site/docs/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust/advanced.mdx","sourceDirName":"\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust","slug":"/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust/advanced","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust/advanced","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u8bed\u6cd5","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust/"},"next":{"title":"\u5305\u7ba1\u7406\u4e0e\u6a21\u5757","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/rust/modules"}}');var r=l(74848),i=l(28453);const t={},a="\u8fdb\u9636",d={},c=[{value:"Unsafe Rust",id:"unsafe-rust",level:2},{value:"Unsafe\u8d85\u80fd\u529b",id:"unsafe\u8d85\u80fd\u529b",level:3},{value:"\u88f8\u6307\u9488\uff08Raw Pointers\uff09",id:"\u88f8\u6307\u9488raw-pointers",level:3},{value:"\u8c03\u7528Unsafe\u51fd\u6570",id:"\u8c03\u7528unsafe\u51fd\u6570",level:3},{value:"\u521b\u5efaUnsafe\u4ee3\u7801\u7684\u5b89\u5168\u62bd\u8c61",id:"\u521b\u5efaunsafe\u4ee3\u7801\u7684\u5b89\u5168\u62bd\u8c61",level:3},{value:"\u4f7f\u7528extern\u8c03\u7528\u5916\u90e8\u4ee3\u7801",id:"\u4f7f\u7528extern\u8c03\u7528\u5916\u90e8\u4ee3\u7801",level:3},{value:"\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf",id:"\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf",level:3},{value:"\u5b9e\u73b0Unsafe Trait",id:"\u5b9e\u73b0unsafe-trait",level:3},{value:"\u8bbf\u95eeUnion\u7684\u5b57\u6bb5",id:"\u8bbf\u95eeunion\u7684\u5b57\u6bb5",level:3},{value:"Advanced Traits",id:"advanced-traits",level:2},{value:"\u5173\u8054\u7c7b\u578b\uff08Associated Types\uff09",id:"\u5173\u8054\u7c7b\u578bassociated-types",level:3},{value:"\u9ed8\u8ba4\u6cdb\u578b\u53c2\u6570\u548c\u8fd0\u7b97\u7b26\u91cd\u8f7d",id:"\u9ed8\u8ba4\u6cdb\u578b\u53c2\u6570\u548c\u8fd0\u7b97\u7b26\u91cd\u8f7d",level:3},{value:"\u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5\uff08Fully Qualified Syntax\uff09",id:"\u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5fully-qualified-syntax",level:3},{value:"Supertraits",id:"supertraits",level:3},{value:"Newtype\u6a21\u5f0f",id:"newtype\u6a21\u5f0f",level:3},{value:"Advanced Types",id:"advanced-types",level:2},{value:"\u7c7b\u578b\u522b\u540d\uff08Type Aliases\uff09",id:"\u7c7b\u578b\u522b\u540dtype-aliases",level:3},{value:"Never\u7c7b\u578b\uff08!\uff09",id:"never\u7c7b\u578b",level:3},{value:"\u52a8\u6001\u5927\u5c0f\u7c7b\u578b\uff08DST\uff09",id:"\u52a8\u6001\u5927\u5c0f\u7c7b\u578bdst",level:3},{value:"Advanced Functions",id:"advanced-functions",level:2},{value:"\u51fd\u6570\u6307\u9488",id:"\u51fd\u6570\u6307\u9488",level:3},{value:"\u8fd4\u56de\u95ed\u5305",id:"\u8fd4\u56de\u95ed\u5305",level:3},{value:"\u5b8f\uff08Macro\uff09",id:"\u5b8fmacro",level:2},{value:"\u58f0\u660e\u5b8f",id:"\u58f0\u660e\u5b8f",level:3},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:4},{value:"\u8fc7\u7a0b\u5b8f",id:"\u8fc7\u7a0b\u5b8f",level:3},{value:"\u6d3e\u751f\u5b8f",id:"\u6d3e\u751f\u5b8f",level:4},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-1",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-1",level:4},{value:"\u5c5e\u6027\u5b8f",id:"\u5c5e\u6027\u5b8f",level:4},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-2",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-2",level:4},{value:"\u51fd\u6570\u5f0f\u5b8f",id:"\u51fd\u6570\u5f0f\u5b8f",level:4},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-3",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-3",level:4}];function u(n){const e={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u8fdb\u9636",children:"\u8fdb\u9636"})}),"\n",(0,r.jsx)(e.h2,{id:"unsafe-rust",children:"Unsafe Rust"}),"\n",(0,r.jsxs)(e.p,{children:["Rust\u7684\u6838\u5fc3\u4f18\u52bf\u4e4b\u4e00\u662f\u5185\u5b58\u5b89\u5168\uff0c\u7f16\u8bd1\u5668\u4f1a\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u4e25\u683c\u7684\u68c0\u67e5\u3002\u4f46\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u7ed5\u8fc7\u8fd9\u4e9b\u68c0\u67e5\u6765\u5b9e\u73b0\u4e00\u4e9b\u5e95\u5c42\u64cd\u4f5c\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528",(0,r.jsx)(e.code,{children:"unsafe"}),"\u5173\u952e\u5b57\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"unsafe\u8d85\u80fd\u529b",children:"Unsafe\u8d85\u80fd\u529b"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728",(0,r.jsx)(e.code,{children:"unsafe"}),"\u5757\u4e2d\uff0c\u4f60\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u4e94\u79cd\u64cd\u4f5c\uff1a"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u89e3\u5f15\u7528\u88f8\u6307\u9488"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u8c03\u7528unsafe\u51fd\u6570\u6216\u65b9\u6cd5"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u5b9e\u73b0unsafe trait"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u8bbf\u95eeunion\u7684\u5b57\u6bb5"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u88f8\u6307\u9488raw-pointers",children:"\u88f8\u6307\u9488\uff08Raw Pointers\uff09"}),"\n",(0,r.jsx)(e.p,{children:"\u88f8\u6307\u9488\u7c7b\u4f3c\u4e8e\u5f15\u7528\uff0c\u4f46\u4e0d\u53d7\u501f\u7528\u68c0\u67e5\u5668\u7684\u7ea6\u675f\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'fn main() {\n    let mut num = 5;\n\n    // \u521b\u5efa\u88f8\u6307\u9488\uff08\u5728\u5b89\u5168\u4ee3\u7801\u4e2d\u4e5f\u53ef\u4ee5\u521b\u5efa\uff09\n    let r1 = &num as *const i32;        // \u4e0d\u53ef\u53d8\u88f8\u6307\u9488\n    let r2 = &mut num as *mut i32;      // \u53ef\u53d8\u88f8\u6307\u9488\n\n    // \u89e3\u5f15\u7528\u88f8\u6307\u9488\u5fc5\u987b\u5728unsafe\u5757\u4e2d\n    unsafe {\n        println!("r1: {}", *r1);\n        println!("r2: {}", *r2);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u88f8\u6307\u9488\u7684\u7279\u70b9\uff1a"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5141\u8bb8\u5ffd\u7565\u501f\u7528\u89c4\u5219\uff0c\u53ef\u4ee5\u540c\u65f6\u62e5\u6709\u53ef\u53d8\u548c\u4e0d\u53ef\u53d8\u6307\u9488"}),"\n",(0,r.jsx)(e.li,{children:"\u4e0d\u4fdd\u8bc1\u6307\u5411\u6709\u6548\u7684\u5185\u5b58"}),"\n",(0,r.jsx)(e.li,{children:"\u5141\u8bb8\u4e3a\u7a7a"}),"\n",(0,r.jsx)(e.li,{children:"\u4e0d\u4f1a\u81ea\u52a8\u6e05\u7406\u5185\u5b58"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u8c03\u7528unsafe\u51fd\u6570",children:"\u8c03\u7528Unsafe\u51fd\u6570"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'unsafe fn dangerous() {\n    println!("\u8fd9\u662f\u4e00\u4e2aunsafe\u51fd\u6570");\n}\n\nfn main() {\n    unsafe {\n        dangerous();\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u521b\u5efaunsafe\u4ee3\u7801\u7684\u5b89\u5168\u62bd\u8c61",children:"\u521b\u5efaUnsafe\u4ee3\u7801\u7684\u5b89\u5168\u62bd\u8c61"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::slice;\n\nfn split_at_mut(slice: &mut [i32], mid: usize) -> (&mut [i32], &mut [i32]) {\n    let len = slice.len();\n    let ptr = slice.as_mut_ptr();\n\n    assert!(mid <= len);\n\n    unsafe {\n        (\n            slice::from_raw_parts_mut(ptr, mid),\n            slice::from_raw_parts_mut(ptr.add(mid), len - mid),\n        )\n    }\n}\n\nfn main() {\n    let mut v = vec![1, 2, 3, 4, 5, 6];\n    let (left, right) = split_at_mut(&mut v, 3);\n    \n    println!("left: {:?}", left);   // [1, 2, 3]\n    println!("right: {:?}", right); // [4, 5, 6]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528extern\u8c03\u7528\u5916\u90e8\u4ee3\u7801",children:"\u4f7f\u7528extern\u8c03\u7528\u5916\u90e8\u4ee3\u7801"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'extern "C" {\n    fn abs(input: i32) -> i32;\n}\n\nfn main() {\n    unsafe {\n        println!("C\u8bed\u8a00\u7684abs(-3) = {}", abs(-3));\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf",children:"\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'static mut COUNTER: u32 = 0;\n\nfn add_to_count(inc: u32) {\n    unsafe {\n        COUNTER += inc;\n    }\n}\n\nfn main() {\n    add_to_count(3);\n\n    unsafe {\n        println!("COUNTER: {}", COUNTER);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9e\u73b0unsafe-trait",children:"\u5b9e\u73b0Unsafe Trait"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"unsafe trait Foo {\n    // \u65b9\u6cd5\u5b9a\u4e49\n}\n\nunsafe impl Foo for i32 {\n    // \u65b9\u6cd5\u5b9e\u73b0\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u8bbf\u95eeunion\u7684\u5b57\u6bb5",children:"\u8bbf\u95eeUnion\u7684\u5b57\u6bb5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'#[repr(C)]\nunion MyUnion {\n    f1: u32,\n    f2: f32,\n}\n\nfn main() {\n    let u = MyUnion { f1: 1 };\n    \n    unsafe {\n        println!("u.f1: {}", u.f1);\n        println!("u.f2: {}", u.f2);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"advanced-traits",children:"Advanced Traits"}),"\n",(0,r.jsx)(e.h3,{id:"\u5173\u8054\u7c7b\u578bassociated-types",children:"\u5173\u8054\u7c7b\u578b\uff08Associated Types\uff09"}),"\n",(0,r.jsx)(e.p,{children:"\u5173\u8054\u7c7b\u578b\u662ftrait\u4e2d\u7684\u7c7b\u578b\u5360\u4f4d\u7b26\uff0c\u5b9e\u73b0trait\u65f6\u9700\u8981\u6307\u5b9a\u5177\u4f53\u7c7b\u578b\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"pub trait Iterator {\n    type Item;  // \u5173\u8054\u7c7b\u578b\n\n    fn next(&mut self) -> Option<Self::Item>;\n}\n\nstruct Counter {\n    count: u32,\n}\n\nimpl Iterator for Counter {\n    type Item = u32;  // \u6307\u5b9a\u5173\u8054\u7c7b\u578b\n\n    fn next(&mut self) -> Option<Self::Item> {\n        self.count += 1;\n        if self.count < 6 {\n            Some(self.count)\n        } else {\n            None\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5173\u8054\u7c7b\u578b vs \u6cdb\u578b\uff1a"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u4f7f\u7528\u6cdb\u578b\uff08\u53ef\u4ee5\u4e3a\u540c\u4e00\u7c7b\u578b\u5b9e\u73b0\u591a\u6b21\uff09\npub trait Iterator<T> {\n    fn next(&mut self) -> Option<T>;\n}\n\n// \u4f7f\u7528\u5173\u8054\u7c7b\u578b\uff08\u6bcf\u4e2a\u7c7b\u578b\u53ea\u80fd\u5b9e\u73b0\u4e00\u6b21\uff09\npub trait Iterator {\n    type Item;\n    fn next(&mut self) -> Option<Self::Item>;\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u9ed8\u8ba4\u6cdb\u578b\u53c2\u6570\u548c\u8fd0\u7b97\u7b26\u91cd\u8f7d",children:"\u9ed8\u8ba4\u6cdb\u578b\u53c2\u6570\u548c\u8fd0\u7b97\u7b26\u91cd\u8f7d"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::ops::Add;\n\n#[derive(Debug, PartialEq)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\nimpl Add for Point {\n    type Output = Point;\n\n    fn add(self, other: Point) -> Point {\n        Point {\n            x: self.x + other.x,\n            y: self.y + other.y,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 2 };\n    let p2 = Point { x: 3, y: 4 };\n    \n    println!("{:?}", p1 + p2);  // Point { x: 4, y: 6 }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u9ed8\u8ba4\u6cdb\u578b\u53c2\u6570\uff1a"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"trait Add<Rhs=Self> {  // Rhs\u9ed8\u8ba4\u4e3aSelf\n    type Output;\n    fn add(self, rhs: Rhs) -> Self::Output;\n}\n\n// \u4e0d\u540c\u7c7b\u578b\u76f8\u52a0\nstruct Millimeters(u32);\nstruct Meters(u32);\n\nimpl Add<Meters> for Millimeters {\n    type Output = Millimeters;\n\n    fn add(self, other: Meters) -> Millimeters {\n        Millimeters(self.0 + (other.0 * 1000))\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5fully-qualified-syntax",children:"\u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5\uff08Fully Qualified Syntax\uff09"}),"\n",(0,r.jsx)(e.p,{children:"\u5f53\u591a\u4e2atrait\u6709\u540c\u540d\u65b9\u6cd5\u65f6\uff0c\u9700\u8981\u4f7f\u7528\u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5\u6765\u6d88\u9664\u6b67\u4e49\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'trait Pilot {\n    fn fly(&self);\n}\n\ntrait Wizard {\n    fn fly(&self);\n}\n\nstruct Human;\n\nimpl Pilot for Human {\n    fn fly(&self) {\n        println!("\u673a\u957f\u5728\u6b64");\n    }\n}\n\nimpl Wizard for Human {\n    fn fly(&self) {\n        println!("\u98de\u8d77\u6765\uff01");\n    }\n}\n\nimpl Human {\n    fn fly(&self) {\n        println!("*\u75af\u72c2\u6325\u52a8\u624b\u81c2*");\n    }\n}\n\nfn main() {\n    let person = Human;\n    \n    person.fly();           // \u8c03\u7528Human\u7684fly\n    Pilot::fly(&person);    // \u8c03\u7528Pilot\u7684fly\n    Wizard::fly(&person);   // \u8c03\u7528Wizard\u7684fly\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5173\u8054\u51fd\u6570\u7684\u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5\uff1a"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'trait Animal {\n    fn baby_name() -> String;\n}\n\nstruct Dog;\n\nimpl Dog {\n    fn baby_name() -> String {\n        String::from("Spot")\n    }\n}\n\nimpl Animal for Dog {\n    fn baby_name() -> String {\n        String::from("puppy")\n    }\n}\n\nfn main() {\n    println!("A baby dog is called a {}", Dog::baby_name());\n    // \u5b8c\u5168\u9650\u5b9a\u8bed\u6cd5\n    println!("A baby dog is called a {}", <Dog as Animal>::baby_name());\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"supertraits",children:"Supertraits"}),"\n",(0,r.jsx)(e.p,{children:"\u8981\u6c42\u5b9e\u73b0\u67d0\u4e2atrait\u7684\u7c7b\u578b\u4e5f\u5fc5\u987b\u5b9e\u73b0\u53e6\u4e00\u4e2atrait\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::fmt;\n\ntrait OutlinePrint: fmt::Display {  // \u8981\u6c42\u5b9e\u73b0Display\n    fn outline_print(&self) {\n        let output = self.to_string();\n        let len = output.len();\n        println!("{}", "*".repeat(len + 4));\n        println!("*{}*", " ".repeat(len + 2));\n        println!("* {} *", output);\n        println!("*{}*", " ".repeat(len + 2));\n        println!("{}", "*".repeat(len + 4));\n    }\n}\n\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\nimpl fmt::Display for Point {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        write!(f, "({}, {})", self.x, self.y)\n    }\n}\n\nimpl OutlinePrint for Point {}\n\nfn main() {\n    let p = Point { x: 1, y: 3 };\n    p.outline_print();\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"newtype\u6a21\u5f0f",children:"Newtype\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u7528\u5143\u7ec4\u7ed3\u6784\u4f53\u5305\u88c5\u5916\u90e8\u7c7b\u578b\uff0c\u4ee5\u4fbf\u4e3a\u5176\u5b9e\u73b0\u5916\u90e8trait\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::fmt;\n\nstruct Wrapper(Vec<String>);\n\nimpl fmt::Display for Wrapper {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        write!(f, "[{}]", self.0.join(", "))\n    }\n}\n\nfn main() {\n    let w = Wrapper(vec![String::from("hello"), String::from("world")]);\n    println!("w = {}", w);\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"advanced-types",children:"Advanced Types"}),"\n",(0,r.jsx)(e.h3,{id:"\u7c7b\u578b\u522b\u540dtype-aliases",children:"\u7c7b\u578b\u522b\u540d\uff08Type Aliases\uff09"}),"\n",(0,r.jsxs)(e.p,{children:["\u4f7f\u7528",(0,r.jsx)(e.code,{children:"type"}),"\u5173\u952e\u5b57\u521b\u5efa\u7c7b\u578b\u522b\u540d\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'type Kilometers = i32;\n\nlet x: i32 = 5;\nlet y: Kilometers = 5;\n\nprintln!("x + y = {}", x + y);\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u51cf\u5c11\u91cd\u590d\uff1a"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'type Thunk = Box<dyn Fn() + Send + \'static>;\n\nlet f: Thunk = Box::new(|| println!("hi"));\n\nfn takes_long_type(f: Thunk) {\n    // --snip--\n}\n\nfn returns_long_type() -> Thunk {\n    // --snip--\n    Box::new(|| ())\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"never\u7c7b\u578b",children:"Never\u7c7b\u578b\uff08!\uff09"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"!"}),"\u7c7b\u578b\u8868\u793a\u6c38\u4e0d\u8fd4\u56de\u7684\u51fd\u6570\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'fn bar() -> ! {\n    panic!("\u8fd9\u4e2a\u51fd\u6570\u6c38\u4e0d\u8fd4\u56de");\n}\n\nfn main() {\n    let guess: u32 = match guess.trim().parse() {\n        Ok(num) => num,\n        Err(_) => continue,  // continue\u7684\u7c7b\u578b\u662f!\n    };\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u52a8\u6001\u5927\u5c0f\u7c7b\u578bdst",children:"\u52a8\u6001\u5927\u5c0f\u7c7b\u578b\uff08DST\uff09"}),"\n",(0,r.jsx)(e.p,{children:"Rust\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u77e5\u9053\u7c7b\u578b\u7684\u5927\u5c0f\uff0c\u4f46\u67d0\u4e9b\u7c7b\u578b\u7684\u5927\u5c0f\u53ea\u80fd\u5728\u8fd0\u884c\u65f6\u786e\u5b9a\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// str\u662fDST\uff0c\u5927\u5c0f\u672a\u77e5\nlet s1: str = "Hello";  // \u9519\u8bef\uff01\n\n// &str\u662f\u5df2\u77e5\u5927\u5c0f\u7684\uff08\u6307\u9488+\u957f\u5ea6\uff09\nlet s2: &str = "Hello";  // \u6b63\u786e\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Sized Trait\uff1a"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u6cdb\u578b\u51fd\u6570\u9ed8\u8ba4\u8981\u6c42T: Sized\nfn generic<T>(t: T) {\n    // --snip--\n}\n\n// \u7b49\u4ef7\u4e8e\nfn generic<T: Sized>(t: T) {\n    // --snip--\n}\n\n// \u653e\u5bbd\u9650\u5236\nfn generic<T: ?Sized>(t: &T) {  // ?Sized\u8868\u793a\u53ef\u80fd\u662fDST\n    // --snip--\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"advanced-functions",children:"Advanced Functions"}),"\n",(0,r.jsx)(e.h3,{id:"\u51fd\u6570\u6307\u9488",children:"\u51fd\u6570\u6307\u9488"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'fn add_one(x: i32) -> i32 {\n    x + 1\n}\n\nfn do_twice(f: fn(i32) -> i32, arg: i32) -> i32 {\n    f(arg) + f(arg)\n}\n\nfn main() {\n    let answer = do_twice(add_one, 5);\n    println!("The answer is: {}", answer);  // 12\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u51fd\u6570\u6307\u9488 vs \u95ed\u5305\uff1a"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u51fd\u6570\u6307\u9488\u5b9e\u73b0\u4e86\u6240\u6709\u4e09\u4e2a\u95ed\u5305trait\uff08Fn\u3001FnMut\u3001FnOnce\uff09\nfn returns_closure() -> Box<dyn Fn(i32) -> i32> {\n    Box::new(|x| x + 1)\n}\n\n// \u53ef\u4ee5\u4f20\u9012\u51fd\u6570\u6307\u9488\u6216\u95ed\u5305\nlet list_of_numbers = vec![1, 2, 3];\nlet list_of_strings: Vec<String> = list_of_numbers\n    .iter()\n    .map(|i| i.to_string())  // \u95ed\u5305\n    .collect();\n\nlet list_of_strings: Vec<String> = list_of_numbers\n    .iter()\n    .map(ToString::to_string)  // \u51fd\u6570\u6307\u9488\n    .collect();\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u8fd4\u56de\u95ed\u5305",children:"\u8fd4\u56de\u95ed\u5305"}),"\n",(0,r.jsx)(e.p,{children:"\u95ed\u5305\u7531trait\u8868\u793a\uff0c\u4e0d\u80fd\u76f4\u63a5\u8fd4\u56de\uff0c\u9700\u8981\u4f7f\u7528trait\u5bf9\u8c61\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'fn returns_closure() -> Box<dyn Fn(i32) -> i32> {\n    Box::new(|x| x + 1)\n}\n\nfn main() {\n    let f = returns_closure();\n    println!("{}", f(5));  // 6\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u5b8fmacro",children:"\u5b8f\uff08Macro\uff09"}),"\n",(0,r.jsxs)(e.p,{children:["\u5b8f\u662f\u4e00\u79cd\u5143\u7f16\u7a0b\uff0c\u901a\u8fc7\u5728\u7f16\u8bd1\u65f6\u5bf9\u6307\u5b9a\u7684\u6e90\u4ee3\u7801\u8fdb\u884c\u66ff\u6362\uff08\u5373\u5b8f\u5c55\u5f00\uff09\u53ef\u5b9e\u73b0\u5404\u79cd\u8fdb\u9636\u7684\u80fd\u529b\u3002Rust\u4e2d\u7684\u5b8f\u5206\u4e3a",(0,r.jsx)(e.strong,{children:"\u58f0\u660e\u5b8f"}),"\uff08",(0,r.jsx)(e.em,{children:"declarative macros"}),"\uff09\u548c\u4ee5\u4e0b\u4e09\u79cd",(0,r.jsx)(e.strong,{children:"\u8fc7\u7a0b\u5b8f"}),"\uff08 ",(0,r.jsx)(e.em,{children:"procedural macros"}),"\uff09"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u6d3e\u751f\u5b8f\uff08",(0,r.jsxs)(e.em,{children:["Custom ",(0,r.jsx)(e.code,{children:"#[derive]"})," macros"]}),"\uff09"]}),"\n",(0,r.jsxs)(e.li,{children:["\u5c5e\u6027\u5b8f\uff08",(0,r.jsx)(e.em,{children:"Attribute-like macros"}),"\uff09"]}),"\n",(0,r.jsxs)(e.li,{children:["\u51fd\u6570\u5f0f\u5b8f\uff08",(0,r.jsx)(e.em,{children:"Function-like macros"}),"\uff09"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u58f0\u660e\u5b8f\u548c\u8fc7\u7a0b\u5b8f\u4e2d\u7684\u51fd\u6570\u5f0f\u5b8f\u5728\u529f\u80fd\u4e0a\u5341\u5206\u8d34\u8fd1\uff0c\u4f7f\u7528\u4e0a\u4e5f\u90fd\u548c\u666e\u901a\u51fd\u6570\u975e\u5e38\u76f8\u4f3c\uff0c\u4e8c\u8005\u533a\u522b\u5728\u4e8e\u58f0\u660e\u5b8f\u4e3b\u8981\u662f\u505a\u5b57\u7b26\u4e32\u5c42\u9762\u4e0a\u7684\u5339\u914d\u4e0e\u66ff\u6362\uff0c\u800c\u8fc7\u7a0b\u5b8f\u662f\u57fa\u4e8eToken\u6d41\u4e43\u81f3\u8bed\u6cd5\u6811\u5c42\u9762\u4e0a\u7684\u64cd\u4f5c\u3002\u53e6\u5916\u76f8\u8f83\u4e8e\u666e\u901a\u51fd\u6570\u7684\u529f\u80fd\u6765\u8bf4\uff0c\u5b8f\u6700\u5927\u7684\u7279\u522b\u662f\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u5c55\u5f00\uff0c\u5177\u5907\u66f4\u5f3a\u5927\u7684\u8868\u8fbe\u80fd\u529b\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u58f0\u660e\u5b8f",children:"\u58f0\u660e\u5b8f"}),"\n",(0,r.jsx)(e.h4,{id:"\u5b9a\u4e49",children:"\u5b9a\u4e49"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"#[macro_export]\nmacro_rules! vec {\n    ( $( $x:expr ),* ) => {\n        {\n            let mut temp_vec = Vec::new();\n            $(\n                temp_vec.push($x);\n            )*\n            temp_vec\n        }\n    };\n}\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"let v: Vec<u32> = vec![1, 2, 3];\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u8fc7\u7a0b\u5b8f",children:"\u8fc7\u7a0b\u5b8f"}),"\n",(0,r.jsx)(e.h4,{id:"\u6d3e\u751f\u5b8f",children:"\u6d3e\u751f\u5b8f"}),"\n",(0,r.jsx)(e.p,{children:"\u6d3e\u751f\u5b8f\u4e3b\u8981\u88ab\u7ed3\u6784\u4f53\u6216\u679a\u4e3e\u7c7b\u578b\u8fdb\u884c\u6d88\u8d39\uff0c\u6700\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u7ed9\u7ed3\u6784\u4f53\u63d0\u4f9b\u67d0\u4e2aTrait\u7684\u9ed8\u8ba4\u5b9e\u73b0\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u5b9a\u4e49-1",children:"\u5b9a\u4e49"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use proc_macro::TokenStream;\nuse quote::quote;\nuse syn;\n\n#[proc_macro_derive(HelloMacro)]\npub fn hello_macro_derive(input: TokenStream) -> TokenStream {\n    // Construct a representation of Rust code as a syntax tree\n    // that we can manipulate\n    let ast = syn::parse(input).unwrap();\n\n    // Build the trait implementation\n    impl_hello_macro(&ast)\n}\n\nfn impl_hello_macro(ast: &syn::DeriveInput) -> TokenStream {\n    let name = &ast.ident;\n    let gen = quote! {\n        impl HelloMacro for #name {\n            fn hello_macro() {\n                println!("Hello, Macro! My name is {}!", stringify!(#name));\n            }\n        }\n    };\n    gen.into()\n}\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u4f7f\u7528-1",children:"\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"use hello_macro::HelloMacro;\nuse hello_macro_derive::HelloMacro;\n\n#[derive(HelloMacro)]\nstruct Pancakes;\n\nfn main() {\n    Pancakes::hello_macro();\n}\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u5c5e\u6027\u5b8f",children:"\u5c5e\u6027\u5b8f"}),"\n",(0,r.jsx)(e.p,{children:"\u5c5e\u6027\u5b8f\u4e0d\u4ec5\u53ef\u4ee5\u88ab\u7528\u6765\u66ff\u6362\u7ed3\u6784\u4f53\u548c\u679a\u4e3e\uff0c\u8fd8\u80fd\u66ff\u6362\u51fd\u6570\u7b49\u6e90\u4ee3\u7801\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u4f7f\u7528\u5c5e\u6027\u5b8f\u7684\u65f6\u5019\u53ef\u4ee5\u63a5\u6536\u66f4\u591a\u989d\u5916\u7684\u53c2\u6570\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u5b9a\u4e49-2",children:"\u5b9a\u4e49"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"#[proc_macro_attribute]\npub fn route(attr: TokenStream, item: TokenStream) -> TokenStream {\n}\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u4f7f\u7528-2",children:"\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'#[route(GET, "/")]\nfn index() {\n}\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u51fd\u6570\u5f0f\u5b8f",children:"\u51fd\u6570\u5f0f\u5b8f"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u5f0f\u5b8f\u5728\u4f7f\u7528\u4e0a\u7c7b\u4f3c\u4e8e\u76f4\u63a5\u8c03\u7528\u51fd\u6570\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u5b9a\u4e49-3",children:"\u5b9a\u4e49"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"#[proc_macro]\npub fn sql(input: TokenStream) -> TokenStream {\n}\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u4f7f\u7528-3",children:"\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"let sql = sql!(SELECT * FROM posts WHERE id=1);\n"})})]})}function o(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(u,{...n})}):u(n)}},28453(n,e,l){l.d(e,{R:()=>t,x:()=>a});var s=l(96540);const r={},i=s.createContext(r);function t(n){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);