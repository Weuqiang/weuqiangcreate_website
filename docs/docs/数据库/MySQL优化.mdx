---
sidebar_position: 1
title: MySQL
---

# MySQL

MySQL

## 

### 

```sql
-- 
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50)
);

-- 
CREATE UNIQUE INDEX idx_email ON users(email);

-- 
CREATE INDEX idx_name ON users(name);

-- 
CREATE INDEX idx_name_age ON users(name, age);

-- 
CREATE FULLTEXT INDEX idx_content ON articles(content);
```

### 

```sql
-- 1. 
CREATE INDEX idx_abc ON table(a, b, c);
-- : a, ab, abc
-- : b, c, bc

-- 2. 
--  
SELECT * FROM users WHERE YEAR(created_at) = 2024;
--  
SELECT * FROM users WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01';

--  LIKE
SELECT * FROM users WHERE name LIKE '%john%';
--  
SELECT * FROM users WHERE name LIKE 'john%';

-- 3. 
CREATE INDEX idx_name_age ON users(name, age);
-- 
SELECT name, age FROM users WHERE name = 'John';
```

## 

### EXPLAIN

```sql
EXPLAIN SELECT * FROM orders 
WHERE user_id = 1 AND status = 'completed';

-- 
-- type: ALL() < index < range < ref < eq_ref < const
-- key: 
-- rows: 
-- Extra: 
```

### 

```sql
-- 
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;  -- 2

-- 
-- mysqldumpslow
```

### 

```sql
-- 1. SELECT *
--  
SELECT * FROM users WHERE id = 1;
--  
SELECT id, name, email FROM users WHERE id = 1;

-- 2. LIMIT
SELECT * FROM users ORDER BY created_at DESC LIMIT 10;

-- 3. JOIN
--  
SELECT * FROM orders WHERE user_id IN (
    SELECT id FROM users WHERE status = 'active'
);
--  
SELECT o.* FROM orders o
INNER JOIN users u ON o.user_id = u.id
WHERE u.status = 'active';

-- 4. 
--  
INSERT INTO users (name) VALUES ('Alice');
INSERT INTO users (name) VALUES ('Bob');
--  
INSERT INTO users (name) VALUES ('Alice'), ('Bob'), ('Charlie');

-- 5. 
--  OFFSET
SELECT * FROM users ORDER BY id LIMIT 10000, 10;
--  WHERE
SELECT * FROM users WHERE id > 10000 ORDER BY id LIMIT 10;
```

## 

### 

```sql
-- 
SELECT @@transaction_isolation;

-- 
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- 
-- 1. READ UNCOMMITTED
-- 2. READ COMMITTED
-- 3. REPEATABLE READMySQL
-- 4. SERIALIZABLE
```

### 

```sql
-- 
BEGIN;
SELECT * FROM users WHERE id = 1 FOR UPDATE;  -- 
UPDATE users SET balance = balance - 100 WHERE id = 1;
COMMIT;

-- 
SELECT * FROM users WHERE id = 1 LOCK IN SHARE MODE;

-- 
SHOW ENGINE INNODB STATUS;
```

## 

### 

```ini
# my.cnf
[mysqld]
server-id = 1
log-bin = mysql-bin
binlog-format = ROW
```

### 

```ini
# my.cnf
[mysqld]
server-id = 2
relay-log = mysql-relay-bin
read-only = 1
```

### 

```sql
-- 
CREATE USER 'repl'@'%' IDENTIFIED BY 'password';
GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';

-- binlog
SHOW MASTER STATUS;

-- 
CHANGE MASTER TO
    MASTER_HOST='192.168.1.10',
    MASTER_USER='repl',
    MASTER_PASSWORD='password',
    MASTER_LOG_FILE='mysql-bin.000001',
    MASTER_LOG_POS=154;

-- 
START SLAVE;

-- 
SHOW SLAVE STATUS\G
```

## 

### 

```sql
-- 
-- 
CREATE DATABASE user_db;
-- 
CREATE DATABASE order_db;
-- 
CREATE DATABASE product_db;
```

### 

```sql
-- ID
CREATE TABLE users_0 LIKE users;
CREATE TABLE users_1 LIKE users;
CREATE TABLE users_2 LIKE users;
CREATE TABLE users_3 LIKE users;

-- user_id % 4
```

### 

```python
def get_table_name(user_id, table_count=4):
    """ID"""
    table_index = user_id % table_count
    return f"users_{table_index}"

def get_db_name(user_id, db_count=2):
    """ID"""
    db_index = (user_id // 1000000) % db_count
    return f"user_db_{db_index}"
```

## 

### 

```sql
-- 
SHOW STATUS LIKE 'Threads_connected';
SHOW STATUS LIKE 'Max_used_connections';

-- QPS/TPS
SHOW GLOBAL STATUS LIKE 'Questions';
SHOW GLOBAL STATUS LIKE 'Com_commit';

-- 
SHOW STATUS LIKE 'Qcache_hits';
SHOW STATUS LIKE 'Qcache_inserts';

-- InnoDB
SHOW ENGINE INNODB STATUS;

-- 
SELECT 
    table_schema,
    table_name,
    ROUND(data_length / 1024 / 1024, 2) AS data_mb,
    ROUND(index_length / 1024 / 1024, 2) AS index_mb
FROM information_schema.tables
WHERE table_schema = 'mydb'
ORDER BY data_length DESC;
```

## 

### 

```bash
# mysqldump
mysqldump -u root -p \
    --single-transaction \
    --master-data=2 \
    --databases mydb > backup.sql

# 
mysql -u root -p mydb < backup.sql
```

### 

```bash
# xtrabackup
xtrabackup --backup \
    --target-dir=/backup/full \
    --user=root \
    --password=password

# 
xtrabackup --prepare --target-dir=/backup/full

# 
xtrabackup --copy-back --target-dir=/backup/full
```

## 

1. ****
2. ****ANALYZE TABLE
3. ****
4. ****
5. ****
6. ****+
7. ****
8. ****

## 

MySQL
-  
-  SQL
-  
-  
-  
-  

