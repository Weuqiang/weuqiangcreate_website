---
sidebar_position: 2
title: React
tags: [, React, , Hooks, DOM]
---

# React

React

## 

### React DevTools Profiler

```javascript
// Profiler
import { Profiler } from 'react';

function App() {
  const onRenderCallback = (
    id,                   // 
    phase,                // "mount"  "update"
    actualDuration,       // 
    baseDuration,         // memoization
    startTime,            // 
    commitTime,           // 
    interactions          // interactions
  ) => {
    console.log(`${id} ${phase} phase:`);
    console.log(`Actual duration: ${actualDuration}ms`);
    console.log(`Base duration: ${baseDuration}ms`);
  };
  
  return (
    <Profiler id="App" onRender={onRenderCallback}>
      <div>
        <Header />
        <Main />
        <Footer />
      </div>
    </Profiler>
  );
}
```

### Chrome Performance

```javascript
// 
function expensiveOperation() {
  performance.mark('expensive-start');
  
  // 
  for (let i = 0; i < 1000000; i++) {
    // ...
  }
  
  performance.mark('expensive-end');
  performance.measure('expensive', 'expensive-start', 'expensive-end');
  
  const measure = performance.getEntriesByName('expensive')[0];
  console.log(`: ${measure.duration}ms`);
}
```

## 

### React.memo

```javascript
//  
function Child({ name }) {
  console.log('Child render');
  return <div>{name}</div>;
}

//  React.memoprops
const Child = React.memo(function Child({ name }) {
  console.log('Child render');
  return <div>{name}</div>;
});

// 
const Child = React.memo(
  function Child({ user }) {
    return <div>{user.name}</div>;
  },
  (prevProps, nextProps) => {
    // true
    return prevProps.user.id === nextProps.user.id;
  }
);

// 
function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('John');
  
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>
        Count: {count}
      </button>
      <Child name={name} />
      {/* countChild */}
    </div>
  );
}
```

### useMemo

```javascript
//  
function Component({ items }) {
  const expensiveValue = computeExpensiveValue(items);
  return <div>{expensiveValue}</div>;
}

//  useMemoitems
function Component({ items }) {
  const expensiveValue = useMemo(() => {
    console.log('expensiveValue');
    return computeExpensiveValue(items);
  }, [items]);
  
  return <div>{expensiveValue}</div>;
}

// 
function TodoList({ todos, filter, sortBy }) {
  const filteredAndSortedTodos = useMemo(() => {
    console.log('');
    
    let result = todos;
    
    // 
    if (filter) {
      result = result.filter(todo => 
        todo.title.includes(filter)
      );
    }
    
    // 
    if (sortBy === 'date') {
      result = result.sort((a, b) => 
        new Date(b.createdAt) - new Date(a.createdAt)
      );
    } else if (sortBy === 'priority') {
      result = result.sort((a, b) => 
        b.priority - a.priority
      );
    }
    
    return result;
  }, [todos, filter, sortBy]);
  
  return (
    <ul>
      {filteredAndSortedTodos.map(todo => (
        <li key={todo.id}>{todo.title}</li>
      ))}
    </ul>
  );
}
```

### useCallback

```javascript
//  
function Parent() {
  const [count, setCount] = useState(0);
  
  const handleClick = () => {
    console.log('clicked');
  };
  
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>
        Count: {count}
      </button>
      <Child onClick={handleClick} />
      {/* handleClickChild */}
    </div>
  );
}

//  useCallback
function Parent() {
  const [count, setCount] = useState(0);
  
  const handleClick = useCallback(() => {
    console.log('clicked');
  }, []); // 
  
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>
        Count: {count}
      </button>
      <Child onClick={handleClick} />
      {/* handleClickChild */}
    </div>
  );
}

// useCallback
function SearchBox({ onSearch }) {
  const [query, setQuery] = useState('');
  
  const handleSearch = useCallback(() => {
    onSearch(query);
  }, [query, onSearch]); // queryonSearch
  
  return (
    <div>
      <input 
        value={query} 
        onChange={e => setQuery(e.target.value)} 
      />
      <button onClick={handleSearch}>Search</button>
    </div>
  );
}
```

## 

### 

```javascript
import { useState, useRef, useEffect } from 'react';

function VirtualList({ items, itemHeight, containerHeight }) {
  const [scrollTop, setScrollTop] = useState(0);
  const containerRef = useRef(null);
  
  // 
  const visibleCount = Math.ceil(containerHeight / itemHeight);
  const startIndex = Math.floor(scrollTop / itemHeight);
  const endIndex = Math.min(startIndex + visibleCount + 1, items.length);
  
  // 
  const visibleItems = items.slice(startIndex, endIndex);
  
  // 
  const totalHeight = items.length * itemHeight;
  
  // 
  const offsetY = startIndex * itemHeight;
  
  const handleScroll = (e) => {
    setScrollTop(e.target.scrollTop);
  };
  
  return (
    <div
      ref={containerRef}
      style={{
        height: containerHeight,
        overflow: 'auto'
      }}
      onScroll={handleScroll}
    >
      <div style={{ height: totalHeight, position: 'relative' }}>
        <div style={{ transform: `translateY(${offsetY}px)` }}>
          {visibleItems.map((item, index) => (
            <div
              key={startIndex + index}
              style={{ height: itemHeight }}
            >
              {item.content}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// 
function App() {
  const items = Array.from({ length: 10000 }, (_, i) => ({
    id: i,
    content: `Item ${i}`
  }));
  
  return (
    <VirtualList
      items={items}
      itemHeight={50}
      containerHeight={600}
    />
  );
}
```

### key

```javascript
//  key
function BadList({ items }) {
  return (
    <ul>
      {items.map((item, index) => (
        <li key={index}>{item.name}</li>
      ))}
    </ul>
  );
}

//  IDkey
function GoodList({ items }) {
  return (
    <ul>
      {items.map(item => (
        <li key={item.id}>{item.name}</li>
      ))}
    </ul>
  );
}

// key
const items1 = [
  { id: 1, name: 'A' },
  { id: 2, name: 'B' },
  { id: 3, name: 'C' }
];

const items2 = [
  { id: 1, name: 'A' },
  { id: 4, name: 'D' }, // 
  { id: 2, name: 'B' },
  { id: 3, name: 'C' }
];

// indexkeyReact
// idkeyReact
```

## 

### 

```javascript
//  
function BadComponent() {
  const [state, setState] = useState({
    user: { name: 'John', age: 30 },
    posts: [],
    comments: [],
    loading: false
  });
  
  // user
  const updateUser = (name) => {
    setState(prev => ({
      ...prev,
      user: { ...prev.user, name }
    }));
  };
  
  return <div>...</div>;
}

//  
function GoodComponent() {
  const [user, setUser] = useState({ name: 'John', age: 30 });
  const [posts, setPosts] = useState([]);
  const [comments, setComments] = useState([]);
  const [loading, setLoading] = useState(false);
  
  // user
  const updateUser = (name) => {
    setUser(prev => ({ ...prev, name }));
  };
  
  return <div>...</div>;
}
```

### Context

```javascript
//  Context
const AppContext = createContext();

function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  const [language, setLanguage] = useState('en');
  
  return (
    <AppContext.Provider value={{ user, setUser, theme, setTheme, language, setLanguage }}>
      {children}
    </AppContext.Provider>
  );
}

//  Context
const UserContext = createContext();
const ThemeContext = createContext();
const LanguageContext = createContext();

function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  const [language, setLanguage] = useState('en');
  
  return (
    <UserContext.Provider value={{ user, setUser }}>
      <ThemeContext.Provider value={{ theme, setTheme }}>
        <LanguageContext.Provider value={{ language, setLanguage }}>
          {children}
        </LanguageContext.Provider>
      </ThemeContext.Provider>
    </UserContext.Provider>
  );
}

// useMemoContext value
function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  
  const value = useMemo(() => ({ user, setUser }), [user]);
  
  return (
    <UserContext.Provider value={value}>
      {children}
    </UserContext.Provider>
  );
}
```

## 

### React.lazy

```javascript
import { lazy, Suspense } from 'react';

// 
const Dashboard = lazy(() => import('./Dashboard'));
const Profile = lazy(() => import('./Profile'));
const Settings = lazy(() => import('./Settings'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Routes>
        <Route path="/dashboard" element={<Dashboard />} />
        <Route path="/profile" element={<Profile />} />
        <Route path="/settings" element={<Settings />} />
      </Routes>
    </Suspense>
  );
}

// 
const Dashboard = lazy(() => import('./Dashboard'));

function App() {
  const preloadDashboard = () => {
    // 
    import('./Dashboard');
  };
  
  return (
    <nav>
      <Link 
        to="/dashboard" 
        onMouseEnter={preloadDashboard}
      >
        Dashboard
      </Link>
    </nav>
  );
}
```

### 

```javascript
function LazyImage({ src, alt, placeholder }) {
  const [imageSrc, setImageSrc] = useState(placeholder);
  const [isLoaded, setIsLoaded] = useState(false);
  const imgRef = useRef(null);
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            setImageSrc(src);
            observer.disconnect();
          }
        });
      },
      { threshold: 0.1 }
    );
    
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
    return () => observer.disconnect();
  }, [src]);
  
  return (
    <img
      ref={imgRef}
      src={imageSrc}
      alt={alt}
      onLoad={() => setIsLoaded(true)}
      style={{
        opacity: isLoaded ? 1 : 0,
        transition: 'opacity 0.3s'
      }}
    />
  );
}
```

## 

### 

```javascript
import { useCallback, useRef } from 'react';

// Hook
function useDebounce(callback, delay) {
  const timeoutRef = useRef(null);
  
  return useCallback((...args) => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    
    timeoutRef.current = setTimeout(() => {
      callback(...args);
    }, delay);
  }, [callback, delay]);
}

// Hook
function useThrottle(callback, delay) {
  const lastRunRef = useRef(Date.now());
  
  return useCallback((...args) => {
    const now = Date.now();
    
    if (now - lastRunRef.current >= delay) {
      callback(...args);
      lastRunRef.current = now;
    }
  }, [callback, delay]);
}

// 
function SearchBox() {
  const [query, setQuery] = useState('');
  
  const handleSearch = useCallback((value) => {
    console.log(':', value);
    // API
  }, []);
  
  const debouncedSearch = useDebounce(handleSearch, 500);
  
  const handleChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    debouncedSearch(value);
  };
  
  return (
    <input
      value={query}
      onChange={handleChange}
      placeholder="..."
    />
  );
}

// 
function ScrollComponent() {
  const handleScroll = useCallback(() => {
    console.log(':', window.scrollY);
  }, []);
  
  const throttledScroll = useThrottle(handleScroll, 200);
  
  useEffect(() => {
    window.addEventListener('scroll', throttledScroll);
    return () => window.removeEventListener('scroll', throttledScroll);
  }, [throttledScroll]);
  
  return <div>...</div>;
}
```

## 

### 

```javascript
//  
function Component({ isLoading, data }) {
  return (
    <div>
      {isLoading ? <Loading /> : <DataView data={data} />}
    </div>
  );
}

//  &&
function Component({ isLoading, data }) {
  return (
    <div>
      {isLoading && <Loading />}
      {!isLoading && <DataView data={data} />}
    </div>
  );
}

//  
function Component({ isLoading, data }) {
  if (isLoading) {
    return <Loading />;
  }
  
  return <DataView data={data} />;
}
```

### Fragment

```javascript
//  div
function Component() {
  return (
    <div>
      <Header />
      <Main />
      <Footer />
    </div>
  );
}

//  Fragment
function Component() {
  return (
    <>
      <Header />
      <Main />
      <Footer />
    </>
  );
}

// keyFragment
function List({ items }) {
  return (
    <>
      {items.map(item => (
        <Fragment key={item.id}>
          <dt>{item.term}</dt>
          <dd>{item.description}</dd>
        </Fragment>
      ))}
    </>
  );
}
```

## 

### useTransition

```javascript
import { useState, useTransition } from 'react';

function SearchResults() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();
  
  const handleChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    
    // 
    startTransition(() => {
      const filtered = largeDataset.filter(item =>
        item.name.includes(value)
      );
      setResults(filtered);
    });
  };
  
  return (
    <div>
      <input value={query} onChange={handleChange} />
      {isPending && <div>...</div>}
      <ul>
        {results.map(item => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}
```

### useDeferredValue

```javascript
import { useState, useDeferredValue, useMemo } from 'react';

function SearchResults() {
  const [query, setQuery] = useState('');
  const deferredQuery = useDeferredValue(query);
  
  const results = useMemo(() => {
    return largeDataset.filter(item =>
      item.name.includes(deferredQuery)
    );
  }, [deferredQuery]);
  
  return (
    <div>
      <input 
        value={query} 
        onChange={e => setQuery(e.target.value)} 
      />
      <ul>
        {results.map(item => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}
```

## 

```javascript
// Hook
function usePerformance(componentName) {
  useEffect(() => {
    const startTime = performance.now();
    
    return () => {
      const endTime = performance.now();
      const duration = endTime - startTime;
      
      console.log(`${componentName} : ${duration}ms`);
      
      // 
      reportPerformance({
        component: componentName,
        duration,
        timestamp: Date.now()
      });
    };
  });
}

// 
function ExpensiveComponent() {
  usePerformance('ExpensiveComponent');
  
  return <div>...</div>;
}
```

## 

React
-  ****React.memouseMemouseCallback
-  ****key
-  ****Context
-  ****
-  ****
-  ****useTransitionuseDeferredValue

****

