
# 
## http

```javascript
const http = require('http')
const server = http.createServer((req, res) => {
    console.log(req.url) // url
    console.log(req.method) // 
    console.log(req.headers) // 

    if (req.url === '/') {
        // 
        res.writeHead(200, {'Content-Type': 'text/plain; charset=utf-8'})

        // 
        res.statusCode = 200
        // 
        res.setHeader('Content-Type', 'text/plain; charset=utf-8')
        // Set-Cookie
        res.setHeader('Set-Cookie', 'name=akara; secure')

        // 
        res.write("hello world")
        res.write("!!!")
        // 
        res.end()
    }

})

server.listen(3000, () => {
    console.log("3000")
})
```

### 

```javascript
const http = require('http')
const server = http.createServer((req, res) => {
    if (req.url === '/') {
        // ...
    }
    else {
        let filePath = path.join(__dirname, 'static', url.pathname)
        try {
            let file = await fs.readFileAsync(filePath)
            res.statusCode = 200
            res.end(file)
        } catch (error) {
            res.statusCode = 404
            res.end("404 Not Found")
        }
    }
    // 
    else {
        let fileName = url.pathname
        let type
        switch(fileName.substr(fileName.lastIndexOf('.') + 1)) {
            case 'css':
                type = 'text/css; charset=utf-8'
                break
            case 'js':
                type = 'applaction/javascript; charset=utf-8'
                break
            // other situations 
            default:
                type = 'application/octet-stream'
                break
        }
        try {
            let file = await fs.readFileAsync(`./static${url.pathname}`)
            res.writeHead(200, {'Content-Type': type})
            res.end(file)
        } catch (error) {
            res.writeHead(400, {'Content-Type': 'text/plain; charset=utf-8'})
            res.end("404")
        }
    }
}).listen(3000)


```

### Post

```javascript
//  ()
let type = typeof data
let header
if (type === 'string') {
    header = 'application/x-www-form-urlencoded'
}
else if (data instanceof File || data instanceof FormData) {
    header = 'multipart/form-data; boundary=---xxxxxxxxxxxx'
}
else {
    header = 'application/json'
    data = JSON.stringify(data)
}
xhr.setRequestHeader('Content-type', header)
xhr.send(data)


// 
const http = require('http')
const fs = require('fs')
const server = http.createServer((req, res) => {
    if (req.url === '/upload') {

        let segment = []

        req.on('data', (chunk) => {
            // chunkBuffer
            // aaa=bbbBuffer
            // <Buffer 61 61 61 3d 62 62 62>
            segment.push(chunk)
        })

        req.on('end', () => {
            // 
            segment = Buffer.concat(segment)
            // buffer
            // segment = Buffer.concat(segment).toString()
            fs.writeFile('fileName', segment, (err) => {
                res.writeHead(200, {'Content-Type': 'text/plain; charset=utf-8'})
                res.write("")
                res.end()
            })
        })
    }
})

server.listen(3000, () => {
    console.log("3000")
})
```

## fs

```javascript
const fs = require('fs')
```

### `readFile`

```javascript
fs.readFile('./image.png', (err, buffer) => {
    if (err) throw err
})
```

### `writeFile`

```javascript
// 
fs.writeFile('index.txt', 'hello world', 'utf8')
// buffer
fs.writeFile('image.png', buffer)
```

### `createReadStream`

### `createWriteStream`

```javascript
const reader = fs.createReadStream(data.path)
const stream = fs.createWriteStream(`./image/${Math.floor(Math.random() * 10000)}.jpg`)
reader.pipe(stream)
```

## path

```javascript
const path = require('path')
```

### `__dirname`

****

### `path.resolve`

```js
const url = path.resolve('./static')
// 
const url = path.join(process.cwd(), './static')
```

`process.cwd()`****



### `require.resolve`

> 

``` js
const url = require.resolve('webpack') // /path/to/project/node_modules/webpack/lib/index.js
```





### `path.join`

****Linux `/`Windows `\`

```javascript
const path1 = path.join('a', 'b') // 'a/b'
const path2 = path.join('a', 'b', '../c') // 'a/c'
const path3 = path.join(__dirname, '..', 'b') 
```



## process

### `process.cwd()`

 `fs.readFile` `./index.html` `process.cwd()`



```js
fs.readFile(`${__dirname}/../index.html`)
fs.readFile(path.join(__dirname, '../index.html'))
```

### `process.argv`



```js
$node index.js abc
[
    'node',
    'index.js',
    'abc'
] // process.argv
```



### `process.env`

 `Node` `process.env`

#### cross-env

 `cross-env`

```json
// package.json
{
    "script": {
        "start": "cross-env NODE_ENV=development node app.js"
    }
}
```

#### dotenv

 `.env` `dotenv` `.env`

```.env
NODE_ENV=development
name=aka
```

```js
// app.js
const dotenv = require('dotenv')
dotenv.config() // .env

console.log(process.env.NODE_ENV)
```

 `config.js`

```js
// config.js
const dotenv = require('dotenv')
dotenv.config()

module.exports = {
    NODE_ENV: process.env.NODE_ENV,
    name: process.env.name
}
```

```js
// app.js
const { NODE_ENV, name } = require('./config.js')
console.log(NODE_ENV, name)
```



### `process.stdin`



```js
process.stdin.on('data', (chunk) => {
    process.stdout.write('Hello' + chunk)
    process.exit()
})
```

### `process.stdout`



```js
process.stdout.write('Hello world')
```

### 



## util



### `deprecate`

```js
const util = require('util')
function A() {
    console.log('aaa');
}

module.exports = util.deprecate(A, 'A() is deprecated. Use B() instead.')
```

### `promisify`

```js
const util = require('util')
const fs = require('fs')
const readFile = util.promisify(fs.readFile)

async function A() {
    const data = await readFile('./index.html') 
}
```

## child_process

Node `child_process` `folk``exec``execFile``spawn`

 `fork`Node `shell`

### `fork`

```js
// parent.js
const cp = require('child_process')
const path = require('path')
const child = cp.fork('./child.js')

child.on('message', (msg) => { // 
  	console.log(msg);
  	child.disconnect()
})
child.send('hello')

// child.js
process.on('message', (msg) => {
  	console.log(msg);
  	process.send('akara')
})
```

`exec`Node `shell` `rm / -rf` `execFile` `spawn` `execFile`

### `exec`

```js
const exec = util.promisify(cp.exec)

(async function () {
  const res = await exec(cat ${file})
  console.log(res.stdout);
})()
```

### `execFile`

```js
const exec = util.promisify(cp.execFile)

(async function () {
  	const res = await exec('cat', [file])
  	console.log(res.stdout);
})()
```

### `spawn`

`spawn` `pipe`

```js
const cat = cp.spawn('cat', [file])
const sort = cp.spawn('sort')

cat.stdout.pipe(sort.stdin)
sort.stdout.pipe(process.stdout)
```

## cluster

clusternode



```js
var cluster = require('cluster');
var http = require('http');
var numCPUs = require('os').cpus().length; // CPU

if (cluster.isMaster) {
  for (var i = 0; i < numCPUs; i++) {
    cluster.fork();
 }

  cluster.on('exit', function(worker, code, signal) {
    console.log('worker ' + worker.process.pid + ' died');
 });
} else {
  http.createServer(function(req, res) {
    res.writeHead(200);
    res.end("hello world\n");
 }).listen(8000);
}

```

CPUserver8000clusterserver

clusterprocess.on('message')

windowsclusterround-robin8...

windowsround-robin

`cluster.schedulingPolicy = cluster.SCHED_RR;`

pm2cluster8

`pm2 start app.js -i 8`

## url

```javascript
// url http://localhost:3000/index.html?name=akara#aa
const url = require('url')
let {
    search, // '?name=akara'
    query, // 'name=akara'
    pathname, // '/index.html'
    path, // '/index.html?name=akara'
} = url.parse(req.url)
```

## querystring

```javascript
const qs = require('querystring')
var str = 'foo=bar&abc=xyz&abc=123';

querystring.parse(str)
// { foo: 'bar', abc: [ 'xyz', '123' ] }
```

## os



```js
const os = require('os')
const homedir = os.homedir() // 
```

## event

> -

```javascript
var EventEmitter = require('events').EventEmitter
var emitter = new EventEmitter()

emitter.on('ev', function () {

})

emitter.emit('ev')
```

---

Node
