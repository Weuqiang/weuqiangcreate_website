"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[3863],{29475(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"\u6570\u636e\u5e93/redis","title":"Redis - \u9ad8\u6027\u80fd\u7f13\u5b58\u6570\u636e\u5e93","description":"Redis\u662f\u6700\u6d41\u884c\u7684\u5185\u5b58\u6570\u636e\u5e93\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60\u7528Redis\u6784\u5efa\u9ad8\u6027\u80fd\u5e94\u7528\u3002","source":"@site/docs/docs/\u6570\u636e\u5e93/redis.mdx","sourceDirName":"\u6570\u636e\u5e93","slug":"/\u6570\u636e\u5e93/redis","permalink":"/weuqiangcreate_website/docs/\u6570\u636e\u5e93/redis","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Redis - \u9ad8\u6027\u80fd\u7f13\u5b58\u6570\u636e\u5e93"},"sidebar":"tutorialSidebar","previous":{"title":"MongoDB - \u7075\u6d3b\u7684\u6587\u6863\u6570\u636e\u5e93","permalink":"/weuqiangcreate_website/docs/\u6570\u636e\u5e93/mongodb"},"next":{"title":"\u6570\u5b66\u57fa\u7840","permalink":"/weuqiangcreate_website/docs/\u6570\u5b66\u57fa\u7840/"}}');var i=r(74848),l=r(28453);const t={sidebar_position:3,title:"Redis - \u9ad8\u6027\u80fd\u7f13\u5b58\u6570\u636e\u5e93"},d="Redis - \u5185\u5b58\u6570\u636e\u5e93\u4e4b\u738b",a={},c=[{value:"\u7b2c\u4e00\u90e8\u5206\uff1aRedis\u57fa\u7840",id:"\u7b2c\u4e00\u90e8\u5206redis\u57fa\u7840",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981Redis\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981redis",level:3},{value:"\u5b89\u88c5\u548c\u8fde\u63a5",id:"\u5b89\u88c5\u548c\u8fde\u63a5",level:3},{value:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u4e94\u5927\u6570\u636e\u7ed3\u6784",id:"\u7b2c\u4e8c\u90e8\u5206\u4e94\u5927\u6570\u636e\u7ed3\u6784",level:2},{value:"1. String\uff08\u5b57\u7b26\u4e32\uff09",id:"1-string\u5b57\u7b26\u4e32",level:3},{value:"2. Hash\uff08\u54c8\u5e0c\uff09",id:"2-hash\u54c8\u5e0c",level:3},{value:"3. List\uff08\u5217\u8868\uff09",id:"3-list\u5217\u8868",level:3},{value:"4. Set\uff08\u96c6\u5408\uff09",id:"4-set\u96c6\u5408",level:3},{value:"5. Sorted Set\uff08\u6709\u5e8f\u96c6\u5408\uff09",id:"5-sorted-set\u6709\u5e8f\u96c6\u5408",level:3},{value:"\u7b2c\u4e09\u90e8\u5206\uff1a\u9ad8\u7ea7\u7279\u6027",id:"\u7b2c\u4e09\u90e8\u5206\u9ad8\u7ea7\u7279\u6027",level:2},{value:"1. \u53d1\u5e03\u8ba2\u9605",id:"1-\u53d1\u5e03\u8ba2\u9605",level:3},{value:"2. \u4e8b\u52a1",id:"2-\u4e8b\u52a1",level:3},{value:"3. Lua\u811a\u672c",id:"3-lua\u811a\u672c",level:3},{value:"\u7b2c\u56db\u90e8\u5206\uff1a\u5b9e\u6218\u5e94\u7528",id:"\u7b2c\u56db\u90e8\u5206\u5b9e\u6218\u5e94\u7528",level:2},{value:"1. \u7f13\u5b58\u7cfb\u7edf",id:"1-\u7f13\u5b58\u7cfb\u7edf",level:3},{value:"2. \u5206\u5e03\u5f0f\u9501",id:"2-\u5206\u5e03\u5f0f\u9501",level:3},{value:"3. \u6392\u884c\u699c\u7cfb\u7edf",id:"3-\u6392\u884c\u699c\u7cfb\u7edf",level:3},{value:"4. \u9650\u6d41\u5668",id:"4-\u9650\u6d41\u5668",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u7ec3\u4e60\u9898",id:"\u7ec3\u4e60\u9898",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"redis---\u5185\u5b58\u6570\u636e\u5e93\u4e4b\u738b",children:"Redis - \u5185\u5b58\u6570\u636e\u5e93\u4e4b\u738b"})}),"\n",(0,i.jsxs)(n.p,{children:["Redis\u662f\u6700\u6d41\u884c\u7684\u5185\u5b58\u6570\u636e\u5e93\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60",(0,i.jsx)(n.strong,{children:"\u7528Redis\u6784\u5efa\u9ad8\u6027\u80fd\u5e94\u7528"}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e00\u90e8\u5206redis\u57fa\u7840",children:"\u7b2c\u4e00\u90e8\u5206\uff1aRedis\u57fa\u7840"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981redis",children:"\u4e3a\u4ec0\u4e48\u9700\u8981Redis\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95ee\u9898"}),"\uff1a\u6570\u636e\u5e93\u67e5\u8be2\u592a\u6162\uff0c\u6bcf\u6b21\u90fd\u8981\u67e5\u6570\u636e\u5e93"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u6bcf\u6b21\u90fd\u67e5\u6570\u636e\u5e93 - \u6162\uff01\ndef get_user(user_id):\n    return db.query("SELECT * FROM users WHERE id = ?", user_id)\n# \u8017\u65f6\uff1a50ms\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3"}),"\uff1a\u7528Redis\u7f13\u5b58"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u5148\u67e5\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u518d\u67e5\u6570\u636e\u5e93\ndef get_user(user_id):\n    # 1. \u5148\u67e5Redis\n    user = redis.get(f"user:{user_id}")\n    if user:\n        return json.loads(user)  # \u8017\u65f6\uff1a1ms\n    \n    # 2. \u7f13\u5b58\u6ca1\u6709\uff0c\u67e5\u6570\u636e\u5e93\n    user = db.query("SELECT * FROM users WHERE id = ?", user_id)\n    \n    # 3. \u5199\u5165\u7f13\u5b58\n    redis.setex(f"user:{user_id}", 3600, json.dumps(user))\n    \n    return user\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u88c5\u548c\u8fde\u63a5",children:"\u5b89\u88c5\u548c\u8fde\u63a5"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Docker\u65b9\u5f0f"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542f\u52a8Redis\ndocker run -d --name redis \\\n  -p 6379:6379 \\\n  redis:latest\n\n# \u8fdb\u5165Redis CLI\ndocker exec -it redis redis-cli\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Python\u8fde\u63a5"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import redis\n\n# \u8fde\u63a5Redis\nr = redis.Redis(host='localhost', port=6379, db=0, decode_responses=True)\n\n# \u6d4b\u8bd5\u8fde\u63a5\nr.ping()  # \u8fd4\u56deTrue\u8868\u793a\u8fde\u63a5\u6210\u529f\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e8c\u90e8\u5206\u4e94\u5927\u6570\u636e\u7ed3\u6784",children:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u4e94\u5927\u6570\u636e\u7ed3\u6784"}),"\n",(0,i.jsx)(n.h3,{id:"1-string\u5b57\u7b26\u4e32",children:"1. String\uff08\u5b57\u7b26\u4e32\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import redis\n\nr = redis.Redis(host='localhost', port=6379, decode_responses=True)\n\n# \u8bbe\u7f6e\u503c\nr.set('name', 'Alice')\n\n# \u83b7\u53d6\u503c\nname = r.get('name')\nprint(name)  # Alice\n\n# \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\nr.setex('session:123', 3600, 'user_data')\n\n# \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff08\u6beb\u79d2\uff09\nr.psetex('token:456', 60000, 'auth_token')\n\n# \u53ea\u6709key\u4e0d\u5b58\u5728\u65f6\u624d\u8bbe\u7f6e\nr.setnx('lock:order', 'locked')\n\n# \u6279\u91cf\u8bbe\u7f6e\nr.mset({'key1': 'value1', 'key2': 'value2'})\n\n# \u6279\u91cf\u83b7\u53d6\nvalues = r.mget(['key1', 'key2'])\n\n# \u8ffd\u52a0\u5b57\u7b26\u4e32\nr.append('name', ' Smith')\n\n# \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\nlength = r.strlen('name')\n\n# \u6570\u503c\u64cd\u4f5c\nr.set('counter', 0)\nr.incr('counter')  # \u52a01\nr.incrby('counter', 10)  # \u52a010\nr.decr('counter')  # \u51cf1\nr.decrby('counter', 5)  # \u51cf5\n\n# \u83b7\u53d6\u5e76\u8bbe\u7f6e\nold_value = r.getset('name', 'Bob')\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5e94\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u7f13\u5b58\uff1a\u7528\u6237\u4fe1\u606f\u3001\u914d\u7f6e\u4fe1\u606f"}),"\n",(0,i.jsx)(n.li,{children:"\u8ba1\u6570\u5668\uff1a\u70b9\u8d5e\u6570\u3001\u6d4f\u89c8\u91cf"}),"\n",(0,i.jsx)(n.li,{children:"\u5206\u5e03\u5f0f\u9501\uff1a\u9632\u6b62\u5e76\u53d1\u95ee\u9898"}),"\n",(0,i.jsx)(n.li,{children:"Session\u5b58\u50a8\uff1a\u7528\u6237\u4f1a\u8bdd"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-hash\u54c8\u5e0c",children:"2. Hash\uff08\u54c8\u5e0c\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u8bbe\u7f6ehash\u5b57\u6bb5\nr.hset('user:1', 'name', 'Alice')\nr.hset('user:1', 'age', 25)\n\n# \u6279\u91cf\u8bbe\u7f6e\nr.hmset('user:1', {'email': 'alice@example.com', 'city': 'Beijing'})\n\n# \u83b7\u53d6\u5b57\u6bb5\nname = r.hget('user:1', 'name')\n\n# \u6279\u91cf\u83b7\u53d6\nuser = r.hmget('user:1', ['name', 'age', 'email'])\n\n# \u83b7\u53d6\u6240\u6709\u5b57\u6bb5\nuser_data = r.hgetall('user:1')\nprint(user_data)\n# {'name': 'Alice', 'age': '25', 'email': 'alice@example.com', 'city': 'Beijing'}\n\n# \u83b7\u53d6\u6240\u6709\u5b57\u6bb5\u540d\nkeys = r.hkeys('user:1')\n\n# \u83b7\u53d6\u6240\u6709\u503c\nvalues = r.hvals('user:1')\n\n# \u5224\u65ad\u5b57\u6bb5\u662f\u5426\u5b58\u5728\nexists = r.hexists('user:1', 'name')\n\n# \u5220\u9664\u5b57\u6bb5\nr.hdel('user:1', 'city')\n\n# \u5b57\u6bb5\u6570\u91cf\ncount = r.hlen('user:1')\n\n# \u6570\u503c\u64cd\u4f5c\nr.hincrby('user:1', 'age', 1)  # age\u52a01\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5e94\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5bf9\u8c61\u7f13\u5b58\uff1a\u7528\u6237\u5bf9\u8c61\u3001\u5546\u54c1\u5bf9\u8c61"}),"\n",(0,i.jsx)(n.li,{children:"\u8d2d\u7269\u8f66\uff1a\u7528\u6237ID\u4e3akey\uff0c\u5546\u54c1ID\u4e3afield"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-list\u5217\u8868",children:"3. List\uff08\u5217\u8868\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u5de6\u4fa7\u63d2\u5165\nr.lpush('queue', 'task1')\nr.lpush('queue', 'task2', 'task3')\n\n# \u53f3\u4fa7\u63d2\u5165\nr.rpush('queue', 'task4')\n\n# \u5de6\u4fa7\u5f39\u51fa\ntask = r.lpop('queue')\n\n# \u53f3\u4fa7\u5f39\u51fa\ntask = r.rpop('queue')\n\n# \u963b\u585e\u5f39\u51fa\uff08\u961f\u5217\u4e3a\u7a7a\u65f6\u7b49\u5f85\uff09\ntask = r.blpop('queue', timeout=10)\n\n# \u83b7\u53d6\u5217\u8868\u957f\u5ea6\nlength = r.llen('queue')\n\n# \u83b7\u53d6\u8303\u56f4\u5185\u7684\u5143\u7d20\ntasks = r.lrange('queue', 0, -1)  # \u83b7\u53d6\u6240\u6709\n\n# \u83b7\u53d6\u6307\u5b9a\u4f4d\u7f6e\u7684\u5143\u7d20\ntask = r.lindex('queue', 0)\n\n# \u8bbe\u7f6e\u6307\u5b9a\u4f4d\u7f6e\u7684\u5143\u7d20\nr.lset('queue', 0, 'new_task')\n\n# \u5220\u9664\u5143\u7d20\nr.lrem('queue', 1, 'task1')  # \u5220\u96641\u4e2atask1\n\n# \u4fee\u526a\u5217\u8868\nr.ltrim('queue', 0, 99)  # \u53ea\u4fdd\u7559\u524d100\u4e2a\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5e94\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6d88\u606f\u961f\u5217\uff1a\u4efb\u52a1\u961f\u5217\u3001\u901a\u77e5\u961f\u5217"}),"\n",(0,i.jsx)(n.li,{children:"\u6700\u65b0\u5217\u8868\uff1a\u6700\u65b0\u6587\u7ae0\u3001\u6700\u65b0\u8bc4\u8bba"}),"\n",(0,i.jsx)(n.li,{children:"\u65f6\u95f4\u7ebf\uff1a\u5fae\u535a\u65f6\u95f4\u7ebf"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-set\u96c6\u5408",children:"4. Set\uff08\u96c6\u5408\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u6dfb\u52a0\u5143\u7d20\nr.sadd('tags', 'python', 'redis', 'database')\n\n# \u83b7\u53d6\u6240\u6709\u5143\u7d20\ntags = r.smembers('tags')\n\n# \u5224\u65ad\u5143\u7d20\u662f\u5426\u5b58\u5728\nexists = r.sismember('tags', 'python')\n\n# \u5220\u9664\u5143\u7d20\nr.srem('tags', 'database')\n\n# \u968f\u673a\u83b7\u53d6\u5143\u7d20\ntag = r.srandmember('tags')\n\n# \u968f\u673a\u5f39\u51fa\u5143\u7d20\ntag = r.spop('tags')\n\n# \u96c6\u5408\u5927\u5c0f\ncount = r.scard('tags')\n\n# \u96c6\u5408\u8fd0\u7b97\nr.sadd('set1', 'a', 'b', 'c')\nr.sadd('set2', 'b', 'c', 'd')\n\n# \u4ea4\u96c6\ninter = r.sinter('set1', 'set2')  # {'b', 'c'}\n\n# \u5e76\u96c6\nunion = r.sunion('set1', 'set2')  # {'a', 'b', 'c', 'd'}\n\n# \u5dee\u96c6\ndiff = r.sdiff('set1', 'set2')  # {'a'}\n\n# \u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u65b0\u96c6\u5408\nr.sinterstore('result', 'set1', 'set2')\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5e94\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6807\u7b7e\u7cfb\u7edf\uff1a\u6587\u7ae0\u6807\u7b7e\u3001\u7528\u6237\u6807\u7b7e"}),"\n",(0,i.jsx)(n.li,{children:"\u5171\u540c\u597d\u53cb\uff1a\u793e\u4ea4\u5173\u7cfb"}),"\n",(0,i.jsx)(n.li,{children:"\u53bb\u91cd\uff1a\u552f\u4e00\u8bbf\u5ba2\u7edf\u8ba1"}),"\n",(0,i.jsx)(n.li,{children:"\u62bd\u5956\u7cfb\u7edf\uff1a\u968f\u673a\u62bd\u53d6"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"5-sorted-set\u6709\u5e8f\u96c6\u5408",children:"5. Sorted Set\uff08\u6709\u5e8f\u96c6\u5408\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u6dfb\u52a0\u5143\u7d20\uff08\u5e26\u5206\u6570\uff09\nr.zadd('rank', {'alice': 100, 'bob': 90, 'charlie': 95})\n\n# \u83b7\u53d6\u5206\u6570\nscore = r.zscore('rank', 'alice')\n\n# \u589e\u52a0\u5206\u6570\nr.zincrby('rank', 10, 'bob')  # bob\u7684\u5206\u6570\u52a010\n\n# \u83b7\u53d6\u6392\u540d\uff08\u4ece0\u5f00\u59cb\uff09\nrank = r.zrank('rank', 'alice')  # \u5347\u5e8f\u6392\u540d\nrank = r.zrevrank('rank', 'alice')  # \u964d\u5e8f\u6392\u540d\n\n# \u83b7\u53d6\u8303\u56f4\u5185\u7684\u5143\u7d20\n# \u6309\u7d22\u5f15\ntop3 = r.zrange('rank', 0, 2, withscores=True)  # \u5347\u5e8f\ntop3 = r.zrevrange('rank', 0, 2, withscores=True)  # \u964d\u5e8f\n\n# \u6309\u5206\u6570\nusers = r.zrangebyscore('rank', 90, 100, withscores=True)\n\n# \u5220\u9664\u5143\u7d20\nr.zrem('rank', 'charlie')\n\n# \u5220\u9664\u8303\u56f4\u5185\u7684\u5143\u7d20\nr.zremrangebyrank('rank', 0, 2)  # \u5220\u9664\u6392\u540d0-2\u7684\u5143\u7d20\nr.zremrangebyscore('rank', 0, 60)  # \u5220\u9664\u5206\u65700-60\u7684\u5143\u7d20\n\n# \u96c6\u5408\u5927\u5c0f\ncount = r.zcard('rank')\n\n# \u5206\u6570\u8303\u56f4\u5185\u7684\u5143\u7d20\u6570\u91cf\ncount = r.zcount('rank', 90, 100)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5e94\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6392\u884c\u699c\uff1a\u6e38\u620f\u6392\u884c\u3001\u70ed\u95e8\u6587\u7ae0"}),"\n",(0,i.jsx)(n.li,{children:"\u5ef6\u65f6\u961f\u5217\uff1a\u5b9a\u65f6\u4efb\u52a1"}),"\n",(0,i.jsx)(n.li,{children:"\u8303\u56f4\u67e5\u8be2\uff1a\u4ef7\u683c\u7b5b\u9009"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u4e09\u90e8\u5206\u9ad8\u7ea7\u7279\u6027",children:"\u7b2c\u4e09\u90e8\u5206\uff1a\u9ad8\u7ea7\u7279\u6027"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u53d1\u5e03\u8ba2\u9605",children:"1. \u53d1\u5e03\u8ba2\u9605"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import redis\nimport threading\n\nr = redis.Redis(host='localhost', port=6379)\n\n# \u8ba2\u9605\u8005\ndef subscriber():\n    pubsub = r.pubsub()\n    pubsub.subscribe('news')\n    \n    print(\"\u7b49\u5f85\u6d88\u606f...\")\n    for message in pubsub.listen():\n        if message['type'] == 'message':\n            print(f\"\u6536\u5230\u6d88\u606f: {message['data'].decode()}\")\n\n# \u53d1\u5e03\u8005\ndef publisher():\n    import time\n    time.sleep(1)\n    \n    for i in range(5):\n        r.publish('news', f'\u65b0\u95fb{i}')\n        time.sleep(1)\n\n# \u542f\u52a8\u8ba2\u9605\u8005\u7ebf\u7a0b\nt = threading.Thread(target=subscriber, daemon=True)\nt.start()\n\n# \u53d1\u5e03\u6d88\u606f\npublisher()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u4e8b\u52a1",children:"2. \u4e8b\u52a1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u5f00\u59cb\u4e8b\u52a1\npipe = r.pipeline()\n\n# \u6dfb\u52a0\u547d\u4ee4\npipe.set('key1', 'value1')\npipe.set('key2', 'value2')\npipe.incr('counter')\n\n# \u6267\u884c\u4e8b\u52a1\nresults = pipe.execute()\n\n# \u76d1\u89c6key\uff08\u4e50\u89c2\u9501\uff09\nwith r.pipeline() as pipe:\n    while True:\n        try:\n            # \u76d1\u89c6key\n            pipe.watch('balance')\n            \n            # \u83b7\u53d6\u5f53\u524d\u503c\n            balance = int(pipe.get('balance') or 0)\n            \n            # \u68c0\u67e5\u6761\u4ef6\n            if balance < 100:\n                pipe.unwatch()\n                break\n            \n            # \u5f00\u59cb\u4e8b\u52a1\n            pipe.multi()\n            pipe.decrby('balance', 100)\n            \n            # \u6267\u884c\n            pipe.execute()\n            break\n        except redis.WatchError:\n            # \u5982\u679ckey\u88ab\u4fee\u6539\uff0c\u91cd\u8bd5\n            continue\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-lua\u811a\u672c",children:"3. Lua\u811a\u672c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u539f\u5b50\u6027\u64cd\u4f5c\uff1a\u83b7\u53d6\u5e76\u5220\u9664\nlua_script = """\nlocal value = redis.call(\'GET\', KEYS[1])\nif value then\n    redis.call(\'DEL\', KEYS[1])\n    return value\nelse\n    return nil\nend\n"""\n\n# \u6ce8\u518c\u811a\u672c\nget_and_delete = r.register_script(lua_script)\n\n# \u6267\u884c\u811a\u672c\nresult = get_and_delete(keys=[\'mykey\'])\n\n# \u9650\u6d41\u811a\u672c\nrate_limit_script = """\nlocal key = KEYS[1]\nlocal limit = tonumber(ARGV[1])\nlocal window = tonumber(ARGV[2])\n\nlocal current = redis.call(\'INCR\', key)\nif current == 1 then\n    redis.call(\'EXPIRE\', key, window)\nend\n\nif current > limit then\n    return 0\nelse\n    return 1\nend\n"""\n\nrate_limiter = r.register_script(rate_limit_script)\n\n# \u9650\u5236\u6bcf\u79d210\u6b21\u8bf7\u6c42\nallowed = rate_limiter(keys=[\'rate:user:123\'], args=[10, 1])\nif allowed:\n    print("\u8bf7\u6c42\u901a\u8fc7")\nelse:\n    print("\u8bf7\u6c42\u88ab\u9650\u6d41")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b2c\u56db\u90e8\u5206\u5b9e\u6218\u5e94\u7528",children:"\u7b2c\u56db\u90e8\u5206\uff1a\u5b9e\u6218\u5e94\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u7f13\u5b58\u7cfb\u7edf",children:"1. \u7f13\u5b58\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import redis\nimport json\nimport time\nfrom functools import wraps\n\nclass RedisCache:\n    """Redis\u7f13\u5b58\u88c5\u9970\u5668"""\n    \n    def __init__(self, host=\'localhost\', port=6379):\n        self.redis = redis.Redis(host=host, port=port, decode_responses=True)\n    \n    def cache(self, expire=3600, key_prefix=\'\'):\n        """\u7f13\u5b58\u88c5\u9970\u5668"""\n        def decorator(func):\n            @wraps(func)\n            def wrapper(*args, **kwargs):\n                # \u751f\u6210\u7f13\u5b58key\n                cache_key = f"{key_prefix}:{func.__name__}:{args}:{kwargs}"\n                \n                # \u5c1d\u8bd5\u4ece\u7f13\u5b58\u83b7\u53d6\n                cached = self.redis.get(cache_key)\n                if cached:\n                    print(f"\u7f13\u5b58\u547d\u4e2d: {cache_key}")\n                    return json.loads(cached)\n                \n                # \u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u6267\u884c\u51fd\u6570\n                print(f"\u7f13\u5b58\u672a\u547d\u4e2d: {cache_key}")\n                result = func(*args, **kwargs)\n                \n                # \u5199\u5165\u7f13\u5b58\n                self.redis.setex(cache_key, expire, json.dumps(result))\n                \n                return result\n            return wrapper\n        return decorator\n\n# \u4f7f\u7528\ncache = RedisCache()\n\n@cache.cache(expire=60, key_prefix=\'user\')\ndef get_user_info(user_id):\n    """\u6a21\u62df\u6570\u636e\u5e93\u67e5\u8be2"""\n    time.sleep(1)  # \u6a21\u62df\u6162\u67e5\u8be2\n    return {\n        \'id\': user_id,\n        \'name\': f\'User{user_id}\',\n        \'email\': f\'user{user_id}@example.com\'\n    }\n\n# \u7b2c\u4e00\u6b21\u8c03\u7528\uff1a\u67e5\u8be2\u6570\u636e\u5e93\nuser = get_user_info(123)  # \u8017\u65f61\u79d2\n\n# \u7b2c\u4e8c\u6b21\u8c03\u7528\uff1a\u4ece\u7f13\u5b58\u83b7\u53d6\nuser = get_user_info(123)  # \u8017\u65f6<1ms\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u5206\u5e03\u5f0f\u9501",children:"2. \u5206\u5e03\u5f0f\u9501"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import redis\nimport time\nimport uuid\n\nclass RedisLock:\n    """Redis\u5206\u5e03\u5f0f\u9501"""\n    \n    def __init__(self, redis_client, lock_name, timeout=10):\n        self.redis = redis_client\n        self.lock_name = f"lock:{lock_name}"\n        self.timeout = timeout\n        self.identifier = str(uuid.uuid4())\n    \n    def acquire(self):\n        """\u83b7\u53d6\u9501"""\n        end_time = time.time() + self.timeout\n        \n        while time.time() < end_time:\n            # \u5c1d\u8bd5\u83b7\u53d6\u9501\n            if self.redis.set(self.lock_name, self.identifier, nx=True, ex=self.timeout):\n                return True\n            \n            # \u7b49\u5f85\u4e00\u5c0f\u6bb5\u65f6\u95f4\n            time.sleep(0.001)\n        \n        return False\n    \n    def release(self):\n        """\u91ca\u653e\u9501"""\n        # \u4f7f\u7528Lua\u811a\u672c\u4fdd\u8bc1\u539f\u5b50\u6027\n        lua_script = """\n        if redis.call(\'GET\', KEYS[1]) == ARGV[1] then\n            return redis.call(\'DEL\', KEYS[1])\n        else\n            return 0\n        end\n        """\n        \n        script = self.redis.register_script(lua_script)\n        return script(keys=[self.lock_name], args=[self.identifier])\n    \n    def __enter__(self):\n        if not self.acquire():\n            raise Exception("\u65e0\u6cd5\u83b7\u53d6\u9501")\n        return self\n    \n    def __exit__(self, exc_type, exc_val, exc_tb):\n        self.release()\n\n# \u4f7f\u7528\nr = redis.Redis(host=\'localhost\', port=6379)\n\n# \u65b9\u5f0f1\uff1a\u624b\u52a8\u7ba1\u7406\nlock = RedisLock(r, \'order:123\')\nif lock.acquire():\n    try:\n        # \u6267\u884c\u4e1a\u52a1\u903b\u8f91\n        print("\u5904\u7406\u8ba2\u5355...")\n        time.sleep(2)\n    finally:\n        lock.release()\n\n# \u65b9\u5f0f2\uff1a\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\nwith RedisLock(r, \'order:456\'):\n    print("\u5904\u7406\u8ba2\u5355...")\n    time.sleep(2)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u6392\u884c\u699c\u7cfb\u7edf",children:"3. \u6392\u884c\u699c\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import redis\nimport time\n\nclass Leaderboard:\n    """\u6392\u884c\u699c\u7cfb\u7edf"""\n    \n    def __init__(self, redis_client, name):\n        self.redis = redis_client\n        self.key = f"leaderboard:{name}"\n    \n    def add_score(self, user_id, score):\n        """\u6dfb\u52a0\u5206\u6570"""\n        self.redis.zincrby(self.key, score, user_id)\n    \n    def get_rank(self, user_id):\n        """\u83b7\u53d6\u6392\u540d\uff08\u4ece1\u5f00\u59cb\uff09"""\n        rank = self.redis.zrevrank(self.key, user_id)\n        return rank + 1 if rank is not None else None\n    \n    def get_score(self, user_id):\n        """\u83b7\u53d6\u5206\u6570"""\n        return self.redis.zscore(self.key, user_id)\n    \n    def get_top(self, n=10):\n        """\u83b7\u53d6TOP N"""\n        return self.redis.zrevrange(self.key, 0, n-1, withscores=True)\n    \n    def get_around(self, user_id, n=5):\n        """\u83b7\u53d6\u7528\u6237\u5468\u56f4\u7684\u6392\u540d"""\n        rank = self.redis.zrevrank(self.key, user_id)\n        if rank is None:\n            return []\n        \n        start = max(0, rank - n)\n        end = rank + n\n        \n        return self.redis.zrevrange(self.key, start, end, withscores=True)\n    \n    def get_range(self, start_rank, end_rank):\n        """\u83b7\u53d6\u6392\u540d\u8303\u56f4"""\n        return self.redis.zrevrange(self.key, start_rank-1, end_rank-1, withscores=True)\n\n# \u4f7f\u7528\nr = redis.Redis(host=\'localhost\', port=6379, decode_responses=True)\nleaderboard = Leaderboard(r, \'game:2024\')\n\n# \u6dfb\u52a0\u5206\u6570\nleaderboard.add_score(\'user1\', 100)\nleaderboard.add_score(\'user2\', 200)\nleaderboard.add_score(\'user3\', 150)\n\n# \u83b7\u53d6TOP 10\ntop10 = leaderboard.get_top(10)\nprint("TOP 10:")\nfor i, (user, score) in enumerate(top10, 1):\n    print(f"{i}. {user}: {score}")\n\n# \u83b7\u53d6\u7528\u6237\u6392\u540d\nrank = leaderboard.get_rank(\'user1\')\nprint(f"user1\u6392\u540d: {rank}")\n\n# \u83b7\u53d6\u7528\u6237\u5468\u56f4\u7684\u6392\u540d\naround = leaderboard.get_around(\'user1\', 2)\nprint("\u5468\u56f4\u6392\u540d:", around)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u9650\u6d41\u5668",children:"4. \u9650\u6d41\u5668"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import redis\nimport time\n\nclass RateLimiter:\n    """\u9650\u6d41\u5668"""\n    \n    def __init__(self, redis_client):\n        self.redis = redis_client\n    \n    def is_allowed(self, key, limit, window):\n        """\n        \u56fa\u5b9a\u7a97\u53e3\u9650\u6d41\n        key: \u9650\u6d41key\n        limit: \u9650\u5236\u6b21\u6570\n        window: \u65f6\u95f4\u7a97\u53e3\uff08\u79d2\uff09\n        """\n        current = self.redis.incr(key)\n        \n        if current == 1:\n            self.redis.expire(key, window)\n        \n        return current <= limit\n    \n    def is_allowed_sliding(self, key, limit, window):\n        """\n        \u6ed1\u52a8\u7a97\u53e3\u9650\u6d41\n        """\n        now = time.time()\n        window_start = now - window\n        \n        # \u5220\u9664\u7a97\u53e3\u5916\u7684\u8bb0\u5f55\n        self.redis.zremrangebyscore(key, 0, window_start)\n        \n        # \u83b7\u53d6\u5f53\u524d\u7a97\u53e3\u5185\u7684\u8bf7\u6c42\u6570\n        count = self.redis.zcard(key)\n        \n        if count < limit:\n            # \u6dfb\u52a0\u5f53\u524d\u8bf7\u6c42\n            self.redis.zadd(key, {str(now): now})\n            self.redis.expire(key, window)\n            return True\n        \n        return False\n\n# \u4f7f\u7528\nr = redis.Redis(host=\'localhost\', port=6379)\nlimiter = RateLimiter(r)\n\n# \u56fa\u5b9a\u7a97\u53e3\uff1a\u6bcf\u79d2\u6700\u591a10\u6b21\u8bf7\u6c42\nfor i in range(15):\n    if limiter.is_allowed(\'api:user:123\', 10, 1):\n        print(f"\u8bf7\u6c42{i+1}: \u901a\u8fc7")\n    else:\n        print(f"\u8bf7\u6c42{i+1}: \u88ab\u9650\u6d41")\n    time.sleep(0.05)\n\n# \u6ed1\u52a8\u7a97\u53e3\uff1a\u6bcf10\u79d2\u6700\u591a100\u6b21\u8bf7\u6c42\nfor i in range(105):\n    if limiter.is_allowed_sliding(\'api:user:456\', 100, 10):\n        print(f"\u8bf7\u6c42{i+1}: \u901a\u8fc7")\n    else:\n        print(f"\u8bf7\u6c42{i+1}: \u88ab\u9650\u6d41")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(n.p,{children:"Redis\u662f\u9ad8\u6027\u80fd\u7684\u5185\u5b58\u6570\u636e\u5e93\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4e94\u5927\u6570\u636e\u7ed3\u6784"}),"\uff1aString\u3001Hash\u3001List\u3001Set\u3001Sorted Set"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4e30\u5bcc\u529f\u80fd"}),"\uff1a\u7f13\u5b58\u3001\u5206\u5e03\u5f0f\u9501\u3001\u6392\u884c\u699c\u3001\u9650\u6d41"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9ad8\u6027\u80fd"}),"\uff1a\u5185\u5b58\u5b58\u50a8\u3001\u5355\u7ebf\u7a0b\u6a21\u578b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6301\u4e45\u5316"}),"\uff1aRDB\u3001AOF"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8bb0\u4f4f\uff1a",(0,i.jsx)(n.strong,{children:"Redis\u662f\u7f13\u5b58\u548c\u9ad8\u6027\u80fd\u573a\u666f\u7684\u9996\u9009"}),"\uff01"]}),"\n",(0,i.jsx)(n.h2,{id:"\u7ec3\u4e60\u9898",children:"\u7ec3\u4e60\u9898"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u5b9e\u73b0\u4e00\u4e2a\u8d2d\u7269\u8f66\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.li,{children:"\u5b9e\u73b0\u5ef6\u65f6\u961f\u5217"}),"\n",(0,i.jsx)(n.li,{children:"\u5b9e\u73b0\u5e03\u9686\u8fc7\u6ee4\u5668"}),"\n",(0,i.jsx)(n.li,{children:"\u642d\u5efaRedis\u96c6\u7fa4"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0a\u4e00\u7ae0\uff1a",(0,i.jsx)(n.a,{href:"/weuqiangcreate_website/docs/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb",children:"MongoDB\u6587\u6863\u6570\u636e\u5e93"})]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453(e,n,r){r.d(n,{R:()=>t,x:()=>d});var s=r(96540);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);