---
sidebar_position: 12
title: JavaScript
tags: [JavaScript, , , ]
---

# JavaScript

## 

JavaScript

## 

### 1. Singleton



```javascript
// 
class Singleton {
  constructor() {
    if (Singleton.instance) {
      return Singleton.instance;
    }
    Singleton.instance = this;
    this.data = [];
  }
  
  addData(item) {
    this.data.push(item);
  }
  
  getData() {
    return this.data;
  }
}

// 
const instance1 = new Singleton();
const instance2 = new Singleton();
console.log(instance1 === instance2); // true

// 
class ConfigManager {
  constructor() {
    if (ConfigManager.instance) {
      return ConfigManager.instance;
    }
    
    this.config = {
      apiUrl: 'https://api.example.com',
      timeout: 5000,
      retryCount: 3
    };
    
    ConfigManager.instance = this;
  }
  
  get(key) {
    return this.config[key];
  }
  
  set(key, value) {
    this.config[key] = value;
  }
  
  getAll() {
    return { ...this.config };
  }
}

// 
const config = new ConfigManager();
config.set('apiUrl', 'https://new-api.example.com');

// 
class Store {
  constructor() {
    if (Store.instance) {
      return Store.instance;
    }
    
    this.state = {};
    this.listeners = [];
    Store.instance = this;
  }
  
  getState() {
    return { ...this.state };
  }
  
  setState(newState) {
    this.state = { ...this.state, ...newState };
    this.notify();
  }
  
  subscribe(listener) {
    this.listeners.push(listener);
    return () => {
      this.listeners = this.listeners.filter(l => l !== listener);
    };
  }
  
  notify() {
    this.listeners.forEach(listener => listener(this.state));
  }
}

// 
const store = new Store();
store.subscribe(state => console.log('State changed:', state));
store.setState({ user: { name: 'John' } });
```

### 2. Factory

new

```javascript
// 
class UserFactory {
  static createUser(type, data) {
    switch (type) {
      case 'admin':
        return new AdminUser(data);
      case 'member':
        return new MemberUser(data);
      case 'guest':
        return new GuestUser(data);
      default:
        throw new Error('Unknown user type');
    }
  }
}

class AdminUser {
  constructor(data) {
    this.name = data.name;
    this.role = 'admin';
    this.permissions = ['read', 'write', 'delete'];
  }
}

class MemberUser {
  constructor(data) {
    this.name = data.name;
    this.role = 'member';
    this.permissions = ['read', 'write'];
  }
}

class GuestUser {
  constructor(data) {
    this.name = data.name;
    this.role = 'guest';
    this.permissions = ['read'];
  }
}

// 
const admin = UserFactory.createUser('admin', { name: 'Alice' });
const member = UserFactory.createUser('member', { name: 'Bob' });

// HTTP
class RequestFactory {
  static create(type, config) {
    const baseConfig = {
      timeout: 5000,
      headers: {
        'Content-Type': 'application/json'
      }
    };
    
    switch (type) {
      case 'json':
        return {
          ...baseConfig,
          ...config,
          headers: {
            ...baseConfig.headers,
            'Content-Type': 'application/json'
          }
        };
      
      case 'form':
        return {
          ...baseConfig,
          ...config,
          headers: {
            ...baseConfig.headers,
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        };
      
      case 'multipart':
        return {
          ...baseConfig,
          ...config,
          headers: {
            ...baseConfig.headers,
            'Content-Type': 'multipart/form-data'
          }
        };
      
      default:
        return { ...baseConfig, ...config };
    }
  }
}

// 
const jsonRequest = RequestFactory.create('json', { url: '/api/users' });
const formRequest = RequestFactory.create('form', { url: '/api/login' });
```

### 3. Builder



```javascript
// 
class QueryBuilder {
  constructor() {
    this.query = {
      select: [],
      from: '',
      where: [],
      orderBy: [],
      limit: null,
      offset: null
    };
  }
  
  select(...fields) {
    this.query.select.push(...fields);
    return this;
  }
  
  from(table) {
    this.query.from = table;
    return this;
  }
  
  where(condition) {
    this.query.where.push(condition);
    return this;
  }
  
  orderBy(field, direction = 'ASC') {
    this.query.orderBy.push({ field, direction });
    return this;
  }
  
  limit(count) {
    this.query.limit = count;
    return this;
  }
  
  offset(count) {
    this.query.offset = count;
    return this;
  }
  
  build() {
    let sql = `SELECT ${this.query.select.join(', ')} FROM ${this.query.from}`;
    
    if (this.query.where.length > 0) {
      sql += ` WHERE ${this.query.where.join(' AND ')}`;
    }
    
    if (this.query.orderBy.length > 0) {
      const orderClauses = this.query.orderBy.map(
        o => `${o.field} ${o.direction}`
      );
      sql += ` ORDER BY ${orderClauses.join(', ')}`;
    }
    
    if (this.query.limit !== null) {
      sql += ` LIMIT ${this.query.limit}`;
    }
    
    if (this.query.offset !== null) {
      sql += ` OFFSET ${this.query.offset}`;
    }
    
    return sql;
  }
}

// 
const query = new QueryBuilder()
  .select('id', 'name', 'email')
  .from('users')
  .where('age > 18')
  .where('status = "active"')
  .orderBy('created_at', 'DESC')
  .limit(10)
  .offset(0)
  .build();

console.log(query);
// SELECT id, name, email FROM users WHERE age > 18 AND status = "active" ORDER BY created_at DESC LIMIT 10 OFFSET 0

// HTTP
class RequestBuilder {
  constructor(baseUrl = '') {
    this.baseUrl = baseUrl;
    this.config = {
      method: 'GET',
      headers: {},
      params: {},
      data: null
    };
  }
  
  method(method) {
    this.config.method = method.toUpperCase();
    return this;
  }
  
  url(url) {
    this.config.url = url;
    return this;
  }
  
  headers(headers) {
    this.config.headers = { ...this.config.headers, ...headers };
    return this;
  }
  
  params(params) {
    this.config.params = { ...this.config.params, ...params };
    return this;
  }
  
  data(data) {
    this.config.data = data;
    return this;
  }
  
  auth(token) {
    this.config.headers['Authorization'] = `Bearer ${token}`;
    return this;
  }
  
  json(data) {
    this.config.headers['Content-Type'] = 'application/json';
    this.config.data = JSON.stringify(data);
    return this;
  }
  
  async send() {
    const url = new URL(this.config.url, this.baseUrl);
    Object.keys(this.config.params).forEach(key => {
      url.searchParams.append(key, this.config.params[key]);
    });
    
    const response = await fetch(url.toString(), {
      method: this.config.method,
      headers: this.config.headers,
      body: this.config.data
    });
    
    return response.json();
  }
}

// 
const request = new RequestBuilder('https://api.example.com')
  .method('POST')
  .url('/users')
  .auth('your-token')
  .json({ name: 'John', age: 30 })
  .send();
```

## 

### 1. Proxy



```javascript
// 
class ImageProxy {
  constructor(url) {
    this.url = url;
    this.image = null;
  }
  
  display() {
    if (!this.image) {
      console.log('...');
      this.image = new Image();
      this.image.src = this.url;
    }
    return this.image;
  }
}

// 
class CacheProxy {
  constructor(target) {
    this.target = target;
    this.cache = new Map();
  }
  
  get(key) {
    if (this.cache.has(key)) {
      console.log('');
      return this.cache.get(key);
    }
    
    console.log('');
    const value = this.target.get(key);
    this.cache.set(key, value);
    return value;
  }
}

// API
class APIProxy {
  constructor(api) {
    this.api = api;
    this.cache = new Map();
    this.cacheTime = 60000; // 1
  }
  
  async get(url, options = {}) {
    const cacheKey = `${url}:${JSON.stringify(options)}`;
    const cached = this.cache.get(cacheKey);
    
    if (cached && Date.now() - cached.timestamp < this.cacheTime) {
      console.log('');
      return cached.data;
    }
    
    console.log('API');
    const data = await this.api.get(url, options);
    
    this.cache.set(cacheKey, {
      data,
      timestamp: Date.now()
    });
    
    return data;
  }
  
  clearCache() {
    this.cache.clear();
  }
}

// ES6 Proxy
const validator = {
  set(target, property, value) {
    if (property === 'age') {
      if (typeof value !== 'number' || value < 0 || value > 150) {
        throw new Error('Invalid age');
      }
    }
    target[property] = value;
    return true;
  }
};

const person = new Proxy({}, validator);
person.age = 30; // OK
// person.age = -1; // Error: Invalid age

// 
function reactive(target) {
  const handlers = {
    get(target, property) {
      console.log(`: ${property}`);
      return target[property];
    },
    set(target, property, value) {
      console.log(`: ${property} = ${value}`);
      target[property] = value;
      // 
      return true;
    }
  };
  
  return new Proxy(target, handlers);
}

const state = reactive({
  count: 0,
  name: 'John'
});

state.count++; // : count = 1
console.log(state.name); // : name
```

### 2. Decorator



```javascript
// 
function log(target, name, descriptor) {
  const original = descriptor.value;
  descriptor.value = function(...args) {
    console.log(` ${name}:`, args);
    const result = original.apply(this, args);
    console.log(`${name} :`, result);
    return result;
  };
  return descriptor;
}

function measure(target, name, descriptor) {
  const original = descriptor.value;
  descriptor.value = function(...args) {
    const start = performance.now();
    const result = original.apply(this, args);
    const end = performance.now();
    console.log(`${name} : ${end - start}ms`);
    return result;
  };
  return descriptor;
}

class Calculator {
  @log
  @measure
  add(a, b) {
    return a + b;
  }
}

// 
function withLogging(fn) {
  return function(...args) {
    console.log(`:`, args);
    const result = fn.apply(this, args);
    console.log(`:`, result);
    return result;
  };
}

function withCache(fn) {
  const cache = new Map();
  return function(...args) {
    const key = JSON.stringify(args);
    if (cache.has(key)) {
      console.log('');
      return cache.get(key);
    }
    const result = fn.apply(this, args);
    cache.set(key, result);
    return result;
  };
}

// 
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

const cachedFib = withCache(fibonacci);
console.log(cachedFib(10)); // 
console.log(cachedFib(10)); // 

// API
class API {
  constructor(baseUrl) {
    this.baseUrl = baseUrl;
  }
  
  async request(url, options) {
    const response = await fetch(`${this.baseUrl}${url}`, options);
    return response.json();
  }
}

// 
function withRetry(api, maxRetries = 3) {
  const originalRequest = api.request.bind(api);
  
  api.request = async function(url, options) {
    let lastError;
    for (let i = 0; i < maxRetries; i++) {
      try {
        return await originalRequest(url, options);
      } catch (error) {
        lastError = error;
        console.log(` ${i + 1}/${maxRetries}`);
        await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
      }
    }
    throw lastError;
  };
  
  return api;
}

// 
function withLoggingAPI(api) {
  const originalRequest = api.request.bind(api);
  
  api.request = async function(url, options) {
    console.log(`: ${url}`, options);
    const start = Date.now();
    try {
      const result = await originalRequest(url, options);
      console.log(`: ${url}: ${Date.now() - start}ms`);
      return result;
    } catch (error) {
      console.error(`: ${url}`, error);
      throw error;
    }
  };
  
  return api;
}

// 
let api = new API('https://api.example.com');
api = withRetry(api, 3);
api = withLoggingAPI(api);
```

### 3. Adapter



```javascript
// 
class OldAPI {
  getData() {
    return {
      user_name: 'John',
      user_age: 30,
      user_email: 'john@example.com'
    };
  }
}

// 
class APIAdapter {
  constructor(oldAPI) {
    this.oldAPI = oldAPI;
  }
  
  getUserData() {
    const data = this.oldAPI.getData();
    return {
      name: data.user_name,
      age: data.user_age,
      email: data.user_email
    };
  }
}

// 
const oldAPI = new OldAPI();
const adapter = new APIAdapter(oldAPI);
const userData = adapter.getUserData();
console.log(userData); // { name: 'John', age: 30, email: 'john@example.com' }

// 
class LocalStorageAdapter {
  get(key) {
    const value = localStorage.getItem(key);
    return value ? JSON.parse(value) : null;
  }
  
  set(key, value) {
    localStorage.setItem(key, JSON.stringify(value));
  }
  
  remove(key) {
    localStorage.removeItem(key);
  }
}

class SessionStorageAdapter {
  get(key) {
    const value = sessionStorage.getItem(key);
    return value ? JSON.parse(value) : null;
  }
  
  set(key, value) {
    sessionStorage.setItem(key, JSON.stringify(value));
  }
  
  remove(key) {
    sessionStorage.removeItem(key);
  }
}

// 
class StorageManager {
  constructor(adapter) {
    this.adapter = adapter;
  }
  
  save(key, value) {
    return this.adapter.set(key, value);
  }
  
  load(key) {
    return this.adapter.get(key);
  }
  
  delete(key) {
    return this.adapter.remove(key);
  }
}

// 
const localStorage = new StorageManager(new LocalStorageAdapter());
const sessionStorage = new StorageManager(new SessionStorageAdapter());

localStorage.save('user', { name: 'John' });
const user = localStorage.load('user');
```

## 

### 1. Observer



```javascript
// 
class EventEmitter {
  constructor() {
    this.events = {};
  }
  
  on(event, listener) {
    if (!this.events[event]) {
      this.events[event] = [];
    }
    this.events[event].push(listener);
    
    // 
    return () => this.off(event, listener);
  }
  
  off(event, listener) {
    if (!this.events[event]) return;
    this.events[event] = this.events[event].filter(l => l !== listener);
  }
  
  emit(event, ...args) {
    if (!this.events[event]) return;
    this.events[event].forEach(listener => listener(...args));
  }
  
  once(event, listener) {
    const onceWrapper = (...args) => {
      listener(...args);
      this.off(event, onceWrapper);
    };
    this.on(event, onceWrapper);
  }
}

// 
const emitter = new EventEmitter();

const unsubscribe = emitter.on('data', (data) => {
  console.log(':', data);
});

emitter.emit('data', { id: 1, name: 'John' });
unsubscribe(); // 

// 
class Store extends EventEmitter {
  constructor(initialState = {}) {
    super();
    this.state = initialState;
  }
  
  getState() {
    return { ...this.state };
  }
  
  setState(newState) {
    const oldState = this.state;
    this.state = { ...this.state, ...newState };
    this.emit('change', this.state, oldState);
  }
  
  subscribe(listener) {
    return this.on('change', listener);
  }
}

// 
const store = new Store({ count: 0 });

store.subscribe((newState, oldState) => {
  console.log(':', oldState, '->', newState);
});

store.setState({ count: 1 });
store.setState({ count: 2 });
```

### 2. Strategy



```javascript
// 
class Validator {
  constructor() {
    this.strategies = {};
  }
  
  addStrategy(name, strategy) {
    this.strategies[name] = strategy;
  }
  
  validate(value, rules) {
    const errors = [];
    
    for (const rule of rules) {
      const [strategyName, ...args] = rule.split(':');
      const strategy = this.strategies[strategyName];
      
      if (strategy && !strategy(value, ...args)) {
        errors.push(`: ${rule}`);
      }
    }
    
    return errors;
  }
}

// 
const validator = new Validator();

validator.addStrategy('required', (value) => {
  return value !== '' && value !== null && value !== undefined;
});

validator.addStrategy('minLength', (value, length) => {
  return value.length >= parseInt(length);
});

validator.addStrategy('maxLength', (value, length) => {
  return value.length <= parseInt(length);
});

validator.addStrategy('email', (value) => {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
});

validator.addStrategy('number', (value) => {
  return !isNaN(value);
});

// 
const errors = validator.validate('john@example.com', [
  'required',
  'email',
  'minLength:5'
]);

console.log(errors); // []

// 
class PaymentContext {
  constructor(strategy) {
    this.strategy = strategy;
  }
  
  setStrategy(strategy) {
    this.strategy = strategy;
  }
  
  pay(amount) {
    return this.strategy.pay(amount);
  }
}

class AlipayStrategy {
  pay(amount) {
    console.log(` ¥${amount}`);
    // API
    return { success: true, method: 'alipay' };
  }
}

class WechatStrategy {
  pay(amount) {
    console.log(` ¥${amount}`);
    // API
    return { success: true, method: 'wechat' };
  }
}

class CreditCardStrategy {
  pay(amount) {
    console.log(` ¥${amount}`);
    // API
    return { success: true, method: 'credit_card' };
  }
}

// 
const payment = new PaymentContext(new AlipayStrategy());
payment.pay(100);

payment.setStrategy(new WechatStrategy());
payment.pay(200);
```

### 3. Chain of Responsibility



```javascript
// 
class MiddlewareChain {
  constructor() {
    this.middlewares = [];
  }
  
  use(middleware) {
    this.middlewares.push(middleware);
    return this;
  }
  
  async execute(context) {
    let index = 0;
    
    const next = async () => {
      if (index >= this.middlewares.length) return;
      const middleware = this.middlewares[index++];
      await middleware(context, next);
    };
    
    await next();
  }
}

// 
const chain = new MiddlewareChain();

chain.use(async (ctx, next) => {
  console.log('1: ');
  await next();
  console.log('1: ');
});

chain.use(async (ctx, next) => {
  console.log('2: ');
  ctx.data = 'processed';
  await next();
  console.log('2: ');
});

chain.use(async (ctx, next) => {
  console.log('3: ', ctx.data);
});

chain.execute({ data: 'initial' });

// 
class RequestHandler {
  constructor() {
    this.handlers = [];
  }
  
  addHandler(handler) {
    this.handlers.push(handler);
    return this;
  }
  
  async handle(request) {
    for (const handler of this.handlers) {
      const result = await handler(request);
      if (result === false) {
        break; // 
      }
    }
  }
}

// 
const authHandler = async (request) => {
  if (!request.headers.authorization) {
    console.log('');
    return false;
  }
  console.log('');
  return true;
};

const validationHandler = async (request) => {
  if (!request.body) {
    console.log('');
    return false;
  }
  console.log('');
  return true;
};

const businessHandler = async (request) => {
  console.log('');
  return true;
};

// 
const handler = new RequestHandler();
handler
  .addHandler(authHandler)
  .addHandler(validationHandler)
  .addHandler(businessHandler);

handler.handle({
  headers: { authorization: 'Bearer token' },
  body: { name: 'John' }
});
```

## 



1. ****
2. ****
3. ****
4. ****

## 

- [JavaScript](https://www.patterns.dev/)
- [](https://refactoring.com/)
- [Head First](https://www.oreilly.com/library/view/head-first-design/0596007124/)

