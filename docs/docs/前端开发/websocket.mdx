---
sidebarDepth: 4
---
# WebSocket



``` js
let ws = new WebSocket('ws://url.com:port')
ws.onopen = () => {}
ws.onclose = () => {}
ws.onerror = () => {}
ws.onmessage = (e) => {}

ws.send()
```



WebSocket`socket.io``ws` `ws`

### ws

``` js
// Websocket Api
let ws = new WebSocket('ws://localhost:8080')
ws.onopen = () => {}
ws.onmessage = () => {}

// 
const WebSocket = require('ws');
const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', function connection(ws) {
  ws.on('message', function incoming(message) {
    console.log('received: %s', message);
  });

  ws.send('something');
});
```

### socket.io

``` html
<!-- socket.io -->
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
</script>
```

``` js
// 
var io = require('socket.io')(http);
io.on('connection', function(socket){
  console.log('a user connected');
  socket.on('disconnect', function(){
    console.log('user disconnected');
  });
});
```







``` js
ws.onclose = () => {
    reconnect()
}
ws.onerror = () => {
    reconnect()
}
```



### 

`onclose``onclose`

`onclose``onclose``onclose`









``` js
let ws = new WebSocket('ws://localhost:3001')
ws.onopen = () => {
    heartCheck.start()
}
ws.onmessage = (data) => {
    heartCheck.reset()
}
ws.onclose = () => {
    reconnect()
}
ws.onerror = () => {
    reconnect()
}

let heartCheck = {
    timeout: 60000, // 1
    timer: null,
    start() {
        this.timer = setTimeout(() => {
            ws.send('heart')
        }, timeout)
    },
    reset() {
        clearTimeout(this.timer)
        this.start()
    }
}
```