---
sidebar_position: 6
title: TypeScripté«˜çº§ç‰¹æ€§ä¸å®æˆ˜
tags: [å‰ç«¯, TypeScript, ç±»å‹ç³»ç»Ÿ, æ³›å‹]
---

# TypeScripté«˜çº§ç‰¹æ€§ä¸å®æˆ˜

TypeScriptæ˜¯JavaScriptçš„è¶…é›†ï¼Œæœ¬æ–‡å°†æ·±å…¥è®²è§£TypeScriptçš„é«˜çº§ç‰¹æ€§å’Œå®æˆ˜æŠ€å·§ã€‚

## é«˜çº§ç±»å‹

### è”åˆç±»å‹ä¸äº¤å‰ç±»å‹

```typescript
// è”åˆç±»å‹ï¼ˆUnion Typesï¼‰
type Status = 'pending' | 'success' | 'error';
type ID = string | number;

function handleStatus(status: Status) {
  switch (status) {
    case 'pending':
      console.log('åŠ è½½ä¸­...');
      break;
    case 'success':
      console.log('æˆåŠŸ');
      break;
    case 'error':
      console.log('å¤±è´¥');
      break;
  }
}

// äº¤å‰ç±»å‹ï¼ˆIntersection Typesï¼‰
interface Person {
  name: string;
  age: number;
}

interface Employee {
  employeeId: string;
  department: string;
}

type Staff = Person & Employee;

const staff: Staff = {
  name: 'John',
  age: 30,
  employeeId: 'E001',
  department: 'IT'
};

// ç±»å‹å®ˆå«
function isString(value: unknown): value is string {
  return typeof value === 'string';
}

function processValue(value: string | number) {
  if (isString(value)) {
    console.log(value.toUpperCase());
  } else {
    console.log(value.toFixed(2));
  }
}
```

### æ˜ å°„ç±»å‹

```typescript
// Partial - æ‰€æœ‰å±æ€§å¯é€‰
type Partial<T> = {
  [P in keyof T]?: T[P];
};

interface User {
  id: number;
  name: string;
  email: string;
}

type PartialUser = Partial<User>;
// { id?: number; name?: string; email?: string; }

// Required - æ‰€æœ‰å±æ€§å¿…é€‰
type Required<T> = {
  [P in keyof T]-?: T[P];
};

// Readonly - æ‰€æœ‰å±æ€§åªè¯»
type Readonly<T> = {
  readonly [P in keyof T]: T[P];
};

// Pick - é€‰æ‹©éƒ¨åˆ†å±æ€§
type Pick<T, K extends keyof T> = {
  [P in K]: T[P];
};

type UserBasic = Pick<User, 'id' | 'name'>;
// { id: number; name: string; }

// Omit - æ’é™¤éƒ¨åˆ†å±æ€§
type Omit<T, K extends keyof T> = Pick<T, Exclude<keyof T, K>>;

type UserWithoutEmail = Omit<User, 'email'>;
// { id: number; name: string; }

// Record - åˆ›å»ºå¯¹è±¡ç±»å‹
type Record<K extends keyof any, T> = {
  [P in K]: T;
};

type PageInfo = Record<'home' | 'about' | 'contact', { title: string; url: string }>;

const pages: PageInfo = {
  home: { title: 'Home', url: '/' },
  about: { title: 'About', url: '/about' },
  contact: { title: 'Contact', url: '/contact' }
};
```

### æ¡ä»¶ç±»å‹

```typescript
// æ¡ä»¶ç±»å‹
type IsString<T> = T extends string ? true : false;

type A = IsString<string>;  // true
type B = IsString<number>;  // false

// åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹
type ToArray<T> = T extends any ? T[] : never;

type StrOrNumArray = ToArray<string | number>;
// string[] | number[]

// inferå…³é”®å­—
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : never;

function getUserInfo() {
  return { name: 'John', age: 30 };
}

type UserInfo = ReturnType<typeof getUserInfo>;
// { name: string; age: number; }

// æå–Promiseçš„å€¼ç±»å‹
type UnwrapPromise<T> = T extends Promise<infer U> ? U : T;

type Result = UnwrapPromise<Promise<string>>;  // string

// å®ç”¨å·¥å…·ç±»å‹
type NonNullable<T> = T extends null | undefined ? never : T;

type Value = string | null | undefined;
type NonNullValue = NonNullable<Value>;  // string

// æå–å‡½æ•°å‚æ•°ç±»å‹
type Parameters<T extends (...args: any) => any> = 
  T extends (...args: infer P) => any ? P : never;

function add(a: number, b: number) {
  return a + b;
}

type AddParams = Parameters<typeof add>;  // [number, number]
```

## æ³›å‹

### æ³›å‹å‡½æ•°

```typescript
// åŸºç¡€æ³›å‹
function identity<T>(arg: T): T {
  return arg;
}

const num = identity<number>(42);
const str = identity<string>('hello');

// æ³›å‹çº¦æŸ
interface Lengthwise {
  length: number;
}

function logLength<T extends Lengthwise>(arg: T): T {
  console.log(arg.length);
  return arg;
}

logLength('hello');        // âœ“
logLength([1, 2, 3]);      // âœ“
logLength({ length: 10 }); // âœ“
// logLength(42);          // âœ— é”™è¯¯

// å¤šä¸ªæ³›å‹å‚æ•°
function merge<T, U>(obj1: T, obj2: U): T & U {
  return { ...obj1, ...obj2 };
}

const result = merge(
  { name: 'John' },
  { age: 30 }
);
// { name: string; age: number; }

// æ³›å‹é»˜è®¤å€¼
function createArray<T = string>(length: number, value: T): T[] {
  return Array(length).fill(value);
}

const arr1 = createArray(3, 'x');     // string[]
const arr2 = createArray<number>(3, 0); // number[]
```

### æ³›å‹ç±»

```typescript
class GenericNumber<T> {
  zeroValue: T;
  add: (x: T, y: T) => T;
  
  constructor(zeroValue: T, add: (x: T, y: T) => T) {
    this.zeroValue = zeroValue;
    this.add = add;
  }
}

const myGenericNumber = new GenericNumber<number>(
  0,
  (x, y) => x + y
);

// æ³›å‹æ¥å£
interface Repository<T> {
  find(id: string): Promise<T>;
  findAll(): Promise<T[]>;
  create(item: T): Promise<T>;
  update(id: string, item: Partial<T>): Promise<T>;
  delete(id: string): Promise<void>;
}

class UserRepository implements Repository<User> {
  async find(id: string): Promise<User> {
    // å®ç°
  }
  
  async findAll(): Promise<User[]> {
    // å®ç°
  }
  
  async create(user: User): Promise<User> {
    // å®ç°
  }
  
  async update(id: string, user: Partial<User>): Promise<User> {
    // å®ç°
  }
  
  async delete(id: string): Promise<void> {
    // å®ç°
  }
}
```

## è£…é¥°å™¨

### ç±»è£…é¥°å™¨

```typescript
// ç±»è£…é¥°å™¨
function sealed(constructor: Function) {
  Object.seal(constructor);
  Object.seal(constructor.prototype);
}

@sealed
class Greeter {
  greeting: string;
  
  constructor(message: string) {
    this.greeting = message;
  }
}

// è£…é¥°å™¨å·¥å‚
function Component(options: { selector: string; template: string }) {
  return function (constructor: Function) {
    constructor.prototype.selector = options.selector;
    constructor.prototype.template = options.template;
  };
}

@Component({
  selector: 'app-root',
  template: '<h1>Hello</h1>'
})
class AppComponent {}

// æ–¹æ³•è£…é¥°å™¨
function log(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  
  descriptor.value = function (...args: any[]) {
    console.log(`è°ƒç”¨ ${propertyKey}ï¼Œå‚æ•°:`, args);
    const result = originalMethod.apply(this, args);
    console.log(`${propertyKey} è¿”å›:`, result);
    return result;
  };
  
  return descriptor;
}

class Calculator {
  @log
  add(a: number, b: number) {
    return a + b;
  }
}

// å±æ€§è£…é¥°å™¨
function readonly(target: any, propertyKey: string) {
  Object.defineProperty(target, propertyKey, {
    writable: false
  });
}

class Person {
  @readonly
  name: string = 'John';
}

// å‚æ•°è£…é¥°å™¨
function required(target: any, propertyKey: string, parameterIndex: number) {
  const existingRequiredParameters: number[] = 
    Reflect.getOwnMetadata('required', target, propertyKey) || [];
  
  existingRequiredParameters.push(parameterIndex);
  
  Reflect.defineMetadata(
    'required',
    existingRequiredParameters,
    target,
    propertyKey
  );
}

class UserService {
  createUser(@required name: string, age: number) {
    // å®ç°
  }
}
```

## å®æˆ˜æŠ€å·§

### ç±»å‹å®‰å…¨çš„APIå®¢æˆ·ç«¯

```typescript
// APIå“åº”ç±»å‹
interface ApiResponse<T> {
  success: boolean;
  data: T;
  message?: string;
}

// APIé”™è¯¯ç±»å‹
interface ApiError {
  code: string;
  message: string;
  details?: any;
}

// APIå®¢æˆ·ç«¯
class ApiClient {
  private baseURL: string;
  
  constructor(baseURL: string) {
    this.baseURL = baseURL;
  }
  
  async request<T>(
    endpoint: string,
    options?: RequestInit
  ): Promise<ApiResponse<T>> {
    const response = await fetch(`${this.baseURL}${endpoint}`, options);
    
    if (!response.ok) {
      const error: ApiError = await response.json();
      throw new Error(error.message);
    }
    
    return response.json();
  }
  
  async get<T>(endpoint: string): Promise<T> {
    const response = await this.request<T>(endpoint);
    return response.data;
  }
  
  async post<T, D = any>(endpoint: string, data: D): Promise<T> {
    const response = await this.request<T>(endpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    return response.data;
  }
}

// ä½¿ç”¨
interface User {
  id: number;
  name: string;
  email: string;
}

const api = new ApiClient('https://api.example.com');

// ç±»å‹å®‰å…¨çš„APIè°ƒç”¨
const user = await api.get<User>('/users/1');
console.log(user.name); // âœ“ ç±»å‹å®‰å…¨

const newUser = await api.post<User, Omit<User, 'id'>>('/users', {
  name: 'John',
  email: 'john@example.com'
});
```

### ç±»å‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†

```typescript
// Reduxç±»å‹å®šä¹‰
interface State {
  user: User | null;
  posts: Post[];
  loading: boolean;
}

// Actionç±»å‹
type Action =
  | { type: 'SET_USER'; payload: User }
  | { type: 'SET_POSTS'; payload: Post[] }
  | { type: 'SET_LOADING'; payload: boolean };

// Reducer
function reducer(state: State, action: Action): State {
  switch (action.type) {
    case 'SET_USER':
      return { ...state, user: action.payload };
    case 'SET_POSTS':
      return { ...state, posts: action.payload };
    case 'SET_LOADING':
      return { ...state, loading: action.payload };
    default:
      return state;
  }
}

// Actionåˆ›å»ºå™¨
const actions = {
  setUser: (user: User): Action => ({
    type: 'SET_USER',
    payload: user
  }),
  
  setPosts: (posts: Post[]): Action => ({
    type: 'SET_POSTS',
    payload: posts
  }),
  
  setLoading: (loading: boolean): Action => ({
    type: 'SET_LOADING',
    payload: loading
  })
};

// ç±»å‹å®‰å…¨çš„useReducer
import { useReducer } from 'react';

function useAppState() {
  const [state, dispatch] = useReducer(reducer, {
    user: null,
    posts: [],
    loading: false
  });
  
  return {
    state,
    actions: {
      setUser: (user: User) => dispatch(actions.setUser(user)),
      setPosts: (posts: Post[]) => dispatch(actions.setPosts(posts)),
      setLoading: (loading: boolean) => dispatch(actions.setLoading(loading))
    }
  };
}
```

### ç±»å‹å®‰å…¨çš„è¡¨å•

```typescript
// è¡¨å•å€¼ç±»å‹
interface FormValues {
  username: string;
  email: string;
  age: number;
  agree: boolean;
}

// è¡¨å•é”™è¯¯ç±»å‹
type FormErrors<T> = {
  [K in keyof T]?: string;
};

// è¡¨å•Hook
function useForm<T extends Record<string, any>>(
  initialValues: T,
  validate: (values: T) => FormErrors<T>
) {
  const [values, setValues] = useState<T>(initialValues);
  const [errors, setErrors] = useState<FormErrors<T>>({});
  const [touched, setTouched] = useState<Partial<Record<keyof T, boolean>>>({});
  
  const handleChange = (name: keyof T) => (
    e: React.ChangeEvent<HTMLInputElement>
  ) => {
    const value = e.target.type === 'checkbox' 
      ? e.target.checked 
      : e.target.value;
    
    setValues(prev => ({ ...prev, [name]: value }));
  };
  
  const handleBlur = (name: keyof T) => () => {
    setTouched(prev => ({ ...prev, [name]: true }));
    const validationErrors = validate(values);
    setErrors(validationErrors);
  };
  
  const handleSubmit = (onSubmit: (values: T) => void) => (
    e: React.FormEvent
  ) => {
    e.preventDefault();
    const validationErrors = validate(values);
    
    if (Object.keys(validationErrors).length === 0) {
      onSubmit(values);
    } else {
      setErrors(validationErrors);
    }
  };
  
  return {
    values,
    errors,
    touched,
    handleChange,
    handleBlur,
    handleSubmit
  };
}

// ä½¿ç”¨
function LoginForm() {
  const { values, errors, touched, handleChange, handleBlur, handleSubmit } = 
    useForm<FormValues>(
      {
        username: '',
        email: '',
        age: 0,
        agree: false
      },
      (values) => {
        const errors: FormErrors<FormValues> = {};
        
        if (!values.username) {
          errors.username = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';
        }
        
        if (!values.email) {
          errors.email = 'é‚®ç®±ä¸èƒ½ä¸ºç©º';
        } else if (!/\S+@\S+\.\S+/.test(values.email)) {
          errors.email = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®';
        }
        
        if (values.age < 18) {
          errors.age = 'å¹´é¾„å¿…é¡»å¤§äº18å²';
        }
        
        return errors;
      }
    );
  
  return (
    <form onSubmit={handleSubmit(console.log)}>
      <input
        name="username"
        value={values.username}
        onChange={handleChange('username')}
        onBlur={handleBlur('username')}
      />
      {touched.username && errors.username && (
        <span>{errors.username}</span>
      )}
      
      {/* å…¶ä»–å­—æ®µ */}
    </form>
  );
}
```

## æ€§èƒ½ä¼˜åŒ–

### ç±»å‹æ¨æ–­ä¼˜åŒ–

```typescript
// âŒ æ˜¾å¼ç±»å‹æ³¨è§£ï¼ˆä¸å¿…è¦ï¼‰
const numbers: number[] = [1, 2, 3];
const user: User = { id: 1, name: 'John' };

// âœ… ç±»å‹æ¨æ–­
const numbers = [1, 2, 3];  // number[]
const user = { id: 1, name: 'John' };  // { id: number; name: string; }

// âŒ è¿‡åº¦ä½¿ç”¨any
function process(data: any) {
  return data.value;
}

// âœ… ä½¿ç”¨æ³›å‹
function process<T extends { value: any }>(data: T) {
  return data.value;
}

// âŒ é‡å¤çš„ç±»å‹å®šä¹‰
interface UserResponse {
  id: number;
  name: string;
  email: string;
}

interface UserRequest {
  name: string;
  email: string;
}

// âœ… ä½¿ç”¨å·¥å…·ç±»å‹
interface User {
  id: number;
  name: string;
  email: string;
}

type UserResponse = User;
type UserRequest = Omit<User, 'id'>;
```

## æ€»ç»“

TypeScripté«˜çº§ç‰¹æ€§çš„æ ¸å¿ƒï¼š
- ğŸ¯ **é«˜çº§ç±»å‹**ï¼šè”åˆã€äº¤å‰ã€æ˜ å°„ã€æ¡ä»¶ç±»å‹
- ğŸ”§ **æ³›å‹**ï¼šå‡½æ•°ã€ç±»ã€æ¥å£æ³›å‹
- ğŸ¨ **è£…é¥°å™¨**ï¼šç±»ã€æ–¹æ³•ã€å±æ€§è£…é¥°å™¨
- ğŸ’¡ **å®æˆ˜æŠ€å·§**ï¼šç±»å‹å®‰å…¨çš„APIã€çŠ¶æ€ç®¡ç†ã€è¡¨å•
- ğŸš€ **æ€§èƒ½ä¼˜åŒ–**ï¼šç±»å‹æ¨æ–­ã€é¿å…any
- âœ… **æœ€ä½³å®è·µ**ï¼šç±»å‹å¤ç”¨ã€å·¥å…·ç±»å‹

è®°ä½ï¼š**TypeScriptçš„ç›®æ ‡æ˜¯è®©JavaScriptæ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤ï¼**

