"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[43465],{9145(n,e,t){t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"\u5927\u6570\u636e\u6280\u672f/Flink\u5b9e\u65f6\u8ba1\u7b97","title":"Flink - \u6d41\u6279\u4e00\u4f53\u7684\u5b9e\u65f6\u8ba1\u7b97\u5f15\u64ce","description":"Flink\u662f\u76ee\u524d\u6700\u5f3a\u5927\u7684\u5b9e\u65f6\u8ba1\u7b97\u6846\u67b6\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60\u7528Flink\u6784\u5efa\u771f\u6b63\u7684\u5b9e\u65f6\u5e94\u7528\u3002","source":"@site/docs/docs/\u5927\u6570\u636e\u6280\u672f/Flink\u5b9e\u65f6\u8ba1\u7b97.mdx","sourceDirName":"\u5927\u6570\u636e\u6280\u672f","slug":"/\u5927\u6570\u636e\u6280\u672f/Flink\u5b9e\u65f6\u8ba1\u7b97","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/Flink\u5b9e\u65f6\u8ba1\u7b97","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Flink - \u6d41\u6279\u4e00\u4f53\u7684\u5b9e\u65f6\u8ba1\u7b97\u5f15\u64ce"},"sidebar":"tutorialSidebar","previous":{"title":"Kafka - \u5b9e\u65f6\u6570\u636e\u6d41\u7684\u9ad8\u901f\u516c\u8def","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/Kafka\u6d88\u606f\u961f\u5217"},"next":{"title":"Hive - SQL on Hadoop","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/Hive\u6570\u636e\u4ed3\u5e93"}}');var r=t(74848),s=t(28453);const a={sidebar_position:4,title:"Flink - \u6d41\u6279\u4e00\u4f53\u7684\u5b9e\u65f6\u8ba1\u7b97\u5f15\u64ce"},o="Flink - \u65b0\u4e00\u4ee3\u5927\u6570\u636e\u5904\u7406\u6846\u67b6",l={},c=[{value:"\u7b2c\u4e00\u90e8\u5206\uff1a\u4e3a\u4ec0\u4e48\u9009\u62e9Flink\uff1f",id:"\u7b2c\u4e00\u90e8\u5206\u4e3a\u4ec0\u4e48\u9009\u62e9flink",level:2},{value:"Flink vs Spark Streaming",id:"flink-vs-spark-streaming",level:3},{value:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u5feb\u901f\u5f00\u59cb",id:"\u7b2c\u4e8c\u90e8\u5206\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u5b89\u88c5Flink",id:"\u5b89\u88c5flink",level:3},{value:"\u7b2c\u4e00\u4e2aFlink\u7a0b\u5e8f",id:"\u7b2c\u4e00\u4e2aflink\u7a0b\u5e8f",level:3},{value:"\u7b2c\u4e09\u90e8\u5206\uff1aDataStream API",id:"\u7b2c\u4e09\u90e8\u5206datastream-api",level:2},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c",level:3},{value:"\u5b9e\u6218\uff1aWordCount",id:"\u5b9e\u6218wordcount",level:3},{value:"\u7b2c\u56db\u90e8\u5206\uff1a\u7a97\u53e3\u64cd\u4f5c",id:"\u7b2c\u56db\u90e8\u5206\u7a97\u53e3\u64cd\u4f5c",level:2},{value:"\u7a97\u53e3\u7c7b\u578b",id:"\u7a97\u53e3\u7c7b\u578b",level:3},{value:"\u5b9e\u6218\uff1a\u5b9e\u65f6\u9500\u552e\u7edf\u8ba1",id:"\u5b9e\u6218\u5b9e\u65f6\u9500\u552e\u7edf\u8ba1",level:3},{value:"\u7b2c\u4e94\u90e8\u5206\uff1a\u72b6\u6001\u7ba1\u7406",id:"\u7b2c\u4e94\u90e8\u5206\u72b6\u6001\u7ba1\u7406",level:2},{value:"\u4ec0\u4e48\u662f\u72b6\u6001\uff1f",id:"\u4ec0\u4e48\u662f\u72b6\u6001",level:3},{value:"\u5b9e\u6218\uff1a\u7528\u6237\u884c\u4e3a\u8ffd\u8e2a",id:"\u5b9e\u6218\u7528\u6237\u884c\u4e3a\u8ffd\u8e2a",level:3},{value:"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee",id:"\u7b2c\u516d\u90e8\u5206\u5b9e\u6218\u9879\u76ee",level:2},{value:"\u9879\u76ee\uff1a\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf",id:"\u9879\u76ee\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf",level:3},{value:"\u9879\u76ee\uff1a\u5b9e\u65f6\u5f02\u5e38\u68c0\u6d4b",id:"\u9879\u76ee\u5b9e\u65f6\u5f02\u5e38\u68c0\u6d4b",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u7ec3\u4e60\u9898",id:"\u7ec3\u4e60\u9898",level:2}];function m(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"flink---\u65b0\u4e00\u4ee3\u5927\u6570\u636e\u5904\u7406\u6846\u67b6",children:"Flink - \u65b0\u4e00\u4ee3\u5927\u6570\u636e\u5904\u7406\u6846\u67b6"})}),"\n",(0,r.jsxs)(e.p,{children:["Flink\u662f\u76ee\u524d\u6700\u5f3a\u5927\u7684\u5b9e\u65f6\u8ba1\u7b97\u6846\u67b6\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60",(0,r.jsx)(e.strong,{children:"\u7528Flink\u6784\u5efa\u771f\u6b63\u7684\u5b9e\u65f6\u5e94\u7528"}),"\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e00\u90e8\u5206\u4e3a\u4ec0\u4e48\u9009\u62e9flink",children:"\u7b2c\u4e00\u90e8\u5206\uff1a\u4e3a\u4ec0\u4e48\u9009\u62e9Flink\uff1f"}),"\n",(0,r.jsx)(e.h3,{id:"flink-vs-spark-streaming",children:"Flink vs Spark Streaming"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# Spark Streaming\uff1a\u5fae\u6279\u5904\u7406\n# \u6bcf\u96941\u79d2\u5904\u7406\u4e00\u6279\u6570\u636e\nstream.window(1, 'seconds').process()\n\n# Flink\uff1a\u771f\u6b63\u7684\u6d41\u5904\u7406\n# \u6bcf\u6761\u6570\u636e\u5230\u8fbe\u7acb\u5373\u5904\u7406\nstream.process()  # \u5ef6\u8fdf\u66f4\u4f4e\uff01\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Flink\u7684\u4f18\u52bf"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u771f\u6b63\u7684\u6d41\u5904\u7406"}),"\uff1a\u9010\u6761\u5904\u7406\uff0c\u5ef6\u8fdf\u6beb\u79d2\u7ea7"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u7cbe\u786e\u4e00\u6b21"}),"\uff1aExactly-Once\u8bed\u4e49"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u72b6\u6001\u7ba1\u7406"}),"\uff1a\u5185\u7f6e\u72b6\u6001\u5b58\u50a8"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4e8b\u4ef6\u65f6\u95f4"}),"\uff1a\u652f\u6301\u4e71\u5e8f\u6570\u636e"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6d41\u6279\u4e00\u4f53"}),"\uff1a\u540c\u4e00\u5957API\u5904\u7406\u6d41\u548c\u6279"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e8c\u90e8\u5206\u5feb\u901f\u5f00\u59cb",children:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u5feb\u901f\u5f00\u59cb"}),"\n",(0,r.jsx)(e.h3,{id:"\u5b89\u88c5flink",children:"\u5b89\u88c5Flink"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u65b9\u6cd51\uff1aDocker\uff08\u63a8\u8350\uff09"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"# docker-compose.yml\nversion: '3'\nservices:\n  jobmanager:\n    image: flink:1.17\n    ports:\n      - \"8081:8081\"\n    command: jobmanager\n    environment:\n      - |\n        FLINK_PROPERTIES=\n        jobmanager.rpc.address: jobmanager\n\n  taskmanager:\n    image: flink:1.17\n    depends_on:\n      - jobmanager\n    command: taskmanager\n    environment:\n      - |\n        FLINK_PROPERTIES=\n        jobmanager.rpc.address: jobmanager\n        taskmanager.numberOfTaskSlots: 2\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8\ndocker-compose up -d\n\n# \u8bbf\u95eeWeb UI\n# http://localhost:8081\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u65b9\u6cd52\uff1aPyFlink"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pip install apache-flink\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u7b2c\u4e00\u4e2aflink\u7a0b\u5e8f",children:"\u7b2c\u4e00\u4e2aFlink\u7a0b\u5e8f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pyflink.datastream import StreamExecutionEnvironment\n\n# \u521b\u5efa\u6267\u884c\u73af\u5883\nenv = StreamExecutionEnvironment.get_execution_environment()\n\n# \u521b\u5efa\u6570\u636e\u6d41\ndata = env.from_collection([1, 2, 3, 4, 5])\n\n# \u8f6c\u6362\nresult = data.map(lambda x: x * 2)\n\n# \u8f93\u51fa\nresult.print()\n\n# \u6267\u884c\nenv.execute("First Flink Job")\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e09\u90e8\u5206datastream-api",children:"\u7b2c\u4e09\u90e8\u5206\uff1aDataStream API"}),"\n",(0,r.jsx)(e.h3,{id:"\u57fa\u672c\u64cd\u4f5c",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.common.typeinfo import Types\n\nenv = StreamExecutionEnvironment.get_execution_environment()\n\n# 1. map\uff1a\u8f6c\u6362\u6bcf\u4e2a\u5143\u7d20\ndata = env.from_collection([1, 2, 3, 4, 5])\nresult = data.map(lambda x: x * 2, output_type=Types.INT())\n\n# 2. filter\uff1a\u8fc7\u6ee4\u5143\u7d20\nresult = data.filter(lambda x: x % 2 == 0)\n\n# 3. flat_map\uff1a\u5c55\u5e73\ntext = env.from_collection(["hello world", "flink is great"])\nwords = text.flat_map(\n    lambda line: line.split(),\n    output_type=Types.STRING()\n)\n\n# 4. key_by\uff1a\u6309key\u5206\u7ec4\npairs = env.from_collection([("a", 1), ("b", 2), ("a", 3)])\nkeyed = pairs.key_by(lambda x: x[0])\n\n# 5. reduce\uff1a\u805a\u5408\nresult = keyed.reduce(lambda x, y: (x[0], x[1] + y[1]))\n\n# 6. window\uff1a\u7a97\u53e3\u64cd\u4f5c\nfrom pyflink.datastream.window import TumblingProcessingTimeWindows\nfrom pyflink.common.time import Time\n\nwindowed = keyed.window(TumblingProcessingTimeWindows.of(Time.seconds(5)))\nresult = windowed.reduce(lambda x, y: (x[0], x[1] + y[1]))\n\nresult.print()\nenv.execute("DataStream Operations")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9e\u6218wordcount",children:"\u5b9e\u6218\uff1aWordCount"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.common.typeinfo import Types\n\ndef word_count():\n    """\u6d41\u5f0fWordCount"""\n    env = StreamExecutionEnvironment.get_execution_environment()\n    \n    # \u4ecesocket\u8bfb\u53d6\u6570\u636e\n    # \u5148\u542f\u52a8\uff1anc -lk 9999\n    text = env.socket_text_stream("localhost", 9999)\n    \n    # \u5904\u7406\n    counts = text.flat_map(lambda line: line.split()) \\\n        .map(lambda word: (word, 1), output_type=Types.TUPLE([Types.STRING(), Types.INT()])) \\\n        .key_by(lambda x: x[0]) \\\n        .reduce(lambda x, y: (x[0], x[1] + y[1]))\n    \n    # \u8f93\u51fa\n    counts.print()\n    \n    # \u6267\u884c\n    env.execute("Streaming WordCount")\n\nif __name__ == \'__main__\':\n    word_count()\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u56db\u90e8\u5206\u7a97\u53e3\u64cd\u4f5c",children:"\u7b2c\u56db\u90e8\u5206\uff1a\u7a97\u53e3\u64cd\u4f5c"}),"\n",(0,r.jsx)(e.h3,{id:"\u7a97\u53e3\u7c7b\u578b",children:"\u7a97\u53e3\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.window import TumblingProcessingTimeWindows, \\\n    SlidingProcessingTimeWindows, SessionWindows\nfrom pyflink.common.time import Time\nfrom pyflink.common.typeinfo import Types\n\nenv = StreamExecutionEnvironment.get_execution_environment()\n\n# \u6a21\u62df\u6570\u636e\u6d41\ndata = env.from_collection([\n    ("user1", 100),\n    ("user2", 200),\n    ("user1", 150),\n])\n\nkeyed = data.key_by(lambda x: x[0])\n\n# 1. \u6eda\u52a8\u7a97\u53e3\uff1a\u4e0d\u91cd\u53e0\ntumbling = keyed.window(TumblingProcessingTimeWindows.of(Time.seconds(10)))\n\n# 2. \u6ed1\u52a8\u7a97\u53e3\uff1a\u6709\u91cd\u53e0\nsliding = keyed.window(SlidingProcessingTimeWindows.of(\n    Time.seconds(10),  # \u7a97\u53e3\u5927\u5c0f\n    Time.seconds(5)    # \u6ed1\u52a8\u6b65\u957f\n))\n\n# 3. \u4f1a\u8bdd\u7a97\u53e3\uff1a\u57fa\u4e8e\u6d3b\u52a8\u95f4\u9694\nsession = keyed.window(SessionWindows.with_gap(Time.seconds(30)))\n\n# \u805a\u5408\nresult = tumbling.reduce(lambda x, y: (x[0], x[1] + y[1]))\nresult.print()\n\nenv.execute("Window Operations")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9e\u6218\u5b9e\u65f6\u9500\u552e\u7edf\u8ba1",children:"\u5b9e\u6218\uff1a\u5b9e\u65f6\u9500\u552e\u7edf\u8ba1"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.window import TumblingProcessingTimeWindows\nfrom pyflink.common.time import Time\nfrom pyflink.common.typeinfo import Types\nimport json\n\nclass SalesAnalyzer:\n    \"\"\"\u5b9e\u65f6\u9500\u552e\u5206\u6790\"\"\"\n    \n    @staticmethod\n    def run():\n        env = StreamExecutionEnvironment.get_execution_environment()\n        \n        # \u4eceKafka\u8bfb\u53d6\u8ba2\u5355\u6570\u636e\n        from pyflink.datastream.connectors import FlinkKafkaConsumer\n        from pyflink.common.serialization import SimpleStringSchema\n        \n        kafka_consumer = FlinkKafkaConsumer(\n            topics='orders',\n            deserialization_schema=SimpleStringSchema(),\n            properties={'bootstrap.servers': 'localhost:9092', 'group.id': 'flink-group'}\n        )\n        \n        orders = env.add_source(kafka_consumer)\n        \n        # \u89e3\u6790JSON\n        parsed = orders.map(\n            lambda x: json.loads(x),\n            output_type=Types.MAP(Types.STRING(), Types.STRING())\n        )\n        \n        # \u63d0\u53d6\u91d1\u989d\n        amounts = parsed.map(\n            lambda x: (x['category'], float(x['amount'])),\n            output_type=Types.TUPLE([Types.STRING(), Types.FLOAT()])\n        )\n        \n        # \u6309\u7c7b\u522b\u5206\u7ec4\uff0c5\u79d2\u7a97\u53e3\u7edf\u8ba1\n        result = amounts.key_by(lambda x: x[0]) \\\n            .window(TumblingProcessingTimeWindows.of(Time.seconds(5))) \\\n            .reduce(lambda x, y: (x[0], x[1] + y[1]))\n        \n        # \u8f93\u51fa\n        result.print()\n        \n        env.execute(\"Real-time Sales Analysis\")\n\nif __name__ == '__main__':\n    SalesAnalyzer.run()\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u4e94\u90e8\u5206\u72b6\u6001\u7ba1\u7406",children:"\u7b2c\u4e94\u90e8\u5206\uff1a\u72b6\u6001\u7ba1\u7406"}),"\n",(0,r.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u72b6\u6001",children:"\u4ec0\u4e48\u662f\u72b6\u6001\uff1f"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u72b6\u6001\u5c31\u662f\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u9700\u8981\u8bb0\u4f4f\u7684\u4fe1\u606f"}),"\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.functions import MapFunction, RuntimeContext\nfrom pyflink.common.typeinfo import Types\n\nclass StatefulMapper(MapFunction):\n    """\u6709\u72b6\u6001\u7684Map\u51fd\u6570"""\n    \n    def open(self, runtime_context: RuntimeContext):\n        """\u521d\u59cb\u5316\u72b6\u6001"""\n        # \u83b7\u53d6\u72b6\u6001\u63cf\u8ff0\u7b26\n        from pyflink.datastream.state import ValueStateDescriptor\n        \n        descriptor = ValueStateDescriptor(\n            "count",  # \u72b6\u6001\u540d\u79f0\n            Types.INT()  # \u72b6\u6001\u7c7b\u578b\n        )\n        \n        # \u83b7\u53d6\u72b6\u6001\n        self.count_state = runtime_context.get_state(descriptor)\n    \n    def map(self, value):\n        """\u5904\u7406\u5143\u7d20"""\n        # \u8bfb\u53d6\u72b6\u6001\n        count = self.count_state.value()\n        if count is None:\n            count = 0\n        \n        # \u66f4\u65b0\u72b6\u6001\n        count += 1\n        self.count_state.update(count)\n        \n        return f"{value}: count={count}"\n\n# \u4f7f\u7528\nenv = StreamExecutionEnvironment.get_execution_environment()\ndata = env.from_collection(["a", "b", "a", "c", "a"])\n\nresult = data.key_by(lambda x: x).map(\n    StatefulMapper(),\n    output_type=Types.STRING()\n)\n\nresult.print()\nenv.execute("Stateful Processing")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9e\u6218\u7528\u6237\u884c\u4e3a\u8ffd\u8e2a",children:"\u5b9e\u6218\uff1a\u7528\u6237\u884c\u4e3a\u8ffd\u8e2a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.functions import KeyedProcessFunction\nfrom pyflink.common.typeinfo import Types\nimport json\n\nclass UserBehaviorTracker(KeyedProcessFunction):\n    """\u7528\u6237\u884c\u4e3a\u8ffd\u8e2a\u5668"""\n    \n    def open(self, runtime_context):\n        from pyflink.datastream.state import ValueStateDescriptor, ListStateDescriptor\n        \n        # \u7528\u6237\u6700\u540e\u6d3b\u8dc3\u65f6\u95f4\n        self.last_active = runtime_context.get_state(\n            ValueStateDescriptor("last_active", Types.LONG())\n        )\n        \n        # \u7528\u6237\u884c\u4e3a\u5386\u53f2\n        self.behavior_history = runtime_context.get_list_state(\n            ListStateDescriptor("history", Types.STRING())\n        )\n    \n    def process_element(self, value, ctx):\n        """\u5904\u7406\u7528\u6237\u884c\u4e3a"""\n        user_id = value[0]\n        action = value[1]\n        timestamp = ctx.timestamp()\n        \n        # \u66f4\u65b0\u6700\u540e\u6d3b\u8dc3\u65f6\u95f4\n        last_time = self.last_active.value()\n        self.last_active.update(timestamp)\n        \n        # \u6dfb\u52a0\u5230\u5386\u53f2\n        self.behavior_history.add(action)\n        \n        # \u8ba1\u7b97\u7528\u6237\u6d3b\u8dc3\u5ea6\n        history = list(self.behavior_history.get())\n        activity_score = len(history)\n        \n        # \u68c0\u6d4b\u5f02\u5e38\u884c\u4e3a\n        if last_time and (timestamp - last_time) < 1000:  # 1\u79d2\u5185\u591a\u6b21\u64cd\u4f5c\n            yield f"\u26a0\ufe0f \u5f02\u5e38: \u7528\u6237{user_id}\u64cd\u4f5c\u8fc7\u4e8e\u9891\u7e41"\n        \n        yield f"\u7528\u6237{user_id}: {action}, \u6d3b\u8dc3\u5ea6={activity_score}"\n\n# \u4f7f\u7528\nenv = StreamExecutionEnvironment.get_execution_environment()\n\n# \u6a21\u62df\u7528\u6237\u884c\u4e3a\u6d41\nbehaviors = env.from_collection([\n    ("user1", "login"),\n    ("user1", "view"),\n    ("user2", "login"),\n    ("user1", "purchase"),\n    ("user2", "view"),\n])\n\nresult = behaviors.key_by(lambda x: x[0]).process(\n    UserBehaviorTracker(),\n    output_type=Types.STRING()\n)\n\nresult.print()\nenv.execute("User Behavior Tracking")\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7b2c\u516d\u90e8\u5206\u5b9e\u6218\u9879\u76ee",children:"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee"}),"\n",(0,r.jsx)(e.h3,{id:"\u9879\u76ee\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf",children:"\u9879\u76ee\uff1a\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.functions import KeyedProcessFunction\nfrom pyflink.common.typeinfo import Types\nfrom collections import defaultdict\nimport json\n\nclass RealtimeRecommender(KeyedProcessFunction):\n    \"\"\"\u5b9e\u65f6\u63a8\u8350\u5f15\u64ce\"\"\"\n    \n    def open(self, runtime_context):\n        from pyflink.datastream.state import MapStateDescriptor\n        \n        # \u7528\u6237\u6d4f\u89c8\u5386\u53f2\n        self.view_history = runtime_context.get_map_state(\n            MapStateDescriptor(\"views\", Types.STRING(), Types.INT())\n        )\n        \n        # \u7528\u6237\u5174\u8da3\u6807\u7b7e\n        self.interest_tags = runtime_context.get_map_state(\n            MapStateDescriptor(\"tags\", Types.STRING(), Types.FLOAT())\n        )\n    \n    def process_element(self, value, ctx):\n        \"\"\"\u5904\u7406\u7528\u6237\u884c\u4e3a\uff0c\u751f\u6210\u63a8\u8350\"\"\"\n        user_id = value['user_id']\n        item_id = value['item_id']\n        action = value['action']\n        category = value['category']\n        \n        # \u66f4\u65b0\u6d4f\u89c8\u5386\u53f2\n        view_count = self.view_history.get(item_id)\n        if view_count is None:\n            view_count = 0\n        self.view_history.put(item_id, view_count + 1)\n        \n        # \u66f4\u65b0\u5174\u8da3\u6807\u7b7e\n        interest_score = self.interest_tags.get(category)\n        if interest_score is None:\n            interest_score = 0.0\n        \n        # \u6839\u636e\u884c\u4e3a\u7c7b\u578b\u66f4\u65b0\u5206\u6570\n        if action == 'view':\n            interest_score += 1.0\n        elif action == 'click':\n            interest_score += 2.0\n        elif action == 'cart':\n            interest_score += 5.0\n        elif action == 'purchase':\n            interest_score += 10.0\n        \n        self.interest_tags.put(category, interest_score)\n        \n        # \u751f\u6210\u63a8\u8350\n        recommendations = self.generate_recommendations()\n        \n        yield {\n            'user_id': user_id,\n            'recommendations': recommendations,\n            'interests': dict(self.interest_tags.items())\n        }\n    \n    def generate_recommendations(self):\n        \"\"\"\u751f\u6210\u63a8\u8350\u5217\u8868\"\"\"\n        # \u83b7\u53d6Top3\u5174\u8da3\u7c7b\u522b\n        interests = list(self.interest_tags.items())\n        interests.sort(key=lambda x: x[1], reverse=True)\n        \n        top_categories = [cat for cat, score in interests[:3]]\n        \n        # \u57fa\u4e8e\u5174\u8da3\u7c7b\u522b\u63a8\u8350\u5546\u54c1\n        recommendations = []\n        for category in top_categories:\n            # \u8fd9\u91cc\u5e94\u8be5\u4ece\u5546\u54c1\u5e93\u67e5\u8be2\n            recommendations.append(f\"\u63a8\u8350{category}\u7c7b\u5546\u54c1\")\n        \n        return recommendations\n\n# \u4f7f\u7528\ndef run_recommender():\n    env = StreamExecutionEnvironment.get_execution_environment()\n    \n    # \u4eceKafka\u8bfb\u53d6\u7528\u6237\u884c\u4e3a\n    from pyflink.datastream.connectors import FlinkKafkaConsumer\n    from pyflink.common.serialization import SimpleStringSchema\n    \n    kafka_consumer = FlinkKafkaConsumer(\n        topics='user_behavior',\n        deserialization_schema=SimpleStringSchema(),\n        properties={'bootstrap.servers': 'localhost:9092'}\n    )\n    \n    behaviors = env.add_source(kafka_consumer)\n    \n    # \u89e3\u6790JSON\n    parsed = behaviors.map(\n        lambda x: json.loads(x),\n        output_type=Types.MAP(Types.STRING(), Types.STRING())\n    )\n    \n    # \u5b9e\u65f6\u63a8\u8350\n    recommendations = parsed.key_by(lambda x: x['user_id']).process(\n        RealtimeRecommender(),\n        output_type=Types.MAP(Types.STRING(), Types.STRING())\n    )\n    \n    # \u8f93\u51fa\u5230Kafka\n    from pyflink.datastream.connectors import FlinkKafkaProducer\n    \n    kafka_producer = FlinkKafkaProducer(\n        topic='recommendations',\n        serialization_schema=SimpleStringSchema(),\n        producer_config={'bootstrap.servers': 'localhost:9092'}\n    )\n    \n    recommendations.map(\n        lambda x: json.dumps(x),\n        output_type=Types.STRING()\n    ).add_sink(kafka_producer)\n    \n    env.execute(\"Realtime Recommender\")\n\nif __name__ == '__main__':\n    run_recommender()\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u9879\u76ee\u5b9e\u65f6\u5f02\u5e38\u68c0\u6d4b",children:"\u9879\u76ee\uff1a\u5b9e\u65f6\u5f02\u5e38\u68c0\u6d4b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.functions import KeyedProcessFunction\nfrom pyflink.common.typeinfo import Types\nimport json\n\nclass AnomalyDetector(KeyedProcessFunction):\n    \"\"\"\u5b9e\u65f6\u5f02\u5e38\u68c0\u6d4b\"\"\"\n    \n    def open(self, runtime_context):\n        from pyflink.datastream.state import ValueStateDescriptor, ListStateDescriptor\n        \n        # \u6700\u8fd1N\u4e2a\u503c\n        self.recent_values = runtime_context.get_list_state(\n            ListStateDescriptor(\"recent\", Types.FLOAT())\n        )\n        \n        # \u7edf\u8ba1\u4fe1\u606f\n        self.stats = runtime_context.get_value_state(\n            ValueStateDescriptor(\"stats\", Types.MAP(Types.STRING(), Types.FLOAT()))\n        )\n    \n    def process_element(self, value, ctx):\n        \"\"\"\u68c0\u6d4b\u5f02\u5e38\"\"\"\n        metric_name = value['metric']\n        metric_value = float(value['value'])\n        timestamp = value['timestamp']\n        \n        # \u83b7\u53d6\u5386\u53f2\u6570\u636e\n        history = list(self.recent_values.get())\n        history.append(metric_value)\n        \n        # \u4fdd\u6301\u6700\u8fd1100\u4e2a\u503c\n        if len(history) > 100:\n            history = history[-100:]\n        \n        # \u66f4\u65b0\u72b6\u6001\n        self.recent_values.clear()\n        for v in history:\n            self.recent_values.add(v)\n        \n        # \u8ba1\u7b97\u7edf\u8ba1\u91cf\n        if len(history) >= 10:\n            import numpy as np\n            mean = np.mean(history)\n            std = np.std(history)\n            \n            # 3-sigma\u89c4\u5219\u68c0\u6d4b\u5f02\u5e38\n            if abs(metric_value - mean) > 3 * std:\n                yield {\n                    'type': 'anomaly',\n                    'metric': metric_name,\n                    'value': metric_value,\n                    'mean': mean,\n                    'std': std,\n                    'timestamp': timestamp,\n                    'message': f'\u5f02\u5e38\u503c\u68c0\u6d4b: {metric_value:.2f} (\u5747\u503c={mean:.2f}, \u6807\u51c6\u5dee={std:.2f})'\n                }\n            else:\n                yield {\n                    'type': 'normal',\n                    'metric': metric_name,\n                    'value': metric_value\n                }\n\n# \u4f7f\u7528\ndef run_anomaly_detector():\n    env = StreamExecutionEnvironment.get_execution_environment()\n    \n    # \u6a21\u62df\u76d1\u63a7\u6570\u636e\n    metrics = env.from_collection([\n        {'metric': 'cpu', 'value': 50, 'timestamp': 1000},\n        {'metric': 'cpu', 'value': 52, 'timestamp': 2000},\n        {'metric': 'cpu', 'value': 95, 'timestamp': 3000},  # \u5f02\u5e38\n        {'metric': 'cpu', 'value': 51, 'timestamp': 4000},\n    ])\n    \n    # \u68c0\u6d4b\u5f02\u5e38\n    results = metrics.key_by(lambda x: x['metric']).process(\n        AnomalyDetector(),\n        output_type=Types.MAP(Types.STRING(), Types.STRING())\n    )\n    \n    # \u8fc7\u6ee4\u5f02\u5e38\n    anomalies = results.filter(lambda x: x['type'] == 'anomaly')\n    \n    # \u8f93\u51fa\u544a\u8b66\n    anomalies.print()\n    \n    env.execute(\"Anomaly Detection\")\n\nif __name__ == '__main__':\n    run_anomaly_detector()\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsx)(e.p,{children:"Flink\u662f\u5b9e\u65f6\u8ba1\u7b97\u7684\u672a\u6765\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u771f\u6b63\u7684\u6d41\u5904\u7406"}),"\uff1a\u6beb\u79d2\u7ea7\u5ef6\u8fdf"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u7cbe\u786e\u4e00\u6b21"}),"\uff1a\u6570\u636e\u4e0d\u4e22\u4e0d\u91cd"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u72b6\u6001\u7ba1\u7406"}),"\uff1a\u8f7b\u677e\u5904\u7406\u6709\u72b6\u6001\u8ba1\u7b97"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6d41\u6279\u4e00\u4f53"}),"\uff1a\u7edf\u4e00API"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u8bb0\u4f4f\uff1a",(0,r.jsx)(e.strong,{children:"Flink\u8ba9\u5b9e\u65f6\u8ba1\u7b97\u53d8\u5f97\u7b80\u5355"}),"\uff01"]}),"\n",(0,r.jsx)(e.h2,{id:"\u7ec3\u4e60\u9898",children:"\u7ec3\u4e60\u9898"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u5b9e\u73b0\u5b9e\u65f6Top-N\u70ed\u699c"}),"\n",(0,r.jsx)(e.li,{children:"\u6784\u5efa\u5b9e\u65f6\u98ce\u63a7\u7cfb\u7edf"}),"\n",(0,r.jsx)(e.li,{children:"\u5b9e\u73b0CEP\u590d\u6742\u4e8b\u4ef6\u5904\u7406"}),"\n",(0,r.jsx)(e.li,{children:"\u642d\u5efaFlink\u96c6\u7fa4"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u4e0b\u4e00\u7ae0\uff1aHive\u6570\u636e\u4ed3\u5e93\uff08\u5373\u5c06\u63a8\u51fa\uff09"})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(m,{...n})}):m(n)}},28453(n,e,t){t.d(e,{R:()=>a,x:()=>o});var i=t(96540);const r={},s=i.createContext(r);function a(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);