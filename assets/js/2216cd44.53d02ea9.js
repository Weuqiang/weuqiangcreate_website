"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[62539],{41766(n,e,t){t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>s});const r=JSON.parse('{"id":"\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/17\u5e76\u53d1\u6267\u884c","title":"\u5e76\u53d1\u6267\u884c","description":"\u6982\u8ff0","source":"@site/docs/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/17\u5e76\u53d1\u6267\u884c.mdx","sourceDirName":"\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C","slug":"/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/17\u5e76\u53d1\u6267\u884c","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/17\u5e76\u53d1\u6267\u884c","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"sidebar_position":17,"title":"\u5e76\u53d1\u6267\u884c"},"sidebar":"tutorialSidebar","previous":{"title":"C\u9884\u5904\u7406\u5668\u548cC\u5e93","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/16C\u9884\u5904\u7406\u5668\u548cC\u5e93"},"next":{"title":"\u7f51\u7edc\u7f16\u7a0b","permalink":"/weuqiangcreate_website/docs/\u9009\u62e9\u7f16\u7a0b\u8bed\u8a00/C/18\u7f51\u7edc\u7f16\u7a0b"}}');var i=t(74848),d=t(28453);const a={sidebar_position:17,title:"\u5e76\u53d1\u6267\u884c"},o="\u5e76\u53d1\u6267\u884c",l={},s=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"POSIX\u7ebf\u7a0b\uff08pthread\uff09",id:"posix\u7ebf\u7a0bpthread",level:2},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"\u521b\u5efa\u548c\u7b49\u5f85\u7ebf\u7a0b",id:"\u521b\u5efa\u548c\u7b49\u5f85\u7ebf\u7a0b",level:3},{value:"\u7ebf\u7a0b\u51fd\u6570\u8fd4\u56de\u503c",id:"\u7ebf\u7a0b\u51fd\u6570\u8fd4\u56de\u503c",level:3},{value:"\u4e92\u65a5\u9501\uff08Mutex\uff09",id:"\u4e92\u65a5\u9501mutex",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u6b7b\u9501\u95ee\u9898",id:"\u6b7b\u9501\u95ee\u9898",level:3},{value:"\u6761\u4ef6\u53d8\u91cf\uff08Condition Variable\uff09",id:"\u6761\u4ef6\u53d8\u91cfcondition-variable",level:2},{value:"\u8bfb\u5199\u9501\uff08Read-Write Lock\uff09",id:"\u8bfb\u5199\u9501read-write-lock",level:2},{value:"\u4fe1\u53f7\u91cf\uff08Semaphore\uff09",id:"\u4fe1\u53f7\u91cfsemaphore",level:2},{value:"\u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8\uff08Thread Local Storage\uff09",id:"\u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8thread-local-storage",level:2},{value:"\u7ebf\u7a0b\u6c60",id:"\u7ebf\u7a0b\u6c60",level:2},{value:"\u539f\u5b50\u64cd\u4f5c",id:"\u539f\u5b50\u64cd\u4f5c",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u7ebf\u7a0b\u5b89\u5168",id:"\u7ebf\u7a0b\u5b89\u5168",level:3},{value:"\u6027\u80fd\u8003\u8651",id:"\u6027\u80fd\u8003\u8651",level:3},{value:"\u5e38\u89c1\u9519\u8bef",id:"\u5e38\u89c1\u9519\u8bef",level:3},{value:"\u5b9e\u9645\u5e94\u7528\u573a\u666f",id:"\u5b9e\u9645\u5e94\u7528\u573a\u666f",level:2},{value:"1. \u5e76\u884c\u8ba1\u7b97",id:"1-\u5e76\u884c\u8ba1\u7b97",level:3},{value:"2. \u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b",id:"2-\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b",level:3},{value:"\u76f8\u5173\u8d44\u6e90",id:"\u76f8\u5173\u8d44\u6e90",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"\u5e76\u53d1\u6267\u884c",children:"\u5e76\u53d1\u6267\u884c"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(e.p,{children:"\u5e76\u53d1\uff08Concurrency\uff09\u662f\u6307\u7a0b\u5e8f\u5728\u540c\u4e00\u65f6\u95f4\u6bb5\u5185\u5904\u7406\u591a\u4e2a\u4efb\u52a1\u7684\u80fd\u529b\u3002\u5728C\u8bed\u8a00\u4e2d\uff0c\u4e3b\u8981\u901a\u8fc7\u591a\u7ebf\u7a0b\uff08Multi-threading\uff09\u6765\u5b9e\u73b0\u5e76\u53d1\u6267\u884c\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["C\u8bed\u8a00\u6807\u51c6\u5e93\u4eceC11\u5f00\u59cb\u5f15\u5165\u4e86\u7ebf\u7a0b\u652f\u6301\uff08",(0,i.jsx)(e.code,{children:"threads.h"}),"\uff09\uff0c\u4f46\u5728\u6b64\u4e4b\u524d\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u4f7f\u7528POSIX\u7ebf\u7a0b\u5e93\uff08pthread\uff09\u6216Windows\u7ebf\u7a0bAPI\u3002"]}),"\n",(0,i.jsx)(e.h2,{id:"posix\u7ebf\u7a0bpthread",children:"POSIX\u7ebf\u7a0b\uff08pthread\uff09"}),"\n",(0,i.jsx)(e.p,{children:"POSIX\u7ebf\u7a0b\uff08\u901a\u5e38\u79f0\u4e3apthread\uff09\u662fUnix/Linux\u7cfb\u7edf\u4e0a\u6700\u5e38\u7528\u7684\u591a\u7ebf\u7a0b\u7f16\u7a0b\u63a5\u53e3\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7ebf\u7a0b\uff08Thread\uff09"}),"\uff1a\u7a0b\u5e8f\u6267\u884c\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7ebf\u7a0b"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4e3b\u7ebf\u7a0b\uff08Main Thread\uff09"}),"\uff1a\u7a0b\u5e8f\u542f\u52a8\u65f6\u81ea\u52a8\u521b\u5efa\u7684\u7ebf\u7a0b"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5b50\u7ebf\u7a0b\uff08Child Thread\uff09"}),"\uff1a\u7531\u4e3b\u7ebf\u7a0b\u6216\u5176\u4ed6\u7ebf\u7a0b\u521b\u5efa\u7684\u7ebf\u7a0b"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u521b\u5efa\u548c\u7b49\u5f85\u7ebf\u7a0b",children:"\u521b\u5efa\u548c\u7b49\u5f85\u7ebf\u7a0b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <unistd.h>\n\n// \u7ebf\u7a0b\u51fd\u6570\nvoid* thread_function(void* arg) {\n    int thread_id = *(int*)arg;\n    printf("\u7ebf\u7a0b %d \u5f00\u59cb\u6267\u884c\\n", thread_id);\n    \n    // \u6a21\u62df\u5de5\u4f5c\n    sleep(2);\n    \n    printf("\u7ebf\u7a0b %d \u6267\u884c\u5b8c\u6bd5\\n", thread_id);\n    return NULL;\n}\n\nint main() {\n    pthread_t thread1, thread2;\n    int id1 = 1, id2 = 2;\n    \n    // \u521b\u5efa\u7ebf\u7a0b\n    pthread_create(&thread1, NULL, thread_function, &id1);\n    pthread_create(&thread2, NULL, thread_function, &id2);\n    \n    printf("\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u5b50\u7ebf\u7a0b\u5b8c\u6210...\\n");\n    \n    // \u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f\n    pthread_join(thread1, NULL);\n    pthread_join(thread2, NULL);\n    \n    printf("\u6240\u6709\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\\n");\n    return 0;\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u7f16\u8bd1\u547d\u4ee4\uff1a",(0,i.jsx)(e.code,{children:"gcc program.c -pthread -o program"})]}),"\n",(0,i.jsx)(e.h3,{id:"\u7ebf\u7a0b\u51fd\u6570\u8fd4\u56de\u503c",children:"\u7ebf\u7a0b\u51fd\u6570\u8fd4\u56de\u503c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <stdlib.h>\n\nvoid* calculate_sum(void* arg) {\n    int n = *(int*)arg;\n    int* result = malloc(sizeof(int));\n    \n    *result = 0;\n    for (int i = 1; i <= n; i++) {\n        *result += i;\n    }\n    \n    return result;\n}\n\nint main() {\n    pthread_t thread;\n    int n = 100;\n    int* result;\n    \n    pthread_create(&thread, NULL, calculate_sum, &n);\n    \n    // \u83b7\u53d6\u7ebf\u7a0b\u8fd4\u56de\u503c\n    pthread_join(thread, (void**)&result);\n    \n    printf("1\u5230%d\u7684\u548c\u4e3a: %d\\n", n, *result);\n    \n    free(result);\n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e92\u65a5\u9501mutex",children:"\u4e92\u65a5\u9501\uff08Mutex\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u4e92\u65a5\u9501\u7528\u4e8e\u4fdd\u62a4\u5171\u4eab\u8d44\u6e90\uff0c\u9632\u6b62\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u9020\u6210\u6570\u636e\u7ade\u4e89\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n\nint counter = 0;\npthread_mutex_t mutex;\n\nvoid* increment(void* arg) {\n    for (int i = 0; i < 100000; i++) {\n        pthread_mutex_lock(&mutex);    // \u52a0\u9501\n        counter++;\n        pthread_mutex_unlock(&mutex);  // \u89e3\u9501\n    }\n    return NULL;\n}\n\nint main() {\n    pthread_t threads[5];\n    \n    // \u521d\u59cb\u5316\u4e92\u65a5\u9501\n    pthread_mutex_init(&mutex, NULL);\n    \n    // \u521b\u5efa5\u4e2a\u7ebf\u7a0b\n    for (int i = 0; i < 5; i++) {\n        pthread_create(&threads[i], NULL, increment, NULL);\n    }\n    \n    // \u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5b8c\u6210\n    for (int i = 0; i < 5; i++) {\n        pthread_join(threads[i], NULL);\n    }\n    \n    printf("\u6700\u7ec8\u8ba1\u6570: %d\\n", counter);\n    \n    // \u9500\u6bc1\u4e92\u65a5\u9501\n    pthread_mutex_destroy(&mutex);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u6b7b\u9501\u95ee\u9898",children:"\u6b7b\u9501\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:"\u6b7b\u9501\u662f\u6307\u4e24\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u8d44\u6e90\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u65e0\u6cd5\u7ee7\u7eed\u6267\u884c\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <unistd.h>\n\npthread_mutex_t mutex1, mutex2;\n\nvoid* thread1_func(void* arg) {\n    pthread_mutex_lock(&mutex1);\n    printf("\u7ebf\u7a0b1\u83b7\u5f97mutex1\\n");\n    sleep(1);\n    \n    printf("\u7ebf\u7a0b1\u7b49\u5f85mutex2...\\n");\n    pthread_mutex_lock(&mutex2);  // \u53ef\u80fd\u6b7b\u9501\n    \n    printf("\u7ebf\u7a0b1\u83b7\u5f97mutex2\\n");\n    \n    pthread_mutex_unlock(&mutex2);\n    pthread_mutex_unlock(&mutex1);\n    return NULL;\n}\n\nvoid* thread2_func(void* arg) {\n    pthread_mutex_lock(&mutex2);\n    printf("\u7ebf\u7a0b2\u83b7\u5f97mutex2\\n");\n    sleep(1);\n    \n    printf("\u7ebf\u7a0b2\u7b49\u5f85mutex1...\\n");\n    pthread_mutex_lock(&mutex1);  // \u53ef\u80fd\u6b7b\u9501\n    \n    printf("\u7ebf\u7a0b2\u83b7\u5f97mutex1\\n");\n    \n    pthread_mutex_unlock(&mutex1);\n    pthread_mutex_unlock(&mutex2);\n    return NULL;\n}\n\nint main() {\n    pthread_t t1, t2;\n    \n    pthread_mutex_init(&mutex1, NULL);\n    pthread_mutex_init(&mutex2, NULL);\n    \n    pthread_create(&t1, NULL, thread1_func, NULL);\n    pthread_create(&t2, NULL, thread2_func, NULL);\n    \n    pthread_join(t1, NULL);\n    pthread_join(t2, NULL);\n    \n    pthread_mutex_destroy(&mutex1);\n    pthread_mutex_destroy(&mutex2);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u907f\u514d\u6b7b\u9501\u7684\u65b9\u6cd5\uff1a"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6309\u56fa\u5b9a\u987a\u5e8f\u83b7\u53d6\u9501"}),"\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528",(0,i.jsx)(e.code,{children:"pthread_mutex_trylock()"}),"\u5c1d\u8bd5\u52a0\u9501"]}),"\n",(0,i.jsx)(e.li,{children:"\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4"}),"\n",(0,i.jsx)(e.li,{children:"\u907f\u514d\u5d4c\u5957\u9501"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u6761\u4ef6\u53d8\u91cfcondition-variable",children:"\u6761\u4ef6\u53d8\u91cf\uff08Condition Variable\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u6761\u4ef6\u53d8\u91cf\u7528\u4e8e\u7ebf\u7a0b\u95f4\u7684\u540c\u6b65\uff0c\u5141\u8bb8\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u6210\u7acb\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <unistd.h>\n\npthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t cond = PTHREAD_COND_INITIALIZER;\nint ready = 0;\n\nvoid* producer(void* arg) {\n    sleep(2);  // \u6a21\u62df\u51c6\u5907\u6570\u636e\n    \n    pthread_mutex_lock(&mutex);\n    ready = 1;\n    printf("\u751f\u4ea7\u8005\uff1a\u6570\u636e\u5df2\u51c6\u5907\u597d\\n");\n    pthread_cond_signal(&cond);  // \u901a\u77e5\u7b49\u5f85\u7684\u7ebf\u7a0b\n    pthread_mutex_unlock(&mutex);\n    \n    return NULL;\n}\n\nvoid* consumer(void* arg) {\n    pthread_mutex_lock(&mutex);\n    \n    while (!ready) {\n        printf("\u6d88\u8d39\u8005\uff1a\u7b49\u5f85\u6570\u636e...\\n");\n        pthread_cond_wait(&cond, &mutex);  // \u7b49\u5f85\u6761\u4ef6\u53d8\u91cf\n    }\n    \n    printf("\u6d88\u8d39\u8005\uff1a\u6536\u5230\u6570\u636e\uff0c\u5f00\u59cb\u5904\u7406\\n");\n    pthread_mutex_unlock(&mutex);\n    \n    return NULL;\n}\n\nint main() {\n    pthread_t prod, cons;\n    \n    pthread_create(&cons, NULL, consumer, NULL);\n    pthread_create(&prod, NULL, producer, NULL);\n    \n    pthread_join(prod, NULL);\n    pthread_join(cons, NULL);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u8bfb\u5199\u9501read-write-lock",children:"\u8bfb\u5199\u9501\uff08Read-Write Lock\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u8bfb\u5199\u9501\u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u53d6\uff0c\u4f46\u5199\u5165\u65f6\u9700\u8981\u72ec\u5360\u8bbf\u95ee\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <unistd.h>\n\npthread_rwlock_t rwlock;\nint shared_data = 0;\n\nvoid* reader(void* arg) {\n    int id = *(int*)arg;\n    \n    pthread_rwlock_rdlock(&rwlock);  // \u8bfb\u9501\n    printf("\u8bfb\u8005%d: \u8bfb\u53d6\u6570\u636e = %d\\n", id, shared_data);\n    sleep(1);\n    pthread_rwlock_unlock(&rwlock);\n    \n    return NULL;\n}\n\nvoid* writer(void* arg) {\n    int id = *(int*)arg;\n    \n    pthread_rwlock_wrlock(&rwlock);  // \u5199\u9501\n    shared_data++;\n    printf("\u5199\u8005%d: \u5199\u5165\u6570\u636e = %d\\n", id, shared_data);\n    sleep(1);\n    pthread_rwlock_unlock(&rwlock);\n    \n    return NULL;\n}\n\nint main() {\n    pthread_t readers[3], writers[2];\n    int ids[5] = {1, 2, 3, 4, 5};\n    \n    pthread_rwlock_init(&rwlock, NULL);\n    \n    // \u521b\u5efa\u8bfb\u8005\u548c\u5199\u8005\u7ebf\u7a0b\n    for (int i = 0; i < 3; i++) {\n        pthread_create(&readers[i], NULL, reader, &ids[i]);\n    }\n    for (int i = 0; i < 2; i++) {\n        pthread_create(&writers[i], NULL, writer, &ids[i+3]);\n    }\n    \n    // \u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\n    for (int i = 0; i < 3; i++) {\n        pthread_join(readers[i], NULL);\n    }\n    for (int i = 0; i < 2; i++) {\n        pthread_join(writers[i], NULL);\n    }\n    \n    pthread_rwlock_destroy(&rwlock);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u4fe1\u53f7\u91cfsemaphore",children:"\u4fe1\u53f7\u91cf\uff08Semaphore\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u4fe1\u53f7\u91cf\u7528\u4e8e\u63a7\u5236\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\u6570\u91cf\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <semaphore.h>\n#include <unistd.h>\n\nsem_t semaphore;\n\nvoid* worker(void* arg) {\n    int id = *(int*)arg;\n    \n    printf("\u7ebf\u7a0b%d: \u7b49\u5f85\u8d44\u6e90...\\n", id);\n    sem_wait(&semaphore);  // P\u64cd\u4f5c\uff0c\u4fe1\u53f7\u91cf-1\n    \n    printf("\u7ebf\u7a0b%d: \u83b7\u5f97\u8d44\u6e90\uff0c\u5f00\u59cb\u5de5\u4f5c\\n", id);\n    sleep(2);  // \u6a21\u62df\u5de5\u4f5c\n    printf("\u7ebf\u7a0b%d: \u91ca\u653e\u8d44\u6e90\\n", id);\n    \n    sem_post(&semaphore);  // V\u64cd\u4f5c\uff0c\u4fe1\u53f7\u91cf+1\n    \n    return NULL;\n}\n\nint main() {\n    pthread_t threads[5];\n    int ids[5] = {1, 2, 3, 4, 5};\n    \n    // \u521d\u59cb\u5316\u4fe1\u53f7\u91cf\uff0c\u521d\u59cb\u503c\u4e3a2\uff08\u6700\u591a2\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\uff09\n    sem_init(&semaphore, 0, 2);\n    \n    for (int i = 0; i < 5; i++) {\n        pthread_create(&threads[i], NULL, worker, &ids[i]);\n    }\n    \n    for (int i = 0; i < 5; i++) {\n        pthread_join(threads[i], NULL);\n    }\n    \n    sem_destroy(&semaphore);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8thread-local-storage",children:"\u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8\uff08Thread Local Storage\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u7ebf\u7a0b\u5c40\u90e8\u5b58\u50a8\u5141\u8bb8\u6bcf\u4e2a\u7ebf\u7a0b\u62e5\u6709\u81ea\u5df1\u7684\u53d8\u91cf\u526f\u672c\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n\n// \u4f7f\u7528__thread\u5173\u952e\u5b57\u58f0\u660e\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\n__thread int thread_local_var = 0;\n\nvoid* thread_func(void* arg) {\n    int id = *(int*)arg;\n    \n    thread_local_var = id * 100;\n    printf("\u7ebf\u7a0b%d: thread_local_var = %d\\n", id, thread_local_var);\n    \n    return NULL;\n}\n\nint main() {\n    pthread_t threads[3];\n    int ids[3] = {1, 2, 3};\n    \n    for (int i = 0; i < 3; i++) {\n        pthread_create(&threads[i], NULL, thread_func, &ids[i]);\n    }\n    \n    for (int i = 0; i < 3; i++) {\n        pthread_join(threads[i], NULL);\n    }\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u7ebf\u7a0b\u6c60",children:"\u7ebf\u7a0b\u6c60"}),"\n",(0,i.jsx)(e.p,{children:"\u7ebf\u7a0b\u6c60\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u5e76\u53d1\u7f16\u7a0b\u6a21\u5f0f\uff0c\u9884\u5148\u521b\u5efa\u4e00\u5b9a\u6570\u91cf\u7684\u7ebf\u7a0b\uff0c\u91cd\u590d\u4f7f\u7528\u8fd9\u4e9b\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <unistd.h>\n\n#define THREAD_POOL_SIZE 4\n#define TASK_QUEUE_SIZE 100\n\ntypedef struct {\n    void (*function)(void*);\n    void* argument;\n} task_t;\n\ntypedef struct {\n    pthread_t threads[THREAD_POOL_SIZE];\n    task_t task_queue[TASK_QUEUE_SIZE];\n    int queue_front;\n    int queue_rear;\n    int task_count;\n    pthread_mutex_t mutex;\n    pthread_cond_t cond;\n    int shutdown;\n} thread_pool_t;\n\nthread_pool_t pool;\n\nvoid* worker_thread(void* arg) {\n    while (1) {\n        pthread_mutex_lock(&pool.mutex);\n        \n        while (pool.task_count == 0 && !pool.shutdown) {\n            pthread_cond_wait(&pool.cond, &pool.mutex);\n        }\n        \n        if (pool.shutdown) {\n            pthread_mutex_unlock(&pool.mutex);\n            pthread_exit(NULL);\n        }\n        \n        task_t task = pool.task_queue[pool.queue_front];\n        pool.queue_front = (pool.queue_front + 1) % TASK_QUEUE_SIZE;\n        pool.task_count--;\n        \n        pthread_mutex_unlock(&pool.mutex);\n        \n        // \u6267\u884c\u4efb\u52a1\n        task.function(task.argument);\n    }\n    \n    return NULL;\n}\n\nvoid thread_pool_init() {\n    pool.queue_front = 0;\n    pool.queue_rear = 0;\n    pool.task_count = 0;\n    pool.shutdown = 0;\n    \n    pthread_mutex_init(&pool.mutex, NULL);\n    pthread_cond_init(&pool.cond, NULL);\n    \n    for (int i = 0; i < THREAD_POOL_SIZE; i++) {\n        pthread_create(&pool.threads[i], NULL, worker_thread, NULL);\n    }\n}\n\nvoid thread_pool_add_task(void (*function)(void*), void* argument) {\n    pthread_mutex_lock(&pool.mutex);\n    \n    pool.task_queue[pool.queue_rear].function = function;\n    pool.task_queue[pool.queue_rear].argument = argument;\n    pool.queue_rear = (pool.queue_rear + 1) % TASK_QUEUE_SIZE;\n    pool.task_count++;\n    \n    pthread_cond_signal(&pool.cond);\n    pthread_mutex_unlock(&pool.mutex);\n}\n\nvoid thread_pool_destroy() {\n    pthread_mutex_lock(&pool.mutex);\n    pool.shutdown = 1;\n    pthread_cond_broadcast(&pool.cond);\n    pthread_mutex_unlock(&pool.mutex);\n    \n    for (int i = 0; i < THREAD_POOL_SIZE; i++) {\n        pthread_join(pool.threads[i], NULL);\n    }\n    \n    pthread_mutex_destroy(&pool.mutex);\n    pthread_cond_destroy(&pool.cond);\n}\n\n// \u793a\u4f8b\u4efb\u52a1\u51fd\u6570\nvoid example_task(void* arg) {\n    int task_id = *(int*)arg;\n    printf("\u6267\u884c\u4efb\u52a1 %d\\n", task_id);\n    sleep(1);\n    printf("\u4efb\u52a1 %d \u5b8c\u6210\\n", task_id);\n}\n\nint main() {\n    thread_pool_init();\n    \n    int task_ids[10];\n    for (int i = 0; i < 10; i++) {\n        task_ids[i] = i + 1;\n        thread_pool_add_task(example_task, &task_ids[i]);\n    }\n    \n    sleep(5);  // \u7b49\u5f85\u4efb\u52a1\u5b8c\u6210\n    \n    thread_pool_destroy();\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u539f\u5b50\u64cd\u4f5c",children:"\u539f\u5b50\u64cd\u4f5c"}),"\n",(0,i.jsx)(e.p,{children:"\u539f\u5b50\u64cd\u4f5c\u662f\u4e0d\u53ef\u5206\u5272\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u907f\u514d\u4f7f\u7528\u9501\u7684\u5f00\u9500\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n#include <stdatomic.h>\n\natomic_int counter = 0;\n\nvoid* increment(void* arg) {\n    for (int i = 0; i < 100000; i++) {\n        atomic_fetch_add(&counter, 1);  // \u539f\u5b50\u52a0\u6cd5\n    }\n    return NULL;\n}\n\nint main() {\n    pthread_t threads[5];\n    \n    for (int i = 0; i < 5; i++) {\n        pthread_create(&threads[i], NULL, increment, NULL);\n    }\n    \n    for (int i = 0; i < 5; i++) {\n        pthread_join(threads[i], NULL);\n    }\n    \n    printf("\u6700\u7ec8\u8ba1\u6570: %d\\n", counter);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsx)(e.h3,{id:"\u7ebf\u7a0b\u5b89\u5168",children:"\u7ebf\u7a0b\u5b89\u5168"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6570\u636e\u7ade\u4e89"}),"\uff1a\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff0c\u81f3\u5c11\u6709\u4e00\u4e2a\u662f\u5199\u64cd\u4f5c"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4e34\u754c\u533a"}),"\uff1a\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4ee3\u7801\u6bb5\uff0c\u9700\u8981\u4f7f\u7528\u540c\u6b65\u673a\u5236\u4fdd\u62a4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7ebf\u7a0b\u5b89\u5168\u51fd\u6570"}),"\uff1a\u53ef\u4ee5\u88ab\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8c03\u7528\u800c\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u7684\u51fd\u6570"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u6027\u80fd\u8003\u8651",children:"\u6027\u80fd\u8003\u8651"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907f\u514d\u8fc7\u5ea6\u540c\u6b65"}),"\uff1a\u9501\u7684\u7c92\u5ea6\u8981\u9002\u4e2d\uff0c\u8fc7\u7ec6\u4f1a\u589e\u52a0\u5f00\u9500"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u51cf\u5c11\u9501\u7ade\u4e89"}),"\uff1a\u5c3d\u91cf\u7f29\u77ed\u6301\u6709\u9501\u7684\u65f6\u95f4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4f7f\u7528\u65e0\u9501\u6570\u636e\u7ed3\u6784"}),"\uff1a\u5728\u5408\u9002\u7684\u573a\u666f\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7ebf\u7a0b\u6570\u91cf"}),"\uff1a\u901a\u5e38\u8bbe\u7f6e\u4e3aCPU\u6838\u5fc3\u6570\u6216\u7a0d\u591a\u4e00\u4e9b"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u5e38\u89c1\u9519\u8bef",children:"\u5e38\u89c1\u9519\u8bef"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u5fd8\u8bb0\u521d\u59cb\u5316/\u9500\u6bc1\u540c\u6b65\u5bf9\u8c61"})}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6b7b\u9501"}),"\uff1a\u5faa\u73af\u7b49\u5f85\u8d44\u6e90"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6570\u636e\u7ade\u4e89"}),"\uff1a\u672a\u6b63\u786e\u4fdd\u62a4\u5171\u4eab\u6570\u636e"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5185\u5b58\u6cc4\u6f0f"}),"\uff1a\u7ebf\u7a0b\u521b\u5efa\u540e\u672ajoin\u6216detach"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u5b9e\u9645\u5e94\u7528\u573a\u666f",children:"\u5b9e\u9645\u5e94\u7528\u573a\u666f"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u5e76\u884c\u8ba1\u7b97",children:"1. \u5e76\u884c\u8ba1\u7b97"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <pthread.h>\n\n#define ARRAY_SIZE 1000000\n#define NUM_THREADS 4\n\nint array[ARRAY_SIZE];\nlong partial_sums[NUM_THREADS];\n\ntypedef struct {\n    int thread_id;\n    int start;\n    int end;\n} thread_data_t;\n\nvoid* calculate_partial_sum(void* arg) {\n    thread_data_t* data = (thread_data_t*)arg;\n    long sum = 0;\n    \n    for (int i = data->start; i < data->end; i++) {\n        sum += array[i];\n    }\n    \n    partial_sums[data->thread_id] = sum;\n    return NULL;\n}\n\nint main() {\n    pthread_t threads[NUM_THREADS];\n    thread_data_t thread_data[NUM_THREADS];\n    \n    // \u521d\u59cb\u5316\u6570\u7ec4\n    for (int i = 0; i < ARRAY_SIZE; i++) {\n        array[i] = i + 1;\n    }\n    \n    // \u521b\u5efa\u7ebf\u7a0b\u8ba1\u7b97\u90e8\u5206\u548c\n    int chunk_size = ARRAY_SIZE / NUM_THREADS;\n    for (int i = 0; i < NUM_THREADS; i++) {\n        thread_data[i].thread_id = i;\n        thread_data[i].start = i * chunk_size;\n        thread_data[i].end = (i == NUM_THREADS - 1) ? ARRAY_SIZE : (i + 1) * chunk_size;\n        pthread_create(&threads[i], NULL, calculate_partial_sum, &thread_data[i]);\n    }\n    \n    // \u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5b8c\u6210\n    for (int i = 0; i < NUM_THREADS; i++) {\n        pthread_join(threads[i], NULL);\n    }\n    \n    // \u8ba1\u7b97\u603b\u548c\n    long total_sum = 0;\n    for (int i = 0; i < NUM_THREADS; i++) {\n        total_sum += partial_sums[i];\n    }\n    \n    printf("\u6570\u7ec4\u603b\u548c: %ld\\n", total_sum);\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b",children:"2. \u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",metastring:"showLineNumbers",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <unistd.h>\n\n#define BUFFER_SIZE 10\n\nint buffer[BUFFER_SIZE];\nint count = 0;\nint in = 0;\nint out = 0;\n\npthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t not_full = PTHREAD_COND_INITIALIZER;\npthread_cond_t not_empty = PTHREAD_COND_INITIALIZER;\n\nvoid* producer(void* arg) {\n    int id = *(int*)arg;\n    \n    for (int i = 0; i < 20; i++) {\n        int item = rand() % 100;\n        \n        pthread_mutex_lock(&mutex);\n        \n        while (count == BUFFER_SIZE) {\n            pthread_cond_wait(&not_full, &mutex);\n        }\n        \n        buffer[in] = item;\n        in = (in + 1) % BUFFER_SIZE;\n        count++;\n        \n        printf("\u751f\u4ea7\u8005%d: \u751f\u4ea7 %d (\u7f13\u51b2\u533a: %d)\\n", id, item, count);\n        \n        pthread_cond_signal(&not_empty);\n        pthread_mutex_unlock(&mutex);\n        \n        usleep(100000);  // 0.1\u79d2\n    }\n    \n    return NULL;\n}\n\nvoid* consumer(void* arg) {\n    int id = *(int*)arg;\n    \n    for (int i = 0; i < 20; i++) {\n        pthread_mutex_lock(&mutex);\n        \n        while (count == 0) {\n            pthread_cond_wait(&not_empty, &mutex);\n        }\n        \n        int item = buffer[out];\n        out = (out + 1) % BUFFER_SIZE;\n        count--;\n        \n        printf("\u6d88\u8d39\u8005%d: \u6d88\u8d39 %d (\u7f13\u51b2\u533a: %d)\\n", id, item, count);\n        \n        pthread_cond_signal(&not_full);\n        pthread_mutex_unlock(&mutex);\n        \n        usleep(150000);  // 0.15\u79d2\n    }\n    \n    return NULL;\n}\n\nint main() {\n    pthread_t prod_threads[2], cons_threads[2];\n    int prod_ids[2] = {1, 2};\n    int cons_ids[2] = {1, 2};\n    \n    for (int i = 0; i < 2; i++) {\n        pthread_create(&prod_threads[i], NULL, producer, &prod_ids[i]);\n        pthread_create(&cons_threads[i], NULL, consumer, &cons_ids[i]);\n    }\n    \n    for (int i = 0; i < 2; i++) {\n        pthread_join(prod_threads[i], NULL);\n        pthread_join(cons_threads[i], NULL);\n    }\n    \n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u76f8\u5173\u8d44\u6e90",children:"\u76f8\u5173\u8d44\u6e90"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://computing.llnl.gov/tutorials/pthreads/",children:"POSIX Threads Programming"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://man7.org/linux/man-pages/man7/pthreads.7.html",children:"Linux man pages - pthread"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://en.cppreference.com/w/c/thread",children:"C11 Threads"})}),"\n"]})]})}function c(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},28453(n,e,t){t.d(e,{R:()=>a,x:()=>o});var r=t(96540);const i={},d=r.createContext(i);function a(n){const e=r.useContext(d);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),r.createElement(d.Provider,{value:e},n.children)}}}]);