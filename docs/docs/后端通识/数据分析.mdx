---
sidebar_position: 7
title: 
---

:::info
Python 

- **NumPy**
- **Pandas**DataFrame/Series  
- **Matplotlib/Pyecharts**

 Python  →  → 

```python
import numpy as np      # 
import pandas as pd     # 
import matplotlib.pyplot as plt  # 
```
:::

## NumPy

NumPyNumerical Python Python ndarray

**NumPy **
- **** C  Python  10-100 
- ****
- ****
- ****PandasSciPyScikit-learn  NumPy

### 

#### 

```python showLineNumbers
# 
import numpy as np

# 
import numpy                    #  numpy.array
from numpy import *             # 
from numpy import array, sin    # 
```

:::tip
** `import numpy as np`** NumPy 
:::

** NumPy  Python **

```python showLineNumbers
# Python 
a = [1, 2, 3]
# a + 1  # TypeError: 

# 
b = [x + 1 for x in a]
print(b)  # [2, 3, 4]

# NumPy 
import numpy as np
a = np.array([1, 2, 3])
b = a + 1
print(b)  # [2 3 4]

# 
c = a + b
print(c)  # [3 5 7]

# 
print(a * b)  # [2 6 12]

# 
print(a ** b)  # [1 8 81]
```

:::tip
**NumPy **
```python
# Python 
result = []
for i in range(1000000):
    result.append(i * 2)

# NumPy 10-100 
arr = np.arange(1000000)
result = arr * 2
```
:::

#### 

```python showLineNumbers
import numpy as np

a = np.array([[1, 2, 3], [4, 5, 6]])
print(a)
# [[1 2 3]
#  [4 5 6]]

# 
print(a.shape)   # (2, 3) - 23

# 
print(a.size)    # 6

# 
print(a.ndim)    # 2

# 
print(a.dtype)   # int64  int32

# 
print(a.itemsize)  # 8 (64)
```

:::tip
****
- `shape` (3, 4) 34
- `size`
- `ndim`123...
- `dtype`int64, float64
- `itemsize`
:::

#### 

```python showLineNumbers
import numpy as np

# 
a = np.array([1, 2, 3, 4])
print(a)  # [1 2 3 4]

# 
b = np.array((1, 2, 3, 4))
print(b)  # [1 2 3 4]

# 
c = np.array([[1, 2], [3, 4]])
print(c)
# [[1 2]
#  [3 4]]

# 
d = np.array([1, 2, 3], dtype=float)
print(d)  # [1. 2. 3.]

# 
zeros = np.zeros((2, 3))
print(zeros)
# [[0. 0. 0.]
#  [0. 0. 0.]]

# 
ones = np.ones((2, 3))
print(ones)
# [[1. 1. 1.]
#  [1. 1. 1.]]

# 
eye = np.eye(3)
print(eye)
# [[1. 0. 0.]
#  [0. 1. 0.]
#  [0. 0. 1.]]

# 
full = np.full((2, 3), 7)
print(full)
# [[7 7 7]
#  [7 7 7]]
```

### 

#### 

```python showLineNumbers
import numpy as np

a = np.array([1, 2, 3, 4, 5])

# 
print(a[0])    # 1 - 
print(a[-1])   # 5 - 

# 
print(a[:2])   # [1 2] - 
print(a[2:])   # [3 4 5] - 3
print(a[1:4])  # [2 3 4] - 24
print(a[::2])  # [1 3 5] - 2
print(a[::-1]) # [5 4 3 2 1] - 

# 
a[0] = 100
print(a)  # [100 2 3 4 5]
```

#### 

```python showLineNumbers
import numpy as np

a = np.array([[0, 1, 2, 3, 4, 5],
              [10, 11, 12, 13, 14, 15],
              [20, 21, 22, 23, 24, 25],
              [30, 31, 32, 33, 34, 35],
              [40, 41, 42, 43, 44, 45],
              [50, 51, 52, 53, 54, 55]])

# 
print(a[0, 3])   # 3 - 03

# 
print(a[0])      # [ 0  1  2  3  4  5]

# 
print(a[:, 2])   # [ 2 12 22 32 42 52]

# 
print(a[0:2])    # 
# [[ 0  1  2  3  4  5]
#  [10 11 12 13 14 15]]

# 
print(a[:, 3:5]) # 3-4
# [[ 3  4]
#  [13 14]
#  [23 24]
#  [33 34]
#  [43 44]
#  [53 54]]

# 
print(a[0, 3:5])    # 03-4  [3 4]
print(a[4:, 4:])    # 
# [[44 45]
#  [54 55]]

# 
print(a[2::2, ::2]) # 2
# [[20 22 24]
#  [40 42 44]]
```

:::warning
****
NumPy 

```python
a = np.array([1, 2, 3, 4, 5])
b = a[2:4]      # b  a 
b[0] = 100      #  b
print(a)        # [  1   2 100   4   5] - a 

#  copy() 
c = a[2:4].copy()
c[0] = 200
print(a)        # [  1   2 100   4   5] - a 
```
:::

#### 



```python showLineNumbers
import numpy as np

a = np.arange(0, 80, 10)  # [ 0 10 20 30 40 50 60 70]

# 
indices = [1, 2, -3]
print(a[indices])  # [10 20 50]

# 
print(a[[0, 2, 4]])  # [ 0 20 40]

# 
a = np.arange(12).reshape(3, 4)
print(a)
# [[ 0  1  2  3]
#  [ 4  5  6  7]
#  [ 8  9 10 11]]

# 02
print(a[[0, 2]])
# [[ 0  1  2  3]
#  [ 8  9 10 11]]

# 
rows = [0, 1, 2]
cols = [1, 2, 3]
print(a[rows, cols])  # [ 1  6 11]
```

#### 



```python showLineNumbers
import numpy as np

a = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])

# mask
mask = a > 5
print(mask)
# [False False False False False  True  True  True  True  True]

# 
print(a[mask])  # [ 6  7  8  9 10]

# 
print(a[a > 5])      # [ 6  7  8  9 10]
print(a[a % 2 == 0]) # [ 2  4  6  8 10] - 

# 
print(a[(a > 3) & (a < 8)])  # [4 5 6 7]
print(a[(a < 3) | (a > 8)])  # [ 1  2  9 10]

# 
a[a > 5] = 0
print(a)  # [1 2 3 4 5 0 0 0 0 0]
```

:::tip
****
- `&`and
- `|`or
- `~`not

 `&`  `|` `and`  `or`
:::

#### where 

`where` 

```python showLineNumbers
import numpy as np

a = np.array([1, 2, 4, 6, 8])

# 
indices = np.where(a > 2)
print(indices)  # (array([2, 3, 4]),)
print(indices[0])  # [2 3 4]

# 
print(a[indices])  # [4 6 8]

#  where
a = np.array([[0, 12, 5, 20],
              [1, 2, 11, 15]])
rows, cols = np.where(a > 10)
print(rows)  # [0 0 1 1]
print(cols)  # [1 3 2 3]
print(a[rows, cols])  # [12 20 11 15]

# where 
a = np.array([1, 2, 3, 4, 5])
result = np.where(a > 3, '', '')
print(result)  # ['' '' '' '' '']
```

### 

#### 

```python showLineNumbers
import numpy as np

a = np.array([1, 2, 3, 4])
b = np.array([10, 20, 30, 40])

# 
print(a + b)     # [11 22 33 44]
print(a + 10)    # [11 12 13 14] - 

# 
print(b - a)     # [ 9 18 27 36]
print(a - 1)     # [0 1 2 3]

# 
print(a * b)     # [ 10  40  90 160]
print(a * 2)     # [2 4 6 8]

# 
print(b / a)     # [10. 10. 10. 10.]
print(a / 2)     # [0.5 1.  1.5 2. ]

# 
print(b // a)    # [10 10 10 10]

# 
print(b % a)     # [0 0 0 0]

# 
print(a ** 2)    # [ 1  4  9 16]
print(2 ** a)    # [ 2  4  8 16]
```

#### 

Broadcasting

```python showLineNumbers
import numpy as np

# 
a = np.array([1, 2, 3])
print(a + 10)  # [11 12 13]

# 
a = np.array([[1, 2, 3],
              [4, 5, 6]])
b = np.array([10, 20, 30])
print(a + b)
# [[11 22 33]
#  [14 25 36]]

# 
a = np.array([[1, 2, 3],
              [4, 5, 6]])
b = np.array([[10],
              [20]])
print(a + b)
# [[11 12 13]
#  [24 25 26]]

# 
# 11
# 21""
```

:::tip
****
1. 1
2. 1
3. 

```python
a: (3, 4)      b: (4,)     -> (3, 4)
a: (3, 1)      b: (3, 4)   -> (3, 4)
a: (2, 3, 4)   b: (3, 1)   -> (2, 3, 4)
```
:::

#### ufunc

```python showLineNumbers
import numpy as np

a = np.array([1, 4, 9, 16])

# 
print(np.sqrt(a))      # [1. 2. 3. 4.] - 
print(np.square(a))    # [  1  16  81 256] - 
print(np.exp(a))       # [2.71828183e+00 5.45981500e+01 ...]
print(np.log(a))       # [0.         1.38629436 2.19722458 2.77258872]
print(np.log10(a))     # [0.         0.60205999 0.95424251 1.20411998]

# 
angles = np.array([0, np.pi/2, np.pi])
print(np.sin(angles))  # [ 0.0000000e+00  1.0000000e+00  1.2246468e-16]
print(np.cos(angles))  # [ 1.000000e+00  6.123234e-17 -1.000000e+00]
print(np.tan(angles))  # [ 0.00000000e+00  1.63312394e+16 -1.22464680e-16]

# 
a = np.array([1.2, 2.5, 3.7, 4.9])
print(np.floor(a))     # [1. 2. 3. 4.] - 
print(np.ceil(a))      # [2. 3. 4. 5.] - 
print(np.round(a))     # [1. 2. 4. 5.] - 

# 
a = np.array([-1, -2, 3, -4])
print(np.abs(a))       # [1 2 3 4]
print(np.absolute(a))  # [1 2 3 4] - 

# 
print(np.sign(a))      # [-1 -1  1 -1]
```

#### 

```python showLineNumbers
import numpy as np

a = np.array([[1, 2, 3],
              [4, 5, 6]])

# 
print(np.sum(a))        # 21 - 
print(a.sum())          # 21 - 
print(a.sum(axis=0))    # [5 7 9] - 
print(a.sum(axis=1))    # [ 6 15] - 

# 
print(np.mean(a))       # 3.5
print(a.mean(axis=0))   # [2.5 3.5 4.5]
print(a.mean(axis=1))   # [2. 5.]

# 
print(a.max())          # 6
print(a.min())          # 1
print(a.max(axis=0))    # [4 5 6]
print(a.min(axis=1))    # [1 4]

# 
print(a.argmax())       # 5 - 
print(a.argmin())       # 0
print(a.argmax(axis=0)) # [1 1 1]
print(a.argmax(axis=1)) # [2 2]

# 
print(a.std())          # 1.707825127659933
print(a.var())          # 2.9166666666666665

# 
print(np.cumsum(a))     # [ 1  3  6 10 15 21]
print(np.cumprod(a))    # [  1   2   6  24 120 720]
```

:::tip
**axis **
- `axis=None`
- `axis=0`0
- `axis=1`1

axis=0 ""
:::

#### 

```python showLineNumbers
import numpy as np

a = np.array([1, 2, 3, 4, 5, 6])

# clip
print(np.clip(a, 2, 5))  # [2 2 3 4 5 5]

# 
print(np.all(a > 0))     # True - 
print(np.any(a > 5))     # True - 

# 
a = np.array([1, 5, 3])
b = np.array([2, 4, 6])
print(np.maximum(a, b))  # [2 5 6] - 
print(np.minimum(a, b))  # [1 4 3] - 
```

### 

#### 

```python showLineNumbers
import numpy as np

a = np.arange(12)
print(a)        # [ 0  1  2  3  4  5  6  7  8  9 10 11]
print(a.shape)  # (12,)

# reshape
b = a.reshape(3, 4)
print(b)
# [[ 0  1  2  3]
#  [ 4  5  6  7]
#  [ 8  9 10 11]]
print(a.shape)  # (12,) - 

# resize
a.resize(3, 4)
print(a.shape)  # (3, 4) - 

# reshape  -1 
a = np.arange(12)
print(a.reshape(3, -1))  # (3, 4) - 4
print(a.reshape(-1, 4))  # (3, 4) - 3
print(a.reshape(2, 2, -1))  # (2, 2, 3)

# flatten
a = np.array([[1, 2], [3, 4]])
b = a.flatten()
b[0] = 100
print(a[0, 0])  # 1 - 

# ravel
b = a.ravel()
b[0] = 100
print(a[0, 0])  # 100 - 

# 
a = np.array([[1, 2, 3],
              [4, 5, 6]])
print(a.T)
# [[1 4]
#  [2 5]
#  [3 6]]

# squeeze1
a = np.arange(10).reshape(1, 10)
print(a.shape)           # (1, 10)
b = np.squeeze(a)
print(b.shape)           # (10,)

# expand_dims
a = np.array([1, 2, 3])
b = np.expand_dims(a, axis=0)
print(b.shape)           # (1, 3)
c = np.expand_dims(a, axis=1)
print(c.shape)           # (3, 1)
```

:::warning
**reshape vs resize vs ravel vs flatten**
- `reshape`
- `resize`
- `ravel`
- `flatten`

```python
a = np.array([[1, 2], [3, 4]])
b = a.reshape(4)   # 
c = a.ravel()      # 
d = a.flatten()    # 

c[0] = 100
print(a[0, 0])     # 100 - ravel 

d[0] = 200
print(a[0, 0])     # 100 - flatten 
```
:::

#### 

```python showLineNumbers
import numpy as np

a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])

# concatenate
print(np.concatenate([a, b], axis=0))  # 
# [[1 2]
#  [3 4]
#  [5 6]
#  [7 8]]

print(np.concatenate([a, b], axis=1))  # 
# [[1 2 5 6]
#  [3 4 7 8]]

# vstack axis=0
print(np.vstack([a, b]))
# [[1 2]
#  [3 4]
#  [5 6]
#  [7 8]]

# hstack axis=1
print(np.hstack([a, b]))
# [[1 2 5 6]
#  [3 4 7 8]]

# stack
a = np.array([1, 2, 3])
b = np.array([4, 5, 6])
print(np.stack([a, b]))        # axis=0
# [[1 2 3]
#  [4 5 6]]

print(np.stack([a, b], axis=1))  # axis=1
# [[1 4]
#  [2 5]
#  [3 6]]

# append
a = np.array([1, 2, 3])
b = np.append(a, [4, 5, 6])
print(b)  # [1 2 3 4 5 6]

#  append
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6]])
print(np.append(a, b, axis=0))
# [[1 2]
#  [3 4]
#  [5 6]]
```

:::tip
****
- `vstack`  `concatenate(axis=0)`
- `hstack`  `concatenate(axis=1)`
- `stack`
- `append`
:::

#### 

```python showLineNumbers
import numpy as np

a = np.arange(12).reshape(3, 4)
print(a)
# [[ 0  1  2  3]
#  [ 4  5  6  7]
#  [ 8  9 10 11]]

# split
parts = np.split(a, 3, axis=0)  # 3
for i, part in enumerate(parts):
    print(f"Part {i}:\n{part}")

# vsplit
parts = np.vsplit(a, 3)  # 3

# hsplit
parts = np.hsplit(a, [1, 3])  # 13
# [:, :1], [:, 1:3], [:, 3:]

# array_split
a = np.arange(10)
parts = np.array_split(a, 3)  # 3
print(parts[0])  # [0 1 2 3]
print(parts[1])  # [4 5 6]
print(parts[2])  # [7 8 9]
```

#### 

```python showLineNumbers
import numpy as np

a = np.array([1, 2, 3, 4])

# 
b = a
b[0] = 100
print(a[0])  # 100 - a 

# view
a = np.array([1, 2, 3, 4])
b = a.view()
b[0] = 100
print(a[0])  # 100 - a 
b.shape = (2, 2)
print(a.shape)  # (4,) - 

# copy
a = np.array([1, 2, 3, 4])
b = a.copy()
b[0] = 100
print(a[0])  # 1 - a 
```

:::warning
****

|  |  |  |  |
|------|------|----------|----------|
| `b = a` |  |  |  |
| `b = a.view()` |  |  |  |
| `b = a.copy()` |  |  |  |


- 
-  view
-  copy
:::

### 

NumPy 

#### 

```python showLineNumbers
import numpy as np

# arange range
print(np.arange(5))          # [0 1 2 3 4]
print(np.arange(2, 10))      # [2 3 4 5 6 7 8 9]
print(np.arange(0, 10, 2))   # [0 2 4 6 8]
print(np.arange(0, 1, 0.1))  # [0.  0.1 0.2 ... 0.9]

# linspace
print(np.linspace(0, 1, 5))      # [0.   0.25 0.5  0.75 1.  ]
print(np.linspace(0, 10, 11))    # [ 0.  1.  2. ... 10.]
print(np.linspace(0, 2*np.pi, 5))  # [0. 1.57 3.14 4.71 6.28]

# logspace
print(np.logspace(0, 2, 5))  # [ 1.  3.16 10. 31.62 100. ]
#  [10^0, 10^0.5, 10^1, 10^1.5, 10^2]
```

:::tip
**arange vs linspace**
- `arange(start, stop, step)`
- `linspace(start, stop, num)`

```python
# 010
arange(0, 10, 1)      # [0 1 2 3 4 5 6 7 8 9] - 10
linspace(0, 10, 11)   # [0 1 2 3 4 5 6 7 8 9 10] - 11
```
:::

#### 

```python showLineNumbers
import numpy as np

# 
print(np.zeros(5))          # [0. 0. 0. 0. 0.]
print(np.zeros((2, 3)))     # 2x3 

# 
print(np.ones(5))           # [1. 1. 1. 1. 1.]
print(np.ones((2, 3)))      # 2x3 

# 
print(np.full(5, 7))        # [7 7 7 7 7]
print(np.full((2, 3), 3.14))  # 2x3 3.14

# 
print(np.eye(3))
# [[1. 0. 0.]
#  [0. 1. 0.]
#  [0. 0. 1.]]

# 
print(np.diag([1, 2, 3]))
# [[1 0 0]
#  [0 2 0]
#  [0 0 3]]

# 
print(np.empty((2, 3)))  # 

# 
a = np.array([[1, 2], [3, 4]])
print(np.zeros_like(a))   # 
print(np.ones_like(a))    # 
print(np.full_like(a, 7)) # 7
```

#### 

```python showLineNumbers
import numpy as np

# 
np.random.seed(42)

#  [0, 1)
print(np.random.rand(5))      # 
print(np.random.rand(2, 3))   # 

# 01
print(np.random.randn(5))     # 
print(np.random.randn(2, 3))  # 

# 
print(np.random.randint(0, 10, 5))      # [0, 10) 5
print(np.random.randint(1, 100, (2, 3)))  # 2x3 

# 
print(np.random.uniform(0, 10, 5))  # [0, 10) 

# 
print(np.random.normal(5, 2, 10))  # 5210

# 
a = np.array([1, 2, 3, 4, 5])
print(np.random.choice(a, 3))          # 3
print(np.random.choice(a, 3, replace=False))  # 

# 
np.random.shuffle(a)  # 
print(a)

# 
print(np.random.permutation(10))  # [0, 10) 
```

:::tip
****

NumPy 1.17+  `np.random.Generator`

```python
rng = np.random.default_rng(42)  # 

rng.random(5)           #  rand
rng.standard_normal(5)  #  randn
rng.integers(0, 10, 5)  #  randint
rng.choice(a, 3)        #  choice
```
:::

#### 

```python showLineNumbers
import numpy as np

# meshgrid
x = np.linspace(-1, 1, 3)  # [-1.  0.  1.]
y = np.linspace(-1, 1, 3)  # [-1.  0.  1.]

X, Y = np.meshgrid(x, y)
print(X)
# [[-1.  0.  1.]
#  [-1.  0.  1.]
#  [-1.  0.  1.]]

print(Y)
# [[-1. -1. -1.]
#  [ 0.  0.  0.]
#  [ 1.  1.  1.]]

# 3D
Z = np.sqrt(X**2 + Y**2)  # 
print(Z)
# [[1.41421356 1.         1.41421356]
#  [1.         0.         1.        ]
#  [1.41421356 1.         1.41421356]]
```

### IO

NumPy 

#### 

```python showLineNumbers
import numpy as np

# 
data = np.array([[1, 2, 3],
                 [4, 5, 6],
                 [7, 8, 9]])

# 
np.savetxt('data.txt', data)
# 1.000000e+00 2.000000e+00 ...

# 
np.savetxt('data.txt', data, fmt='%d')  # 
np.savetxt('data.txt', data, fmt='%.2f')  # 2

# 
np.savetxt('data.csv', data, delimiter=',', fmt='%d')

# 
loaded = np.loadtxt('data.txt')
print(loaded)

# CSV
loaded = np.loadtxt('data.csv', delimiter=',')
print(loaded)

# genfromtxt
data_with_header = """
Name,Age,Score
Alice,25,85.5
Bob,30,92.0
Charlie,28,78.5
"""

# 
with open('students.csv', 'w') as f:
    f.write(data_with_header)

# 
data = np.genfromtxt('students.csv', 
                     delimiter=',',
                     skip_header=1,
                     usecols=(1, 2),  # 
                     dtype=float)
print(data)
# [[25.  85.5]
#  [30.  92. ]
#  [28.  78.5]]
```

:::tip
**loadtxt vs genfromtxt**
- `loadtxt`
- `genfromtxt`


- `delimiter`
- `skip_header`
- `usecols`
- `dtype`
:::

#### 

```python showLineNumbers
import numpy as np

a = np.array([[1, 2, 3], [4, 5, 6]])

# .npy 
np.save('array.npy', a)

# 
loaded = np.load('array.npy')
print(loaded)

# .npz 
b = np.array([7, 8, 9])
np.savez('arrays.npz', array1=a, array2=b)

# 
data = np.load('arrays.npz')
print(data['array1'])  # [[1 2 3] [4 5 6]]
print(data['array2'])  # [7 8 9]
print(data.files)      # ['array1', 'array2']

# 
np.savez_compressed('arrays_compressed.npz', array1=a, array2=b)

# 
import os
print(f": {os.path.getsize('arrays.npz')} bytes")
print(f": {os.path.getsize('arrays_compressed.npz')} bytes")
```

:::tip
****
- **** (.txt, .csv)
  - 
  - 
  - 

- **** (.npy, .npz)
  - 
  - NumPy
  - Python

```python
# 
import numpy as np
a = np.arange(10000.)

np.savetxt('a.txt', a)
np.save('a.npy', a)

import os
print(f": {os.path.getsize('a.txt')} bytes")     # ~150KB
print(f": {os.path.getsize('a.npy')} bytes")    # ~80KB
```
:::

---

## Pandas

Pandas  NumPy 

**Pandas **
- **Series** Excel 
- **DataFrame** Excel  SQL 

**Pandas **
- ****
- ****
- ****
- ****
- **IO** CSVExcelSQLJSON 

:::tip
****
- Series =  + 
- DataFrame =  Series  +  + 
- DataFrame  Series 

```python
# Series
s = pd.Series([1, 2, 3], index=['a', 'b', 'c'])

# DataFrame
df = pd.DataFrame({
    'col1': [1, 2, 3],
    'col2': [4, 5, 6]
}, index=['a', 'b', 'c'])
```
:::

[Pandas ](https://pandas.pydata.org/docs/reference/index.html)

### 

#### Series

Series 

```python showLineNumbers
import pandas as pd
import numpy as np

# 
s = pd.Series([1, 2, 3, 4])
print(s)
# 0    1
# 1    2
# 2    3
# 3    4
# dtype: int64

# 
s = pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])
print(s)
# a    1
# b    2
# c    3
# d    4
# dtype: int64

# 
data = {'Japan': 'Tokyo', 'Korea': 'Seoul', 'China': 'Beijing'}
s = pd.Series(data)
print(s)
# Japan     Tokyo
# Korea     Seoul
# China   Beijing
# dtype: object

# 
s = pd.Series(5, index=['a', 'b', 'c'])
print(s)
# a    5
# b    5
# c    5
# dtype: int64
```

**Series **

```python showLineNumbers
import pandas as pd

s = pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])

# 
print(s.values)  # [1 2 3 4]

# 
print(s.index)   # Index(['a', 'b', 'c', 'd'], dtype='object')

# 
print(s.shape)   # (4,)

# 
print(s.size)    # 4

# 
print(s.dtype)   # int64

# 
s.name = "Numbers"
s.index.name = "Letters"
print(s)
# Letters
# a    1
# b    2
# c    3
# d    4
# Name: Numbers, dtype: int64
```

**Series **

```python showLineNumbers
import pandas as pd

s = pd.Series([10, 20, 30, 40], index=['a', 'b', 'c', 'd'])

# 
print(s['a'])      # 10
print(s[['a', 'c']])  # 

# 
print(s[0])        # 10
print(s[[0, 2]])   # 

# 
print(s['a':'c'])  # 
print(s[0:2])      # 

# 
print(s[s > 20])
# c    30
# d    40

# 
print(s[(s > 15) & (s < 35)])
# b    20
# c    30
```

:::warning
** vs **
```python
s = pd.Series([10, 20, 30], index=['a', 'b', 'c'])

s['a':'c']  #  'c'a=10, b=20, c=30
s[0:2]      # 2a=10, b=20
```
:::

**Series **

```python showLineNumbers
import pandas as pd

s = pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])

# 
print(s + 10)       # 10
print(s * 2)        # 2
print(s ** 2)       # 

# Series 
s1 = pd.Series([1, 2, 3], index=['a', 'b', 'c'])
s2 = pd.Series([4, 5, 6], index=['b', 'c', 'd'])
print(s1 + s2)
# a    NaN  #  s1 
# b    6.0  # 2 + 4
# c    8.0  # 3 + 5
# d    NaN  #  s2 

# 
print(np.sqrt(s))   # 
print(np.exp(s))    # 

# 
print(s.sum())      # 10
print(s.mean())     # 2.5
print(s.max())      # 4
print(s.min())      # 1
print(s.std())      # 
print(s.describe()) # 
```

#### DataFrame

DataFrame 

```python showLineNumbers
import pandas as pd

# 
data = {
    'name': ['Alice', 'Bob', 'Charlie'],
    'age': [25, 30, 35],
    'city': ['Beijing', 'Shanghai', 'Guangzhou']
}
df = pd.DataFrame(data)
print(df)
#       name  age       city
# 0    Alice   25    Beijing
# 1      Bob   30   Shanghai
# 2  Charlie   35  Guangzhou

# 
df = pd.DataFrame(data, index=['row1', 'row2', 'row3'])
print(df)

# 
df = pd.DataFrame(data, columns=['city', 'name', 'age'])
print(df)

# 
data = [
    ['Alice', 25, 'Beijing'],
    ['Bob', 30, 'Shanghai'],
    ['Charlie', 35, 'Guangzhou']
]
df = pd.DataFrame(data, columns=['name', 'age', 'city'])
print(df)

#  NumPy 
data = np.array([['Japan', 'Tokyo', 4000],
                 ['Korea', 'Seoul', 1300],
                 ['China', 'Beijing', 9100]])
df = pd.DataFrame(data, columns=['nation', 'capital', 'GDP'])
print(df)

#  Series 
s1 = pd.Series([1, 2, 3])
s2 = pd.Series([4, 5, 6])
df = pd.DataFrame({'col1': s1, 'col2': s2})
print(df)
```

**DataFrame **

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'A': [1, 2, 3],
    'B': [4, 5, 6],
    'C': [7, 8, 9]
})

# 
print(df.shape)      # (3, 3) - 33

# 
print(df.size)       # 9 - 

# 
print(df.ndim)       # 2

# 
print(df.columns)    # Index(['A', 'B', 'C'], dtype='object')

# 
print(df.index)      # RangeIndex(start=0, stop=3, step=1)

# 
print(df.dtypes)
# A    int64
# B    int64
# C    int64

# NumPy 
print(df.values)
# [[1 4 7]
#  [2 5 8]
#  [3 6 9]]

# 
print(df.info())
# <class 'pandas.core.frame.DataFrame'>
# RangeIndex: 3 entries, 0 to 2
# Data columns (total 3 columns):
#  #   Column  Non-Null Count  Dtype
# ---  ------  --------------  -----
#  0   A       3 non-null      int64
#  1   B       3 non-null      int64
#  2   C       3 non-null      int64

# 
print(df.describe())
#               A         B         C
# count  3.000000  3.000000  3.000000
# mean   2.000000  5.000000  8.000000
# std    1.000000  1.000000  1.000000
# min    1.000000  4.000000  7.000000
# 25%    1.500000  4.500000  7.500000
# 50%    2.000000  5.000000  8.000000
# 75%    2.500000  5.500000  8.500000
# max    3.000000  6.000000  9.000000
```

****

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'A': range(10),
    'B': range(10, 20),
    'C': range(20, 30)
})

# 
print(df.head())     # 5
print(df.head(3))    # 3

# 
print(df.tail())     # 5
print(df.tail(3))    # 3

# 
print(df.sample(3))  # 3
print(df.sample(frac=0.5))  # 50%
```

:::tip
****
```python
df.head()        # 
df.info()        # 
df.describe()    # 
```
:::

#### Index

Index  Pandas 

```python showLineNumbers
import pandas as pd

# 
index = pd.Index(['a', 'b', 'c', 'd'])
print(index)
# Index(['a', 'b', 'c', 'd'], dtype='object')

# 
index = pd.Index([1, 2, 3, 4])
print(index)
# Index([1, 2, 3, 4], dtype='int64')

# Index 
# index[0] = 'x'  # TypeError

# Index 
index1 = pd.Index(['A', 'B', 'C'])
index2 = pd.Index(['C', 'D', 'E'])

print(index1.union(index2))        # 
print(index1.intersection(index2)) # 
print(index1.difference(index2))   # 
```

**MultiIndex**

```python showLineNumbers
import pandas as pd

# 
index = pd.MultiIndex.from_tuples([
    ('A', 1), ('A', 2), ('B', 1), ('B', 2)
])
print(index)

# 
arrays = [
    ['A', 'A', 'B', 'B'],
    [1, 2, 1, 2]
]
index = pd.MultiIndex.from_arrays(arrays, names=['letter', 'number'])
print(index)

#  DataFrame 
df = pd.DataFrame({
    'value': [10, 20, 30, 40]
}, index=index)
print(df)
#                value
# letter number       
# A      1         10
#        2         20
# B      1         30
#        2         40

# 
print(df.loc['A'])
#        value
# number      
# 1         10
# 2         20

print(df.loc[('A', 1)])
# value    10
```

**DatetimeIndex**

```python showLineNumbers
import pandas as pd

# 
dates = pd.to_datetime(['2021-01-01', '2021-01-02', '2021-01-03'])
print(dates)
# DatetimeIndex(['2021-01-01', '2021-01-02', '2021-01-03'])

# 
dates = pd.date_range('2021-01-01', periods=10, freq='D')
print(dates)
# DatetimeIndex(['2021-01-01', '2021-01-02', ..., '2021-01-10'])

# 
dates_monthly = pd.date_range('2021-01', periods=12, freq='M')
dates_hourly = pd.date_range('2021-01-01', periods=24, freq='H')
dates_business = pd.date_range('2021-01-01', periods=10, freq='B')  # 

#  DataFrame 
df = pd.DataFrame({
    'value': range(10)
}, index=dates)
print(df.head())

# 
print(df['2021-01-01'])     # 
print(df['2021-01-01':'2021-01-03'])  # 
print(df['2021-01'])        # 
```

:::tip
****
- `D`
- `W`
- `M`
- `MS`
- `Q`
- `Y`
- `H`
- `T`  `min`
- `S`
- `B`
:::

### IO

Pandas 

#### CSV/Excel 

```python showLineNumbers
import pandas as pd

# 
data = [['Google', 10], ['Runoob', 12], ['Wiki', 13]]
df = pd.DataFrame(data, columns=['Site', 'Age'], dtype=float)

# CSV 
df.to_csv('file1.csv', index=False)     #  CSV
df = pd.read_csv('file1.csv')           #  CSV

# Excel .xlsx 
df.to_excel('file1.xlsx', index=False)  #  Excel
df = pd.read_excel('file1.xlsx')        #  Excel

# Excel .xls 
df.to_excel('file1.xls', index=False)
df = pd.read_excel('file1.xls')

print(df)
#     Site   Age
# 0  Google  10.0
# 1  Runoob  12.0
# 2    Wiki  13.0
```

:::tip
****
- `index=False`
- `header=None`
- `encoding='utf-8'`
- `sep=','`CSV
- `sheet_name='Sheet1'` Excel 

```python
#  CSV 
df = pd.read_csv('data.csv', 
                 encoding='utf-8',    # 
                 sep=',',             # 
                 header=0,            # 
                 index_col=0,         # 
                 na_values=['NA', 'null'],  # 
                 skiprows=1,          # 
                 nrows=100)           # 100

#  Excel 
df = pd.read_excel('data.xlsx',
                   sheet_name='Sheet1',  # 
                   header=0,             # 
                   usecols='A:C')        # AC
```
:::

#### JSON 

```python showLineNumbers
import pandas as pd

#  JSON 
data = [
    {
        "id": "A001",
        "name": "",
        "url": "www.runoob.com",
        "likes": 61
    },
    {
        "id": "A002",
        "name": "Google",
        "url": "www.google.com",
        "likes": 124
    },
    {
        "id": "A003",
        "name": "",
        "url": "www.taobao.com",
        "likes": 45
    }
]

#  DataFrame
df = pd.DataFrame(data)

# JSON 
df.to_json('sites.json')         #  JSON
df = pd.read_json('sites.json')  #  JSON

print(df.to_string())
#      id    name             url  likes
# 0  A001      www.runoob.com     61
# 1  A002  Google  www.google.com    124
# 2  A003        www.taobao.com     45
```

:::tip
**JSON **
```python
#  JSON orient 
df.to_json('data.json', orient='records')  # 
df.to_json('data.json', orient='index')    # 
df.to_json('data.json', orient='columns')  # 
df.to_json('data.json', orient='values')   # 
```
:::

#### SQL 

```python showLineNumbers
from sqlalchemy import create_engine, text
import pandas as pd

# 
MYSQL_HOST = 'localhost'
MYSQL_PORT = 3306
MYSQL_USER = 'employee_u'
MYSQL_PASSWORD = 'employee_s'
MYSQL_DB = 'employee'

# 
engine = create_engine(
    f'mysql+pymysql://{MYSQL_USER}:{MYSQL_PASSWORD}@{MYSQL_HOST}:{MYSQL_PORT}/{MYSQL_DB}',
    echo=False
)

# 
dataset = pd.DataFrame({
    'Names': ['Abhinav', 'Aryan', 'Manthan'],
    'DOB': ['10/01/2009', '24/03/2009', '28/02/2009']
})

# 
dataset.to_sql('Employee_Data', con=engine, index=False, if_exists='replace')

# 
with engine.connect() as conn:
    # 1
    df1 = pd.read_sql('Employee_Data', con=conn)
    
    # 2 SQL 
    df2 = pd.read_sql_query(text("SELECT * FROM Employee_Data"), con=conn)
    
    # 3
    df3 = pd.read_sql_table("Employee_Data", conn)

print(df2)
```

:::tip
**if_exists **
- `'fail'`
- `'replace'`
- `'append'`

```python
# 
df.to_sql('table_name', con=engine, if_exists='replace')

# 
df.to_sql('table_name', con=engine, if_exists='append')

# 
df.to_sql('table_name', con=engine, chunksize=1000)
```
:::

:::warning
****
1.  `pymysql``psycopg2`
2.  `chunksize` 
3.  SQL 
4. 
:::

### 

Pandas 

#### 

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'A': [1, 2, 3, 4],
    'B': [5, 6, 7, 8],
    'C': [9, 10, 11, 12]
}, index=['row1', 'row2', 'row3', 'row4'])

print(df)
#       A  B   C
# row1  1  5   9
# row2  2  6  10
# row3  3  7  11
# row4  4  8  12

# 
print(df['A'])          #  Series
print(df[['A', 'C']])   #  DataFrame

# 
print(df[0:2])          # 
print(df['row1':'row3']) # 

# 
df['D'] = df['A'] + df['B']  # 
df['E'] = 100                 # 
del df['E']                   # 
```

:::tip
****
```python
df['A']      # 
df.A         # 

# 
df.count     # 
df['count']  # 'count'
```
:::

#### loc  iloc

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'A': [1, 2, 3, 4],
    'B': [5, 6, 7, 8],
    'C': [9, 10, 11, 12]
}, index=['row1', 'row2', 'row3', 'row4'])

# loc
print(df.loc['row1'])           # 
print(df.loc[['row1', 'row3']]) # 
print(df.loc['row1', 'A'])      # 
print(df.loc['row1':'row3', 'A':'B'])  # 

# iloc
print(df.iloc[0])         # 
print(df.iloc[[0, 2]])    # 13
print(df.iloc[0, 1])      # 12
print(df.iloc[0:2, 0:2])  # 

# 
print(df.loc[df['A'] > 2])         # 
print(df.loc[df['A'] > 2, ['A', 'C']])  # 

# 
df.loc['row1', 'A'] = 100
df.iloc[0, 0] = 200
```

:::tip
**loc vs iloc vs []**

|  |  |  |  |
|------|----------|----------|------|
| `[]` | / |  |  |
| `.loc[]` |  |  |  |
| `.iloc[]` |  |  |  |

```python
# 
df['A']           # 
df.loc[:, 'A']    # 

# 
df[0:2]           # 
df.loc['a':'c']   # 
df.iloc[0:2]      # 

# 
df.loc['a', 'A']  # 
df.iloc[0, 0]     # 
```
:::

#### 

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie', 'David'],
    'age': [25, 30, 35, 28],
    'city': ['Beijing', 'Shanghai', 'Beijing', 'Guangzhou'],
    'salary': [5000, 6000, 7000, 5500]
})

# 
print(df[df['age'] > 28])

# 
print(df[(df['age'] > 25) & (df['salary'] > 5500)])

# 
print(df[(df['city'] == 'Beijing') | (df['salary'] > 6000)])

#  isin
print(df[df['city'].isin(['Beijing', 'Shanghai'])])

# 
print(df[df['name'].str.contains('a')])

#  query 
print(df.query('age > 28 and salary > 5500'))
print(df.query('city == "Beijing" or salary > 6000'))

# 
print(df.loc[df['age'] > 28, ['name', 'city']])
```

:::tip
****
```python
#  & | ~  and or not
df[(df['age'] > 25) & (df['salary'] > 5000)]  # 
# df[(df['age'] > 25) and (df['salary'] > 5000)]  # 

# 
df[(df['age'] > 25) & (df['salary'] > 5000)]  # 
# df[df['age'] > 25 & df['salary'] > 5000]  # 

# query 
df.query('age > 25 and salary > 5000')  #  and/or
```
:::

### 

#### 

```python showLineNumbers
import pandas as pd
import numpy as np

df = pd.DataFrame({
    'A': [1, 2, np.nan, 4],
    'B': [5, np.nan, np.nan, 8],
    'C': [9, 10, 11, 12]
})

print(df)
#      A    B   C
# 0  1.0  5.0   9
# 1  2.0  NaN  10
# 2  NaN  NaN  11
# 3  4.0  8.0  12

# 
print(df.isna())        #  df.isnull()
print(df.isna().sum())  # 

# 
print(df.notna())       #  df.notnull()

# 
print(df.dropna())              # 
print(df.dropna(axis=1))        # 
print(df.dropna(how='all'))     # 
print(df.dropna(thresh=2))      # 2

# 
print(df.fillna(0))             # 0
print(df.fillna({'A': 0, 'B': 99}))  # 
print(df.fillna(method='ffill'))  # 
print(df.fillna(method='bfill'))  # 
print(df.fillna(df.mean()))     # 

# 
print(df.interpolate())         # 
```

:::tip
****

****
- `<5%`
- 
- 

****
- 0-1
- ffillbfill
- 

```python
# 
missing = df.isna().sum()
missing_pct = df.isna().sum() / len(df) * 100
print(pd.DataFrame({'count': missing, 'percentage': missing_pct}))

# 
df_clean = df.dropna(axis=1)

# 
df_filled = df.copy()
df_filled['A'].fillna(df_filled['A'].mean(), inplace=True)
df_filled['B'].fillna(method='ffill', inplace=True)
```
:::

#### 

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'A': [1, 1, 2, 3, 3],
    'B': [5, 5, 6, 7, 7],
    'C': [9, 9, 10, 11, 11]
})

print(df)
#    A  B   C
# 0  1  5   9
# 1  1  5   9
# 2  2  6  10
# 3  3  7  11
# 4  3  7  11

# 
print(df.duplicated())
# 0    False
# 1     True
# 2    False
# 3    False
# 4     True

# 
print(df.duplicated().sum())  # 2

# 
print(df.drop_duplicates())   # 
print(df.drop_duplicates(keep='last'))  # 
print(df.drop_duplicates(keep=False))   # 

# 
print(df.drop_duplicates(subset=['A']))
print(df.drop_duplicates(subset=['A', 'B']))

# 
df.drop_duplicates(inplace=True)
```

#### 

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'A': ['1', '2', '3'],
    'B': [1.0, 2.0, 3.0],
    'C': ['2021-01-01', '2021-01-02', '2021-01-03']
})

print(df.dtypes)
# A    object
# B   float64
# C    object

# 
df['A'] = df['A'].astype(int)
df['B'] = df['B'].astype(int)
df['C'] = pd.to_datetime(df['C'])

print(df.dtypes)
# A             int64
# B             int64
# C    datetime64[ns]

# 
df = df.astype({'A': 'int32', 'B': 'float32'})

# 
df['A'] = pd.to_numeric(df['A'], errors='coerce')  # NaN
df['A'] = pd.to_numeric(df['A'], errors='ignore')  # 

# 
df['category'] = pd.Categorical(['A', 'B', 'A', 'C'])
```

:::tip
****
```python
# 
pd.to_numeric(df['col'])          # 
pd.to_numeric(df['col'], errors='coerce')  # NaN

# 
pd.to_datetime(df['col'])         # 
pd.to_datetime(df['col'], format='%Y-%m-%d')  # 

# 
df['col'].astype(str)             # 

# 
df['col'] = df['col'].astype('category')
```
:::

### 

#### apply/map/applymap

```python showLineNumbers
import pandas as pd
import numpy as np

df = pd.DataFrame({
    'name': ['alice', 'bob', 'charlie'],
    'age': [25, 30, 35],
    'salary': [5000, 6000, 7000]
})

# mapSeries 
df['name_upper'] = df['name'].map(str.upper)
df['age_group'] = df['age'].map(lambda x: '' if x < 30 else '')

# 
name_mapping = {'alice': 'Alice', 'bob': 'Bob', 'charlie': 'Charlie'}
df['name_title'] = df['name'].map(name_mapping)

print(df)

# applyDataFrame/Series 
# axis=0
print(df[['age', 'salary']].apply(np.mean))

# axis=1
df['total'] = df.apply(lambda row: row['age'] + row['salary'], axis=1)

# 
def analyze(series):
    return pd.Series({
        'min': series.min(),
        'max': series.max(),
        'mean': series.mean()
    })

print(df[['age', 'salary']].apply(analyze))

# applymapDataFrame 
df_num = df[['age', 'salary']]
df_doubled = df_num.applymap(lambda x: x * 2)
print(df_doubled)
```

:::tip
**map vs apply vs applymap**

|  |  |  |  |
|------|----------|------|------|
| `map` | Series |  | Series |
| `apply` | Series/DataFrame |  | Series/DataFrame |
| `applymap` | DataFrame |  | DataFrame |

```python
# map
df['col'].map({'A': 1, 'B': 2})
df['col'].map(lambda x: x * 2)

# apply
df['col'].apply(complex_function)
df.apply(lambda row: row['A'] + row['B'], axis=1)

# applymapmap
df.applymap(lambda x: x * 2)
df.map(lambda x: x * 2)  # 
```
:::

#### 

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'name': ['Charlie', 'Alice', 'Bob'],
    'age': [35, 25, 30],
    'salary': [7000, 5000, 6000]
})

# 
print(df.sort_values('age'))  # age
print(df.sort_values('age', ascending=False))  # 

# 
print(df.sort_values(['age', 'salary']))
print(df.sort_values(['age', 'salary'], ascending=[True, False]))

# 
df_indexed = df.set_index('name')
print(df_indexed.sort_index())  # 
print(df_indexed.sort_index(axis=1))  # 

# 
df.sort_values('age', inplace=True)

# rank
df['age_rank'] = df['age'].rank()
df['salary_rank'] = df['salary'].rank(ascending=False)
df['age_rank_dense'] = df['age'].rank(method='dense')

print(df)
```

:::tip
**rank  method **
- `average`
- `min`
- `max`
- `first`
- `dense`

```python
s = pd.Series([1, 3, 3, 5])

s.rank(method='average')  # [1.0, 2.5, 2.5, 4.0]
s.rank(method='min')      # [1.0, 2.0, 2.0, 4.0]
s.rank(method='max')      # [1.0, 3.0, 3.0, 4.0]
s.rank(method='first')    # [1.0, 2.0, 3.0, 4.0]
s.rank(method='dense')    # [1.0, 2.0, 2.0, 3.0]
```
:::

#### 

```python showLineNumbers
import pandas as pd

df1 = pd.DataFrame({
    'A': [1, 2, 3],
    'B': [4, 5, 6]
})

df2 = pd.DataFrame({
    'A': [7, 8, 9],
    'B': [10, 11, 12]
})

# concat/
print(pd.concat([df1, df2]))  # axis=0
print(pd.concat([df1, df2], axis=1))  # 
print(pd.concat([df1, df2], ignore_index=True))  # 

# mergeSQL
left = pd.DataFrame({
    'key': ['A', 'B', 'C'],
    'value1': [1, 2, 3]
})

right = pd.DataFrame({
    'key': ['A', 'B', 'D'],
    'value2': [4, 5, 6]
})

# 
print(pd.merge(left, right, on='key'))
#   key  value1  value2
# 0   A       1       4
# 1   B       2       5

# 
print(pd.merge(left, right, on='key', how='left'))
#   key  value1  value2
# 0   A       1     4.0
# 1   B       2     5.0
# 2   C       3     NaN

# 
print(pd.merge(left, right, on='key', how='right'))

# 
print(pd.merge(left, right, on='key', how='outer'))
#   key  value1  value2
# 0   A     1.0     4.0
# 1   B     2.0     5.0
# 2   C     3.0     NaN
# 3   D     NaN     6.0

# 
left = pd.DataFrame({'key_left': ['A', 'B'], 'value': [1, 2]})
right = pd.DataFrame({'key_right': ['A', 'B'], 'value': [3, 4]})
print(pd.merge(left, right, left_on='key_left', right_on='key_right'))

# join
df1 = pd.DataFrame({'A': [1, 2]}, index=['a', 'b'])
df2 = pd.DataFrame({'B': [3, 4]}, index=['a', 'b'])
print(df1.join(df2))
```

:::tip
**merge  how **

|  | SQL |  |
|------|---------|------|
| `inner` | INNER JOIN |  |
| `left` | LEFT JOIN |  |
| `right` | RIGHT JOIN |  |
| `outer` | FULL OUTER JOIN |  |
| `cross` | CROSS JOIN |  |

```python
# 
pd.merge(df1, df2, on=['key1', 'key2'])

# 
pd.merge(df1, df2, on='key', suffixes=('_left', '_right'))

# 
pd.merge(df1, df2, on='key', how='outer', indicator=True)
```
:::

### 

#### GroupBy

```python showLineNumbers
import pandas as pd
import numpy as np

df = pd.DataFrame({
    'class': ['A', 'A', 'B', 'B', 'C', 'C'],
    'name': ['Alice', 'Bob', 'Charlie', 'David', 'Eve', 'Frank'],
    'score': [85, 90, 75, 80, 95, 88]
})

# 
grouped = df.groupby('class')

# 
print(grouped['score'].mean())   # 
print(grouped['score'].sum())    # 
print(grouped['score'].count())  # 
print(grouped['score'].max())    # 

# 
print(grouped['score'].agg(['mean', 'sum', 'count', 'max', 'min']))

# 
print(grouped.agg({
    'score': ['mean', 'max'],
    'name': 'count'
}))

# 
print(grouped['score'].agg(lambda x: x.max() - x.min()))

# 
df['semester'] = ['S1', 'S1', 'S1', 'S2', 'S2', 'S2']
print(df.groupby(['class', 'semester'])['score'].mean())

# 
for name, group in grouped:
    print(f"\nClass {name}:")
    print(group)

# transformDataFrame
df['score_mean'] = grouped['score'].transform('mean')
df['score_normalized'] = grouped['score'].transform(lambda x: (x - x.mean()) / x.std())
print(df)

# filter
print(grouped.filter(lambda x: x['score'].mean() > 85))
```

:::tip
**GroupBy Split-Apply-Combine**

1. **Split**
2. **Apply**
3. **Combine**

```python
# 
df.groupby('key').agg('mean')          # 
df.groupby('key').transform('mean')    # 
df.groupby('key').filter(lambda x: len(x) > 2)  # 
df.groupby('key').apply(custom_function)  # 
```
:::

#### Pivot

```python showLineNumbers
import pandas as pd

df = pd.DataFrame({
    'date': ['2021-01', '2021-01', '2021-02', '2021-02'],
    'city': ['Beijing', 'Shanghai', 'Beijing', 'Shanghai'],
    'sales': [100, 150, 120, 160],
    'profit': [20, 30, 25, 35]
})

# pivot_table
pivot = pd.pivot_table(
    df,
    values='sales',          # 
    index='date',            # 
    columns='city',          # 
    aggfunc='sum'            # 
)
print(pivot)
# city      Beijing  Shanghai
# date                       
# 2021-01       100       150
# 2021-02       120       160

# 
pivot = pd.pivot_table(
    df,
    values='sales',
    index='date',
    columns='city',
    aggfunc=['sum', 'mean']
)
print(pivot)

# 
pivot = pd.pivot_table(
    df,
    values=['sales', 'profit'],
    index='date',
    columns='city',
    aggfunc='sum'
)
print(pivot)

# 
pivot = pd.pivot_table(
    df,
    values='sales',
    index='date',
    columns='city',
    aggfunc='sum',
    margins=True,
    margins_name='Total'
)
print(pivot)

# stack/unstack
df_indexed = df.set_index(['date', 'city'])
print(df_indexed)

# unstack
print(df_indexed.unstack())

# stack
print(df_indexed.unstack().stack())
```

:::tip
**Pivot vs Pivot_table**

- `pivot`/
- `pivot_table`

```python
# pivot
df.pivot(index='date', columns='city', values='sales')

# pivot_table
df.pivot_table(
    values='sales',
    index='date',
    columns='city',
    aggfunc='sum'
)
```
:::

---

## 



  


- [matplotlib](https://matplotlib.org/)
- [pyecharts](https://github.com/pyecharts/pyecharts)


- [matplotlib](https://www.datawhale.cn/learn/summary/56)
- [-](https://antv-2018.alipay.com/zh-cn/vis/chart/index.html)

