# WebGL

WebGLWebGLOpenGL ES2.0OpenGL

WebGL2OpenGL ES3.0

``` js
const canvas = document.querySelector('canvas');
const webgl = canvas.getContext('webgl');
const webgl2 = canvas.getContext('webgl2');
```

## `gl.drawArrays()`

Canvas2DAPIWebGLAPI`gl.drawArrays``gl.drawArrays(gl.TRIANGLES, 0, 3)`WebGLGPU

``` js
gl.drawArrays(gl.POINTS, 0, 3) // 

gl.drawArrays(gl.LINES, 0, 2) // 

gl.drawArrays(gl.TRIANGLES, 0, 3) // 

// buffer
gl.drawArrays(gl.TRIANGLES, 0, 3)
gl.drawArrays(gl.TRIANGLES, 3, 3)
```

WebGLAPI`gl.drawArrays`GPU BufferUniform

## OpenGL Shading LanguageGLSL

GPUWebGLGPU********GPU********

### Vertex Shader

``` glsl
attribute vec2 a_position;
attribute vec4 a_color;
uniform int u_id;
varying vec4 v_color;

void main() {
  vec4 v_color = a_color;
  gl_Position = vec4(a_position, 0.0, 1.0);
}
```
`attribute`GPU Buffer`attribute``attribute`UV

`uniform`JavaScript`uniform``uniform`

`attribute``uniform``varying``a_color``a_color``varying``v_color`****`varying`

`gl_Position`

![vs](https://images2018.cnblogs.com/blog/669331/201803/669331-20180302113903143-870412752.png)

### Fragment Shader

``` glsl
// fragment shader /
precision mediump float; // 
uniform int u_id;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color; 
}
```
`attribute``uniform``varying``uniform`

`varying``v_color``v_color`****UV

`gl_FragColor`



![fs](https://img-blog.csdn.net/20140917135608231)

### attribute

`attribute`GPU BufferVAO`attribute`UV

### varying

`varying``varying`UV

### uniform

`uniform` JavaScript

``` js
const location1 = gl.getUniformLocation(program, "u_1");
const location2 = gl.getUniformLocation(program, "u_2");

gl.uniform1f(location1, 1.);
gl.uniform1i(location2, 2);
```
### Texture

`uniform``sampler2D`

``` js
const texture = gl.createTexture();
const unit = 3 // 3
gl.activeTexture(gl['TEXTURE' + unit]) // 3
gl.bindTexture(gl.TEXTURE_2D, texture) // 3
gl.texImage2D( // 
  gl.TEXTURE_2D,
  0,
  gl.RGBA,
  gl.RGBA,
  gl.UNSIGNED_BYTE,
  new Uint8Array([
   255, 0, 0, 255,
   0, 255, 0, 255,
  ])
);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); // 

const location = gl.getUniformLocation(program, 'u_texture');
gl.uniform1i(location, unit); // uniformGPU
```

``` glsl
precision mediump float;
 
uniform sampler2D u_texture;
 
void main() {
   vec2 texcoord = vec2(0.5, 0.5); // (0, 0)(1, 1)(0.5, 0.5)uvvarying
   gl_FragColor = texture2D(u_texture, texcoord); // 
}
```

### UV

WebGL

UVVaryingUV0, 0(1, 1)

``` glsl
precision mediump float;
 
uniform sampler2D u_texture;
 
void main() {
   vec2 texcoord = vec2(0.5, 0.5); // (0, 0)(1, 1)(0.5, 0.5)uvvarying
   gl_FragColor = texture2D(u_texture, texcoord); // 
}
```



### 

GLSL`float``int``vec2``vec3``vec4``mat2``mat3``mat4`

### 

- `abs(x)`
- `floor(x)`
- `fract(x)`
- `ceil(x)`
- `max(x, y)``min(x, y)``clamp(x, min, max)`
- `mix(a, b, t)``mix(a, b, t)``a * (1 - t) + b * (t)`
- `step(edge, x)``x``edge`01
- `smoothstep(edge0, edge1, x)``x``edge0`0`x``edge0`1`edge0``edge1`
- `length(vec)`



## 

> WebGLWebGL[](https://webglfundamentals.org/webgl/lessons/resources/webgl-state-diagram.html?exampleId=triangle#no-help)

API`gl.drawArrays`GPU BufferUniform

### Shader

WebGL`gl.useProgram()``gl.getAttribLocation()``gl.getUniformLocation()`

``` js
const vsSource = '...' // 
const fsSource = '...' // 

const gl = canvas.getContext('webgl2');
const vs = gl.createShader(gl.VERTEX_SHADER);
gl.shaderSource(vs, vsSource);
gl.compileShader(vs);

const fs = gl.createShader(gl.FRAGMENT_SHADER);
gl.shaderSource(fs, fsSource);
gl.compileShader(fs);

const program = gl.createProgram();
gl.attachShader(program, vs);
gl.attachShader(program, fs);
gl.linkProgram(program);
gl.useProgram(program);
```

### `gl.ARRAY_BUFFER`

`gl.ARRAY_BUFFER`WebGLGPU Buffer`gl.createBuffer()`GPU Buffer`gl.bindBuffer(gl.ARRAY_BUFFER, buffer)`Buffer`gl.bufferData(gl.ARRAY_BUFFER, xxx)`Buffer

``` js
const buffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1.0, 1.0]), this.gl.STATIC_DRAW);
```

### VBOVAO

- VBOUVBufferVBO

- VAOAttributeWebGLMapVAOAttributeBufferVBOsizeoffset

``` js
const location = gl.getAttribLocation(program, 'akara');
gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
gl.enableVertexAttribArray(location);
gl.vertexAttribPointer( // gl.ARRAY_BUFFERVAO
    location,     // location
    3,            // size (components per iteration)
    gl.FLOAT,     // type of to get from buffer
    false,        // normalize
    0,            // stride (bytes to advance each iteration)
    0,            // offset (bytes from start of buffer)
);
```

### `gl.TEXTURE_2D`

`gl.ARRAY_BUFFER`WebGL8

- `gl.activeTexture(gl['TEXTURE' + ])`
- `gl.bindTexture(gl.TEXTURE_2D, xxx)`
- `gl.texImage2D(gl.TEXTURE_2D, xxx)`
- `gl.texParameteri(gl.TEXTURE_2D)`

``` js
gl.activeTexture(gl.TEXTURE0) // 0
gl.activeTexture(gl.TEXTURE7) // 7 

const texture = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.texImage2D( // 
  gl.TEXTURE_2D,
  0,
  gl.RGBA,
  gl.RGBA,
  gl.UNSIGNED_BYTE,
  new Uint8Array([
   255, 0, 0, 255,
   0, 255, 0, 255,
  ])
);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); // 
```



### `gl.FRAMEBUFFE`

`gl.FRAMEBUFFE`WebGLCanvas

`gl.createFrameBuffer()``gl.bindFrameBuffer(gl.FRAMEBUFFER, xxx)`

``` js
const fbo = gl.createFrameBuffer();
gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
```









### `gl.viewport()`

NDCWebGL

``` js
gl.viewport(0, 0, 100, 100)
```



## WebGL

1. VBOVAOUniform
2. `gl.drawArrays()`CPU
3. 
    1. BlenderMaya3D**Model**
    2. /**View**
    3. ********W**Projection**

![](https://img-blog.csdn.net/20171229111837073?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmllemhpaHVh/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

4. GPUW**NDC**-1+1-1+1ViewportVarying![img](https://img-blog.csdnimg.cn/b26e74a5ee5b4f8781cbe684ac25ebaa.png)
5. 
6. 









## 
- 
``` glsl 
vec2 result = vec2(1.0, 1.0) + 2.
```

- 
``` glsl 
vec2 result = vec2(1.0, 1.0) * 2.;
```

- 
``` glsl 
vec2 result = vec2(1.0, 1.0) + vec2(2.0, 2.0);
```

- 
``` glsl 
vec2 a = vec2(1.0, 1.0);
vec2 b = vec2(2.0, 2.0);

vec2 result = a * 0.5 + b * 1;
vec2 result2 = a * t + b * (1 - t); // 

vec2 output = a * x + b * y;
```



`vec2 output = a * x + b * y``vec2(x, y)``vec2 output`

``` glsl
vec2 result3 = mat2(a, b) * vec2(x, y);
```


- A*BA
- 

- 
``` glsl
mat2 result = mat2(1., 1., 1. 1.) + 0.5;
```
- 
``` glsl
mat2 result = mat2(1., 1., 1. 1.) * 0.5;
```

- 
``` glsl
mat2 result = mat2(1., 1., 1. 1.) + mat2(1., 1., 1. 1.);
```

- 

C=ABC=B.map(vec => A*vec)
``` glsl
mat2 result = mat2(vec2(1., 1.), vec2(2., 2.)) * mat2(vec2(1., 1.), vec2(2., 2.));
```

****



`vec2 point = vec2(x, y)``vec2 output = point * 2.``vec3 output = mat2(vec2(2., 0.), vec2(0., 3.)) * point`

`=(())`


“”1



## 

GLSL`rand`

``` glsl
y = fract(sin(x)*10000.0);
```



``` glsl
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}
```



## 

(-1, -1, -1)(1, 1, 1)`gl_Position`Buffer(-1, -1)(1, 1)

(100, 0)(50, 50)100*100Zw1

``` glsl
attribute vec2 a_position;

uniform vec2 u_resolution; // uniform

void main() {
  //  0.0  1.0
  vec2 zeroToOne = a_position / u_resolution;

  //  0->1  0->2
  vec2 zeroToTwo = zeroToOne * 2.0;

  //  0->2  -1->+1 ()
  vec2 clipSpace = zeroToTwo - 1.0;

  gl_Position = vec4(clipSpace, 0, 1);
}
```

(0, 0)(-1, -1)Canvas 2Dy

``` glsl
gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
```





## Trouble Shooting

1. Shader

2. Shader

3. 

4. 

   ``` glsl
   this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, true);
   ```

5. 

   ``` glsl
   this.gl.texParameteri(
     this.gl.TEXTURE_2D,
     this.gl.TEXTURE_MIN_FILTER,
     this.gl.LINEAR
   );
   this.gl.texParameteri(
     this.gl.TEXTURE_2D,
     this.gl.TEXTURE_WRAP_S,
     this.gl.CLAMP_TO_EDGE
   );
   this.gl.texParameteri(
     this.gl.TEXTURE_2D,
     this.gl.TEXTURE_WRAP_T,
     this.gl.CLAMP_TO_EDGE
   );
   ```

6. WebGL8

   ``` glsl
   gl.activeTexture(gl.TEXTURE0);
   ```

   











## 

1. https://juejin.cn/post/6891918137671811079

2. https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial
3. https://shaderific.com/glsl/common_functions.html
4. https://en.wikipedia.org/wiki/Blend_modes
