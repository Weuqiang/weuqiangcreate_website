---
sidebar_position: 3
title: å‰ç«¯å·¥ç¨‹åŒ–å®æˆ˜
tags: [å‰ç«¯, å·¥ç¨‹åŒ–, Webpack, Vite, æ„å»ºä¼˜åŒ–]
---

# å‰ç«¯å·¥ç¨‹åŒ–å®æˆ˜

å‰ç«¯å·¥ç¨‹åŒ–æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„åŸºç¡€ï¼Œæœ¬æ–‡å°†è®²è§£æ„å»ºå·¥å…·ã€ä»£ç è§„èŒƒã€è‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰å·¥ç¨‹åŒ–å®è·µã€‚

## æ„å»ºå·¥å…·å¯¹æ¯”

### Webpack vs Vite

```javascript
const buildToolComparison = {
  webpack: {
    principle: 'æ‰“åŒ…æ‰€æœ‰æ¨¡å—',
    devServer: 'éœ€è¦æ‰“åŒ…åæ‰èƒ½å¯åŠ¨',
    hmr: 'è¾ƒæ…¢',
    production: 'æˆç†Ÿç¨³å®š',
    ecosystem: 'ç”Ÿæ€ä¸°å¯Œ',
    config: 'é…ç½®å¤æ‚',
    useCase: 'å¤§å‹é¡¹ç›®ã€éœ€è¦ç²¾ç»†æ§åˆ¶'
  },
  
  vite: {
    principle: 'ESM + esbuildé¢„æ„å»º',
    devServer: 'å³æ—¶å¯åŠ¨',
    hmr: 'æå¿«',
    production: 'Rollupæ‰“åŒ…',
    ecosystem: 'å¿«é€Ÿå‘å±•',
    config: 'é…ç½®ç®€å•',
    useCase: 'ç°ä»£æµè§ˆå™¨ã€å¿«é€Ÿå¼€å‘'
  }
};
```

## Webpackæ·±åº¦é…ç½®

### åŸºç¡€é…ç½®

```javascript
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

module.exports = {
  mode: 'production',
  
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js'
  },
  
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash:8].js',
    chunkFilename: '[name].[contenthash:8].chunk.js',
    publicPath: '/'
  },
  
  resolve: {
    extensions: ['.js', '.jsx', '.ts', '.tsx', '.json'],
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@utils': path.resolve(__dirname, 'src/utils')
    }
  },
  
  module: {
    rules: [
      // JavaScript/TypeScript
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: [
              ['@babel/preset-env', {
                useBuiltIns: 'usage',
                corejs: 3
              }],
              '@babel/preset-react',
              '@babel/preset-typescript'
            ],
            plugins: [
              '@babel/plugin-transform-runtime'
            ]
          }
        }
      },
      
      // CSS
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'postcss-loader'
        ]
      },
      
      // SCSS
      {
        test: /\.scss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'postcss-loader',
          'sass-loader'
        ]
      },
      
      // å›¾ç‰‡
      {
        test: /\.(png|jpg|jpeg|gif|svg)$/,
        type: 'asset',
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024 // 10KB
          }
        },
        generator: {
          filename: 'images/[name].[hash:8][ext]'
        }
      },
      
      // å­—ä½“
      {
        test: /\.(woff|woff2|eot|ttf|otf)$/,
        type: 'asset/resource',
        generator: {
          filename: 'fonts/[name].[hash:8][ext]'
        }
      }
    ]
  },
  
  plugins: [
    new CleanWebpackPlugin(),
    
    new HtmlWebpackPlugin({
      template: './public/index.html',
      minify: {
        removeComments: true,
        collapseWhitespace: true,
        removeAttributeQuotes: true
      }
    }),
    
    new MiniCssExtractPlugin({
      filename: 'css/[name].[contenthash:8].css',
      chunkFilename: 'css/[name].[contenthash:8].chunk.css'
    })
  ],
  
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10
        },
        common: {
          minChunks: 2,
          priority: 5,
          reuseExistingChunk: true
        }
      }
    },
    runtimeChunk: 'single'
  }
};
```

### æ€§èƒ½ä¼˜åŒ–é…ç½®

```javascript
// webpack.prod.js
const TerserPlugin = require('terser-webpack-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
const CompressionPlugin = require('compression-webpack-plugin');
const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');

module.exports = {
  mode: 'production',
  
  optimization: {
    minimize: true,
    minimizer: [
      // JSå‹ç¼©
      new TerserPlugin({
        parallel: true,
        terserOptions: {
          compress: {
            drop_console: true,
            drop_debugger: true
          }
        }
      }),
      
      // CSSå‹ç¼©
      new CssMinimizerPlugin()
    ],
    
    // ä»£ç åˆ†å‰²
    splitChunks: {
      chunks: 'all',
      minSize: 20000,
      maxSize: 244000,
      minChunks: 1,
      maxAsyncRequests: 30,
      maxInitialRequests: 30,
      cacheGroups: {
        // Reactç›¸å…³
        react: {
          test: /[\\/]node_modules[\\/](react|react-dom|react-router-dom)[\\/]/,
          name: 'react-vendor',
          priority: 20
        },
        
        // UIåº“
        antd: {
          test: /[\\/]node_modules[\\/]antd[\\/]/,
          name: 'antd-vendor',
          priority: 15
        },
        
        // å…¶ä»–ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendor',
          priority: 10
        },
        
        // å…¬å…±ä»£ç 
        common: {
          minChunks: 2,
          priority: 5,
          reuseExistingChunk: true
        }
      }
    }
  },
  
  plugins: [
    // Gzipå‹ç¼©
    new CompressionPlugin({
      algorithm: 'gzip',
      test: /\.(js|css|html|svg)$/,
      threshold: 10240,
      minRatio: 0.8
    }),
    
    // æ‰“åŒ…åˆ†æ
    new BundleAnalyzerPlugin({
      analyzerMode: 'static',
      openAnalyzer: false,
      reportFilename: 'bundle-report.html'
    })
  ],
  
  performance: {
    hints: 'warning',
    maxEntrypointSize: 512000,
    maxAssetSize: 512000
  }
};
```

## Viteé…ç½®

### åŸºç¡€é…ç½®

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@utils': path.resolve(__dirname, 'src/utils')
    }
  },
  
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@import "@/styles/variables.scss";`
      }
    },
    modules: {
      localsConvention: 'camelCase'
    }
  },
  
  server: {
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'ui-vendor': ['antd'],
          'utils': ['axios', 'dayjs', 'lodash-es']
        }
      }
    },
    
    chunkSizeWarningLimit: 1000
  }
});
```

### æ€§èƒ½ä¼˜åŒ–

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import viteCompression from 'vite-plugin-compression';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(),
    
    // Gzipå‹ç¼©
    viteCompression({
      algorithm: 'gzip',
      ext: '.gz'
    }),
    
    // æ‰“åŒ…åˆ†æ
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ],
  
  build: {
    rollupOptions: {
      output: {
        // ä»£ç åˆ†å‰²
        manualChunks(id) {
          if (id.includes('node_modules')) {
            // æŒ‰åŒ…ååˆ†å‰²
            return id.toString().split('node_modules/')[1].split('/')[0].toString();
          }
        }
      }
    },
    
    // å¯ç”¨CSSä»£ç åˆ†å‰²
    cssCodeSplit: true,
    
    // æ„å»ºç›®æ ‡
    target: 'es2015',
    
    // å‹ç¼©é€‰é¡¹
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  },
  
  // ä¾èµ–é¢„æ„å»º
  optimizeDeps: {
    include: ['react', 'react-dom', 'react-router-dom'],
    exclude: ['@vite/client', '@vite/env']
  }
});
```

## ä»£ç è§„èŒƒ

### ESLinté…ç½®

```javascript
// .eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  
  extends: [
    'eslint:recommended',
    'plugin:react/recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'prettier'
  ],
  
  parser: '@typescript-eslint/parser',
  
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  
  plugins: [
    'react',
    '@typescript-eslint',
    'react-hooks'
  ],
  
  rules: {
    'react/react-in-jsx-scope': 'off',
    'react/prop-types': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/no-unused-vars': ['error', {
      argsIgnorePattern: '^_'
    }],
    'no-console': ['warn', {
      allow: ['warn', 'error']
    }]
  },
  
  settings: {
    react: {
      version: 'detect'
    }
  }
};
```

### Prettieré…ç½®

```javascript
// .prettierrc.js
module.exports = {
  printWidth: 100,
  tabWidth: 2,
  useTabs: false,
  semi: true,
  singleQuote: true,
  quoteProps: 'as-needed',
  jsxSingleQuote: false,
  trailingComma: 'es5',
  bracketSpacing: true,
  jsxBracketSameLine: false,
  arrowParens: 'always',
  endOfLine: 'lf'
};
```

### Husky + lint-staged

```json
// package.json
{
  "scripts": {
    "prepare": "husky install"
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{css,scss,less}": [
      "stylelint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

```bash
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

## è‡ªåŠ¨åŒ–éƒ¨ç½²

### GitHub Actions

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm test
      
      - name: Build
        run: npm run build
        env:
          CI: false
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

### Dockeréƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

```nginx
# nginx.conf
server {
    listen 80;
    server_name localhost;
    
    root /usr/share/nginx/html;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

## æ€§èƒ½ç›‘æ§

### æ€§èƒ½æŒ‡æ ‡æ”¶é›†

```javascript
// performance.js
class PerformanceMonitor {
  constructor() {
    this.metrics = {};
  }
  
  // æ”¶é›†æ€§èƒ½æŒ‡æ ‡
  collectMetrics() {
    if (!window.performance) return;
    
    const navigation = performance.getEntriesByType('navigation')[0];
    const paint = performance.getEntriesByType('paint');
    
    this.metrics = {
      // DNSæŸ¥è¯¢æ—¶é—´
      dns: navigation.domainLookupEnd - navigation.domainLookupStart,
      
      // TCPè¿æ¥æ—¶é—´
      tcp: navigation.connectEnd - navigation.connectStart,
      
      // è¯·æ±‚æ—¶é—´
      request: navigation.responseStart - navigation.requestStart,
      
      // å“åº”æ—¶é—´
      response: navigation.responseEnd - navigation.responseStart,
      
      // DOMè§£ææ—¶é—´
      domParse: navigation.domInteractive - navigation.responseEnd,
      
      // èµ„æºåŠ è½½æ—¶é—´
      resourceLoad: navigation.loadEventStart - navigation.domContentLoadedEventEnd,
      
      // é¦–æ¬¡ç»˜åˆ¶
      fp: paint.find(p => p.name === 'first-paint')?.startTime,
      
      // é¦–æ¬¡å†…å®¹ç»˜åˆ¶
      fcp: paint.find(p => p.name === 'first-contentful-paint')?.startTime,
      
      // é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´
      loadTime: navigation.loadEventEnd - navigation.fetchStart
    };
    
    return this.metrics;
  }
  
  // ä¸ŠæŠ¥æ€§èƒ½æ•°æ®
  report() {
    const metrics = this.collectMetrics();
    
    // å‘é€åˆ°ç›‘æ§æœåŠ¡
    fetch('/api/performance', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        url: window.location.href,
        metrics,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      })
    });
  }
}

// ä½¿ç”¨
const monitor = new PerformanceMonitor();
window.addEventListener('load', () => {
  setTimeout(() => monitor.report(), 0);
});
```

### Web Vitals

```javascript
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric) {
  const body = JSON.stringify({
    name: metric.name,
    value: metric.value,
    id: metric.id,
    url: window.location.href
  });
  
  // ä½¿ç”¨sendBeaconç¡®ä¿æ•°æ®å‘é€
  if (navigator.sendBeacon) {
    navigator.sendBeacon('/api/analytics', body);
  } else {
    fetch('/api/analytics', {
      method: 'POST',
      body,
      keepalive: true
    });
  }
}

// æ”¶é›†æ ¸å¿ƒWebæŒ‡æ ‡
getCLS(sendToAnalytics);  // ç´¯ç§¯å¸ƒå±€åç§»
getFID(sendToAnalytics);  // é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ
getFCP(sendToAnalytics);  // é¦–æ¬¡å†…å®¹ç»˜åˆ¶
getLCP(sendToAnalytics);  // æœ€å¤§å†…å®¹ç»˜åˆ¶
getTTFB(sendToAnalytics); // é¦–å­—èŠ‚æ—¶é—´
```

## æ€»ç»“

å‰ç«¯å·¥ç¨‹åŒ–çš„æ ¸å¿ƒï¼š
- ğŸ› ï¸ **æ„å»ºå·¥å…·**ï¼šWebpackæ·±åº¦é…ç½®ã€Viteå¿«é€Ÿå¼€å‘
- ğŸ“ **ä»£ç è§„èŒƒ**ï¼šESLintã€Prettierã€Husky
- ğŸš€ **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šCI/CDã€Dockerå®¹å™¨åŒ–
- ğŸ“Š **æ€§èƒ½ç›‘æ§**ï¼šæ€§èƒ½æŒ‡æ ‡ã€Web Vitals
- ğŸ”§ **ä¼˜åŒ–ç­–ç•¥**ï¼šä»£ç åˆ†å‰²ã€å‹ç¼©ã€ç¼“å­˜

è®°ä½ï¼š**å·¥ç¨‹åŒ–æ˜¯æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡çš„å…³é”®ï¼**

