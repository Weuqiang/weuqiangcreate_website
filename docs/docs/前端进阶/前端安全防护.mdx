---
sidebar_position: 5
title: 
tags: [, , XSS, CSRF, ]
---

# 

Web

## XSS

### XSS

```javascript
const xssTypes = {
  // 1. XSS
  stored: {
    description: '',
    example: '',
    flow: [
      '1. ',
      '2. ',
      '3. '
    ]
  },
  
  // 2. XSS
  reflected: {
    description: 'URL',
    example: '',
    flow: [
      '1. URL',
      '2. URL',
      '3. ',
      '4. '
    ]
  },
  
  // 3. DOMXSS
  dom: {
    description: 'DOM',
    example: '',
    flow: [
      '1. URL',
      '2. JSURL',
      '3. DOM',
      '4. '
    ]
  }
};
```

### XSS

```javascript
//  XSS
// 
const comment = '<script>alert("XSS")</script>';
await api.post('/comments', { content: comment });

// 
db.comments.insert({ content: comment });

// 
<div dangerouslySetInnerHTML={{ __html: comment }} />

//  XSS
// URL: /search?q=<script>alert("XSS")</script>
const query = new URLSearchParams(location.search).get('q');
document.getElementById('result').innerHTML = `${query}`;

//  DOMXSS
// URL: #<img src=x onerror=alert("XSS")>
const hash = location.hash.slice(1);
document.getElementById('content').innerHTML = hash;
```

### XSS

```javascript
// 1. 
class InputFilter {
  // HTML
  escapeHtml(str) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#x27;',
      '/': '&#x2F;'
    };
    return str.replace(/[&<>"'/]/g, char => map[char]);
  }
  
  // 
  sanitize(html) {
    const div = document.createElement('div');
    div.innerHTML = html;
    
    // script
    const scripts = div.querySelectorAll('script');
    scripts.forEach(script => script.remove());
    
    // 
    const elements = div.querySelectorAll('*');
    elements.forEach(el => {
      Array.from(el.attributes).forEach(attr => {
        if (attr.name.startsWith('on')) {
          el.removeAttribute(attr.name);
        }
      });
    });
    
    return div.innerHTML;
  }
}

// 2. DOMPurify
import DOMPurify from 'dompurify';

const clean = DOMPurify.sanitize(dirtyHtml, {
  ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a'],
  ALLOWED_ATTR: ['href']
});

// 3. React
function SafeComponent({ userInput }) {
  // React
  return <div>{userInput}</div>;
}

// 4. CSPContent Security Policy
// HTTP
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' https://trusted.cdn.com

// HTML meta
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' https://trusted.cdn.com">

// 5. HttpOnly Cookie
// JSCookie
Set-Cookie: sessionId=xxx; HttpOnly; Secure; SameSite=Strict
```

## CSRF

### CSRF

```javascript
const csrfConcept = {
  description: '',
  
  attackFlow: [
    '1. ACookie',
    '2. B',
    '3. BA',
    '4. Cookie',
    '5. A'
  ],
  
  example: `
    <!-- B -->
    <img src="https://bank.com/transfer?to=attacker&amount=1000">
    
    <!--  -->
    <form action="https://bank.com/transfer" method="POST">
      <input type="hidden" name="to" value="attacker">
      <input type="hidden" name="amount" value="1000">
    </form>
    <script>document.forms[0].submit();</script>
  `
};
```

### CSRF

```javascript
// 1. CSRF Token
class CSRFProtection {
  // Token
  generateToken() {
    return crypto.randomBytes(32).toString('hex');
  }
  
  // 
  middleware(req, res, next) {
    if (req.method === 'GET') {
      // GETToken
      const token = this.generateToken();
      req.session.csrfToken = token;
      res.locals.csrfToken = token;
      next();
    } else {
      // POSTToken
      const token = req.body._csrf || req.headers['x-csrf-token'];
      if (token === req.session.csrfToken) {
        next();
      } else {
        res.status(403).json({ error: 'Invalid CSRF token' });
      }
    }
  }
}

// 
// Token
<form action="/transfer" method="POST">
  <input type="hidden" name="_csrf" value="{{ csrfToken }}">
  <input type="text" name="amount">
  <button type="submit">Transfer</button>
</form>

// AJAXToken
fetch('/api/transfer', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
  },
  body: JSON.stringify({ amount: 1000 })
});

// 2. SameSite Cookie
Set-Cookie: sessionId=xxx; SameSite=Strict

// Strict: Cookie
// Lax: CookieGET
// None: CookieSecure

// 3. Referer
app.use((req, res, next) => {
  const referer = req.headers.referer;
  const host = req.headers.host;
  
  if (referer && !referer.includes(host)) {
    return res.status(403).json({ error: 'Invalid referer' });
  }
  
  next();
});

// 4. Cookie
// Cookie
res.cookie('csrf-token', token);

// Cookie
const csrfToken = document.cookie
  .split('; ')
  .find(row => row.startsWith('csrf-token='))
  .split('=')[1];

fetch('/api/transfer', {
  headers: {
    'X-CSRF-Token': csrfToken
  }
});
```

## 

### 

```html
<!--  -->
<style>
  iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    z-index: 999;
  }
  
  .fake-button {
    position: absolute;
    top: 100px;
    left: 100px;
  }
</style>

<iframe src="https://bank.com/transfer"></iframe>
<button class="fake-button"></button>

<!-- ""iframe"" -->
```

### 

```javascript
// 1. X-Frame-Options
// HTTP
X-Frame-Options: DENY              // iframe
X-Frame-Options: SAMEORIGIN        // iframe
X-Frame-Options: ALLOW-FROM https://trusted.com

// 2. CSP frame-ancestors
Content-Security-Policy: frame-ancestors 'self'

// 3. JavaScript
if (window.top !== window.self) {
  // iframe
  window.top.location = window.self.location;
}

// 4. sandbox
<iframe src="untrusted.html" sandbox="allow-scripts"></iframe>
```

## SQL

### SQL

```javascript
//  
app.get('/user', (req, res) => {
  const { id } = req.query;
  const sql = `SELECT * FROM users WHERE id = ${id}`;
  db.query(sql, (err, result) => {
    res.json(result);
  });
});

// /user?id=1 OR 1=1
// SQL: SELECT * FROM users WHERE id = 1 OR 1=1
// 

//  
app.get('/user', (req, res) => {
  const { id } = req.query;
  const sql = 'SELECT * FROM users WHERE id = ?';
  db.query(sql, [id], (err, result) => {
    res.json(result);
  });
});

//  ORM
const user = await User.findOne({
  where: { id: req.query.id }
});
```

## 

### 

```javascript
// 1. 
//  
localStorage.setItem('password', 'secret123');
localStorage.setItem('creditCard', '1234-5678-9012-3456');

//  
localStorage.setItem('theme', 'dark');
localStorage.setItem('language', 'zh-CN');

// 2. 
import CryptoJS from 'crypto-js';

class SecureStorage {
  constructor(secretKey) {
    this.secretKey = secretKey;
  }
  
  encrypt(data) {
    return CryptoJS.AES.encrypt(
      JSON.stringify(data),
      this.secretKey
    ).toString();
  }
  
  decrypt(encrypted) {
    const bytes = CryptoJS.AES.decrypt(encrypted, this.secretKey);
    return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
  }
  
  setItem(key, value) {
    const encrypted = this.encrypt(value);
    localStorage.setItem(key, encrypted);
  }
  
  getItem(key) {
    const encrypted = localStorage.getItem(key);
    return encrypted ? this.decrypt(encrypted) : null;
  }
}

// 3. HTTPS
// HTTPS

// 4. 
console.log('User data:', user); //  

// console
if (process.env.NODE_ENV === 'production') {
  console.log = () => {};
  console.error = () => {};
}

// 5. 
// webpack
const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new TerserPlugin({
        terserOptions: {
          compress: {
            drop_console: true,
            drop_debugger: true
          },
          mangle: true
        }
      })
    ]
  }
};
```

## 

### 

```bash
# 
npm audit

# 
npm audit fix

# 
npm audit fix --force

# Snyk
npm install -g snyk
snyk test
snyk wizard
```

### 

```javascript
// package.json
{
  "dependencies": {
    //  
    "react": "18.2.0",
    
    //  
    "lodash": "*",
    "axios": "^1.0.0"
  },
  
  "scripts": {
    "preinstall": "npx npm-force-resolutions"
  },
  
  // 
  "resolutions": {
    "lodash": "4.17.21"
  }
}

// package-lock.json
// 
```

## 

```javascript
const securityBestPractices = {
  // 1. 
  input: {
    validate: '',
    sanitize: '',
    whitelist: ''
  },
  
  // 2. 
  output: {
    escape: 'HTML',
    contextAware: ''
  },
  
  // 3. 
  auth: {
    https: 'HTTPS',
    token: 'JWTSession',
    expire: '',
    refresh: 'Token'
  },
  
  // 4. 
  sensitive: {
    confirm: '',
    captcha: '',
    rateLimit: ''
  },
  
  // 5. 
  error: {
    generic: '',
    log: '',
    monitor: ''
  },
  
  // 6. 
  dependencies: {
    audit: '',
    update: '',
    minimal: ''
  }
};
```

## 

```javascript
const securityChecklist = {
  // XSS
  xss: [
    ' ',
    ' CSP',
    ' CookieHttpOnly',
    ' dangerouslySetInnerHTML',
    ' DOMPurifyHTML'
  ],
  
  // CSRF
  csrf: [
    ' CSRF Token',
    ' CookieSameSite',
    ' Referer',
    ' '
  ],
  
  // 
  clickjacking: [
    ' X-Frame-Options',
    ' CSP frame-ancestors',
    ' JavaScriptiframe'
  ],
  
  // 
  data: [
    ' ',
    ' HTTPS',
    ' ',
    ' '
  ],
  
  // 
  dependencies: [
    ' npm audit',
    ' ',
    ' package-lock.json',
    ' '
  ]
};
```

## 


-  **XSS**CSP
-  **CSRF**TokenSameSite Cookie
-  ****X-Frame-OptionsCSP
-  ****HTTPS
-  ****
-  ****

****

