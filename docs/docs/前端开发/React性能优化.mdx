---
sidebar_position: 4
title: React
tags: [React, , ]
---

# React

ReactReact

## 

### React DevTools Profiler

```jsx
// Profiler API
import { Profiler } from 'react';

function onRenderCallback(
  id, // id
  phase, // "mount"  "update"
  actualDuration, // 
  baseDuration, // memoization
  startTime, // 
  commitTime, // 
  interactions // interactions
) {
  console.log(`${id} ${phase} took ${actualDuration}ms`);
}

function App() {
  return (
    <Profiler id="App" onRender={onRenderCallback}>
      <Navigation />
      <Main />
    </Profiler>
  );
}
```

### Chrome DevTools Performance

```javascript
// User Timing API
performance.mark('component-render-start');
// 
performance.mark('component-render-end');
performance.measure(
  'component-render',
  'component-render-start',
  'component-render-end'
);
```

## 

### React.memo

```jsx
// 
const ExpensiveComponent = React.memo(({ data, onUpdate }) => {
  console.log('ExpensiveComponent rendered');
  return (
    <div>
      <h2>{data.title}</h2>
      <button onClick={onUpdate}>Update</button>
    </div>
  );
});

// 
const MyComponent = React.memo(
  ({ user }) => {
    return <div>{user.name}</div>;
  },
  (prevProps, nextProps) => {
    // true
    return prevProps.user.id === nextProps.user.id;
  }
);

//  
function Parent() {
  return <ExpensiveComponent data={{ title: 'Hello' }} />;
}

//  useMemo
function Parent() {
  const data = useMemo(() => ({ title: 'Hello' }), []);
  return <ExpensiveComponent data={data} />;
}
```

### useMemouseCallback

```jsx
import { useMemo, useCallback, useState } from 'react';

function SearchResults({ query }) {
  const [filter, setFilter] = useState('all');
  
  //  
  const filteredResults = expensiveFilter(query, filter);
  
  //  
  const filteredResults = useMemo(
    () => expensiveFilter(query, filter),
    [query, filter]
  );
  
  //  
  const handleClick = () => {
    console.log('clicked');
  };
  
  //  
  const handleClick = useCallback(() => {
    console.log('clicked');
  }, []);
  
  return (
    <div>
      <ResultList results={filteredResults} onClick={handleClick} />
    </div>
  );
}

// 
function DataTable({ data, sortBy, filterBy }) {
  const processedData = useMemo(() => {
    console.log('Processing data...');
    return data
      .filter(item => item.category === filterBy)
      .sort((a, b) => a[sortBy] - b[sortBy])
      .map(item => ({
        ...item,
        displayName: `${item.firstName} ${item.lastName}`
      }));
  }, [data, sortBy, filterBy]);
  
  return (
    <table>
      {processedData.map(item => (
        <tr key={item.id}>
          <td>{item.displayName}</td>
        </tr>
      ))}
    </table>
  );
}
```

### 

```jsx
//  
function Parent() {
  return (
    <Child
      style={{ color: 'red' }}
      onClick={() => console.log('clicked')}
    />
  );
}

//  useMemo/useCallback
const style = { color: 'red' };

function Parent() {
  const handleClick = useCallback(() => {
    console.log('clicked');
  }, []);
  
  return <Child style={style} onClick={handleClick} />;
}
```

## 

### 

```jsx
import { FixedSizeList } from 'react-window';

// 
function VirtualList({ items }) {
  const Row = ({ index, style }) => (
    <div style={style}>
      {items[index].name}
    </div>
  );
  
  return (
    <FixedSizeList
      height={600}
      itemCount={items.length}
      itemSize={50}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
}

// react-virtualized
import { List, AutoSizer } from 'react-virtualized';

function AdvancedList({ items }) {
  const rowRenderer = ({ key, index, style }) => (
    <div key={key} style={style}>
      <h3>{items[index].title}</h3>
      <p>{items[index].description}</p>
    </div>
  );
  
  return (
    <AutoSizer>
      {({ height, width }) => (
        <List
          width={width}
          height={height}
          rowCount={items.length}
          rowHeight={100}
          rowRenderer={rowRenderer}
        />
      )}
    </AutoSizer>
  );
}
```

### key

```jsx
//  key
{items.map((item, index) => (
  <Item key={index} data={item} />
))}

//  ID
{items.map(item => (
  <Item key={item.id} data={item} />
))}

//  
{items.map(item => (
  <Item key={Math.random()} data={item} />
))}

//  
{items.map(item => (
  <Item key={`${item.type}-${item.id}`} data={item} />
))}
```

## 

### React.lazySuspense

```jsx
import { lazy, Suspense } from 'react';

// 
const HeavyComponent = lazy(() => import('./HeavyComponent'));
const Dashboard = lazy(() => import('./Dashboard'));
const Profile = lazy(() => import('./Profile'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/dashboard" element={<Dashboard />} />
        <Route path="/profile" element={<Profile />} />
      </Routes>
    </Suspense>
  );
}

// 
function Navigation() {
  const handleMouseEnter = () => {
    // 
    import('./Dashboard');
  };
  
  return (
    <nav>
      <Link to="/dashboard" onMouseEnter={handleMouseEnter}>
        Dashboard
      </Link>
    </nav>
  );
}
```

### 

```jsx
// 
function Editor() {
  const [showPreview, setShowPreview] = useState(false);
  const [Preview, setPreview] = useState(null);
  
  const loadPreview = async () => {
    if (!Preview) {
      const module = await import('./Preview');
      setPreview(() => module.default);
    }
    setShowPreview(true);
  };
  
  return (
    <div>
      <textarea />
      <button onClick={loadPreview}>Show Preview</button>
      {showPreview && Preview && <Preview />}
    </div>
  );
}
```

## 

### Context

```jsx
//  Context
const AppContext = createContext();

function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
  return (
    <AppContext.Provider value={{ user, setUser, theme, setTheme }}>
      {children}
    </AppContext.Provider>
  );
}

//  1Context
const UserContext = createContext();
const ThemeContext = createContext();

function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
  return (
    <UserContext.Provider value={{ user, setUser }}>
      <ThemeContext.Provider value={{ theme, setTheme }}>
        {children}
      </ThemeContext.Provider>
    </UserContext.Provider>
  );
}

//  2useMemovalue
function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
  const userValue = useMemo(() => ({ user, setUser }), [user]);
  const themeValue = useMemo(() => ({ theme, setTheme }), [theme]);
  
  return (
    <UserContext.Provider value={userValue}>
      <ThemeContext.Provider value={themeValue}>
        {children}
      </ThemeContext.Provider>
    </UserContext.Provider>
  );
}

//  3
function useUserSelector(selector) {
  const { user } = useContext(UserContext);
  return useMemo(() => selector(user), [user, selector]);
}

function UserName() {
  const name = useUserSelector(user => user?.name);
  return <div>{name}</div>;
}
```

### 

```jsx
//  
function Parent() {
  const [count, setCount] = useState(0);
  const [text, setText] = useState('');
  
  return (
    <div>
      <Counter count={count} setCount={setCount} />
      <Input text={text} setText={setText} />
      <ExpensiveComponent />  {/* counttext */}
    </div>
  );
}

//  
function Parent() {
  return (
    <div>
      <CounterContainer />
      <InputContainer />
      <ExpensiveComponent />  {/*  */}
    </div>
  );
}

function CounterContainer() {
  const [count, setCount] = useState(0);
  return <Counter count={count} setCount={setCount} />;
}
```

## 

### 

```jsx
import { unstable_batchedUpdates } from 'react-dom';

// React 18
function handleClick() {
  unstable_batchedUpdates(() => {
    setCount(c => c + 1);
    setFlag(f => !f);
    // 
  });
}

// React 18
async function handleClick() {
  setCount(c => c + 1);
  setFlag(f => !f);
  // 
  
  await fetch('/api');
  setData(newData);  // 
}

// 
import { flushSync } from 'react-dom';

function handleClick() {
  flushSync(() => {
    setCount(c => c + 1);
  });
  // 
  
  setFlag(f => !f);
  // 
}
```

### 

```jsx
import { useMemo, useCallback } from 'react';
import { debounce, throttle } from 'lodash';

function SearchInput() {
  //  
  const handleSearch = debounce((value) => {
    console.log('Searching:', value);
  }, 300);
  
  //  useMemo
  const handleSearch = useMemo(
    () => debounce((value) => {
      console.log('Searching:', value);
    }, 300),
    []
  );
  
  // 
  useEffect(() => {
    return () => {
      handleSearch.cancel();
    };
  }, [handleSearch]);
  
  return <input onChange={e => handleSearch(e.target.value)} />;
}

// Hook
function useDebounce(callback, delay) {
  const callbackRef = useRef(callback);
  
  useEffect(() => {
    callbackRef.current = callback;
  }, [callback]);
  
  return useMemo(
    () => debounce((...args) => callbackRef.current(...args), delay),
    [delay]
  );
}

// 
function SearchInput() {
  const handleSearch = useDebounce((value) => {
    console.log('Searching:', value);
  }, 300);
  
  return <input onChange={e => handleSearch(e.target.value)} />;
}
```

## 

### 

```jsx
// Intersection Observer
function LazyImage({ src, alt, placeholder }) {
  const [imageSrc, setImageSrc] = useState(placeholder);
  const [isLoaded, setIsLoaded] = useState(false);
  const imgRef = useRef();
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setImageSrc(src);
          observer.disconnect();
        }
      },
      { threshold: 0.1 }
    );
    
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
    return () => observer.disconnect();
  }, [src]);
  
  return (
    <img
      ref={imgRef}
      src={imageSrc}
      alt={alt}
      onLoad={() => setIsLoaded(true)}
      style={{ opacity: isLoaded ? 1 : 0.5 }}
    />
  );
}

// loading="lazy"
function SimpleImage({ src, alt }) {
  return <img src={src} alt={alt} loading="lazy" />;
}
```

### 

```jsx
function ResponsiveImage({ src, alt }) {
  return (
    <picture>
      <source
        media="(min-width: 1200px)"
        srcSet={`${src}-large.jpg 1x, ${src}-large@2x.jpg 2x`}
      />
      <source
        media="(min-width: 768px)"
        srcSet={`${src}-medium.jpg 1x, ${src}-medium@2x.jpg 2x`}
      />
      <img
        src={`${src}-small.jpg`}
        srcSet={`${src}-small@2x.jpg 2x`}
        alt={alt}
        loading="lazy"
      />
    </picture>
  );
}
```

## 

### 

```jsx
// 
function ProductList({ products }) {
  const prefetchProduct = (id) => {
    // 
    queryClient.prefetchQuery(['product', id], () => fetchProduct(id));
  };
  
  return (
    <div>
      {products.map(product => (
        <Link
          key={product.id}
          to={`/product/${product.id}`}
          onMouseEnter={() => prefetchProduct(product.id)}
        >
          {product.name}
        </Link>
      ))}
    </div>
  );
}
```

### 

```jsx
// DataLoader
class DataLoader {
  constructor(batchFn, options = {}) {
    this.batchFn = batchFn;
    this.cache = new Map();
    this.queue = [];
    this.batchScheduled = false;
  }
  
  load(key) {
    if (this.cache.has(key)) {
      return Promise.resolve(this.cache.get(key));
    }
    
    return new Promise((resolve, reject) => {
      this.queue.push({ key, resolve, reject });
      
      if (!this.batchScheduled) {
        this.batchScheduled = true;
        process.nextTick(() => this.dispatch());
      }
    });
  }
  
  dispatch() {
    const queue = this.queue;
    this.queue = [];
    this.batchScheduled = false;
    
    const keys = queue.map(item => item.key);
    
    this.batchFn(keys).then(values => {
      queue.forEach((item, index) => {
        const value = values[index];
        this.cache.set(item.key, value);
        item.resolve(value);
      });
    });
  }
}

// 
const userLoader = new DataLoader(async (ids) => {
  const response = await fetch(`/api/users?ids=${ids.join(',')}`);
  return response.json();
});

function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    userLoader.load(userId).then(setUser);
  }, [userId]);
  
  return user ? <div>{user.name}</div> : <div>Loading...</div>;
}
```

## 

### 

```markdown
 React DevTools Profiler
 React.memo
 useMemo
 useCallback
 
 key
 
 React.lazySuspense
 Context
 
 
 
 
```

### 

```jsx
//  1
<Component style={{ margin: 10 }} />

//  2
<button onClick={() => handleClick(id)} />

//  3Context
<AppContext.Provider value={{ ...allAppState }} />

//  4
// 

//  5key
{items.map((item, index) => <Item key={index} />)}

//  6useEffect
useEffect(() => {
  doSomething(prop);
}, []); // prop
```

## 

React
-  
-  
-  
-  
-  

****

