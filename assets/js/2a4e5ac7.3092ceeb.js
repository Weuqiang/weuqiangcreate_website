"use strict";(globalThis.webpackChunkweuqiangcreate_website=globalThis.webpackChunkweuqiangcreate_website||[]).push([[3181],{58164(n,e,s){s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>u,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"\u5927\u6570\u636e\u6280\u672f/Hive\u6570\u636e\u4ed3\u5e93","title":"Hive - SQL on Hadoop","description":"Hive\u8ba9\u4f60\u53ef\u4ee5\u7528SQL\u67e5\u8be2HDFS\u4e0a\u7684\u6570\u636e\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60\u7528Hive\u6784\u5efa\u6570\u636e\u4ed3\u5e93\u3002","source":"@site/docs/docs/\u5927\u6570\u636e\u6280\u672f/Hive\u6570\u636e\u4ed3\u5e93.mdx","sourceDirName":"\u5927\u6570\u636e\u6280\u672f","slug":"/\u5927\u6570\u636e\u6280\u672f/Hive\u6570\u636e\u4ed3\u5e93","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/Hive\u6570\u636e\u4ed3\u5e93","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Hive - SQL on Hadoop"},"sidebar":"tutorialSidebar","previous":{"title":"Flink - \u6d41\u6279\u4e00\u4f53\u7684\u5b9e\u65f6\u8ba1\u7b97\u5f15\u64ce","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/Flink\u5b9e\u65f6\u8ba1\u7b97"},"next":{"title":"HBase - \u6d77\u91cf\u6570\u636e\u7684\u5b9e\u65f6\u67e5\u8be2","permalink":"/weuqiangcreate_website/docs/\u5927\u6570\u636e\u6280\u672f/HBase\u5217\u5f0f\u5b58\u50a8"}}');var a=s(74848),i=s(28453);const d={sidebar_position:5,title:"Hive - SQL on Hadoop"},t="Hive - \u7528SQL\u67e5\u8be2\u5927\u6570\u636e",l={},o=[{value:"\u7b2c\u4e00\u90e8\u5206\uff1a\u7406\u89e3Hive",id:"\u7b2c\u4e00\u90e8\u5206\u7406\u89e3hive",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981Hive\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981hive",level:3},{value:"Hive\u67b6\u6784",id:"hive\u67b6\u6784",level:3},{value:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u5feb\u901f\u5f00\u59cb",id:"\u7b2c\u4e8c\u90e8\u5206\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u4f7f\u7528Docker\u642d\u5efaHive",id:"\u4f7f\u7528docker\u642d\u5efahive",level:3},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c",level:3},{value:"\u7b2c\u4e09\u90e8\u5206\uff1a\u8868\u64cd\u4f5c",id:"\u7b2c\u4e09\u90e8\u5206\u8868\u64cd\u4f5c",level:2},{value:"\u521b\u5efa\u8868",id:"\u521b\u5efa\u8868",level:3},{value:"\u52a0\u8f7d\u6570\u636e",id:"\u52a0\u8f7d\u6570\u636e",level:3},{value:"\u7b2c\u56db\u90e8\u5206\uff1a\u67e5\u8be2\u64cd\u4f5c",id:"\u7b2c\u56db\u90e8\u5206\u67e5\u8be2\u64cd\u4f5c",level:2},{value:"\u57fa\u672c\u67e5\u8be2",id:"\u57fa\u672c\u67e5\u8be2",level:3},{value:"\u8fde\u63a5\u67e5\u8be2",id:"\u8fde\u63a5\u67e5\u8be2",level:3},{value:"\u5b50\u67e5\u8be2",id:"\u5b50\u67e5\u8be2",level:3},{value:"\u7a97\u53e3\u51fd\u6570",id:"\u7a97\u53e3\u51fd\u6570",level:3},{value:"\u7b2c\u4e94\u90e8\u5206\uff1a\u5206\u533a\u548c\u5206\u6876",id:"\u7b2c\u4e94\u90e8\u5206\u5206\u533a\u548c\u5206\u6876",level:2},{value:"\u5206\u533a\u8868",id:"\u5206\u533a\u8868",level:3},{value:"\u5206\u6876\u8868",id:"\u5206\u6876\u8868",level:3},{value:"\u7b2c\u516d\u90e8\u5206\uff1a\u6027\u80fd\u4f18\u5316",id:"\u7b2c\u516d\u90e8\u5206\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u6587\u4ef6\u683c\u5f0f",id:"1-\u6587\u4ef6\u683c\u5f0f",level:3},{value:"2. \u6267\u884c\u5f15\u64ce",id:"2-\u6267\u884c\u5f15\u64ce",level:3},{value:"3. \u5411\u91cf\u5316\u6267\u884c",id:"3-\u5411\u91cf\u5316\u6267\u884c",level:3},{value:"4. CBO\u4f18\u5316",id:"4-cbo\u4f18\u5316",level:3},{value:"\u7b2c\u4e03\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee",id:"\u7b2c\u4e03\u90e8\u5206\u5b9e\u6218\u9879\u76ee",level:2},{value:"\u9879\u76ee\uff1a\u7535\u5546\u6570\u636e\u5206\u6790",id:"\u9879\u76ee\u7535\u5546\u6570\u636e\u5206\u6790",level:3},{value:"\u9879\u76ee\uff1a\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790",id:"\u9879\u76ee\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790",level:3},{value:"\u7b2c\u516b\u90e8\u5206\uff1aUDF\u81ea\u5b9a\u4e49\u51fd\u6570",id:"\u7b2c\u516b\u90e8\u5206udf\u81ea\u5b9a\u4e49\u51fd\u6570",level:2},{value:"Python UDF",id:"python-udf",level:3},{value:"Java UDF",id:"java-udf",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u7ec3\u4e60\u9898",id:"\u7ec3\u4e60\u9898",level:2}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"hive---\u7528sql\u67e5\u8be2\u5927\u6570\u636e",children:"Hive - \u7528SQL\u67e5\u8be2\u5927\u6570\u636e"})}),"\n",(0,a.jsxs)(e.p,{children:["Hive\u8ba9\u4f60\u53ef\u4ee5\u7528SQL\u67e5\u8be2HDFS\u4e0a\u7684\u6570\u636e\u3002\u8fd9\u4e00\u7ae0\u6559\u4f60",(0,a.jsx)(e.strong,{children:"\u7528Hive\u6784\u5efa\u6570\u636e\u4ed3\u5e93"}),"\u3002"]}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u4e00\u90e8\u5206\u7406\u89e3hive",children:"\u7b2c\u4e00\u90e8\u5206\uff1a\u7406\u89e3Hive"}),"\n",(0,a.jsx)(e.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981hive",children:"\u4e3a\u4ec0\u4e48\u9700\u8981Hive\uff1f"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"\u95ee\u9898"}),"\uff1aHDFS\u4e0a\u6709TB\u7ea7\u6570\u636e\uff0c\u60f3\u505a\u7edf\u8ba1\u5206\u6790\uff0c\u4f46\u4e0d\u4f1a\u5199MapReduce\u600e\u4e48\u529e\uff1f"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"\u4f20\u7edf\u65b9\u5f0f"}),"\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"# \u5199MapReduce - \u592a\u590d\u6742\uff01\nclass Mapper:\n    def map(self, key, value):\n        # 100\u884c\u4ee3\u7801...\n"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"Hive\u65b9\u5f0f"}),"\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u7528SQL - \u7b80\u5355\uff01\nSELECT category, COUNT(*) as count\nFROM products\nGROUP BY category;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"hive\u67b6\u6784",children:"Hive\u67b6\u6784"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Client\uff08\u5ba2\u6237\u7aef\uff09            \u2502\n\u2502      JDBC/ODBC/CLI                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Hive Server                \u2502\n\u2502      \u89e3\u6790SQL\u3001\u751f\u6210\u6267\u884c\u8ba1\u5212           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Metastore                  \u2502\n\u2502      \u5b58\u50a8\u8868\u7ed3\u6784\u3001\u5206\u533a\u4fe1\u606f            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Execution Engine           \u2502\n\u2502      MapReduce/Spark/Tez            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          HDFS                       \u2502\n\u2502      \u5b58\u50a8\u5b9e\u9645\u6570\u636e                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u4e8c\u90e8\u5206\u5feb\u901f\u5f00\u59cb",children:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u5feb\u901f\u5f00\u59cb"}),"\n",(0,a.jsx)(e.h3,{id:"\u4f7f\u7528docker\u642d\u5efahive",children:"\u4f7f\u7528Docker\u642d\u5efaHive"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:'# docker-compose.yml\nversion: \'3\'\nservices:\n  namenode:\n    image: bde2020/hadoop-namenode:2.0.0-hadoop3.2.1-java8\n    environment:\n      - CLUSTER_NAME=test\n    ports:\n      - "9870:9870"\n      - "9000:9000"\n\n  datanode:\n    image: bde2020/hadoop-datanode:2.0.0-hadoop3.2.1-java8\n    environment:\n      - CORE_CONF_fs_defaultFS=hdfs://namenode:9000\n\n  hive-server:\n    image: bde2020/hive:2.3.2-postgresql-metastore\n    environment:\n      - HIVE_CORE_CONF_javax_jdo_option_ConnectionURL=jdbc:postgresql://hive-metastore/metastore\n    ports:\n      - "10000:10000"\n    depends_on:\n      - hive-metastore\n\n  hive-metastore:\n    image: bde2020/hive:2.3.2-postgresql-metastore\n    environment:\n      - SERVICE_PRECONDITION=namenode:9870 datanode:9864 hive-metastore-postgresql:5432\n    ports:\n      - "9083:9083"\n\n  hive-metastore-postgresql:\n    image: bde2020/hive-metastore-postgresql:2.3.0\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8\ndocker-compose up -d\n\n# \u8fdb\u5165Hive\ndocker exec -it hive-server bash\nhive\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u57fa\u672c\u64cd\u4f5c",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u6570\u636e\u5e93\nCREATE DATABASE IF NOT EXISTS mydb;\n\n-- \u4f7f\u7528\u6570\u636e\u5e93\nUSE mydb;\n\n-- \u67e5\u770b\u6570\u636e\u5e93\nSHOW DATABASES;\n\n-- \u5220\u9664\u6570\u636e\u5e93\nDROP DATABASE IF EXISTS mydb CASCADE;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u4e09\u90e8\u5206\u8868\u64cd\u4f5c",children:"\u7b2c\u4e09\u90e8\u5206\uff1a\u8868\u64cd\u4f5c"}),"\n",(0,a.jsx)(e.h3,{id:"\u521b\u5efa\u8868",children:"\u521b\u5efa\u8868"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5185\u90e8\u8868\uff08\u7ba1\u7406\u8868\uff09\nCREATE TABLE users (\n    user_id INT,\n    name STRING,\n    age INT,\n    city STRING,\n    register_date DATE\n)\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ','\nSTORED AS TEXTFILE;\n\n-- \u5916\u90e8\u8868\nCREATE EXTERNAL TABLE logs (\n    timestamp STRING,\n    level STRING,\n    message STRING\n)\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY '\\t'\nLOCATION '/user/logs/';\n\n-- \u5206\u533a\u8868\nCREATE TABLE orders (\n    order_id STRING,\n    user_id STRING,\n    amount DOUBLE,\n    status STRING\n)\nPARTITIONED BY (date STRING, hour STRING)\nSTORED AS PARQUET;\n\n-- \u5206\u6876\u8868\nCREATE TABLE products (\n    product_id STRING,\n    name STRING,\n    price DOUBLE,\n    category STRING\n)\nCLUSTERED BY (product_id) INTO 10 BUCKETS\nSTORED AS ORC;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u52a0\u8f7d\u6570\u636e",children:"\u52a0\u8f7d\u6570\u636e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u4ece\u672c\u5730\u6587\u4ef6\u52a0\u8f7d\nLOAD DATA LOCAL INPATH '/tmp/users.csv' \nINTO TABLE users;\n\n-- \u4eceHDFS\u52a0\u8f7d\nLOAD DATA INPATH '/user/data/users.csv' \nINTO TABLE users;\n\n-- \u63d2\u5165\u6570\u636e\nINSERT INTO TABLE users \nVALUES (1, 'Alice', 25, 'Beijing', '2024-01-01');\n\n-- \u4ece\u67e5\u8be2\u7ed3\u679c\u63d2\u5165\nINSERT INTO TABLE users\nSELECT user_id, name, age, city, register_date\nFROM temp_users\nWHERE age > 18;\n\n-- \u8986\u76d6\u63d2\u5165\nINSERT OVERWRITE TABLE users\nSELECT * FROM temp_users;\n\n-- \u52a8\u6001\u5206\u533a\u63d2\u5165\nSET hive.exec.dynamic.partition=true;\nSET hive.exec.dynamic.partition.mode=nonstrict;\n\nINSERT INTO TABLE orders PARTITION(date, hour)\nSELECT order_id, user_id, amount, status, \n       DATE(order_time) as date,\n       HOUR(order_time) as hour\nFROM raw_orders;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u56db\u90e8\u5206\u67e5\u8be2\u64cd\u4f5c",children:"\u7b2c\u56db\u90e8\u5206\uff1a\u67e5\u8be2\u64cd\u4f5c"}),"\n",(0,a.jsx)(e.h3,{id:"\u57fa\u672c\u67e5\u8be2",children:"\u57fa\u672c\u67e5\u8be2"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u7b80\u5355\u67e5\u8be2\nSELECT * FROM users LIMIT 10;\n\n-- \u6761\u4ef6\u8fc7\u6ee4\nSELECT name, age, city\nFROM users\nWHERE age > 25 AND city = 'Beijing';\n\n-- \u6392\u5e8f\nSELECT name, age\nFROM users\nORDER BY age DESC\nLIMIT 10;\n\n-- \u5206\u7ec4\u805a\u5408\nSELECT city, COUNT(*) as user_count, AVG(age) as avg_age\nFROM users\nGROUP BY city\nHAVING user_count > 100\nORDER BY user_count DESC;\n\n-- \u53bb\u91cd\nSELECT DISTINCT city FROM users;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u8fde\u63a5\u67e5\u8be2",children:"\u8fde\u63a5\u67e5\u8be2"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5185\u8fde\u63a5\nSELECT u.name, o.order_id, o.amount\nFROM users u\nJOIN orders o ON u.user_id = o.user_id;\n\n-- \u5de6\u8fde\u63a5\nSELECT u.name, o.order_id, o.amount\nFROM users u\nLEFT JOIN orders o ON u.user_id = o.user_id;\n\n-- \u591a\u8868\u8fde\u63a5\nSELECT u.name, o.order_id, p.product_name, od.quantity\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nJOIN order_details od ON o.order_id = od.order_id\nJOIN products p ON od.product_id = p.product_id;\n\n-- Map Join\uff08\u5c0f\u8868\u5e7f\u64ad\uff09\nSELECT /*+ MAPJOIN(small_table) */\n    a.*, b.*\nFROM large_table a\nJOIN small_table b ON a.key = b.key;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u5b50\u67e5\u8be2",children:"\u5b50\u67e5\u8be2"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- WHERE\u5b50\u67e5\u8be2\nSELECT name, age\nFROM users\nWHERE user_id IN (\n    SELECT user_id \n    FROM orders \n    WHERE amount > 1000\n);\n\n-- FROM\u5b50\u67e5\u8be2\nSELECT city, avg_age\nFROM (\n    SELECT city, AVG(age) as avg_age\n    FROM users\n    GROUP BY city\n) t\nWHERE avg_age > 30;\n\n-- WITH\u5b50\u53e5\uff08CTE\uff09\nWITH high_value_users AS (\n    SELECT user_id, SUM(amount) as total_amount\n    FROM orders\n    GROUP BY user_id\n    HAVING total_amount > 10000\n)\nSELECT u.name, h.total_amount\nFROM users u\nJOIN high_value_users h ON u.user_id = h.user_id;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u7a97\u53e3\u51fd\u6570",children:"\u7a97\u53e3\u51fd\u6570"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- ROW_NUMBER\uff1a\u6392\u540d\nSELECT \n    name,\n    city,\n    age,\n    ROW_NUMBER() OVER (PARTITION BY city ORDER BY age DESC) as rank\nFROM users;\n\n-- RANK\uff1a\u6392\u540d\uff08\u5141\u8bb8\u5e76\u5217\uff09\nSELECT \n    product_name,\n    category,\n    sales,\n    RANK() OVER (PARTITION BY category ORDER BY sales DESC) as rank\nFROM products;\n\n-- LAG/LEAD\uff1a\u8bbf\u95ee\u524d\u540e\u884c\nSELECT \n    date,\n    sales,\n    LAG(sales, 1) OVER (ORDER BY date) as prev_sales,\n    LEAD(sales, 1) OVER (ORDER BY date) as next_sales\nFROM daily_sales;\n\n-- \u7d2f\u8ba1\u548c\nSELECT \n    date,\n    amount,\n    SUM(amount) OVER (ORDER BY date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) as cumsum\nFROM orders;\n\n-- \u79fb\u52a8\u5e73\u5747\nSELECT \n    date,\n    value,\n    AVG(value) OVER (ORDER BY date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as ma7\nFROM metrics;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u4e94\u90e8\u5206\u5206\u533a\u548c\u5206\u6876",children:"\u7b2c\u4e94\u90e8\u5206\uff1a\u5206\u533a\u548c\u5206\u6876"}),"\n",(0,a.jsx)(e.h3,{id:"\u5206\u533a\u8868",children:"\u5206\u533a\u8868"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u5206\u533a\u8868\nCREATE TABLE logs (\n    timestamp STRING,\n    level STRING,\n    message STRING\n)\nPARTITIONED BY (date STRING, hour STRING)\nSTORED AS PARQUET;\n\n-- \u6dfb\u52a0\u5206\u533a\nALTER TABLE logs ADD PARTITION (date='2024-01-01', hour='00');\n\n-- \u67e5\u770b\u5206\u533a\nSHOW PARTITIONS logs;\n\n-- \u5220\u9664\u5206\u533a\nALTER TABLE logs DROP PARTITION (date='2024-01-01', hour='00');\n\n-- \u67e5\u8be2\u7279\u5b9a\u5206\u533a\nSELECT * FROM logs\nWHERE date='2024-01-01' AND hour='00';\n\n-- \u5206\u533a\u88c1\u526a\uff08\u53ea\u626b\u63cf\u9700\u8981\u7684\u5206\u533a\uff09\nSELECT COUNT(*) FROM logs\nWHERE date BETWEEN '2024-01-01' AND '2024-01-07';\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u5206\u6876\u8868",children:"\u5206\u6876\u8868"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u5206\u6876\u8868\nCREATE TABLE users_bucketed (\n    user_id INT,\n    name STRING,\n    age INT\n)\nCLUSTERED BY (user_id) INTO 10 BUCKETS\nSTORED AS ORC;\n\n-- \u63d2\u5165\u6570\u636e\uff08\u9700\u8981\u8bbe\u7f6e\uff09\nSET hive.enforce.bucketing=true;\n\nINSERT INTO TABLE users_bucketed\nSELECT user_id, name, age FROM users;\n\n-- \u5206\u6876\u8868\u7684\u4f18\u52bf\uff1a\u9ad8\u6548\u91c7\u6837\nSELECT * FROM users_bucketed\nTABLESAMPLE(BUCKET 1 OUT OF 10 ON user_id);\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u516d\u90e8\u5206\u6027\u80fd\u4f18\u5316",children:"\u7b2c\u516d\u90e8\u5206\uff1a\u6027\u80fd\u4f18\u5316"}),"\n",(0,a.jsx)(e.h3,{id:"1-\u6587\u4ef6\u683c\u5f0f",children:"1. \u6587\u4ef6\u683c\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:'-- Parquet\uff1a\u5217\u5f0f\u5b58\u50a8\uff0c\u538b\u7f29\u7387\u9ad8\nCREATE TABLE data_parquet (\n    id INT,\n    name STRING,\n    value DOUBLE\n)\nSTORED AS PARQUET;\n\n-- ORC\uff1a\u4f18\u5316\u7684\u5217\u5f0f\u5b58\u50a8\nCREATE TABLE data_orc (\n    id INT,\n    name STRING,\n    value DOUBLE\n)\nSTORED AS ORC\nTBLPROPERTIES ("orc.compress"="SNAPPY");\n\n-- \u6027\u80fd\u5bf9\u6bd4\n-- TextFile: 1GB\n-- Parquet: 200MB (5x\u538b\u7f29)\n-- ORC: 150MB (6.7x\u538b\u7f29)\n'})}),"\n",(0,a.jsx)(e.h3,{id:"2-\u6267\u884c\u5f15\u64ce",children:"2. \u6267\u884c\u5f15\u64ce"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u4f7f\u7528Tez\uff08\u6bd4MapReduce\u5feb3-10\u500d\uff09\nSET hive.execution.engine=tez;\n\n-- \u4f7f\u7528Spark\nSET hive.execution.engine=spark;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3-\u5411\u91cf\u5316\u6267\u884c",children:"3. \u5411\u91cf\u5316\u6267\u884c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5f00\u542f\u5411\u91cf\u5316\nSET hive.vectorized.execution.enabled=true;\nSET hive.vectorized.execution.reduce.enabled=true;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"4-cbo\u4f18\u5316",children:"4. CBO\u4f18\u5316"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u6536\u96c6\u7edf\u8ba1\u4fe1\u606f\nANALYZE TABLE users COMPUTE STATISTICS;\nANALYZE TABLE users COMPUTE STATISTICS FOR COLUMNS;\n\n-- \u5f00\u542fCBO\nSET hive.cbo.enable=true;\nSET hive.compute.query.using.stats=true;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u4e03\u90e8\u5206\u5b9e\u6218\u9879\u76ee",children:"\u7b2c\u4e03\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee"}),"\n",(0,a.jsx)(e.h3,{id:"\u9879\u76ee\u7535\u5546\u6570\u636e\u5206\u6790",children:"\u9879\u76ee\uff1a\u7535\u5546\u6570\u636e\u5206\u6790"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- 1. \u521b\u5efa\u8868\u7ed3\u6784\n\n-- \u7528\u6237\u8868\nCREATE TABLE users (\n    user_id STRING,\n    name STRING,\n    age INT,\n    gender STRING,\n    city STRING,\n    register_date DATE\n)\nSTORED AS PARQUET;\n\n-- \u5546\u54c1\u8868\nCREATE TABLE products (\n    product_id STRING,\n    name STRING,\n    category STRING,\n    price DOUBLE\n)\nSTORED AS PARQUET;\n\n-- \u8ba2\u5355\u8868\uff08\u5206\u533a\uff09\nCREATE TABLE orders (\n    order_id STRING,\n    user_id STRING,\n    product_id STRING,\n    quantity INT,\n    amount DOUBLE,\n    order_time TIMESTAMP\n)\nPARTITIONED BY (date STRING)\nSTORED AS PARQUET;\n\n-- 2. \u6570\u636e\u5206\u6790\n\n-- \u6bcf\u65e5\u9500\u552e\u7edf\u8ba1\nSELECT \n    date,\n    COUNT(DISTINCT order_id) as order_count,\n    COUNT(DISTINCT user_id) as user_count,\n    SUM(amount) as total_amount,\n    AVG(amount) as avg_amount\nFROM orders\nGROUP BY date\nORDER BY date;\n\n-- \u5546\u54c1\u9500\u552e\u6392\u884c\nSELECT \n    p.name,\n    p.category,\n    COUNT(o.order_id) as order_count,\n    SUM(o.quantity) as total_quantity,\n    SUM(o.amount) as total_amount\nFROM orders o\nJOIN products p ON o.product_id = p.product_id\nWHERE o.date >= '2024-01-01'\nGROUP BY p.name, p.category\nORDER BY total_amount DESC\nLIMIT 20;\n\n-- \u7528\u6237\u4ef7\u503c\u5206\u6790\uff08RFM\uff09\nWITH user_rfm AS (\n    SELECT \n        user_id,\n        DATEDIFF(CURRENT_DATE, MAX(order_time)) as recency,\n        COUNT(order_id) as frequency,\n        SUM(amount) as monetary\n    FROM orders\n    GROUP BY user_id\n)\nSELECT \n    user_id,\n    recency,\n    frequency,\n    monetary,\n    CASE \n        WHEN recency <= 30 AND frequency >= 10 AND monetary >= 10000 THEN '\u9ad8\u4ef7\u503c'\n        WHEN recency <= 90 AND frequency >= 5 AND monetary >= 5000 THEN '\u4e2d\u4ef7\u503c'\n        ELSE '\u4f4e\u4ef7\u503c'\n    END as user_level\nFROM user_rfm;\n\n-- \u7528\u6237\u7559\u5b58\u5206\u6790\nWITH first_order AS (\n    SELECT \n        user_id,\n        MIN(date) as first_date\n    FROM orders\n    GROUP BY user_id\n),\nretention AS (\n    SELECT \n        f.first_date,\n        DATEDIFF(o.date, f.first_date) as days_since_first,\n        COUNT(DISTINCT o.user_id) as retained_users\n    FROM first_order f\n    JOIN orders o ON f.user_id = o.user_id\n    GROUP BY f.first_date, DATEDIFF(o.date, f.first_date)\n)\nSELECT \n    first_date,\n    days_since_first,\n    retained_users,\n    retained_users * 100.0 / FIRST_VALUE(retained_users) OVER (PARTITION BY first_date ORDER BY days_since_first) as retention_rate\nFROM retention\nORDER BY first_date, days_since_first;\n\n-- \u5546\u54c1\u5173\u8054\u5206\u6790\nSELECT \n    a.product_id as product_a,\n    b.product_id as product_b,\n    COUNT(*) as co_purchase_count\nFROM (\n    SELECT order_id, product_id FROM orders\n) a\nJOIN (\n    SELECT order_id, product_id FROM orders\n) b ON a.order_id = b.order_id AND a.product_id < b.product_id\nGROUP BY a.product_id, b.product_id\nHAVING co_purchase_count >= 10\nORDER BY co_purchase_count DESC\nLIMIT 50;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u9879\u76ee\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790",children:"\u9879\u76ee\uff1a\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u7528\u6237\u884c\u4e3a\u8868\nCREATE TABLE user_behavior (\n    user_id STRING,\n    action STRING,  -- view, click, cart, purchase\n    item_id STRING,\n    timestamp TIMESTAMP\n)\nPARTITIONED BY (date STRING)\nSTORED AS PARQUET;\n\n-- \u6f0f\u6597\u5206\u6790\nWITH funnel AS (\n    SELECT \n        date,\n        COUNT(DISTINCT CASE WHEN action = 'view' THEN user_id END) as view_users,\n        COUNT(DISTINCT CASE WHEN action = 'click' THEN user_id END) as click_users,\n        COUNT(DISTINCT CASE WHEN action = 'cart' THEN user_id END) as cart_users,\n        COUNT(DISTINCT CASE WHEN action = 'purchase' THEN user_id END) as purchase_users\n    FROM user_behavior\n    GROUP BY date\n)\nSELECT \n    date,\n    view_users,\n    click_users,\n    cart_users,\n    purchase_users,\n    click_users * 100.0 / view_users as view_to_click_rate,\n    cart_users * 100.0 / click_users as click_to_cart_rate,\n    purchase_users * 100.0 / cart_users as cart_to_purchase_rate\nFROM funnel\nORDER BY date;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7b2c\u516b\u90e8\u5206udf\u81ea\u5b9a\u4e49\u51fd\u6570",children:"\u7b2c\u516b\u90e8\u5206\uff1aUDF\u81ea\u5b9a\u4e49\u51fd\u6570"}),"\n",(0,a.jsx)(e.h3,{id:"python-udf",children:"Python UDF"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"# my_udf.py\nimport sys\n\n# \u8bfb\u53d6\u8f93\u5165\nfor line in sys.stdin:\n    line = line.strip()\n    # \u5904\u7406\u903b\u8f91\n    result = line.upper()\n    print(result)\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u6dfb\u52a0\u811a\u672c\nADD FILE /path/to/my_udf.py;\n\n-- \u4f7f\u7528UDF\nSELECT TRANSFORM(name)\nUSING 'python my_udf.py'\nAS upper_name\nFROM users;\n"})}),"\n",(0,a.jsx)(e.h3,{id:"java-udf",children:"Java UDF"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"// MyUDF.java\nimport org.apache.hadoop.hive.ql.exec.UDF;\n\npublic class MyUDF extends UDF {\n    public String evaluate(String input) {\n        if (input == null) return null;\n        return input.toUpperCase();\n    }\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u51fd\u6570\nCREATE FUNCTION my_upper AS 'com.example.MyUDF'\nUSING JAR 'hdfs:///user/hive/lib/my-udf.jar';\n\n-- \u4f7f\u7528\u51fd\u6570\nSELECT my_upper(name) FROM users;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,a.jsx)(e.p,{children:"Hive\u8ba9\u5927\u6570\u636e\u5206\u6790\u53d8\u7b80\u5355\uff1a"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"SQL\u63a5\u53e3"}),"\uff1a\u4e0d\u9700\u8981\u5199MapReduce"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5206\u533a\u5206\u6876"}),"\uff1a\u9ad8\u6548\u67e5\u8be2"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u591a\u79cd\u683c\u5f0f"}),"\uff1aParquet\u3001ORC\u538b\u7f29\u5b58\u50a8"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u53ef\u6269\u5c55"}),"\uff1aUDF\u81ea\u5b9a\u4e49\u51fd\u6570"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["\u8bb0\u4f4f\uff1a",(0,a.jsx)(e.strong,{children:"Hive\u662f\u6570\u636e\u4ed3\u5e93\uff0c\u4e0d\u662f\u6570\u636e\u5e93"}),"\uff01"]}),"\n",(0,a.jsx)(e.h2,{id:"\u7ec3\u4e60\u9898",children:"\u7ec3\u4e60\u9898"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsx)(e.li,{children:"\u8bbe\u8ba1\u4e00\u4e2a\u7535\u5546\u6570\u636e\u4ed3\u5e93"}),"\n",(0,a.jsx)(e.li,{children:"\u5b9e\u73b0\u7528\u6237\u753b\u50cf\u5206\u6790"}),"\n",(0,a.jsx)(e.li,{children:"\u4f18\u5316\u6162\u67e5\u8be2"}),"\n",(0,a.jsx)(e.li,{children:"\u5b9e\u73b0\u81ea\u5b9a\u4e49UDF"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"\u4e0b\u4e00\u7ae0\uff1aHBase\u5217\u5f0f\u5b58\u50a8\uff08\u5373\u5c06\u63a8\u51fa\uff09"})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},28453(n,e,s){s.d(e,{R:()=>d,x:()=>t});var r=s(96540);const a={},i=r.createContext(a);function d(n){const e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:d(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);