---
sidebar_position: 7
title: å‰ç«¯æµ‹è¯•å®Œå…¨æŒ‡å—
tags: [å‰ç«¯, æµ‹è¯•, Jest, React Testing Library, E2E]
---

# å‰ç«¯æµ‹è¯•å®Œå…¨æŒ‡å—

å‰ç«¯æµ‹è¯•æ˜¯ä¿è¯ä»£ç è´¨é‡çš„é‡è¦æ‰‹æ®µï¼Œæœ¬æ–‡å°†è¯¦ç»†è®²è§£å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’ŒE2Eæµ‹è¯•çš„å®è·µæ–¹æ³•ã€‚

## æµ‹è¯•é‡‘å­—å¡”

```javascript
const testPyramid = {
  // æµ‹è¯•é‡‘å­—å¡”ç»“æ„
  structure: {
    e2e: {
      level: 'é¡¶å±‚',
      percentage: '10%',
      cost: 'é«˜',
      speed: 'æ…¢',
      coverage: 'ç«¯åˆ°ç«¯æµç¨‹'
    },
    integration: {
      level: 'ä¸­å±‚',
      percentage: '20%',
      cost: 'ä¸­',
      speed: 'ä¸­',
      coverage: 'ç»„ä»¶äº¤äº’'
    },
    unit: {
      level: 'åº•å±‚',
      percentage: '70%',
      cost: 'ä½',
      speed: 'å¿«',
      coverage: 'å‡½æ•°ã€ç»„ä»¶'
    }
  },
  
  principles: [
    'å•å…ƒæµ‹è¯•æ•°é‡æœ€å¤šï¼Œé€Ÿåº¦æœ€å¿«',
    'é›†æˆæµ‹è¯•è¦†ç›–ç»„ä»¶äº¤äº’',
    'E2Eæµ‹è¯•è¦†ç›–å…³é”®ä¸šåŠ¡æµç¨‹',
    'æµ‹è¯•åº”è¯¥å¿«é€Ÿã€å¯é ã€ç‹¬ç«‹'
  ]
};
```

## å•å…ƒæµ‹è¯•

### JeståŸºç¡€

```javascript
// sum.js
export function sum(a, b) {
  return a + b;
}

// sum.test.js
import { sum } from './sum';

describe('sumå‡½æ•°', () => {
  test('1 + 2 = 3', () => {
    expect(sum(1, 2)).toBe(3);
  });
  
  test('è´Ÿæ•°ç›¸åŠ ', () => {
    expect(sum(-1, -2)).toBe(-3);
  });
  
  test('æµ®ç‚¹æ•°ç›¸åŠ ', () => {
    expect(sum(0.1, 0.2)).toBeCloseTo(0.3);
  });
});

// å¸¸ç”¨åŒ¹é…å™¨
describe('åŒ¹é…å™¨ç¤ºä¾‹', () => {
  test('ç›¸ç­‰æ€§', () => {
    expect(2 + 2).toBe(4);                    // ä¸¥æ ¼ç›¸ç­‰
    expect({ name: 'John' }).toEqual({ name: 'John' }); // æ·±åº¦ç›¸ç­‰
  });
  
  test('çœŸå€¼', () => {
    expect(true).toBeTruthy();
    expect(false).toBeFalsy();
    expect(null).toBeNull();
    expect(undefined).toBeUndefined();
    expect('hello').toBeDefined();
  });
  
  test('æ•°å­—', () => {
    expect(10).toBeGreaterThan(5);
    expect(10).toBeGreaterThanOrEqual(10);
    expect(5).toBeLessThan(10);
    expect(5).toBeLessThanOrEqual(5);
  });
  
  test('å­—ç¬¦ä¸²', () => {
    expect('hello world').toMatch(/world/);
    expect('hello').toContain('ell');
  });
  
  test('æ•°ç»„', () => {
    expect([1, 2, 3]).toContain(2);
    expect([1, 2, 3]).toHaveLength(3);
  });
  
  test('å¯¹è±¡', () => {
    expect({ name: 'John', age: 30 }).toHaveProperty('name');
    expect({ name: 'John', age: 30 }).toHaveProperty('name', 'John');
  });
  
  test('å¼‚å¸¸', () => {
    expect(() => {
      throw new Error('é”™è¯¯');
    }).toThrow('é”™è¯¯');
  });
});
```

### å¼‚æ­¥æµ‹è¯•

```javascript
// api.js
export async function fetchUser(id) {
  const response = await fetch(`/api/users/${id}`);
  return response.json();
}

// api.test.js
import { fetchUser } from './api';

describe('fetchUser', () => {
  // æ–¹å¼1ï¼šè¿”å›Promise
  test('è·å–ç”¨æˆ·ä¿¡æ¯', () => {
    return fetchUser(1).then(user => {
      expect(user.name).toBe('John');
    });
  });
  
  // æ–¹å¼2ï¼šasync/await
  test('è·å–ç”¨æˆ·ä¿¡æ¯', async () => {
    const user = await fetchUser(1);
    expect(user.name).toBe('John');
  });
  
  // æ–¹å¼3ï¼šresolves/rejects
  test('è·å–ç”¨æˆ·ä¿¡æ¯', () => {
    return expect(fetchUser(1)).resolves.toEqual({
      id: 1,
      name: 'John'
    });
  });
  
  test('å¤„ç†é”™è¯¯', () => {
    return expect(fetchUser(-1)).rejects.toThrow('User not found');
  });
});
```

### Mockå’ŒSpy

```javascript
// æ¨¡æ‹Ÿå‡½æ•°
describe('Mockå‡½æ•°', () => {
  test('è·Ÿè¸ªå‡½æ•°è°ƒç”¨', () => {
    const mockFn = jest.fn();
    
    mockFn('hello');
    mockFn('world');
    
    expect(mockFn).toHaveBeenCalledTimes(2);
    expect(mockFn).toHaveBeenCalledWith('hello');
    expect(mockFn).toHaveBeenLastCalledWith('world');
  });
  
  test('æ¨¡æ‹Ÿè¿”å›å€¼', () => {
    const mockFn = jest.fn()
      .mockReturnValue(42)
      .mockReturnValueOnce(1)
      .mockReturnValueOnce(2);
    
    expect(mockFn()).toBe(1);
    expect(mockFn()).toBe(2);
    expect(mockFn()).toBe(42);
  });
  
  test('æ¨¡æ‹Ÿå®ç°', () => {
    const mockFn = jest.fn(x => x * 2);
    
    expect(mockFn(5)).toBe(10);
  });
});

// æ¨¡æ‹Ÿæ¨¡å—
jest.mock('./api');

import { fetchUser } from './api';

test('æ¨¡æ‹ŸAPIè°ƒç”¨', async () => {
  fetchUser.mockResolvedValue({ id: 1, name: 'John' });
  
  const user = await fetchUser(1);
  expect(user.name).toBe('John');
});

// Spy
describe('Spy', () => {
  test('ç›‘å¬å¯¹è±¡æ–¹æ³•', () => {
    const user = {
      getName: () => 'John'
    };
    
    const spy = jest.spyOn(user, 'getName');
    
    user.getName();
    
    expect(spy).toHaveBeenCalled();
    
    spy.mockRestore();
  });
});
```

## Reactç»„ä»¶æµ‹è¯•

### React Testing Library

```javascript
// Button.jsx
export function Button({ onClick, children }) {
  return (
    <button onClick={onClick}>
      {children}
    </button>
  );
}

// Button.test.jsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from './Button';

describe('Buttonç»„ä»¶', () => {
  test('æ¸²æŸ“æŒ‰é’®æ–‡æœ¬', () => {
    render(<Button>Click me</Button>);
    
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });
  
  test('ç‚¹å‡»æŒ‰é’®', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByText('Click me'));
    
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
});

// Counter.jsx
import { useState } from 'react';

export function Counter() {
  const [count, setCount] = useState(0);
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
      <button onClick={() => setCount(count - 1)}>Decrement</button>
    </div>
  );
}

// Counter.test.jsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Counter } from './Counter';

describe('Counterç»„ä»¶', () => {
  test('åˆå§‹å€¼ä¸º0', () => {
    render(<Counter />);
    expect(screen.getByText('Count: 0')).toBeInTheDocument();
  });
  
  test('ç‚¹å‡»å¢åŠ æŒ‰é’®', () => {
    render(<Counter />);
    
    fireEvent.click(screen.getByText('Increment'));
    expect(screen.getByText('Count: 1')).toBeInTheDocument();
    
    fireEvent.click(screen.getByText('Increment'));
    expect(screen.getByText('Count: 2')).toBeInTheDocument();
  });
  
  test('ç‚¹å‡»å‡å°‘æŒ‰é’®', () => {
    render(<Counter />);
    
    fireEvent.click(screen.getByText('Decrement'));
    expect(screen.getByText('Count: -1')).toBeInTheDocument();
  });
});
```

### å¼‚æ­¥ç»„ä»¶æµ‹è¯•

```javascript
// UserProfile.jsx
import { useState, useEffect } from 'react';

export function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    fetchUser(userId)
      .then(data => {
        setUser(data);
        setLoading(false);
      })
      .catch(err => {
        setError(err.message);
        setLoading(false);
      });
  }, [userId]);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  
  return (
    <div>
      <h1>{user.name}</h1>
      <p>{user.email}</p>
    </div>
  );
}

// UserProfile.test.jsx
import { render, screen, waitFor } from '@testing-library/react';
import { UserProfile } from './UserProfile';
import { fetchUser } from './api';

jest.mock('./api');

describe('UserProfileç»„ä»¶', () => {
  test('æ˜¾ç¤ºåŠ è½½çŠ¶æ€', () => {
    fetchUser.mockImplementation(() => new Promise(() => {}));
    
    render(<UserProfile userId={1} />);
    
    expect(screen.getByText('Loading...')).toBeInTheDocument();
  });
  
  test('æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯', async () => {
    fetchUser.mockResolvedValue({
      name: 'John',
      email: 'john@example.com'
    });
    
    render(<UserProfile userId={1} />);
    
    await waitFor(() => {
      expect(screen.getByText('John')).toBeInTheDocument();
      expect(screen.getByText('john@example.com')).toBeInTheDocument();
    });
  });
  
  test('æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', async () => {
    fetchUser.mockRejectedValue(new Error('Failed to fetch'));
    
    render(<UserProfile userId={1} />);
    
    await waitFor(() => {
      expect(screen.getByText('Error: Failed to fetch')).toBeInTheDocument();
    });
  });
});
```

### Hooksæµ‹è¯•

```javascript
// useCounter.js
import { useState, useCallback } from 'react';

export function useCounter(initialValue = 0) {
  const [count, setCount] = useState(initialValue);
  
  const increment = useCallback(() => {
    setCount(c => c + 1);
  }, []);
  
  const decrement = useCallback(() => {
    setCount(c => c - 1);
  }, []);
  
  const reset = useCallback(() => {
    setCount(initialValue);
  }, [initialValue]);
  
  return { count, increment, decrement, reset };
}

// useCounter.test.js
import { renderHook, act } from '@testing-library/react';
import { useCounter } from './useCounter';

describe('useCounter', () => {
  test('åˆå§‹å€¼', () => {
    const { result } = renderHook(() => useCounter(10));
    
    expect(result.current.count).toBe(10);
  });
  
  test('å¢åŠ è®¡æ•°', () => {
    const { result } = renderHook(() => useCounter());
    
    act(() => {
      result.current.increment();
    });
    
    expect(result.current.count).toBe(1);
  });
  
  test('å‡å°‘è®¡æ•°', () => {
    const { result } = renderHook(() => useCounter());
    
    act(() => {
      result.current.decrement();
    });
    
    expect(result.current.count).toBe(-1);
  });
  
  test('é‡ç½®è®¡æ•°', () => {
    const { result } = renderHook(() => useCounter(10));
    
    act(() => {
      result.current.increment();
      result.current.increment();
    });
    
    expect(result.current.count).toBe(12);
    
    act(() => {
      result.current.reset();
    });
    
    expect(result.current.count).toBe(10);
  });
});
```

## é›†æˆæµ‹è¯•

### ç»„ä»¶äº¤äº’æµ‹è¯•

```javascript
// TodoList.jsx
import { useState } from 'react';

export function TodoList() {
  const [todos, setTodos] = useState([]);
  const [input, setInput] = useState('');
  
  const addTodo = () => {
    if (input.trim()) {
      setTodos([...todos, { id: Date.now(), text: input, completed: false }]);
      setInput('');
    }
  };
  
  const toggleTodo = (id) => {
    setTodos(todos.map(todo =>
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  };
  
  const deleteTodo = (id) => {
    setTodos(todos.filter(todo => todo.id !== id));
  };
  
  return (
    <div>
      <input
        value={input}
        onChange={e => setInput(e.target.value)}
        placeholder="Add todo"
      />
      <button onClick={addTodo}>Add</button>
      
      <ul>
        {todos.map(todo => (
          <li key={todo.id}>
            <input
              type="checkbox"
              checked={todo.completed}
              onChange={() => toggleTodo(todo.id)}
            />
            <span style={{ textDecoration: todo.completed ? 'line-through' : 'none' }}>
              {todo.text}
            </span>
            <button onClick={() => deleteTodo(todo.id)}>Delete</button>
          </li>
        ))}
      </ul>
    </div>
  );
}

// TodoList.test.jsx
import { render, screen, fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { TodoList } from './TodoList';

describe('TodoListé›†æˆæµ‹è¯•', () => {
  test('å®Œæ•´çš„Todoæµç¨‹', async () => {
    const user = userEvent.setup();
    render(<TodoList />);
    
    // æ·»åŠ Todo
    const input = screen.getByPlaceholderText('Add todo');
    const addButton = screen.getByText('Add');
    
    await user.type(input, 'Buy milk');
    await user.click(addButton);
    
    expect(screen.getByText('Buy milk')).toBeInTheDocument();
    
    // æ·»åŠ ç¬¬äºŒä¸ªTodo
    await user.type(input, 'Buy eggs');
    await user.click(addButton);
    
    expect(screen.getByText('Buy eggs')).toBeInTheDocument();
    
    // å®ŒæˆTodo
    const checkbox = screen.getAllByRole('checkbox')[0];
    await user.click(checkbox);
    
    expect(screen.getByText('Buy milk')).toHaveStyle({
      textDecoration: 'line-through'
    });
    
    // åˆ é™¤Todo
    const deleteButtons = screen.getAllByText('Delete');
    await user.click(deleteButtons[0]);
    
    expect(screen.queryByText('Buy milk')).not.toBeInTheDocument();
    expect(screen.getByText('Buy eggs')).toBeInTheDocument();
  });
});
```

## E2Eæµ‹è¯•

### Cypress

```javascript
// cypress/e2e/login.cy.js
describe('ç™»å½•æµç¨‹', () => {
  beforeEach(() => {
    cy.visit('/login');
  });
  
  it('æˆåŠŸç™»å½•', () => {
    cy.get('[data-testid="email"]').type('user@example.com');
    cy.get('[data-testid="password"]').type('password123');
    cy.get('[data-testid="submit"]').click();
    
    cy.url().should('include', '/dashboard');
    cy.contains('Welcome').should('be.visible');
  });
  
  it('æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', () => {
    cy.get('[data-testid="email"]').type('wrong@example.com');
    cy.get('[data-testid="password"]').type('wrongpassword');
    cy.get('[data-testid="submit"]').click();
    
    cy.contains('Invalid credentials').should('be.visible');
  });
  
  it('éªŒè¯è¡¨å•', () => {
    cy.get('[data-testid="submit"]').click();
    
    cy.contains('Email is required').should('be.visible');
    cy.contains('Password is required').should('be.visible');
  });
});

// cypress/e2e/shopping.cy.js
describe('è´­ç‰©æµç¨‹', () => {
  it('å®Œæ•´çš„è´­ç‰©æµç¨‹', () => {
    // ç™»å½•
    cy.visit('/login');
    cy.get('[data-testid="email"]').type('user@example.com');
    cy.get('[data-testid="password"]').type('password123');
    cy.get('[data-testid="submit"]').click();
    
    // æµè§ˆå•†å“
    cy.visit('/products');
    cy.contains('iPhone').click();
    
    // æ·»åŠ åˆ°è´­ç‰©è½¦
    cy.get('[data-testid="add-to-cart"]').click();
    cy.contains('Added to cart').should('be.visible');
    
    // æŸ¥çœ‹è´­ç‰©è½¦
    cy.get('[data-testid="cart-icon"]').click();
    cy.contains('iPhone').should('be.visible');
    
    // ç»“ç®—
    cy.get('[data-testid="checkout"]').click();
    cy.get('[data-testid="address"]').type('123 Main St');
    cy.get('[data-testid="confirm-order"]').click();
    
    // éªŒè¯è®¢å•æˆåŠŸ
    cy.contains('Order placed successfully').should('be.visible');
  });
});
```

### Playwright

```javascript
// tests/login.spec.js
import { test, expect } from '@playwright/test';

test.describe('ç™»å½•æµç¨‹', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
  });
  
  test('æˆåŠŸç™»å½•', async ({ page }) => {
    await page.fill('[data-testid="email"]', 'user@example.com');
    await page.fill('[data-testid="password"]', 'password123');
    await page.click('[data-testid="submit"]');
    
    await expect(page).toHaveURL(/.*dashboard/);
    await expect(page.locator('text=Welcome')).toBeVisible();
  });
  
  test('æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', async ({ page }) => {
    await page.fill('[data-testid="email"]', 'wrong@example.com');
    await page.fill('[data-testid="password"]', 'wrongpassword');
    await page.click('[data-testid="submit"]');
    
    await expect(page.locator('text=Invalid credentials')).toBeVisible();
  });
});
```

## æµ‹è¯•è¦†ç›–ç‡

```javascript
// jest.config.js
module.exports = {
  collectCoverage: true,
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.test.{js,jsx,ts,tsx}',
    '!src/index.js'
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};

// è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
// npm test -- --coverage
```

## æœ€ä½³å®è·µ

```javascript
const testingBestPractices = {
  // 1. æµ‹è¯•å‘½å
  naming: {
    describe: 'æè¿°æµ‹è¯•çš„åŠŸèƒ½æ¨¡å—',
    test: 'æè¿°å…·ä½“çš„æµ‹è¯•åœºæ™¯',
    example: 'test("ç‚¹å‡»æŒ‰é’®åè®¡æ•°å¢åŠ ", () => {})'
  },
  
  // 2. AAAæ¨¡å¼
  aaa: {
    arrange: 'å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ',
    act: 'æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ',
    assert: 'éªŒè¯ç»“æœ'
  },
  
  // 3. æµ‹è¯•ç‹¬ç«‹æ€§
  independence: [
    'æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ',
    'ä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„ç»“æœ',
    'ä½¿ç”¨beforeEachæ¸…ç†çŠ¶æ€'
  ],
  
  // 4. æµ‹è¯•å¯è¯»æ€§
  readability: [
    'æµ‹è¯•ä»£ç åº”è¯¥æ˜“äºç†è§£',
    'é¿å…è¿‡åº¦æŠ½è±¡',
    'ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å'
  ],
  
  // 5. æµ‹è¯•è¦†ç›–
  coverage: [
    'å…³æ³¨å…³é”®ä¸šåŠ¡é€»è¾‘',
    'è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ',
    'ä¸è¿½æ±‚100%è¦†ç›–ç‡'
  ]
};
```

## æ€»ç»“

å‰ç«¯æµ‹è¯•çš„æ ¸å¿ƒï¼š
- ğŸ§ª **å•å…ƒæµ‹è¯•**ï¼šJestã€å‡½æ•°å’Œç»„ä»¶æµ‹è¯•
- ğŸ”— **é›†æˆæµ‹è¯•**ï¼šç»„ä»¶äº¤äº’ã€ç”¨æˆ·æµç¨‹
- ğŸŒ **E2Eæµ‹è¯•**ï¼šCypressã€Playwright
- ğŸ“Š **æµ‹è¯•è¦†ç›–ç‡**ï¼šå…³æ³¨å…³é”®é€»è¾‘
- âœ… **æœ€ä½³å®è·µ**ï¼šAAAæ¨¡å¼ã€ç‹¬ç«‹æ€§ã€å¯è¯»æ€§

è®°ä½ï¼š**å¥½çš„æµ‹è¯•æ˜¯ä»£ç è´¨é‡çš„ä¿è¯ï¼**

