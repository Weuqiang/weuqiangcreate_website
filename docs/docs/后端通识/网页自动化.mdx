---
sidebar_position: 3
title: 
---



## 





- HTML 
- CSS 
- JavaScript 



- ()

Chrome DevTools Protocol



 Playwright 

Selenium

PyppeteerPuppeteer  Python 

Playwright



### Selenium

 Selenium

[Selenium ](https://www.selenium.dev/selenium/docs/api/py/api.html)

```python showLineNumbers
from selenium import webdriver
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities
import time
import json
import base64
from PIL import Image
from urllib.parse import urlparse
from io import BytesIO

options = webdriver.ChromeOptions()
proxy = False # 
if proxy:
    options.add_argument('--proxy-server={}'.format(proxy))


d = DesiredCapabilities.CHROME
d['loggingPrefs'] = {'performance': 'ALL'}
options.add_experimental_option('w3c', False) # w3c 

''','''
options.add_argument('--ignore-certificate-errors') # 
options.add_argument('--ignore-ssl-errors') #ssl
options.add_argument('--headless') # 
options.binary_location = 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'

driver = webdriver.Chrome('D:\\MyProgram File\\python\\chromedriver.exe',
                options=options,
                desired_capabilities=d)

driver.execute_cdp_cmd("Network.enable", {}) # 

driver.get('https://id.qq.com/vc.html')  # 
time.sleep(2)

for f in driver.find_elements_by_tag_name("form"): # 
    urls = [i.get_attribute("src") for i in f.find_elements_by_tag_name("img")] #


    for log in driver.get_log("performance"):
        log = json.loads(log["message"]) # 
        if log["message"]["method"] == "Network.responseReceived": # 

            for url in urls:
                url = urlparse(url).path #urlhttps

                if url in log['message']['params']['response']['url']: # 
                    request_id = log['message']['params']['requestId'] # requestid
                    data = driver.execute_cdp_cmd("Network.getResponseBody", {"requestId": request_id})['body'] # id
                    data = base64.b64decode(data) # cdpbase64
                    source_img =Image.open(BytesIO(data))# 
                    source_img.show()  #
```

 Selenium 

- 
- 
-  AJAX 
- 

### Pyppeteer

Pyppeteer  JavaScript 

[Pyppeteer ](https://pyppeteer.github.io/pyppeteer/)

```python showLineNumbers
import asyncio
from pyppeteer import launch
from urllib import request

class Get_pic(): ## 
    async def get_refer(self): # 
        browser = await launch(headless=False)
        page = await browser.newPage()
        await page.goto('https://id.qq.com/vc.html')          # 
        image_src = await page.Jeval('#img', 'el => el.src') # 
        # .#id >
        # js  =>  src
        request.urlretrieve(image_src, 'image.png') # 
        await browser.close() # 

new = Get_pic() #
asyncio.run(new.get_refer()) # 
```

### Playwright

 Playwright 2 

Playwright  CDP 
Playwright  JavaScript 

[Playwright ](https://playwright.dev/python/docs/intro)

```python showLineNumbers
from PIL import Image
from urllib.parse import urlparse
from io import BytesIO
import asyncio
from urllib import request
from playwright.async_api import async_playwright

class Get_pic(): ## 
    async def get_refer(self): # 
        async with async_playwright() as p:  # playwright
            browser =await p.chromium.launch(headless=False)  # 
            context = await browser.new_context(ignore_https_errors = True,bypass_csp=True) #  Content-Security-Policy
            page = await context.new_page() # 
            self.img_data = {}
            page.on("response", self.on_response) # responseon_response
            await page.goto('https://id.qq.com/vc.html')          # 
            image_src = await page.eval_on_selector('#img','el => el.src')
            request.urlretrieve(image_src, 'image.png') # 
            image = page.locator("img")
            url = await image.get_attribute("src") # imgsrc
            self.urls = urlparse(url).query #urlhttps
            for u in self.img_data:
                if  self.urls in u:
                    source_img =Image.open(BytesIO(self.img_data[u]))
                    source_img.show()
            await browser.close() # 

    async def on_response(self,response):
        '''
        response playwright  response
        '''
        self.img_data[response.url] = await response.body()

new = Get_pic() #
asyncio.run(new.get_refer()) # 
```

## 

 HTML JavaScriptCSS 

JavaScript 

Python  re 

XPath

CSS CSS 

BeautifulSoupCSS

parselCSS 

 JSON 

execjs JavaScript

### XPath

XPath 

 [XPath ](https://www.runoob.com/xpath/xpath-syntax.html)

|         |                                                                    |
| ------------- | ---------------------------------------------------------------------- |
| nodename      |                                                  |
| /             |                                                |
| //            |  |
| .             |                                                            |
| ..            |                                                    |
| @             |                                                                |
| \*            |                                                        |
| @\*           |                                                        |
| node()        |                                                      |
| /bookstore/\* |  bookstore                                         |
| //\*          |                                                    |
| //title[@*]   |  title                                           |
| text()        |                                                            |

 "|"

```bash showLineNumbers
//title | //price  title  price 
```

|                               |                                                                                     |
| ----------------------------------- | --------------------------------------------------------------------------------------- |
| /bookstore/book[1]                  |  bookstore  book                                              |
| /bookstore/book[last()]             |  bookstore  book                                            |
| /bookstore/book[last()-1]           |  bookstore  book                                          |
| /bookstore/book[position()< 3]      |  bookstore  book                                  |
| //title[@lang]                      |  lang  title                                                |
| //title[@lang='eng']                |  title  eng  lang                                 |
| /bookstore/book[price>35.00]        |  bookstore  book  price  35.00                |
| /bookstore/book[price>35.00]//title |  bookstore  book  title  price  35.00 |

### CSS

CSS 

[CSS ](https://www.w3school.com.cn/cssref/css_selectors.asp)

|                |                   |                                           |
| -------------------- | --------------------- | ------------------------------------------------- |
| .class               | .intro                |  class="intro"                      |
| .class1.class2       | .name1.name2          |  class  name1  name2  |
| .class1 .class2      | .name1 .name2         |  name1  name2   |
| #id                  | #firstname            |  id="firstname"                         |
| \*                   | \*                    |                                       |
| element              | p                     |  p                                    |
| element.class        | p.intro               |  class="intro"  p                   |
| element,element      | div, p                |  div  p                     |
| element element      | div p                 |  div  p                       |
| element>element      | div > p               |  div  p                     |
| element+element      | div + p               |  div  p                     |
| element1~element2    | p ~ ul                |  p  ul                    |
| [attribute]          | [target]              |  target                     |
| [attribute=value]    | [target=_blank]       |  target="\_blank"           |
| [attribute~=value]   | [title~=flower]       |  title  "flower"        |
| [attribute\|=value]  | [lang\|=en]           |  lang  "en"           |
| [attribute^=value]   | a[href^="https"]      |  src  "https"  a      |
| [attribute$=value]   | a[href$=".pdf"]       |  src  ".pdf"  a         |     |
| [attribute*=value]   | a[href*="w3schools"]  |  href  "abc"  a   |
| :active              | a:active              |                                       |
| ::after              | p::after              |  p                        |
| ::before             | p::before             |  p                        |
| :checked             | input:checked         |  input                        |
| :default             | input:default         |  input                              |
| :disabled            | input:disabled        |  input                        |
| :empty               | p:empty               |  p        |
| :enabled             | input:enabled         |  input                          |
| :first-child         | p:first-child         |  p          |
| ::first-letter       | p::first-letter       |  p                            |
| ::first-line         | p::first-line         |  p                              |
| :first-of-type       | p:first-of-type       |  p  p         |
| :focus               | input:focus           |  input                          |
| :fullscreen          | :fullscreen           |                             |
| :hover               | a:hover               |                         |
| :in-range            | input:in-range        |  input                  |
| :indeterminate       | input:indeterminate   |  input                    |
| :invalid             | input:invalid         |  input                    |
| :lang(language)      | p:lang(it)            |  lang  "it" p     |
| :last-child          | p:last-child          |  p          |
| :last-of-type        | p:last-of-type        |  p  p         |
| :link                | a:link                |                             |
| :not(selector)       | :not(p)               |  p                            |
| :nth-child(n)        | p:nth-child(2)        |  p        |
| :nth-last-child(n)   | p:nth-last-child(2)   |                     |
| :nth-of-type(n)      | p:nth-of-type(2)      |  p  p         |
| :nth-last-of-type(n) | p:nth-last-of-type(2) |                 |
| :only-of-type        | p:only-of-type        |  p  p         |
| :only-child          | p:only-child          |  p          |
| :optional            | input:optional        |  "required"  input              |
| :out-of-range        | input:out-of-range    |  input                    |
| ::placeholder        | input::placeholder    |  "placeholder"  input         |
| :read-only           | input:read-only       |  "readonly"  input            |
| :read-write          | input:read-write      |  "readonly"  input            |
| :required            | input:required        |  "required"  input            |
| :root                | :root                 |                                   |
| ::selection          | ::selection           |                           |
| :target              | #news:target          |  #news                          |
| :valid               | input:valid           |  input                    |
| :visited             | a:visited             |                               |

### BeautifulSoup

[BS4 ](http://c.biancheng.net/python_spider/bs4.html)

#### BeautifulSoup 

 lxml 

```python showLineNumbers
pip install beautifulsoup4
pip install lxml
pip install html5lib
```



```python showLineNumbers
html_doc = """
<html><head><title>"c"</title></head>
<body>
<p class="title"><b>c.biancheng.net</b></p>
<p class="website">
<a href="http://c.biancheng.net/python/" id="link1">python</a>
<a href="http://c.biancheng.net/c/" id="link2">c</a>
"""
from bs4 import BeautifulSoup
soup = BeautifulSoup(html_doc, 'lxml')

print(soup.prettify()) #prettify()html/xml
```

#### BeautifulSoup 

 Python 

- TagHTML  Tag 
- NavigableString textstringstrings 
- BeautifulSoup HTML  Tag 
- Comment HTML  NavigableString

```python showLineNumbers
from bs4 import BeautifulSoup
soup = BeautifulSoup('<p class="Web site url"><b>c.biancheng.net</b></p>', 'html.parser')
#phtml
print(soup.p)
#b
print(soup.p.b)
#pNavigableStringstringtextget_text()
print(soup.p.text)
#
print(soup.p.attrs)
#
print(type(soup.p))
#
print(soup.p['class'])
#class,
soup.p['class']=['Web','Site']
print(soup.p)
```

#### Beatifulsoup 

Tag  tag  contentschildren parent  parents  next_sibling  previous_sibling  

```python showLineNumbers
#coding:utf8
from bs4 import BeautifulSoup
html_doc = """
<html><head><title>"c"</title></head>
<body>
<p class="title"><b>c.biancheng.net</b></p>
<p class="website"></p>
<a href="http://c.biancheng.net/python/" id="link1">python</a>,
<a href="http://c.biancheng.net/c/" id="link2">c</a> and
"""
soup = BeautifulSoup(html_doc, 'html.parser')
body_tag=soup.body
print(body_tag)
#
print(body_tag.contents)
```

#### find_all() find()

find_all()  tag 

```bash showLineNumbers
find_all( name , attrs , recursive , text , limit )
```


name name  tag 
attrs tag  class  Python  "class\_"
recursivefind_all()  tag  recursive=False  tag 
text  True
limit find_all()  limit 

find()  find_all()  find_all()  find()  find()  limit 

 find()  None find_all() 

```python showLineNumbers
from bs4 import BeautifulSoup
import re
html_doc = """
<html><head><title>"c"</title></head>
<body>
<p class="title"><b>c.biancheng.net</b></p>
<p class="website"></p>
<a href="http://c.biancheng.net/python/" id="link1">python</a>
<a href="http://c.biancheng.net/c/" id="link2">c</a>
<a href="http://c.biancheng.net/django/" id="link3">django</a>
<p class="vip"></p>
<a href="http://vip.biancheng.net/?from=index" id="link4">vip</a>
"""
#soup
soup = BeautifulSoup(html_doc, 'html.parser')

# find_all 
#a
print(soup.find_all("a"))
#a
print(soup.find_all("a",limit=2))
# HTML 
print(soup.find_all("p",class_="website"))
print(soup.find_all(id="link4"))
#tag
print(soup.find_all(['b','a']))
#id
print(soup.find_all('a',id=re.compile(r'.\d')))
print(soup.find_all(id=True))
#Truetagtag
for tag in soup.find_all(True):
    print(tag.name,end=" ")
#btag
for tag in soup.find_all(re.compile("^b")):
    print(tag.name)

# find 
#a
print(soup.find("a"))
#a
print(soup.find("a",limit=2))
# HTML 
print(soup.find("p",class_="website"))
print(soup.find(id="link4"))
#tag
print(soup.find(['b','a']))
#id
print(soup.find('a',id=re.compile(r'.\d')))
print(soup.find(id=True))
#Truetagtag
for tag in soup.find(True):
    print(tag.name,end=" ")
#btag
for tag in soup.find(re.compile("^b")):
    print(tag.name)
```

#### CSS 

BS4  CSS id Beautiful Soup  select()  HTML 

```python showLineNumbers
html_doc = """
<html><head><title>"c"</title></head>
<body>
<p class="title"><b>c.biancheng.net</b></p>
<p class="website"></p>
<a href="http://c.biancheng.net/python/" id="link1">python</a>
<a href="http://c.biancheng.net/c/" id="link2">c</a>
<a href="http://c.biancheng.net/django/" id="link3">django</a>
<p class="vip"></p>
<a href="http://vip.biancheng.net/?from=index" id="link4">vip</a>
<p class="introduce">:
<a href="http://c.biancheng.net/view/8066.html" id="link5"></a>
<a href="http://c.biancheng.net/view/8092.html" id="link6"></a>
</p>
"""
from bs4 import BeautifulSoup
soup = BeautifulSoup(html_doc, 'html.parser')
#
print(soup.select('title'))
#
print(soup.select('a[href]'))
#
print(soup.select('.vip'))
#
print(soup.select('html head title'))
#
print(soup.select('p + a'))
#idp
print(soup.select('p ~ #link3'))
#nth-of-type(n)n
print(soup.select('p ~ a:nth-of-type(1)'))
#
print(soup.select('p > a'))
print(soup.select('.introduce > #link5'))
```

### parsel

parsel  Beatifulsoup  Scrapy css  xpath [](https://en.wikibooks.org/wiki/XPath/CSS_Equivalents)

#### 

```python showLineNumbers
from parsel import Selector

html = '''
<div>
    <ul>
         <li class="item-0">first item</li>
         <li class="item-1"><a href="link2.html">second item</a></li>
         <li class="item-0 active"><a href="link3.html"><span class="bold">third item</span></a></li>
         <li class="item-1 active"><a href="link4.html">fourth item</a></li>
         <li class="item-0"><a href="link5.html">fifth item</a></li>
     </ul>
 </div>
'''
# 
selector = Selector(text=html)
items = selector.css('.item-0')
items2 = selector.xpath('//li[contains(@class, "item-0")]')

## 
for item in selector.css('.item-0'):
    text = item.xpath('.//text()') # // text()
    print(text.get())# get  SelectorList  Selector 
    print(text.getall())# getall  SelectorList  Selector 

## 
'''
 css  xpath  item-0  active  class
 li  a 
'''
result = selector.css('.item-0.active a::attr(href)').get() # ::attr()
print(result) # link3.html
result = selector.xpath('//li[contains(@class, "item-0") and contains(@class, "active")]/a/@href').get() # /@
print(result) # link3.html

## 
result = selector.css('.item-0').re('link.*') #  link 
print(result)
# ['link3.html"><span class="bold">third item</span></a></li>', 'link5.html">fifth item</a></li>']
```

#### parsel 

 XML  XML 

 xmlns 

```bash showLineNumbers
xmlns:="URI"
xmlns:gd="http://schemas.google.com/g/2005"
```

 URI  url

```python showLineNumbers
import requests
from parsel import Selector
text = requests.get('https://feeds.feedburner.com/PythonInsider').text
sel = Selector(text=text, type='xml') # xml

#   Atom XML 
sel.xpath("//link") # []

# Selector.remove_namespaces 
sel.remove_namespaces()  # 
sel.xpath("//link")
# [<Selector xpath='//link' data='<link rel="alternate" type="text/html...'>,
#<Selector xpath='//link' data='<link rel="next" type="application/at...'>,
# ...]


# ?
#   
#  

## 
sel.xpath("//a:entry/a:author/g:image/@src", namespaces={"a": "http://www.w3.org/2005/Atom","g": "http://schemas.google.com/g/2005"}).getall()
```

#### parsel  CSS  XPath

```python showLineNumbers
from parsel import css2xpath
css2xpath('h1.title')
"descendant-or-self::h1[@class and contains(concat(' ', normalize-space(@class), ' '), ' title ')]"
css2xpath('.profile-data') + '//h2'
"descendant-or-self::*[@class and contains(concat(' ', normalize-space(@class), ' '), ' profile-data ')]//h2"
```

#### parsel 

 XPath XPath  css 

```python showLineNumbers
from scrapy import Selector
sel = Selector(text='<a href="#">Click here to go to the <strong>Next Page</strong></a>')
xp = lambda x: sel.xpath(x).extract() # let's type this only once
xp('//a//text()') # take a peek at the node-set
  # [u'Click here to go to the ', u'Next Page']
xp('string(//a//text())')  # convert it to a string
  # [u'Click here to go to the ']


xp('//a[1]') # selects the first a node
[u'<a href="#">Click here to go to the <strong>Next Page</strong></a>']
xp('string(//a[1])') # converts it to string
[u'Click here to go to the Next Page']

xp("//a[contains(., 'Next Page')]//text()") # good
#['Click here to go to the ', 'Next Page']
xp("//a[contains(.//text(), 'Next Page')]") # bad
# []

xp("substring-after(//a, 'Next ')")# good
# [u'Page']
xp("substring-after(//a//text(), 'Next ')")# bad
# [u'']

## 
sel = Selector(text='<p class="content-author">Someone</p><p class="content text-wrap">Some content</p>')
xp = lambda x: sel.xpath(x).getall()
sel.css('.content').xpath('@class').getall()
# ['content text-wrap']
```

#### parsel  bs4

+class + class + class 

 bs4 parsel 
bs4 parsel 

```python showLineNumbers
from parsel import Selector
from bs4 import BeautifulSoup
from timeit import timeit

 # https://www.kickstarter.com/projects/cloverpress/pixiv-presents-artists-in-taiwan-and-korea?ref=section-homepage-featured-project
with open('1.html','r')as f:
    html = f.read()

def test1():
    sel = Selector(text=html)
    Title = sel.css('h2.project-name').xpath('.//text()').get()
    First_Page_Picture = sel.css('img.aspect-ratio--object::attr(src)').get()
    Pledged_Amount = sel.css('span.money')[4].xpath('.//text()').get()
    Due_Time = sel.css('span[data-test-id=deadline-exists]').xpath('.//text()').get()
    Time_Left = sel.css('span.block.type-16.type-28-md.bold.dark-grey-500')[1].xpath('.//text()').get()
    return Due_Time ,Time_Left,Pledged_Amount,Title,First_Page_Picture


def test2():
    newSoup = BeautifulSoup(html, "html.parser")
    Title = newSoup.find('h2',class_ = 'project-name').text
    First_Page_Picture = newSoup.find('img',class_ = 'aspect-ratio--object')["src"]
    Pledged_Amount = newSoup.find_all('span',class_ = 'money')[4].text
    Due_Time = newSoup.find('span',{'data-test-id': 'deadline-exists'}).text
    Time_Left = newSoup.find_all('span',class_= 'block type-16 type-28-md bold dark-grey-500')[1].text
    return Due_Time ,Time_Left,Pledged_Amount,Title,First_Page_Picture

print(test1() == test2()) # True

t1 = timeit('test1()', 'from __main__ import test1', number=10)
print(t1) # 0.3

t2 = timeit('test2()', 'from __main__ import test2', number=10)
print(t2) # 2
```

### execjs

execjs  execjs.eval(data) json  call() js 

```python showLineNumbers
import execjs

data = """{
    "Name": "Jennifer Smith",
    "Contact Number": 7867567898,
    "Email": "jen123@gmail.com",
    "Hobbies":["Reading", "Sketching", "Horse Riding"]
    }"""

res_p = execjs.eval(data)
print(type(res_p)) #dict


res_j = execjs.compile(res_p)
print(type(res_j._source)) #dict

execjs.eval("'red yellow blue'.split(' ')")
#['red', 'yellow', 'blue']

ctx = execjs.compile("""
    function add(x, y) {
        return x + y;
    }
""")
ctx.call("add", 1, 2)
#3

```