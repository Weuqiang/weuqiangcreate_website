---
sidebar_position: 5
title: subprocess
---

### subprocess 



 Python  shell 

[subprocess](https://docs.python.org/zh-cn/3/library/subprocess.html):subprocess Module Code Documentation

### run() 



```python showLineNumbers
import subprocess

# 
result = subprocess.run(['ls', '-l'], capture_output=True, text=True)

print(result.stdout)  # 
print(result.stderr)  # 
print(result.returncode)  # 0
```



- `args`: 
- `shell`:  shell  False
- `capture_output`:  `stdout=PIPE, stderr=PIPE`
- `text`:  decode
- `timeout`: 
- `check`: True  0 

### shell=True 

 shell 

```python showLineNumbers
import subprocess

#  shell=True
result = subprocess.run('ls -l | grep py', shell=True, capture_output=True, text=True)
print(result.stdout)

# 
result = subprocess.run('echo "Hello World"', shell=True, capture_output=True, text=True)
print(result.stdout)
```

:::warning
`shell=True` 
:::

### 

```python showLineNumbers
import subprocess

try:
    result = subprocess.run(
        ['python', 'nonexist.py'],
        capture_output=True,
        text=True,
        check=True,  # 0
        timeout=5
    )
except subprocess.CalledProcessError as e:
    print(f": {e.returncode}")
    print(f": {e.stderr}")
except subprocess.TimeoutExpired:
    print("")
```

### Popen() 



```python showLineNumbers
import subprocess

# 
process = subprocess.Popen(
    ['python', '-u', 'script.py'],
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE,
    text=True
)

# 
for line in process.stdout:
    print(line, end='')

# 
return_code = process.wait()
print(f": {return_code}")
```

### 

```python showLineNumbers
import subprocess

process = subprocess.Popen(
    ['python', '-u'],  # -u 
    stdin=subprocess.PIPE,
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE,
    text=True
)

# 
stdout, stderr = process.communicate(input='print("Hello from stdin")\n')
print(stdout)
```

### 

####  git 

```python showLineNumbers
import subprocess

def git_status():
    result = subprocess.run(
        ['git', 'status', '--short'],
        capture_output=True,
        text=True
    )
    return result.stdout

def git_commit(message):
    subprocess.run(['git', 'add', '.'], check=True)
    subprocess.run(['git', 'commit', '-m', message], check=True)

print(git_status())
```

####  Python 

```python showLineNumbers
import subprocess

result = subprocess.run(
    ['python', 'data_process.py', '--input', 'data.csv'],
    capture_output=True,
    text=True,
    timeout=300  # 5
)

if result.returncode == 0:
    print("")
    print(result.stdout)
else:
    print("")
    print(result.stderr)
```

#### Windows 

```python showLineNumbers
import subprocess
import sys

if sys.platform == 'win32':
    # Windows 
    result = subprocess.run('dir', shell=True, capture_output=True, text=True)
    print(result.stdout)
    
    #  cmd
    result = subprocess.run(
        ['cmd', '/c', 'dir'],
        capture_output=True,
        text=True
    )
    print(result.stdout)
```

### 

**Q:  run() Popen()**

A:  `run()` `Popen()`

**Q: **

A: Python 
```python
# 
subprocess.run(['echo', 'hello world'])

# 
subprocess.run('echo "hello world"', shell=True)
```

**Q: **

A:  `capture_output=True`  `stdout=subprocess.PIPE`

**Q: **

A: 
```python
result = subprocess.run(
    ['python', 'script.py'],
    capture_output=True,
    encoding='utf-8'  #  'gbk' (Windows)
)
```

### 

1.  shell 
2.  timeout
3.  `check=True` 
4.  `text=True`  `encoding`
5.  `shell=True`

```python showLineNumbers
# 
import subprocess

def run_command(cmd_list, timeout=30):
    """"""
    try:
        result = subprocess.run(
            cmd_list,
            capture_output=True,
            text=True,
            timeout=timeout,
            check=True
        )
        return result.stdout
    except subprocess.CalledProcessError as e:
        print(f": {' '.join(cmd_list)}")
        print(f": {e.stderr}")
        return None
    except subprocess.TimeoutExpired:
        print(f": {' '.join(cmd_list)}")
        return None

# 
output = run_command(['ls', '-la'])
if output:
    print(output)
```
