---
sidebar_position: 4
title: MySQLæŸ¥è¯¢ä¼˜åŒ–å®æˆ˜
tags: [æ•°æ®åº“, MySQL, æŸ¥è¯¢ä¼˜åŒ–, æ€§èƒ½è°ƒä¼˜]
---

# MySQLæŸ¥è¯¢ä¼˜åŒ–å®æˆ˜

æŸ¥è¯¢ä¼˜åŒ–æ˜¯æ•°æ®åº“æ€§èƒ½è°ƒä¼˜çš„æ ¸å¿ƒï¼Œæœ¬æ–‡å°†é€šè¿‡å®æˆ˜æ¡ˆä¾‹è®²è§£MySQLæŸ¥è¯¢ä¼˜åŒ–çš„æ–¹æ³•å’ŒæŠ€å·§ã€‚

## EXPLAINæ‰§è¡Œè®¡åˆ’

### æ‰§è¡Œè®¡åˆ’è¯¦è§£

```sql
-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM orders WHERE user_id = 1;

-- æ‰§è¡Œè®¡åˆ’è¾“å‡º
/*
+----+-------------+--------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+--------+------+---------------+------+---------+------+------+-------------+
*/

-- å­—æ®µè¯´æ˜
```

#### 1. id - æŸ¥è¯¢åºå·

```sql
-- ç®€å•æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE id = 1;
-- id = 1

-- å­æŸ¥è¯¢
EXPLAIN SELECT * FROM users 
WHERE id IN (SELECT user_id FROM orders);
-- id = 1 (å¤–å±‚æŸ¥è¯¢)
-- id = 2 (å­æŸ¥è¯¢)

-- è”åˆæŸ¥è¯¢
EXPLAIN 
SELECT * FROM users WHERE id = 1
UNION
SELECT * FROM users WHERE id = 2;
-- id = 1 (ç¬¬ä¸€ä¸ªæŸ¥è¯¢)
-- id = 2 (ç¬¬äºŒä¸ªæŸ¥è¯¢)
```

#### 2. select_type - æŸ¥è¯¢ç±»å‹

```sql
-- SIMPLEï¼šç®€å•æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE id = 1;

-- PRIMARYï¼šä¸»æŸ¥è¯¢
EXPLAIN SELECT * FROM users 
WHERE id IN (SELECT user_id FROM orders);

-- SUBQUERYï¼šå­æŸ¥è¯¢
EXPLAIN SELECT * FROM users 
WHERE id = (SELECT MAX(user_id) FROM orders);

-- DERIVEDï¼šæ´¾ç”Ÿè¡¨
EXPLAIN SELECT * FROM (
    SELECT * FROM users WHERE age > 18
) AS adults;

-- UNIONï¼šè”åˆæŸ¥è¯¢
EXPLAIN 
SELECT * FROM users WHERE id = 1
UNION
SELECT * FROM users WHERE id = 2;
```

#### 3. type - è®¿é—®ç±»å‹ï¼ˆé‡è¦ï¼ï¼‰

```sql
-- systemï¼šè¡¨åªæœ‰ä¸€è¡Œï¼ˆç³»ç»Ÿè¡¨ï¼‰
-- æœ€ä¼˜

-- constï¼šä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE id = 1;
-- type: const

-- eq_refï¼šå”¯ä¸€ç´¢å¼•æ‰«æ
EXPLAIN SELECT * FROM orders o
JOIN users u ON o.user_id = u.id;
-- type: eq_ref

-- refï¼šéå”¯ä¸€ç´¢å¼•æ‰«æ
EXPLAIN SELECT * FROM users WHERE name = 'John';
-- type: ref

-- rangeï¼šç´¢å¼•èŒƒå›´æ‰«æ
EXPLAIN SELECT * FROM users WHERE age > 18;
-- type: range

-- indexï¼šç´¢å¼•å…¨æ‰«æ
EXPLAIN SELECT id FROM users;
-- type: index

-- ALLï¼šå…¨è¡¨æ‰«æï¼ˆæœ€å·®ï¼‰
EXPLAIN SELECT * FROM users WHERE email LIKE '%@gmail.com';
-- type: ALL

-- æ€§èƒ½æ’åºï¼šsystem > const > eq_ref > ref > range > index > ALL
```

#### 4. possible_keys å’Œ key

```sql
-- possible_keysï¼šå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•
-- keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•

CREATE INDEX idx_name ON users(name);
CREATE INDEX idx_age ON users(age);

EXPLAIN SELECT * FROM users WHERE name = 'John' AND age > 18;
-- possible_keys: idx_name, idx_age
-- key: idx_name (MySQLé€‰æ‹©äº†nameç´¢å¼•)
```

#### 5. rows - æ‰«æè¡Œæ•°

```sql
-- é¢„ä¼°éœ€è¦æ‰«æçš„è¡Œæ•°
EXPLAIN SELECT * FROM users WHERE age > 18;
-- rows: 50000 (éœ€è¦æ‰«æ5ä¸‡è¡Œ)

-- ä¼˜åŒ–å
CREATE INDEX idx_age ON users(age);
EXPLAIN SELECT * FROM users WHERE age > 18;
-- rows: 10000 (åªéœ€æ‰«æ1ä¸‡è¡Œ)
```

#### 6. Extra - é¢å¤–ä¿¡æ¯

```sql
-- Using indexï¼šè¦†ç›–ç´¢å¼•
CREATE INDEX idx_name_age ON users(name, age);
EXPLAIN SELECT name, age FROM users WHERE name = 'John';
-- Extra: Using index

-- Using whereï¼šä½¿ç”¨WHEREè¿‡æ»¤
EXPLAIN SELECT * FROM users WHERE age > 18;
-- Extra: Using where

-- Using filesortï¼šæ–‡ä»¶æ’åºï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰
EXPLAIN SELECT * FROM users ORDER BY age;
-- Extra: Using filesort

-- ä¼˜åŒ–ï¼šæ·»åŠ ç´¢å¼•
CREATE INDEX idx_age ON users(age);
EXPLAIN SELECT * FROM users ORDER BY age;
-- Extra: Using index

-- Using temporaryï¼šä½¿ç”¨ä¸´æ—¶è¡¨ï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰
EXPLAIN SELECT DISTINCT name FROM users;
-- Extra: Using temporary

-- Using index conditionï¼šç´¢å¼•æ¡ä»¶ä¸‹æ¨
CREATE INDEX idx_name_age ON users(name, age);
EXPLAIN SELECT * FROM users WHERE name LIKE 'John%' AND age > 18;
-- Extra: Using index condition
```

## æ…¢æŸ¥è¯¢ä¼˜åŒ–

### 1. å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—

```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢é…ç½®
SHOW VARIABLES LIKE 'slow_query%';
SHOW VARIABLES LIKE 'long_query_time';

-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL slow_query_log_file = '/var/log/mysql/slow.log';
SET GLOBAL long_query_time = 1;  -- 1ç§’

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ç»Ÿè®¡
SHOW GLOBAL STATUS LIKE 'Slow_queries';
```

### 2. åˆ†ææ…¢æŸ¥è¯¢

```bash
# ä½¿ç”¨mysqldumpslowåˆ†æ
mysqldumpslow -s t -t 10 /var/log/mysql/slow.log

# å‚æ•°è¯´æ˜
# -s: æ’åºæ–¹å¼ï¼ˆt:æ—¶é—´, c:æ¬¡æ•°, l:é”æ—¶é—´ï¼‰
# -t: æ˜¾ç¤ºå‰Næ¡
# -g: æ­£åˆ™åŒ¹é…

# ä½¿ç”¨pt-query-digeståˆ†æ
pt-query-digest /var/log/mysql/slow.log
```

### 3. ä¼˜åŒ–æ¡ˆä¾‹

#### æ¡ˆä¾‹1ï¼šé¿å…SELECT *

```sql
-- âŒ æŸ¥è¯¢æ‰€æœ‰åˆ—
SELECT * FROM users WHERE id = 1;

-- âœ… åªæŸ¥è¯¢éœ€è¦çš„åˆ—
SELECT id, name, email FROM users WHERE id = 1;

-- æ€§èƒ½å¯¹æ¯”
-- SELECT *: æ‰«ææ‰€æœ‰åˆ—ï¼Œæ•°æ®é‡å¤§
-- SELECT æŒ‡å®šåˆ—: åªæ‰«æéœ€è¦çš„åˆ—ï¼Œå¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•
```

#### æ¡ˆä¾‹2ï¼šä¼˜åŒ–JOINæŸ¥è¯¢

```sql
-- âŒ ç¬›å¡å°”ç§¯
SELECT * FROM orders, users 
WHERE orders.user_id = users.id;

-- âœ… ä½¿ç”¨JOIN
SELECT * FROM orders 
INNER JOIN users ON orders.user_id = users.id;

-- âŒ å¤§è¡¨JOINå¤§è¡¨
SELECT * FROM orders o
JOIN order_items oi ON o.id = oi.order_id;

-- âœ… å…ˆè¿‡æ»¤å†JOIN
SELECT * FROM orders o
JOIN order_items oi ON o.id = oi.order_id
WHERE o.created_at > '2024-01-01';

-- âœ… ä½¿ç”¨å°è¡¨é©±åŠ¨å¤§è¡¨
SELECT * FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE u.id IN (1, 2, 3);
```

#### æ¡ˆä¾‹3ï¼šä¼˜åŒ–å­æŸ¥è¯¢

```sql
-- âŒ å­æŸ¥è¯¢
SELECT * FROM users 
WHERE id IN (
    SELECT user_id FROM orders WHERE amount > 1000
);

-- âœ… ä½¿ç”¨JOIN
SELECT DISTINCT u.* FROM users u
INNER JOIN orders o ON u.id = o.user_id
WHERE o.amount > 1000;

-- âŒ ç›¸å…³å­æŸ¥è¯¢
SELECT u.*, (
    SELECT COUNT(*) FROM orders WHERE user_id = u.id
) AS order_count
FROM users u;

-- âœ… ä½¿ç”¨JOIN + GROUP BY
SELECT u.*, COUNT(o.id) AS order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id;
```

#### æ¡ˆä¾‹4ï¼šä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢

```sql
-- âŒ æ·±åˆ†é¡µæ€§èƒ½å·®
SELECT * FROM users ORDER BY id LIMIT 1000000, 10;
-- éœ€è¦æ‰«æ1000010è¡Œ

-- âœ… ä½¿ç”¨è¦†ç›–ç´¢å¼• + å»¶è¿Ÿå…³è”
SELECT * FROM users u
INNER JOIN (
    SELECT id FROM users ORDER BY id LIMIT 1000000, 10
) AS t ON u.id = t.id;

-- âœ… ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ
SELECT * FROM users 
WHERE id > 1000000 
ORDER BY id 
LIMIT 10;

-- âœ… ä½¿ç”¨æ—¶é—´æˆ³åˆ†é¡µ
SELECT * FROM users 
WHERE created_at > '2024-01-01 00:00:00'
ORDER BY created_at 
LIMIT 10;
```

#### æ¡ˆä¾‹5ï¼šä¼˜åŒ–COUNTæŸ¥è¯¢

```sql
-- âŒ COUNT(*)å…¨è¡¨æ‰«æ
SELECT COUNT(*) FROM users;

-- âœ… ä½¿ç”¨è¿‘ä¼¼å€¼
SELECT table_rows FROM information_schema.tables
WHERE table_name = 'users';

-- âœ… ä½¿ç”¨ç¼“å­˜
-- Redisç¼“å­˜ç”¨æˆ·æ€»æ•°
SET user:count 1000000 EX 3600

-- âœ… ä½¿ç”¨è®¡æ•°è¡¨
CREATE TABLE counters (
    name VARCHAR(50) PRIMARY KEY,
    count BIGINT
);

INSERT INTO counters VALUES ('users', 0);

-- æ’å…¥ç”¨æˆ·æ—¶æ›´æ–°è®¡æ•°
INSERT INTO users (...) VALUES (...);
UPDATE counters SET count = count + 1 WHERE name = 'users';
```

## ç´¢å¼•ä¼˜åŒ–å®æˆ˜

### 1. ç»„åˆç´¢å¼•ä¼˜åŒ–

```sql
-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE orders (
    id BIGINT PRIMARY KEY,
    user_id BIGINT,
    status VARCHAR(20),
    amount DECIMAL(10,2),
    created_at TIMESTAMP,
    INDEX idx_user_status (user_id, status),
    INDEX idx_created (created_at)
);

-- âœ… å¯ä»¥ä½¿ç”¨idx_user_status
SELECT * FROM orders WHERE user_id = 1;
SELECT * FROM orders WHERE user_id = 1 AND status = 'paid';

-- âŒ ä¸èƒ½ä½¿ç”¨idx_user_status
SELECT * FROM orders WHERE status = 'paid';

-- ä¼˜åŒ–ï¼šè°ƒæ•´ç´¢å¼•é¡ºåºæˆ–åˆ›å»ºæ–°ç´¢å¼•
CREATE INDEX idx_status_user ON orders(status, user_id);

-- âœ… ç´¢å¼•è¦†ç›–
SELECT user_id, status FROM orders WHERE user_id = 1;
-- Extra: Using index

-- âœ… ç´¢å¼•æ’åº
SELECT * FROM orders WHERE user_id = 1 ORDER BY status;
-- Extra: Using index
```

### 2. å‰ç¼€ç´¢å¼•ä¼˜åŒ–

```sql
-- åˆ†æå‰ç¼€é•¿åº¦
SELECT 
    COUNT(DISTINCT LEFT(email, 5)) / COUNT(*) AS sel_5,
    COUNT(DISTINCT LEFT(email, 10)) / COUNT(*) AS sel_10,
    COUNT(DISTINCT LEFT(email, 15)) / COUNT(*) AS sel_15,
    COUNT(DISTINCT email) / COUNT(*) AS sel_full
FROM users;

-- ç»“æœ
-- sel_5: 0.85
-- sel_10: 0.98
-- sel_15: 0.99
-- sel_full: 1.00

-- é€‰æ‹©å‰ç¼€é•¿åº¦10
CREATE INDEX idx_email_prefix ON users(email(10));
```

### 3. ç´¢å¼•åˆå¹¶ä¼˜åŒ–

```sql
-- åˆ›å»ºå•åˆ—ç´¢å¼•
CREATE INDEX idx_name ON users(name);
CREATE INDEX idx_age ON users(age);

-- æŸ¥è¯¢å¯èƒ½ä½¿ç”¨ç´¢å¼•åˆå¹¶
EXPLAIN SELECT * FROM users WHERE name = 'John' AND age > 18;
-- Extra: Using intersect(idx_name, idx_age)

-- ä½†é€šå¸¸ç»„åˆç´¢å¼•æ›´å¥½
CREATE INDEX idx_name_age ON users(name, age);
EXPLAIN SELECT * FROM users WHERE name = 'John' AND age > 18;
-- key: idx_name_age
```

## æŸ¥è¯¢æ”¹å†™æŠ€å·§

### 1. ORæ”¹å†™ä¸ºUNION

```sql
-- âŒ ORæŸ¥è¯¢å¯èƒ½ä¸èµ°ç´¢å¼•
SELECT * FROM users WHERE name = 'John' OR email = 'john@example.com';

-- âœ… æ”¹å†™ä¸ºUNION
SELECT * FROM users WHERE name = 'John'
UNION
SELECT * FROM users WHERE email = 'john@example.com';
```

### 2. INæ”¹å†™ä¸ºEXISTS

```sql
-- âŒ INå­æŸ¥è¯¢
SELECT * FROM users 
WHERE id IN (SELECT user_id FROM orders WHERE amount > 1000);

-- âœ… æ”¹å†™ä¸ºEXISTS
SELECT * FROM users u
WHERE EXISTS (
    SELECT 1 FROM orders o 
    WHERE o.user_id = u.id AND o.amount > 1000
);
```

### 3. å‡½æ•°æ”¹å†™

```sql
-- âŒ åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°
SELECT * FROM users WHERE YEAR(created_at) = 2024;

-- âœ… æ”¹å†™æŸ¥è¯¢æ¡ä»¶
SELECT * FROM users 
WHERE created_at >= '2024-01-01' 
  AND created_at < '2025-01-01';

-- âŒ éšå¼ç±»å‹è½¬æ¢
SELECT * FROM users WHERE phone = 12345678;

-- âœ… ä½¿ç”¨æ­£ç¡®ç±»å‹
SELECT * FROM users WHERE phone = '12345678';
```

### 4. LIKEä¼˜åŒ–

```sql
-- âŒ å‰ç¼€é€šé…ç¬¦
SELECT * FROM users WHERE name LIKE '%John';

-- âœ… åç¼€é€šé…ç¬¦
SELECT * FROM users WHERE name LIKE 'John%';

-- âœ… ä½¿ç”¨å…¨æ–‡ç´¢å¼•
CREATE FULLTEXT INDEX idx_name_fulltext ON users(name);
SELECT * FROM users WHERE MATCH(name) AGAINST('John');
```

## è¡¨ç»“æ„ä¼˜åŒ–

### 1. å­—æ®µç±»å‹ä¼˜åŒ–

```sql
-- âŒ ä½¿ç”¨è¿‡å¤§çš„ç±»å‹
CREATE TABLE users (
    id BIGINT,              -- å¦‚æœä¸éœ€è¦è¿™ä¹ˆå¤§ï¼Œç”¨INT
    name VARCHAR(255),      -- å¦‚æœåå­—ä¸ä¼šè¶…è¿‡50ï¼Œç”¨VARCHAR(50)
    age TINYINT UNSIGNED,   -- âœ… 0-255è¶³å¤Ÿ
    balance DECIMAL(20,2)   -- å¦‚æœé‡‘é¢ä¸ä¼šè¶…è¿‡ç™¾ä¸‡ï¼Œç”¨DECIMAL(10,2)
);

-- âœ… ä½¿ç”¨åˆé€‚çš„ç±»å‹
CREATE TABLE users (
    id INT UNSIGNED,
    name VARCHAR(50),
    age TINYINT UNSIGNED,
    balance DECIMAL(10,2)
);

-- ç±»å‹é€‰æ‹©åŸåˆ™
-- 1. è¶Šå°è¶Šå¥½
-- 2. ç®€å•å°±å¥½ï¼ˆINTæ¯”VARCHARå¿«ï¼‰
-- 3. é¿å…NULLï¼ˆä½¿ç”¨NOT NULL + DEFAULTï¼‰
```

### 2. å‚ç›´æ‹†åˆ†

```sql
-- âŒ å¤§å­—æ®µå’Œå°å­—æ®µæ··åœ¨ä¸€èµ·
CREATE TABLE articles (
    id BIGINT PRIMARY KEY,
    title VARCHAR(200),
    author VARCHAR(50),
    content TEXT,           -- å¤§å­—æ®µ
    views INT,
    created_at TIMESTAMP
);

-- âœ… æ‹†åˆ†ä¸ºä¸¤ä¸ªè¡¨
CREATE TABLE articles (
    id BIGINT PRIMARY KEY,
    title VARCHAR(200),
    author VARCHAR(50),
    views INT,
    created_at TIMESTAMP
);

CREATE TABLE article_content (
    article_id BIGINT PRIMARY KEY,
    content TEXT,
    FOREIGN KEY (article_id) REFERENCES articles(id)
);
```

### 3. æ°´å¹³æ‹†åˆ†

```sql
-- æŒ‰æ—¶é—´åˆ†è¡¨
CREATE TABLE orders_2024_01 (
    id BIGINT PRIMARY KEY,
    user_id BIGINT,
    amount DECIMAL(10,2),
    created_at TIMESTAMP
);

CREATE TABLE orders_2024_02 (
    id BIGINT PRIMARY KEY,
    user_id BIGINT,
    amount DECIMAL(10,2),
    created_at TIMESTAMP
);

-- æŒ‰èŒƒå›´åˆ†è¡¨
CREATE TABLE users_0 (  -- id % 10 = 0
    id BIGINT PRIMARY KEY,
    name VARCHAR(50)
);

CREATE TABLE users_1 (  -- id % 10 = 1
    id BIGINT PRIMARY KEY,
    name VARCHAR(50)
);
```

## æ‰¹é‡æ“ä½œä¼˜åŒ–

### 1. æ‰¹é‡æ’å…¥

```sql
-- âŒ é€æ¡æ’å…¥
INSERT INTO users (name) VALUES ('User1');
INSERT INTO users (name) VALUES ('User2');
INSERT INTO users (name) VALUES ('User3');

-- âœ… æ‰¹é‡æ’å…¥
INSERT INTO users (name) VALUES 
('User1'), ('User2'), ('User3');

-- âœ… LOAD DATAï¼ˆæœ€å¿«ï¼‰
LOAD DATA INFILE '/tmp/users.csv'
INTO TABLE users
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';
```

### 2. æ‰¹é‡æ›´æ–°

```sql
-- âŒ é€æ¡æ›´æ–°
UPDATE users SET status = 'active' WHERE id = 1;
UPDATE users SET status = 'active' WHERE id = 2;
UPDATE users SET status = 'active' WHERE id = 3;

-- âœ… æ‰¹é‡æ›´æ–°
UPDATE users SET status = 'active' WHERE id IN (1, 2, 3);

-- âœ… CASE WHENæ‰¹é‡æ›´æ–°ä¸åŒå€¼
UPDATE users SET status = CASE
    WHEN id = 1 THEN 'active'
    WHEN id = 2 THEN 'inactive'
    WHEN id = 3 THEN 'pending'
END
WHERE id IN (1, 2, 3);
```

## ç›‘æ§ä¸è¯Šæ–­

```sql
-- æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„æŸ¥è¯¢
SHOW PROCESSLIST;

-- æŸ¥çœ‹è¡¨çŠ¶æ€
SHOW TABLE STATUS LIKE 'users';

-- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡
SHOW INDEX FROM users;

-- æŸ¥çœ‹è¡¨å¤§å°
SELECT 
    TABLE_NAME,
    ROUND((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS size_mb
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'your_database'
ORDER BY size_mb DESC;

-- æŸ¥çœ‹ç¢ç‰‡ç‡
SELECT 
    TABLE_NAME,
    DATA_FREE / (DATA_LENGTH + INDEX_LENGTH) AS fragmentation
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'your_database'
    AND DATA_FREE > 0;

-- ä¼˜åŒ–è¡¨ï¼ˆæ•´ç†ç¢ç‰‡ï¼‰
OPTIMIZE TABLE users;
```

## æ€§èƒ½æµ‹è¯•

```javascript
// ä½¿ç”¨Node.jsè¿›è¡Œæ€§èƒ½æµ‹è¯•
class QueryBenchmark {
  async benchmark(query, iterations = 1000) {
    const times = [];
    
    for (let i = 0; i < iterations; i++) {
      const start = Date.now();
      await db.query(query);
      const end = Date.now();
      times.push(end - start);
    }
    
    return {
      avg: times.reduce((a, b) => a + b) / times.length,
      min: Math.min(...times),
      max: Math.max(...times),
      p95: this.percentile(times, 0.95),
      p99: this.percentile(times, 0.99)
    };
  }
  
  percentile(arr, p) {
    const sorted = arr.sort((a, b) => a - b);
    const index = Math.ceil(sorted.length * p) - 1;
    return sorted[index];
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const benchmark = new QueryBenchmark();

const result1 = await benchmark.benchmark(
  'SELECT * FROM users WHERE id = 1'
);

const result2 = await benchmark.benchmark(
  'SELECT id, name FROM users WHERE id = 1'
);

console.log('Query 1:', result1);
console.log('Query 2:', result2);
```

## æ€»ç»“

MySQLæŸ¥è¯¢ä¼˜åŒ–çš„æ ¸å¿ƒï¼š
- ğŸ“Š **EXPLAINåˆ†æ**ï¼šç†è§£æ‰§è¡Œè®¡åˆ’ï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ
- ğŸ” **æ…¢æŸ¥è¯¢ä¼˜åŒ–**ï¼šé¿å…å…¨è¡¨æ‰«æï¼Œä½¿ç”¨ç´¢å¼•
- ğŸ“¦ **ç´¢å¼•ä¼˜åŒ–**ï¼šåˆç†è®¾è®¡ç´¢å¼•ï¼Œé¿å…ç´¢å¼•å¤±æ•ˆ
- âœï¸ **æŸ¥è¯¢æ”¹å†™**ï¼šä¼˜åŒ–SQLè¯­å¥ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡
- ğŸ—‚ï¸ **è¡¨ç»“æ„ä¼˜åŒ–**ï¼šé€‰æ‹©åˆé€‚çš„å­—æ®µç±»å‹å’Œè¡¨ç»“æ„
- ğŸ“ˆ **æ‰¹é‡æ“ä½œ**ï¼šå‡å°‘ç½‘ç»œå¼€é”€ï¼Œæé«˜ååé‡

è®°ä½ï¼š**æŸ¥è¯¢ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¸æ–­ç›‘æ§å’Œè°ƒæ•´ï¼**

