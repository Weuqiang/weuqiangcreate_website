---
sidebar_position: 11
title: 
---

## 

## I/O

## 


## 

- 

* C  C 

- 

* 
*  ASCII ****` ASCII `
* .c 

* 
* ``
* .exe 

---

- ****

* , 

```c showLineNumbers
#include <stdio.h>

int main()
{
    /*
     * 
     *  ASCII
     *  ASCII 
     */
    int num = 666;
    FILE *fa = fopen("ascii.txt", "w");
    fprintf(fa, "%d", num);
    fclose(fa);

    /*
     * 
     *  666 
     */
    FILE *fb = fopen("bin.txt", "w");
    fwrite(&num, 4, 1, fb);
    fclose(fb);

    return 0;
}
```

- 
  ![](https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/a989b57283bdbcd82ae8bfb0c6fb4b8d.png)

- 
  ![](https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/61ccbc31fd2ed870fde8de4598d52ee3.png)

> -  ASCII ,  ASCII , ,  ASCII , 

## 

- FILE 

* FILE  FILE 

```c showLineNumbers
  struct _iobuf {
    char *_ptr;  //
    int _cnt;  //
    char *_base; //)
    int _flag; //
    int _file;  //
    int _charbuf; //,
    int _bufsiz; // 
    char *_tmpfname; //
  };
  typedef struct _iobuf FILE;
```

---

- fileopen 

|  | FILE _ fopen ( const char _ filename, const char \* mode );                              |
| -------- | ---------------------------------------------------------------------------------------- |
|  | stdio.h                                                                                  |
|  |  mode  filename  FILE  |

|
|| char*filaname :|
|| char*mode :|
|| FILE\* |

| mode |   |  |      |  |  |
| ---- | --------- | -------------- | ---------------- | ---------- | ---------- |
| r    |       |            |          |        |        |
| w    |       |      |      |        |        |
| a    |       |      |  |        |        |
| r+   | / |            |          |        |        |
| w+   | / |      |      |        |        |
| a+   | / |      |  |        |        |

> :
>
> - Windows  b rb, r+b Unix/Linux 

---

- fclose 

|        | int fclose ( FILE \* stream );                                 |
| -------------- | -------------------------------------------------------------- |
|        | stdio.h                                                        |
|        | fclose() fopen().                        |
|        | ,  |
|  |                                                                |
|            | FILE\* stream :                            |
|          | int  0  EOF(-1)                            |

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp = fopen("test.txt", "w+");
    fclose(fp);
    return 0;
}
```

--

## 

- 

|        | int fputc (int ch, FILE \* stream );                 |
| -------------- | ---------------------------------------------------- |
|        | stdio.h                                              |
|        |  ch                                |
|  |                                                      |
|            | FILE\* stream :                  |
|            | int :                                |
|          | int  EOF |

```c showLineNumbers
#include <stdio.h>

int main()
{
    // 1.
    FILE *fp = fopen("test.txt", "w+");

    // 2.
    for(char ch = 'a'; ch <= 'z'; ch++){
        // 
        char res = fputc(ch, fp);
        printf("res = %c\n", res);
    }

    // 3.
    fclose(fp);
    return 0;
}
```

- 

|        | int fgetc ( FILE \* stream );                          |
| -------------- | ------------------------------------------------------ |
|        | stdio.h                                                |
|        |                          |
|  |                                                        |
|            | FILE\* stream :                    |
|          | int  EOF |

```c showLineNumbers
#include <stdio.h>

int main()
{
    // 1.
    FILE *fp = fopen("test.txt", "r+");

    // 2.
    char res = EOF;
    while((res = fgetc(fp)) != EOF){
        printf("res = %c\n", res);
    }

    // 3.
    fclose(fp);
    return 0;
}
```

- 
  - feof 

|        | int feof( FILE \* stream );               |
| -------------- | ----------------------------------------- |
|        | stdio.h                                   |
|        |                   |
|  |                                           |
|            | FILE\* stream :       |
|          | int 0   |

```c showLineNumbers
#include <stdio.h>

int main()
{
    // 1.
    FILE *fp = fopen("test.txt", "r+");

    // 2.
    char res = EOF;
    // : ,
    // feof, , 
    while((res = fgetc(fp)) && (!feof(fp))){
        printf("res = %c\n", res);
    }

    // 3.
    fclose(fp);
    return 0;
}
```

> - :
> - feof 
> - , 
> -  feof , 

- 

* 

```c showLineNumbers
#include <stdio.h>
#include <string.h>
void encode(char *name, char *newName, int code);
void decode(char *name, char *newName, int code);
int main()
{
    encode("main.c", "encode.c", 666);
    decode("encode.c", "decode.c", 666);
    return 0;
}
/**
 * @brief encode 
 * @param name 
 * @param newName 
 * @param code 
 */
void encode(char *name, char *newName, int code){
    FILE *fw = fopen(newName, "w+");
    FILE *fr = fopen(name, "r+");
    char ch = EOF;
    while((ch = fgetc(fr)) && (!feof(fr))){
        fputc(ch ^ code, fw);
    }
    fclose(fw);
    fclose(fr);
}
/**
 * @brief encode 
 * @param name 
 * @param newName 
 * @param code 
 */
void decode(char *name, char *newName, int code){
    FILE *fw = fopen(newName, "w+");
    FILE *fr = fopen(name, "r+");
    char ch = EOF;
    while((ch = fgetc(fr)) && (!feof(fr))){
        fputc(ch ^ code, fw);
    }
    fclose(fw);
    fclose(fr);
}
```

---

## 

- 

* window  '\r\n'linux '\n'

- 

* windows '\n''\r\n'linux '\n''\n'windows '\r\n''\n'linux '\n''\n'
* linux  windows windows  linux 

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fw = fopen("test.txt", "w+");
    fputc('a', fw);
    fputc('\n', fw);
    fputc('b', fw);
    fclose(fw);
    return 0;
}
```

![](https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/1d80c69a41198813f0bb19cef89b74ea.png)

---

- 

|        | int fputs(char *str,FILE *fp)             |
| -------------- | ----------------------------------------- |
|        | stdio.h                                   |
|        |  str  fp  |
|  |                                           |
|            | char \* str :     |
|            | FILE \*fp :         |
|          | int  0 EOF              |

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fw = fopen("test.txt", "w+");
    // : fputs\n
    fputs("lnj\n", fw);
    fputs("it666\n", fw);
    fclose(fw);
    return 0;
}
```

- \0 

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp = fopen("test.txt", "w+");
    // : fputs\0
    fputs("lnj\0it666\n", fp);

    fclose(fp);
    return 0;
}
```

---

- 

|        | char *fgets(char *str,int length,FILE \*fp)                                                                                                                     |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|        | stdio.h                                                                                                                                                         |
|        |  fp  length-1  str   length-1 \n  EOF‘\0’ |
|  |                                                                                                                                                                 |
|            | char \* str :                                                                                                                         |
|            | int length :                                                                                                                              |
|            | FILE\* fp :                                                                                                                                         |
|          | char \*  str   NULL                                                                                                   |

-  N-1 

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp = fopen("test.txt", "w+");
    // : fputs\n
    fputs("it666\n", fp);

    // FILE
    // : FILE
    rewind(fp);
    char str[1024];
    // fp4, str
    // N-1, \0
    fgets(str, 4, fp);

    printf("str = %s", str); // it6
    fclose(fp);
    return 0;
}
```

- \n 

```c showLineNumbers
#include <stdio.h>
int main()
{
    FILE *fp = fopen("test.txt", "w+");
    // : fputs\n
    fputs("lnj\n", fp);
    fputs("it666\n", fp);

    // FILE
    // : FILE
    rewind(fp);
    char str[1024];
    // fp1024, str
    // 4\n, 
    // : \n
    fgets(str, 1024, fp);

    printf("str = %s", str); // lnj
    fclose(fp);
    return 0;
}
```

-  EOF 

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp = fopen("test.txt", "w+");
    // : fputs\n
    fputs("lnj\n", fp);
    fputs("it666", fp);

    // FILE
    // : FILE
    rewind(fp);
    char str[1024];
    // fp1024, str
    // 
    while(fgets(str, 1024, fp)){
        printf("str = %s", str);
    }
    fclose(fp);
    return 0;
}
```

- :
  -  feof  feof 
  - ‘\n’

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp = fopen("test.txt", "w+");
    // : fputs\n
    fputs("12345678910\n", fp);
    fputs("12345678910\n", fp);
    fputs("12345678910", fp);

    // FILE
    // : FILE
    rewind(fp);
    char str[1024];
    // fp1024, str
    // 
    while(fgets(str, 1024, fp) && !feof(fp)){
        printf("str = %s", str);
    }
    fclose(fp);
    return 0;
}
```

- :
  -  fgets(str, 5, fp)?

```bash showLineNumbers
12345678910
12345
123
```

---

## 

- C 
-  '\0' '\n' EOF(0xFF) '\0' '\n'  +

* 

|  | int fwrite(void *buffer, int num_bytes, int count, FILE *fp) |
| -------- | ------------------------------------------------------------ |
|  | stdio.h                                                      |
|  |  buffer  fp                      |
|      | char \* buffer :           |
|          | int num_bytes:  count                  |
|          | int count :                                  |
|          | FILE\* fp :                                    |
|    | int  0           |

```c showLineNumbers
#include <stdio.h>
#include <string.h>

int main()
{
    FILE *fp = fopen("test.txt", "wb+");
    // : fwrite
    char *str = "lnj\0it666";
     /*
     * : 
     * : 
     * : 
     * : 
     */
    fwrite((void *)str, 9, 1, fp);

    fclose(fp);
    return 0;
}
```

- 

|  | int fread(void *buffer, int num_bytes, int count, FILE *fp) |
| -------- | ----------------------------------------------------------- |
|  | stdio.h                                                     |
|  |  fp  buffer                     |
|      | char \* buffer :          |
|          | int num_bytes:  count                 |
|          | int count :                                 |
|          | FILE\* fp :                                   |
|    | int  0          |

```c showLineNumbers
#include <stdio.h>

int main()
{
    // test.txt"lnj\0it666"
    FILE *fr = fopen("test.txt", "rb+");
    char buf[1024] = {0};
    // fread, 0
    /*
     * : 
     * : 
     * : 
     * : 
     */
    int n = fread(buf, 1, 1024, fr);
    printf("%i\n", n);
    for(int i = 0; i < n; i++){
        printf("%c", buf[i]);
    }
    fclose(fr);
    return 0;
}
```

> - :
> -  num_bytes ,  count 
> -  num_bytes , 
> - :  char  6C 6E 6A 00 69 74 36 36 36
>    num_bytes  1, count  1024,  6C 6E 6A 00 69 74 36 36 36 , 
>    num_bytes  4, count  1024, [6C 6E 6A 00][69 74 36 36] ,  36,  4 ,  36 

```c showLineNumbers
#include <stdio.h>
#include <string.h>

int main()
{

    // test.txt"lnj\0it666"
    FILE *fr = fopen("test.txt", "rb+");
    char buf[1024] = {0};
    /*
    while(fread(buf, 4, 1, fr) > 0){
        printf("%c\n", buf[0]);
        printf("%c\n", buf[1]);
        printf("%c\n", buf[2]);
        printf("%c\n", buf[3]);
    }
    */
    /*
    while(fread(buf, 1, 4, fr) > 0){
        printf("%c\n", buf[0]);
        printf("%c\n", buf[1]);
        printf("%c\n", buf[2]);
        printf("%c\n", buf[3]);
    }
    */
    while(fread(buf, 1, 1, fr) > 0){
        printf("%c\n", buf[0]);
    }
    fclose(fr);
    return 0;
}
```

> - : fwrite  fread 
> - 

```c showLineNumbers
#include <stdio.h>

int main()
{

    FILE *fp = fopen("test.txt", "wb+");
    int ages[4] = {1, 3, 5, 6};
    fwrite(ages, sizeof(ages), 1, fp);
    rewind(fp);
    int data;
    while(fread(&data, sizeof(int), 1, fp) > 0){
        printf("data = %i\n", data);
    }
    return 0;
}
```

## 

- 
- 

```c showLineNumbers
#include <stdio.h>

typedef struct{
    char *name;
    int age;
    double height;
} Person;

int main()
{
    Person p1 = {"lnj", 35, 1.88};
//    printf("name = %s\n", p1.name);
//    printf("age = %i\n", p1.age);
//    printf("height = %lf\n", p1.height);

    FILE *fp = fopen("person.stu", "wb+");
    fwrite(&p1, sizeof(p1), 1, fp);

    rewind(fp);
    Person p2;
    fread(&p2, sizeof(p2), 1, fp);
    printf("name = %s\n", p2.name);
    printf("age = %i\n", p2.age);
    printf("height = %lf\n", p2.height);

    return 0;
}
```

- 

```c showLineNumbers
#include <stdio.h>

typedef struct{
    char *name;
    int age;
    double height;
} Person;

int main()
{
    Person ps[] = {
      {"zs", 18, 1.65},
      {"ls", 21, 1.88},
      {"ww", 33, 1.9}
    };


    FILE *fp = fopen("person.stu", "wb+");
    fwrite(&ps, sizeof(ps), 1, fp);

    rewind(fp);
    Person p;
    while(fread(&p, sizeof(p), 1, fp) > 0){
        printf("name = %s\n", p.name);
        printf("age = %i\n", p.age);
        printf("height = %lf\n", p.height);
    }
    return 0;
}
```

- 

```c showLineNumbers
#include <stdio.h>
#include <stdlib.h>

typedef struct person{
    char *name;
    int age;
    double height;
    struct person* next;
} Person;
Person *createEmpty();
void  insertNode(Person *head, char *name, int age, double height);
void printfList(Person *head);
int saveList(Person *head, char *name);
Person *loadList(char *name);

int main()
{

//    Person *head = createEmpty();
//    insertNode(head, "zs", 18, 1.9);
//    insertNode(head, "ls", 22, 1.65);
//    insertNode(head, "ws", 31, 1.78);
//    printfList(head);
//    saveList(head, "person.list");
    Person *head = loadList("person.list");
    printfList(head);
    return 0;
}

/**
 * @brief loadList 
 * @param name 
 * @return  
 */
Person *loadList(char *name){
    // 1.
    FILE *fp = fopen(name, "rb+");
    if(fp == NULL){
        return NULL;
    }
    // 2.
    Person *head = createEmpty();
    // 3.
    Person *node = (Person *)malloc(sizeof(Person));
    while(fread(node, sizeof(Person), 1, fp) > 0){
        // 3.
        // 3.1  
        node->next = head->next;
        // 3.2  
        head->next = node;

        // 
        node = (Person *)malloc(sizeof(Person));
    }
    // 
    free(node);
    fclose(fp);
    return head;
}

/**
 * @brief saveList 
 * @param head 
 * @param name 
 * @return   -1 0
 */
int saveList(Person *head, char *name){
    // 1.
    FILE *fp = fopen(name, "wb+");
    if(fp == NULL){
        return -1;
    }
    // 2.
    Person *cur = head->next;
    // 3.
    while(cur != NULL){
        fwrite(cur, sizeof(Person), 1, fp);
        cur = cur->next;
    }
    fclose(fp);
    return 0;
}
/**
 * @brief printfList 
 * @param head 
 */
void printfList(Person *head){
    // 1.
    Person *cur = head->next;
    // 2.NULL, NULL
    while(cur != NULL){
        // 2.1, 
        printf("name = %s\n", cur->name);
        printf("age = %i\n", cur->age);
        printf("height = %lf\n", cur->height);
        printf("next = %x\n", cur->next);
        printf("-----------\n");
        // 2.2
        cur = cur->next;
    }
}

/**
 * @brief insertNode 
 * @param head 
 * @param p 
 */
void  insertNode(Person *head, char *name, int age, double height){
    // 1.
    Person *node = (Person *)malloc(sizeof(Person));
    // 2.
    node->name = name;
    node->age = age;
    node->height = height;

    // 3.
    // 3.1  
    node->next = head->next;
    // 3.2  
    head->next = node;
}
/**
 * @brief createEmpty 
 * @return , NULL
 */
Person *createEmpty(){
    // 1.
    Person *head = NULL;
    // 2., 
    head = (Person *)malloc(sizeof(Person));
    if(head == NULL){
        return head;
    }
    head->next = NULL;
    // 3.
    return head;
}
```

## 

- ftell 

|        | long ftell ( FILE \* stream );                                         |
| -------------- | ---------------------------------------------------------------------- |
|        | stdio.h                                                                |
|        | ,. |
|  |                                                                        |
|            | FILE \*                                                      |
|          | int  -1          |

```c showLineNumbers
#include <stdio.h>

int main()
{
    char *str = "123456789";
    FILE *fp = fopen("test.txt", "w+");
    long cp = ftell(fp);
    printf("cp = %li\n", cp); // 0
    // 
    fputc(str[0], fp);
    cp = ftell(fp);
    printf("cp = %li\n", cp); // 1
    fclose(fp);
    return 0;
}
```

- rewind 

|                                   | void rewind ( FILE \* stream ); |
| ----------------------------------------- | ------------------------------- |
|                                   | stdio.h                         |
|   |                                 |
|                             |                                 |
|                                       | FILE \*               |
|                                     | void                    |

```c showLineNumbers
#include <stdio.h>

int main()
{
    char *str = "123456789";
    FILE *fp = fopen("test.txt", "w+");
    long cp = ftell(fp);
    printf("cp = %li\n", cp); // 0
    // 
    fputc(str[0], fp);
    cp = ftell(fp);
    printf("cp = %li\n", cp); // 1
    // 
    rewind(fp);
    cp = ftell(fp);
    printf("cp = %li\n", cp); // 0
    fclose(fp);
    return 0;
}
```

- fseek 

|        | int fseek ( FILE \* stream, long offset, int where); |
| -------------- | ---------------------------------------------------- |
|        | stdio.h                                              |
|        |                                        |
|  |                                                      |
|            | FILE \* stream                               |
|                | long offset                                    |
|                | int where                                |
|          | int  0 -1                          |

- 

```c showLineNumbers
#define SEEK_CUR 1 
#define SEEK_END 2 
#define SEEK_SET 0 
```

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp = fopen("test.txt", "w+");
    fputs("123456789", fp);
    // , 0
    fseek(fp, 0, SEEK_END);
    int len = ftell(fp); // 
    printf("len = %i\n", len);
    fclose(fp);
    return 0;
}
```

```c showLineNumbers
#include <stdio.h>

int main()
{
    FILE *fp;
   fp = fopen("file.txt","w+");
   fputs("123456789", fp);

   fseek( fp, 7, SEEK_SET );
   fputs("lnj", fp);
   fclose(fp);
    return 0;
}
```