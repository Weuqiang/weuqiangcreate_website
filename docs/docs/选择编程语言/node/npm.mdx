# NPM

## .npmrc

NPM

``` shell
registry=https://registry.npmjs.org/
package-lock=false # NPM
```



## 

### npm config

``` shell
npm config set registry https://registry.npmjs.org/
npm config get prefix 
npm config delete registry
npm config 
```

### npm init

`package.json`

``` shell
npm init -y
```

### npm install

``` shell
npm install <name> --save # yarn add <name>
npm install <name> --save-dev # yarn add <name> -D
npm install -g <name> # yarn global add <name>

npm install
npm ci # CI package-lock.json npm-shrinkwrap.json package.json package-lock.json npm ci
```



`/project/node_modules``package.json``bin``bin``/project/node_modules/.bin`

`/usr/local/lib/node_modules`MacOS`package.json``bin``bin``/usr/local/bin`Windows



`akara-project``package.json``bin``akara-project``/usr/local/bin/akara``akara-project``index.js`

``` json
{
  "bin": {
    "akara": "index.js"
	}
}
```



### npm uninstall

``` shell
npm uninstall <name> # yarn remove <name>
```

### npm update

``` shell
npm update <name> # yarn upgrade <name>

npm update
```



`react@^16.0.0`CI`16.0.0``react``react``npm install react``npm update react``react``package.json``npm update``package.json``package.json``semver``react``package-lock.json`

### npm outdated



``` shell
npm outdated 
```

### npm run 

``` shell
npm run start # 
npm run-script <stage>
```

### npm link

> alias: npm ln





`akara-project``npm link``/usr/local/lib/node_modules``akara-project``package.json``bin``/usr/local/bin`



`pm2``npm link webpack``node_modules``pm2``pm2``package.json``bin``/project/node_modules/.bin`



ABABBAB`npm link`B`npm link`BA`npm link B`BA



### npm exec

`node_modules/.bin`

``` shell
npm exec webpack # npx webpack
```



### npm publish

``` shell
npm publish # 
npm unpublish --force # 

npm publish --access publish # 
```



`npm login``npm``npm publish`NPM

`@akara/my-package``npm publish --access publish`NPM



NPM`.gitignore``.npmignore``package.json``files`

1. `.gitignore`
2. `.npmignore`
3. `package.json` `files`

### npm view



``` shell
npm view <name> # e.g npm view antd
```

### npm version

``` shell
npm version # 
npm version patch # git commitgit tagv1.0.1
npm version minor # v1.1.1
npm version major # v2.0.0
```

### npm audit

``` shell
npm audit # 
npm audit --fix # 
```



### npm fund

``` shell
npm fund
```

/





## package.json

### type

`.cjs``CommonJS``.mjs``ES``.js``type``type``CommonJS``type: 'module'``ES`



### files

`files``"files": ["dist", "README.md"]`

`package.json``README``CHANGE / CHANGELOG / HISTORY 	``LICENSE / LICENCE``NOTICE``main`

### main

 `index.js`

```js
const test = require('my-module') // my-moduleindex.js
```

### exports

`main``exports``main``exports`

```json
{
    "exports": {
        ".": "./index.js", 
        "./test": "./src/test.js" 
    }
}
```

```js
const test = require('my-module') // ./index.js
const test2 = require('my-module/test') // ./src/test.js
```

`exports``exports`

`exports` `require` `import`

```json
{
    "exports": {
        ".": {
            "require": "./a.js",
            "import": "./b.mjs"
        }
    }
}
```



### bin

`npm install``package.json``bin`

``` json
{
	"bin": {
    "akara": "index.js"
	}
}
```

`akara-project``akara-project``/usr/local/bin/akara``/usr/local/lib/node_modules/akara-project/index.js``akara``index.js``index.js``index.js``#!/usr/bin/env node``chmod +x index.js`



`akara-project``akara``project/node_modules/.bin``akara`

1. `./node_modules/.bin/akara`

2. `package.json` `script`

   ```1
   {
       "script": {
           "run-my-script": "akara"
       }
   }
   ```

3. `npm exec akara`

4. `npx akara`

### script

`npm` `npm ci``npm install` `hook script``pre/post script` `lifecycle script`

#### pre & Post 

 `pre` `post`

```json
{
    "script": {
        "test": "echo \"i'm test\"",
        "pretest": "echo \"test\"",
        "posttest": "echo \"test\""
    }
}
```

#### LifeCycle

`npm``prepare``prepack`

```json
{
    "script": {
        "prepare": "echo \"hello akara\""
    }
}
```

### dependencies



### devDependencies

NPMA `npm install A`AA

### peerDependencies

ABBAAB `package.json` `peerDependencies`B1.0A `peerDependencies` `A@1.0.0`B2.0A



### resolutions

`react-router``react-router``@types/react: '*'``react-router``@types/react``@types/react``v18``@types/react``package.json``resolutions``yarn install`[Selective dependency resolutions](https://classic.yarnpkg.com/lang/en/docs/selective-version-resolutions/)

``` json
{
  resolutions: {
    '@types/react': '^17.0.0'
  }
}
```







### browser | module

 `browser` `cjs` `umd``module` `es`

 `webpack` `webpack` `target` `web` `browser` `target` `node` `module`

 `package.json` `browser -> module -> main` `resolve.mainFields`

```js
// webpack.config.js
module.exports = {
    target: 'node', // web
    resolve: {
        mainFields: ['main', 'module', 'browser'] //  ['browser', 'module', 'main']
    }
}
```

## package-lock.json

 `package.json` `dependencies` `"react": "^17.0.2"``"xx": "~0.10.0"`[`semver`](https://github.com/npm/node-semver)

 `npm install <name>` `npm update` `semver`****

- `^` `^0.10.0``0.10.1` `0.11.0` `^1.10.0` `1.10.1``1.11.0` `2.0.0`
- `~` `~` `~1.10.0` `1.10.x` `1.11.0`



`yarn``npm``lock``npm install <name>``npm update``package-lock.json``yarn``yarn.lock``clone``npm install``package-lock.json`



---

[](https://www.zhihu.com/question/65536076)

 `lock` `package-lock.json` `.gitignore`

 `lock` `package-lock.json` `lock` `.npmrc` `package-lock=false` `lock` `package-lock.json`[](https://www.zhihu.com/question/264560841)





## node_modules

 `NPM``node_modules`

```
- A -> B
- C -> B
```

 `NPM@3.x``node_modules`ACB `node_modules`

```
- A
- C
- B
```

ACB

1.  `node_modules` `B@1.1.0`A `B@^1.1.0`B `1.9.0`

   ```
   - A
   - B@1.1.0
   ```
2.  `node_modules` `B@1.1.0`A `B@^1.2.0` `B@1.9.0`

   ```
   - A -> B@1.9.0 
   - B@1.1.0
   ```



