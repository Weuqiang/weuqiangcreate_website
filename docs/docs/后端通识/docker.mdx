---
sidebarDepth: 4
---

# Docker

Docker""

## 


- **Image**
- **Container**
- **Registry**GitHub

## 

```bash
# 
docker images
docker image ls

# 
docker search nginx

# 
docker pull nginx
docker pull nginx:1.21  # 

# 
docker rmi nginx
docker image rm nginx

# 
docker inspect nginx

# 
docker history nginx

# /
docker save nginx > nginx.tar
docker load < nginx.tar
```

## 

### 

```bash
# 
docker run nginx

# 
docker run -d nginx

# 
docker run -d -p 8080:80 nginx  # 8080 -> 80

# 
docker run -d --name my-nginx nginx

# 
docker run -d -v /host/path:/container/path nginx

# 
docker run -d -e MYSQL_ROOT_PASSWORD=123456 mysql

# 
docker run -it ubuntu /bin/bash

# 
docker run -d \
  --name my-app \
  -p 3000:3000 \
  -v $(pwd):/app \
  -e NODE_ENV=production \
  node:16
```

### 

```bash
# 
docker ps              # 
docker ps -a           # 

# //
docker start <container>
docker stop <container>
docker restart <container>

# 
docker rm <container>
docker rm -f <container>  # 

# 
docker exec -it <container> /bin/bash
docker attach <container>  # 

# 
docker logs <container>
docker logs -f <container>  # 
docker logs --tail 100 <container>  # 100

# 
docker inspect <container>

# 
docker stats
docker stats <container>

# 
docker cp <container>:/path/to/file ./local/path
docker cp ./local/file <container>:/path/to/
```

## 

### Dockerfile

```dockerfile
# 
FROM node:16-alpine

# 
WORKDIR /app

# 
COPY package*.json ./

# 
RUN npm install --production

# 
COPY . .

# 
EXPOSE 3000

# 
ENV NODE_ENV=production

# 
CMD ["node", "server.js"]
```

### 

```bash
# 
docker build -t my-app:1.0 .
docker build -t my-app:latest .

# 
docker history my-app

# 
docker tag my-app:1.0 username/my-app:1.0

#  Docker Hub
docker login

# 
docker push username/my-app:1.0

# 
docker logout
```

### Dockerfile 

```dockerfile
# 
FROM node:16-alpine

# 
WORKDIR /app

# 
COPY package*.json ./
RUN npm ci --only=production

# 
COPY . .

#  root 
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001
USER nodejs

# 
EXPOSE 3000

# 
HEALTHCHECK --interval=30s --timeout=3s \
  CMD node healthcheck.js

# 
CMD ["node", "server.js"]
```

### .dockerignore

```
node_modules
npm-debug.log
.git
.gitignore
README.md
.env
.DS_Store
dist
coverage
```

## Docker Compose

Docker Compose 

### docker-compose.yml

```yaml
version: '3.8'

services:
  # Web 
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=db
    depends_on:
      - db
      - redis
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  # 
  db:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=myapp
    volumes:
      - db-data:/var/lib/mysql
    ports:
      - "3306:3306"

  # Redis
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"

  # Nginx
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - web

volumes:
  db-data:
```

### Compose 

```bash
# 
docker-compose up
docker-compose up -d  # 

# 
docker-compose down
docker-compose down -v  #  volumes

# 
docker-compose ps

# 
docker-compose logs
docker-compose logs -f web  #  web 

# 
docker-compose restart
docker-compose restart web

# 
docker-compose build
docker-compose build --no-cache

# 
docker-compose exec web npm install
docker-compose exec db mysql -u root -p

# 
docker-compose up -d --scale web=3
```

## 

### Node.js 

```dockerfile
FROM node:16-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 3000

CMD ["node", "server.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      - ./logs:/app/logs
```

### Nginx

```dockerfile
# 
FROM node:16-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# 
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 

```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend

  backend:
    build: ./backend
    ports:
      - "3000:3000"
    environment:
      - DB_HOST=db
      - REDIS_HOST=redis
    depends_on:
      - db
      - redis

  db:
    image: postgres:14
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=myapp
    volumes:
      - db-data:/var/lib/postgresql/data

  redis:
    image: redis:alpine

volumes:
  db-data:
```

## 

### Volume

```bash
#  volume
docker volume create my-data

#  volumes
docker volume ls

#  volume 
docker volume inspect my-data

#  volume
docker volume rm my-data

#  volumes
docker volume prune

#  volume
docker run -d -v my-data:/app/data nginx
```

### Bind Mount

```bash
# 
docker run -d -v /host/path:/container/path nginx
docker run -d -v $(pwd):/app node:16

# 
docker run -d -v $(pwd):/app:ro nginx
```

## 

```bash
# 
docker network ls

# 
docker network create my-network

# 
docker network inspect my-network

# 
docker network rm my-network

# 
docker network connect my-network my-container

# 
docker run -d --network my-network nginx
```

## 

```bash
# 
docker container prune

# 
docker image prune
docker image prune -a  # 

#  volumes
docker volume prune

# 
docker network prune

# 
docker system prune
docker system prune -a --volumes

# 
docker system df
```

## 

### 

```bash
# 
docker logs <container>

# 
docker inspect <container>

# 
docker exec -it <container> /bin/sh
```

### 

```bash
# 
netstat -ano | findstr :3000  # Windows
lsof -i :3000                 # Linux/Mac

# 
docker run -d -p 3001:3000 my-app
```

### 



```bash
docker pull nginx --registry-mirror=https://xxx.mirror.aliyuncs.com
```

## 

1. **** alpine 
2. **** Dockerfile 
3. ****
4. ** .dockerignore**
5. **** volume 
6. ** root **
7. ****
8. ****

```bash
#  CPU 
docker run -d \
  --cpus=".5" \
  --memory="512m" \
  nginx
```

## 

- [Docker ](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Dockerfile ](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
