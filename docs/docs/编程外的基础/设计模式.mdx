---
sidebarDepth: 4
---
# 



## 

### 



****

```javascript
// 
const Singleton = (function() {
  let instance;
  
  function createInstance() {
    return {
      name: 'Singleton',
      getData() {
        return 'data';
      }
    };
  }
  
  return {
    getInstance() {
      if (!instance) {
        instance = createInstance();
      }
      return instance;
    }
  };
})();

const instance1 = Singleton.getInstance();
const instance2 = Singleton.getInstance();
console.log(instance1 === instance2);  // true

// ES6 
class Singleton {
  constructor() {
    if (Singleton.instance) {
      return Singleton.instance;
    }
    this.name = 'Singleton';
    Singleton.instance = this;
  }
  
  getData() {
    return 'data';
  }
}

// 
class Store {
  constructor() {
    if (Store.instance) {
      return Store.instance;
    }
    this.state = {};
    Store.instance = this;
  }
  
  getState(key) {
    return this.state[key];
  }
  
  setState(key, value) {
    this.state[key] = value;
  }
}

const store1 = new Store();
const store2 = new Store();
store1.setState('user', 'zhangsan');
console.log(store2.getState('user'));  // 'zhangsan'
```



### -

```javascript
// NodeEventEmitter 
class EventEmitter {
      constructor() {
          this.list = {}
      }

      on(name, fn, type = 1) {
          if (!this.list[name]) {
              this.list[name] = []
          }
          this.list[name].push([fn, type])

      }

      once(name, fn, type = 0) {
          this.on(name, fn, type)
      }

      emit(name, ...args) {
          let fns = this.list[name]
          if (!fns || fns.length === 0) return
          fns.forEach((fn, index) => {
              fn[0].apply(this, args)
              if (fn[1] === 0) {
                  fns.splice(index, 1)
              }
          })
      }

      remove(name, func) {
          let fns = this.list[name]
          if (!fns) {
              this.list[name] = []
          }
          fns.forEach((fn, index) => {
              if (fn[0] === func) {
                  fns.splice(index, 1)
              }
          })
      }
  }

let bus = new EventEmitter()

bus.on("click", (value) => {
	console.log(value)
})

bus.emit("click", 111)
```

### 

```javascript
class Publisher {
      constructor() {
          this.list = []
      }

      addListener(listener) {
          this.list.push(listener)
      }

      removeListener(listener) {
          this.list.forEach((item, index) => {
              if (listener === item) {
                  this.list.splice(index, 1)
              }
          })
      }

      notify(obj) {
          this.list.forEach((item) => {
              item.process(obj)
          })
      }
  }

class Subscriber {
    process(obj) {
        console.log(obj.name)
    }
}
```

### MVC

MVC (Model-View-Controller) 

- Model
- View
- Controller



1. View  Controller
2. Controller  Model 
3. Model  View

![](https://www.ruanyifeng.com/blogimg/asset/2015/bg2015020105.png)

### MVVM

MVVMModel-View-ViewModel

MVCViewModelViewModel

![](https://www.ruanyifeng.com/blogimg/asset/2015/bg2015020110.png)

### 



****

```javascript
// 
class CarFactory {
  static createCar(type) {
    switch (type) {
      case 'BMW':
        return new BMW();
      case 'Audi':
        return new Audi();
      case 'Mercedes':
        return new Mercedes();
      default:
        throw new Error('Unknown car type');
    }
  }
}

class BMW {
  constructor() {
    this.brand = 'BMW';
    this.type = 'Luxury';
  }
  
  drive() {
    console.log('Driving a BMW');
  }
}

class Audi {
  constructor() {
    this.brand = 'Audi';
    this.type = 'Luxury';
  }
  
  drive() {
    console.log('Driving an Audi');
  }
}

// 
const bmw = CarFactory.createCar('BMW');
bmw.drive();

// 
class UserFactory {
  static createUser(role) {
    switch (role) {
      case 'admin':
        return new Admin();
      case 'user':
        return new User();
      case 'guest':
        return new Guest();
      default:
        throw new Error('Invalid role');
    }
  }
}

class Admin {
  constructor() {
    this.role = 'admin';
    this.permissions = ['read', 'write', 'delete'];
  }
}

class User {
  constructor() {
    this.role = 'user';
    this.permissions = ['read', 'write'];
  }
}

class Guest {
  constructor() {
    this.role = 'guest';
    this.permissions = ['read'];
  }
}
```

## 

### 



****

```javascript
// 
class Coffee {
  cost() {
    return 5;
  }
  
  description() {
    return 'Simple coffee';
  }
}

// 
class MilkDecorator {
  constructor(coffee) {
    this.coffee = coffee;
  }
  
  cost() {
    return this.coffee.cost() + 2;
  }
  
  description() {
    return this.coffee.description() + ', milk';
  }
}

// 
class SugarDecorator {
  constructor(coffee) {
    this.coffee = coffee;
  }
  
  cost() {
    return this.coffee.cost() + 1;
  }
  
  description() {
    return this.coffee.description() + ', sugar';
  }
}

// 
let coffee = new Coffee();
coffee = new MilkDecorator(coffee);
coffee = new SugarDecorator(coffee);
console.log(coffee.description());  // Simple coffee, milk, sugar
console.log(coffee.cost());         // 8

// 
function log(target, name, descriptor) {
  const original = descriptor.value;
  descriptor.value = function(...args) {
    console.log(`Calling ${name} with`, args);
    const result = original.apply(this, args);
    console.log(`Result:`, result);
    return result;
  };
  return descriptor;
}

class Calculator {
  @log
  add(a, b) {
    return a + b;
  }
}

// 
function withLogging(fn) {
  return function(...args) {
    console.log(`Calling function with`, args);
    const result = fn.apply(this, args);
    console.log(`Result:`, result);
    return result;
  };
}

const add = (a, b) => a + b;
const addWithLogging = withLogging(add);
addWithLogging(2, 3);  // 
```

### 



```javascript
// 
class DiscountStrategy {
    calculate(amount) {
        throw new Error('calculate method must be implemented');
    }
}

class RegularCustomer extends DiscountStrategy {
    calculate(amount) {
        return amount;
    }
}

class PremiumCustomer extends DiscountStrategy {
    calculate(amount) {
        return amount * 0.9; // 10% 
    }
}

class VIPCustomer extends DiscountStrategy {
    calculate(amount) {
        return amount * 0.8; // 20% 
    }
}

// 
class ShoppingCart {
    constructor(discountStrategy) {
        this.discountStrategy = discountStrategy;
        this.amount = 0;
    }
    
    setDiscountStrategy(discountStrategy) {
        this.discountStrategy = discountStrategy;
    }
    
    addItem(price) {
        this.amount += price;
    }
    
    calculateTotal() {
        return this.discountStrategy.calculate(this.amount);
    }
}

// 
const cart = new ShoppingCart(new RegularCustomer());
cart.addItem(100);
cart.addItem(50);
console.log(cart.calculateTotal()); // 150

cart.setDiscountStrategy(new VIPCustomer());
console.log(cart.calculateTotal()); // 120
```

### 



****

```javascript
// 
class RealImage {
  constructor(filename) {
    this.filename = filename;
    this.loadFromDisk();
  }
  
  loadFromDisk() {
    console.log(`Loading ${this.filename} from disk...`);
  }
  
  display() {
    console.log(`Displaying ${this.filename}`);
  }
}

class ProxyImage {
  constructor(filename) {
    this.filename = filename;
    this.realImage = null;
  }
  
  display() {
    if (!this.realImage) {
      this.realImage = new RealImage(this.filename);
    }
    this.realImage.display();
  }
}

// 
const image = new ProxyImage('photo.jpg');
image.display();  // 
image.display();  // 

// 
function createCacheProxy(fn) {
  const cache = new Map();
  
  return function(...args) {
    const key = JSON.stringify(args);
    
    if (cache.has(key)) {
      console.log('');
      return cache.get(key);
    }
    
    const result = fn.apply(this, args);
    cache.set(key, result);
    return result;
  };
}

function expensiveCalculation(n) {
  console.log('...');
  return n * n;
}

const cachedCalculation = createCacheProxy(expensiveCalculation);
console.log(cachedCalculation(5));  // 
console.log(cachedCalculation(5));  // 

// ES6 Proxy 
const handler = {
  get(target, property) {
    console.log(`Getting ${property}`);
    return target[property];
  },
  set(target, property, value) {
    console.log(`Setting ${property} to ${value}`);
    target[property] = value;
    return true;
  }
};

const obj = { name: 'zhangsan' };
const proxy = new Proxy(obj, handler);
console.log(proxy.name);  // Getting name
proxy.age = 25;           // Setting age to 25
```

### 



****

```javascript
// 
class OldPrinter {
  oldPrint(text) {
    console.log(`Old printer: ${text}`);
  }
}

// 
class NewPrinter {
  print(text) {
    console.log(`New printer: ${text}`);
  }
}

// 
class PrinterAdapter {
  constructor(oldPrinter) {
    this.oldPrinter = oldPrinter;
  }
  
  print(text) {
    this.oldPrinter.oldPrint(text);
  }
}

// 
const oldPrinter = new OldPrinter();
const adapter = new PrinterAdapter(oldPrinter);
adapter.print('Hello World');  // Old printer: Hello World

// 
class XMLDataAdapter {
  constructor(xmlData) {
    this.xmlData = xmlData;
  }
  
  toJSON() {
    //  XML  JSON
    return JSON.parse(this.xmlData);
  }
}

class JSONDataAdapter {
  constructor(jsonData) {
    this.jsonData = jsonData;
  }
  
  toJSON() {
    return this.jsonData;
  }
}
```

## 

### 



****

```javascript
class Subject {
  constructor() {
    this.observers = [];
  }
  
  addObserver(observer) {
    this.observers.push(observer);
  }
  
  removeObserver(observer) {
    const index = this.observers.indexOf(observer);
    if (index > -1) {
      this.observers.splice(index, 1);
    }
  }
  
  notify(data) {
    this.observers.forEach(observer => observer.update(data));
  }
}

class Observer {
  constructor(name) {
    this.name = name;
  }
  
  update(data) {
    console.log(`${this.name} received:`, data);
  }
}

// 
const subject = new Subject();
const observer1 = new Observer('Observer 1');
const observer2 = new Observer('Observer 2');

subject.addObserver(observer1);
subject.addObserver(observer2);
subject.notify('Hello');  // 

// 
class Stock {
  constructor(symbol, price) {
    this.symbol = symbol;
    this.price = price;
    this.investors = [];
  }
  
  attach(investor) {
    this.investors.push(investor);
  }
  
  setPrice(price) {
    this.price = price;
    this.notifyInvestors();
  }
  
  notifyInvestors() {
    this.investors.forEach(investor => {
      investor.update(this);
    });
  }
}

class Investor {
  constructor(name) {
    this.name = name;
  }
  
  update(stock) {
    console.log(`${this.name}: ${stock.symbol} price changed to ${stock.price}`);
  }
}

const stock = new Stock('AAPL', 150);
const investor1 = new Investor('');
const investor2 = new Investor('');

stock.attach(investor1);
stock.attach(investor2);
stock.setPrice(155);  // 
```

### -



****

```javascript
class EventEmitter {
  constructor() {
    this.events = {};
  }

  on(eventName, callback) {
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    this.events[eventName].push(callback);
  }

  once(eventName, callback) {
    const wrapper = (...args) => {
      callback.apply(this, args);
      this.off(eventName, wrapper);
    };
    this.on(eventName, wrapper);
  }

  emit(eventName, ...args) {
    const callbacks = this.events[eventName];
    if (callbacks) {
      callbacks.forEach(callback => callback.apply(this, args));
    }
  }

  off(eventName, callback) {
    const callbacks = this.events[eventName];
    if (callbacks) {
      this.events[eventName] = callbacks.filter(cb => cb !== callback);
    }
  }
}

// 
const bus = new EventEmitter();

bus.on('click', (value) => {
  console.log('Clicked:', value);
});

bus.emit('click', 111);  // Clicked: 111

// 
class ComponentA {
  constructor(eventBus) {
    this.eventBus = eventBus;
  }
  
  sendMessage(msg) {
    this.eventBus.emit('message', msg);
  }
}

class ComponentB {
  constructor(eventBus) {
    this.eventBus = eventBus;
    this.eventBus.on('message', this.handleMessage.bind(this));
  }
  
  handleMessage(msg) {
    console.log('ComponentB received:', msg);
  }
}

const eventBus = new EventEmitter();
const compA = new ComponentA(eventBus);
const compB = new ComponentB(eventBus);
compA.sendMessage('Hello from A');
```

### 



****

```javascript
// 
class DiscountStrategy {
  calculate(amount) {
    throw new Error('calculate method must be implemented');
  }
}

class RegularCustomer extends DiscountStrategy {
  calculate(amount) {
    return amount;
  }
}

class PremiumCustomer extends DiscountStrategy {
  calculate(amount) {
    return amount * 0.9;  // 10% 
  }
}

class VIPCustomer extends DiscountStrategy {
  calculate(amount) {
    return amount * 0.8;  // 20% 
  }
}

// 
class ShoppingCart {
  constructor(discountStrategy) {
    this.discountStrategy = discountStrategy;
    this.amount = 0;
  }
  
  setDiscountStrategy(discountStrategy) {
    this.discountStrategy = discountStrategy;
  }
  
  addItem(price) {
    this.amount += price;
  }
  
  calculateTotal() {
    return this.discountStrategy.calculate(this.amount);
  }
}

// 
const cart = new ShoppingCart(new RegularCustomer());
cart.addItem(100);
cart.addItem(50);
console.log(cart.calculateTotal());  // 150

cart.setDiscountStrategy(new VIPCustomer());
console.log(cart.calculateTotal());  // 120

// 
const validators = {
  required: (value) => value !== '' && value !== null && value !== undefined,
  email: (value) => /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(value),
  minLength: (min) => (value) => value.length >= min,
  maxLength: (max) => (value) => value.length <= max
};

class FormValidator {
  constructor() {
    this.rules = {};
  }
  
  addRule(field, validator, message) {
    if (!this.rules[field]) {
      this.rules[field] = [];
    }
    this.rules[field].push({ validator, message });
  }
  
  validate(data) {
    const errors = {};
    
    for (const field in this.rules) {
      for (const rule of this.rules[field]) {
        if (!rule.validator(data[field])) {
          if (!errors[field]) {
            errors[field] = [];
          }
          errors[field].push(rule.message);
        }
      }
    }
    
    return {
      isValid: Object.keys(errors).length === 0,
      errors
    };
  }
}

const validator = new FormValidator();
validator.addRule('username', validators.required, '');
validator.addRule('username', validators.minLength(3), '3');
validator.addRule('email', validators.required, '');
validator.addRule('email', validators.email, '');

const result = validator.validate({
  username: 'ab',
  email: 'invalid-email'
});
console.log(result);
```

### 



****/

```javascript
// 
class Light {
  turnOn() {
    console.log('Light is ON');
  }
  
  turnOff() {
    console.log('Light is OFF');
  }
}

// 
class Command {
  execute() {
    throw new Error('execute method must be implemented');
  }
  
  undo() {
    throw new Error('undo method must be implemented');
  }
}

// 
class TurnOnCommand extends Command {
  constructor(light) {
    super();
    this.light = light;
  }
  
  execute() {
    this.light.turnOn();
  }
  
  undo() {
    this.light.turnOff();
  }
}

class TurnOffCommand extends Command {
  constructor(light) {
    super();
    this.light = light;
  }
  
  execute() {
    this.light.turnOff();
  }
  
  undo() {
    this.light.turnOn();
  }
}

// 
class RemoteControl {
  constructor() {
    this.command = null;
    this.history = [];
  }
  
  setCommand(command) {
    this.command = command;
  }
  
  pressButton() {
    if (this.command) {
      this.command.execute();
      this.history.push(this.command);
    }
  }
  
  pressUndo() {
    if (this.history.length > 0) {
      const lastCommand = this.history.pop();
      lastCommand.undo();
    }
  }
}

// 
const light = new Light();
const turnOnCommand = new TurnOnCommand(light);
const turnOffCommand = new TurnOffCommand(light);
const remote = new RemoteControl();

remote.setCommand(turnOnCommand);
remote.pressButton();  // Light is ON
remote.pressUndo();    // Light is OFF

remote.setCommand(turnOffCommand);
remote.pressButton();  // Light is OFF
remote.pressUndo();    // Light is ON
```

## 

### MVC

MVC (Model-View-Controller) 

- **Model**
- **View**
- **Controller** Model  View

```javascript
// Model
class TodoModel {
  constructor() {
    this.todos = [];
  }
  
  addTodo(text) {
    this.todos.push({ id: Date.now(), text, completed: false });
  }
  
  removeTodo(id) {
    this.todos = this.todos.filter(todo => todo.id !== id);
  }
  
  toggleTodo(id) {
    const todo = this.todos.find(todo => todo.id === id);
    if (todo) {
      todo.completed = !todo.completed;
    }
  }
  
  getTodos() {
    return this.todos;
  }
}

// View
class TodoView {
  constructor() {
    this.app = document.getElementById('app');
  }
  
  render(todos) {
    this.app.innerHTML = todos.map(todo => `
      <div>
        <input type="checkbox" ${todo.completed ? 'checked' : ''} data-id="${todo.id}">
        <span>${todo.text}</span>
        <button data-id="${todo.id}"></button>
      </div>
    `).join('');
  }
  
  bindAddTodo(handler) {
    document.getElementById('add-btn').addEventListener('click', () => {
      const input = document.getElementById('todo-input');
      handler(input.value);
      input.value = '';
    });
  }
  
  bindToggleTodo(handler) {
    this.app.addEventListener('change', (e) => {
      if (e.target.type === 'checkbox') {
        handler(Number(e.target.dataset.id));
      }
    });
  }
  
  bindRemoveTodo(handler) {
    this.app.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        handler(Number(e.target.dataset.id));
      }
    });
  }
}

// Controller
class TodoController {
  constructor(model, view) {
    this.model = model;
    this.view = view;
    
    this.view.bindAddTodo(this.handleAddTodo.bind(this));
    this.view.bindToggleTodo(this.handleToggleTodo.bind(this));
    this.view.bindRemoveTodo(this.handleRemoveTodo.bind(this));
    
    this.updateView();
  }
  
  handleAddTodo(text) {
    this.model.addTodo(text);
    this.updateView();
  }
  
  handleToggleTodo(id) {
    this.model.toggleTodo(id);
    this.updateView();
  }
  
  handleRemoveTodo(id) {
    this.model.removeTodo(id);
    this.updateView();
  }
  
  updateView() {
    this.view.render(this.model.getTodos());
  }
}

// 
const app = new TodoController(new TodoModel(), new TodoView());
```

### MVVM

MVVM (Model-View-ViewModel)  View  Model 

****
- View  Model  ViewModel 
- 
- VueReact 

```javascript
//  MVVM 
class ViewModel {
  constructor(data) {
    this._data = data;
    this._observers = {};
    this.makeReactive(data);
  }
  
  makeReactive(obj) {
    Object.keys(obj).forEach(key => {
      let value = obj[key];
      const self = this;
      
      Object.defineProperty(obj, key, {
        get() {
          return value;
        },
        set(newValue) {
          if (value !== newValue) {
            value = newValue;
            self.notify(key, newValue);
          }
        }
      });
    });
  }
  
  watch(key, callback) {
    if (!this._observers[key]) {
      this._observers[key] = [];
    }
    this._observers[key].push(callback);
  }
  
  notify(key, value) {
    if (this._observers[key]) {
      this._observers[key].forEach(callback => callback(value));
    }
  }
}

// 
const vm = new ViewModel({ name: 'zhangsan', age: 25 });

vm.watch('name', (newValue) => {
  console.log('Name changed to:', newValue);
});

vm._data.name = 'lisi';  // Name changed to: lisi
```

## 

1. **SRP**
2. **OCP**
3. **LSP**
4. **ISP**
5. **DIP**

## 

- ****
- ****
- ****
- ****
- ****
- ****
