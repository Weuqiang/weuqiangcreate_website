---
sidebar_position: 3
title: 数据和C
---

# 数据和C

## 变量与常量

### 变量

变量是程序中用于存储数据的内存位置的名称。变量的值可以在程序执行过程中改变。

```c showLineNumbers
int age = 25;        // 整型变量
float price = 19.99; // 浮点型变量
char grade = 'A';    // 字符型变量
```

### 常量

常量是在程序执行过程中值不能改变的量。C语言中有多种定义常量的方式：

#### 1. 字面常量

直接在代码中使用的固定值。

```c showLineNumbers
int x = 100;        // 100是整型字面常量
float pi = 3.14;    // 3.14是浮点型字面常量
char ch = 'A';      // 'A'是字符型字面常量
```

#### 2. const关键字

使用`const`关键字声明的变量，其值不能被修改。

```c showLineNumbers
const int MAX_SIZE = 100;
const float PI = 3.14159;
const char NEWLINE = '\n';

// MAX_SIZE = 200;  // 错误！不能修改const变量
```

#### 3. #define预处理器

使用`#define`定义符号常量（宏定义）。

```c showLineNumbers
#define MAX_SIZE 100
#define PI 3.14159
#define NEWLINE '\n'

int main() {
    int array[MAX_SIZE];
    float radius = 5.0;
    float area = PI * radius * radius;
    return 0;
}
```

**const vs #define：**

| 特性 | const | #define |
|------|-------|---------|
| 类型检查 | 有类型，编译器会检查 | 无类型，只是文本替换 |
| 作用域 | 遵循作用域规则 | 全局有效（从定义处到文件末尾） |
| 调试 | 可以调试，有符号信息 | 难以调试，预处理后就消失了 |
| 内存 | 占用内存空间 | 不占用内存（编译时替换） |

## 数据类型详解

### 整数类型

#### 基本整数类型

```c showLineNumbers
#include <stdio.h>
#include <limits.h>

int main() {
    // 不同的整数类型
    char c = 'A';           // 1字节
    short s = 32000;        // 2字节
    int i = 2147483647;     // 4字节
    long l = 2147483647L;   // 4或8字节
    long long ll = 9223372036854775807LL; // 8字节
    
    // 打印各类型的大小
    printf("char: %zu bytes\n", sizeof(char));
    printf("short: %zu bytes\n", sizeof(short));
    printf("int: %zu bytes\n", sizeof(int));
    printf("long: %zu bytes\n", sizeof(long));
    printf("long long: %zu bytes\n", sizeof(long long));
    
    // 打印各类型的范围
    printf("\nchar range: %d to %d\n", CHAR_MIN, CHAR_MAX);
    printf("short range: %d to %d\n", SHRT_MIN, SHRT_MAX);
    printf("int range: %d to %d\n", INT_MIN, INT_MAX);
    printf("long range: %ld to %ld\n", LONG_MIN, LONG_MAX);
    printf("long long range: %lld to %lld\n", LLONG_MIN, LLONG_MAX);
    
    return 0;
}
```

#### 有符号与无符号

```c showLineNumbers
#include <stdio.h>

int main() {
    // 有符号整数（可以表示负数）
    signed int si = -100;
    int i = -100;  // int默认是signed
    
    // 无符号整数（只能表示非负数）
    unsigned int ui = 100;
    unsigned char uc = 255;
    
    printf("signed int: %d\n", si);
    printf("unsigned int: %u\n", ui);
    printf("unsigned char: %u\n", uc);
    
    // 无符号数的溢出
    unsigned int x = 0;
    x = x - 1;  // 下溢，变成最大值
    printf("0 - 1 = %u\n", x);  // 4294967295
    
    return 0;
}
```

#### 整数字面量

```c showLineNumbers
int decimal = 100;      // 十进制
int octal = 0144;       // 八进制（以0开头）
int hex = 0x64;         // 十六进制（以0x开头）
int binary = 0b1100100; // 二进制（C23标准，以0b开头）

// 长整型字面量
long l = 100L;          // L或l后缀
long long ll = 100LL;   // LL或ll后缀

// 无符号字面量
unsigned int u = 100U;  // U或u后缀
unsigned long ul = 100UL; // UL或ul后缀
```

### 浮点类型

#### 浮点数类型

```c showLineNumbers
#include <stdio.h>
#include <float.h>

int main() {
    float f = 3.14f;           // 单精度，4字节
    double d = 3.14159265359;  // 双精度，8字节
    long double ld = 3.14159265358979323846L; // 扩展精度
    
    printf("float: %zu bytes\n", sizeof(float));
    printf("double: %zu bytes\n", sizeof(double));
    printf("long double: %zu bytes\n", sizeof(long double));
    
    // 精度范围
    printf("\nfloat precision: %d digits\n", FLT_DIG);
    printf("double precision: %d digits\n", DBL_DIG);
    printf("long double precision: %d digits\n", LDBL_DIG);
    
    // 范围
    printf("\nfloat range: %e to %e\n", FLT_MIN, FLT_MAX);
    printf("double range: %e to %e\n", DBL_MIN, DBL_MAX);
    
    return 0;
}
```

#### 浮点数字面量

```c showLineNumbers
// 普通表示
float f1 = 3.14f;
double d1 = 3.14;
double d2 = 3.14159265359;

// 科学计数法
float f2 = 3.14e2f;    // 3.14 × 10²  = 314.0
double d3 = 1.5e-3;    // 1.5 × 10⁻³ = 0.0015
double d4 = 6.02e23;   // 阿伏伽德罗常数

// 十六进制浮点数（C99）
double d5 = 0x1.5p3;   // 1.5 × 2³ = 12.0
```

#### 浮点数精度问题

```c showLineNumbers
#include <stdio.h>
#include <math.h>

int main() {
    // 精度丢失
    float f = 0.1f + 0.2f;
    printf("0.1 + 0.2 = %.20f\n", f);  // 不等于0.3
    
    // 比较浮点数
    double a = 0.1 + 0.2;
    double b = 0.3;
    
    // 错误的比较方式
    if (a == b) {
        printf("Equal\n");
    } else {
        printf("Not equal\n");  // 会输出这个
    }
    
    // 正确的比较方式
    double epsilon = 1e-10;
    if (fabs(a - b) < epsilon) {
        printf("Approximately equal\n");
    }
    
    return 0;
}
```

### 字符类型

#### char类型

```c showLineNumbers
#include <stdio.h>

int main() {
    char ch1 = 'A';        // 字符字面量
    char ch2 = 65;         // ASCII码值
    char ch3 = '\n';       // 转义字符
    
    printf("ch1 = %c (ASCII: %d)\n", ch1, ch1);
    printf("ch2 = %c (ASCII: %d)\n", ch2, ch2);
    
    // char本质是小整数
    char a = 'A';
    char b = a + 1;
    printf("'A' + 1 = %c\n", b);  // 'B'
    
    // 字符运算
    char upper = 'A';
    char lower = upper + 32;  // 转小写
    printf("%c -> %c\n", upper, lower);
    
    return 0;
}
```

#### 转义序列

| 转义序列 | 含义 | ASCII值 |
|---------|------|---------|
| `\n` | 换行符 | 10 |
| `\t` | 水平制表符 | 9 |
| `\r` | 回车符 | 13 |
| `\b` | 退格符 | 8 |
| `\f` | 换页符 | 12 |
| `\a` | 响铃符 | 7 |
| `\\` | 反斜杠 | 92 |
| `\'` | 单引号 | 39 |
| `\"` | 双引号 | 34 |
| `\0` | 空字符 | 0 |
| `\xhh` | 十六进制值 | - |
| `\ooo` | 八进制值 | - |

```c showLineNumbers
#include <stdio.h>

int main() {
    printf("Hello\nWorld\n");        // 换行
    printf("Name:\tJohn\n");         // 制表符
    printf("Path: C:\\Users\\John\n"); // 反斜杠
    printf("He said \"Hello\"\n");   // 双引号
    
    // 十六进制和八进制
    char ch1 = '\x41';  // 'A'
    char ch2 = '\101';  // 'A'
    printf("%c %c\n", ch1, ch2);
    
    return 0;
}
```

### 布尔类型

C99引入了`_Bool`类型，C23引入了`bool`类型（需要包含`<stdbool.h>`）。

```c showLineNumbers
#include <stdio.h>
#include <stdbool.h>

int main() {
    // C99方式
    _Bool flag1 = 1;
    _Bool flag2 = 0;
    
    // C23方式（推荐）
    bool flag3 = true;
    bool flag4 = false;
    
    printf("flag3 = %d\n", flag3);  // 1
    printf("flag4 = %d\n", flag4);  // 0
    
    // 任何非零值都是true
    bool flag5 = 42;
    printf("flag5 = %d\n", flag5);  // 1
    
    return 0;
}
```

## printf详解

### 基本格式

```c
printf("格式字符串", 参数列表);
```

### 格式说明符

| 说明符 | 输出格式 | 示例 |
|--------|---------|------|
| `%d` / `%i` | 有符号十进制整数 | `printf("%d", 123);` |
| `%u` | 无符号十进制整数 | `printf("%u", 123);` |
| `%o` | 无符号八进制整数 | `printf("%o", 123);` |
| `%x` / `%X` | 无符号十六进制整数 | `printf("%x", 123);` |
| `%f` | 浮点数（小数形式） | `printf("%f", 3.14);` |
| `%e` / `%E` | 浮点数（科学计数法） | `printf("%e", 3.14);` |
| `%g` / `%G` | 自动选择%f或%e | `printf("%g", 3.14);` |
| `%c` | 字符 | `printf("%c", 'A');` |
| `%s` | 字符串 | `printf("%s", "Hello");` |
| `%p` | 指针地址 | `printf("%p", &var);` |
| `%%` | 百分号本身 | `printf("%%");` |

### 修饰符

```c showLineNumbers
#include <stdio.h>

int main() {
    int num = 123;
    float pi = 3.14159;
    
    // 宽度
    printf("%5d\n", num);      // "  123" (右对齐，总宽度5)
    printf("%-5d\n", num);     // "123  " (左对齐，总宽度5)
    printf("%05d\n", num);     // "00123" (用0填充)
    
    // 精度
    printf("%.2f\n", pi);      // "3.14" (保留2位小数)
    printf("%.4f\n", pi);      // "3.1416" (保留4位小数)
    printf("%8.2f\n", pi);     // "    3.14" (总宽度8，2位小数)
    
    // 长度修饰符
    long l = 123456789L;
    long long ll = 123456789012345LL;
    printf("%ld\n", l);        // long
    printf("%lld\n", ll);      // long long
    
    // 其他格式
    printf("%#x\n", 255);      // "0xff" (显示前缀)
    printf("%+d\n", 123);      // "+123" (显示正号)
    printf("% d\n", 123);      // " 123" (正数前加空格)
    
    return 0;
}
```

### 常见用法

```c showLineNumbers
#include <stdio.h>

int main() {
    // 多个参数
    printf("Name: %s, Age: %d, Score: %.2f\n", "John", 25, 95.5);
    
    // 对齐输出
    printf("%-10s %5d %8.2f\n", "Alice", 90, 85.5);
    printf("%-10s %5d %8.2f\n", "Bob", 85, 92.3);
    printf("%-10s %5d %8.2f\n", "Charlie", 95, 88.7);
    
    // 进制转换
    int num = 255;
    printf("Decimal: %d\n", num);
    printf("Octal: %o\n", num);
    printf("Hex: %x\n", num);
    printf("Hex (uppercase): %X\n", num);
    
    return 0;
}
```

## scanf详解

### 基本格式

```c
scanf("格式字符串", 地址列表);
```

:::warning 重要
scanf的参数必须是变量的地址（使用&运算符），而不是变量本身！
:::

### 格式说明符

```c showLineNumbers
#include <stdio.h>

int main() {
    int num;
    float price;
    char ch;
    char name[50];
    
    // 读取整数
    printf("Enter a number: ");
    scanf("%d", &num);
    
    // 读取浮点数
    printf("Enter a price: ");
    scanf("%f", &price);
    
    // 读取字符
    printf("Enter a character: ");
    scanf(" %c", &ch);  // 注意前面的空格，跳过空白字符
    
    // 读取字符串
    printf("Enter your name: ");
    scanf("%s", name);  // 数组名本身就是地址，不需要&
    
    printf("\nYou entered:\n");
    printf("Number: %d\n", num);
    printf("Price: %.2f\n", price);
    printf("Character: %c\n", ch);
    printf("Name: %s\n", name);
    
    return 0;
}
```

### 返回值

scanf返回成功读取的项目数量。

```c showLineNumbers
#include <stdio.h>

int main() {
    int a, b, c;
    int result;
    
    printf("Enter three numbers: ");
    result = scanf("%d %d %d", &a, &b, &c);
    
    printf("Successfully read %d items\n", result);
    
    if (result == 3) {
        printf("a=%d, b=%d, c=%d\n", a, b, c);
    } else {
        printf("Input error!\n");
    }
    
    return 0;
}
```

### 常见问题

#### 1. 缓冲区残留

```c showLineNumbers
#include <stdio.h>

int main() {
    int num;
    char ch;
    
    printf("Enter a number: ");
    scanf("%d", &num);
    
    // 清空缓冲区
    while (getchar() != '\n');
    
    printf("Enter a character: ");
    scanf("%c", &ch);
    
    printf("Number: %d, Character: %c\n", num, ch);
    
    return 0;
}
```

#### 2. 限制输入长度

```c showLineNumbers
#include <stdio.h>

int main() {
    char name[10];
    
    // 最多读取9个字符（留一个给\0）
    printf("Enter your name: ");
    scanf("%9s", name);
    
    printf("Name: %s\n", name);
    
    return 0;
}
```

#### 3. 跳过特定字符

```c showLineNumbers
#include <stdio.h>

int main() {
    int year, month, day;
    
    // 输入格式：2024-01-15
    printf("Enter date (YYYY-MM-DD): ");
    scanf("%d-%d-%d", &year, &month, &day);
    
    printf("Year: %d, Month: %d, Day: %d\n", year, month, day);
    
    return 0;
}
```

## 类型转换

### 隐式类型转换

编译器自动进行的类型转换。

```c showLineNumbers
#include <stdio.h>

int main() {
    // 整数提升
    char c = 'A';
    int i = c;  // char -> int
    printf("c = %c, i = %d\n", c, i);
    
    // 算术转换
    int a = 5;
    float b = 2.5;
    float result = a + b;  // int -> float
    printf("5 + 2.5 = %.1f\n", result);
    
    // 赋值转换
    double d = 3.14159;
    int n = d;  // double -> int (截断小数部分)
    printf("d = %.5f, n = %d\n", d, n);
    
    return 0;
}
```

### 显式类型转换（强制类型转换）

使用类型转换运算符进行的转换。

```c showLineNumbers
#include <stdio.h>

int main() {
    // 整数除法
    int a = 5, b = 2;
    float result1 = a / b;           // 2.0 (整数除法)
    float result2 = (float)a / b;    // 2.5 (浮点除法)
    
    printf("5 / 2 = %.1f\n", result1);
    printf("(float)5 / 2 = %.1f\n", result2);
    
    // 避免溢出
    int x = 1000;
    int y = 1000;
    long result3 = (long)x * y;  // 避免int溢出
    
    printf("1000 * 1000 = %ld\n", result3);
    
    return 0;
}
```

### 类型转换规则

**算术转换的优先级（从高到低）：**

1. `long double`
2. `double`
3. `float`
4. `unsigned long long`
5. `long long`
6. `unsigned long`
7. `long`
8. `unsigned int`
9. `int`

较低类型会自动转换为较高类型。

```c showLineNumbers
#include <stdio.h>

int main() {
    char c = 100;
    short s = 200;
    int i = 300;
    long l = 400;
    float f = 5.5;
    double d = 6.6;
    
    // 混合运算
    double result = c + s + i + l + f + d;
    // 所有类型都转换为double
    
    printf("Result: %.1f\n", result);
    
    return 0;
}
```

## 实用示例

### 温度转换

```c showLineNumbers
#include <stdio.h>

int main() {
    float celsius, fahrenheit;
    
    printf("Enter temperature in Celsius: ");
    scanf("%f", &celsius);
    
    fahrenheit = celsius * 9.0 / 5.0 + 32.0;
    
    printf("%.2f°C = %.2f°F\n", celsius, fahrenheit);
    
    return 0;
}
```

### 计算圆的面积和周长

```c showLineNumbers
#include <stdio.h>

#define PI 3.14159

int main() {
    float radius, area, circumference;
    
    printf("Enter radius: ");
    scanf("%f", &radius);
    
    area = PI * radius * radius;
    circumference = 2 * PI * radius;
    
    printf("Area: %.2f\n", area);
    printf("Circumference: %.2f\n", circumference);
    
    return 0;
}
```

### 交换两个变量的值

```c showLineNumbers
#include <stdio.h>

int main() {
    int a = 10, b = 20, temp;
    
    printf("Before swap: a = %d, b = %d\n", a, b);
    
    // 使用临时变量
    temp = a;
    a = b;
    b = temp;
    
    printf("After swap: a = %d, b = %d\n", a, b);
    
    // 不使用临时变量（异或方法）
    a = a ^ b;
    b = a ^ b;
    a = a ^ b;
    
    printf("After swap again: a = %d, b = %d\n", a, b);
    
    return 0;
}
```

## 注意事项

### 1. 整数溢出

```c showLineNumbers
#include <stdio.h>
#include <limits.h>

int main() {
    int max = INT_MAX;
    printf("INT_MAX = %d\n", max);
    printf("INT_MAX + 1 = %d\n", max + 1);  // 溢出！
    
    return 0;
}
```

### 2. 浮点数比较

```c showLineNumbers
#include <stdio.h>
#include <math.h>

int main() {
    double a = 0.1 + 0.2;
    double b = 0.3;
    
    // 错误
    if (a == b) {
        printf("Equal\n");
    }
    
    // 正确
    if (fabs(a - b) < 1e-10) {
        printf("Approximately equal\n");
    }
    
    return 0;
}
```

### 3. 字符与整数

```c showLineNumbers
#include <stdio.h>

int main() {
    char ch = '5';
    int num = 5;
    
    printf("ch = %c (ASCII: %d)\n", ch, ch);
    printf("num = %d\n", num);
    
    // 字符转数字
    int digit = ch - '0';
    printf("digit = %d\n", digit);
    
    return 0;
}
```

## 相关资源

- [C Data Types - cppreference](https://en.cppreference.com/w/c/language/type)
- [printf - cppreference](https://en.cppreference.com/w/c/io/fprintf)
- [scanf - cppreference](https://en.cppreference.com/w/c/io/fscanf)
