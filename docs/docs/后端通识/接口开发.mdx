---
sidebar_position: 1
title: 
---

## API

API ****Application Programming InterfaceAPI 

 API 

- **Request** URL
- **Response** 
- **Endpoint** API  URL 
- **Method**  GETPOSTPUTDELETE 
- **Data Format**  JSONXML 

### 

|  | **OpenAI API ** | **MCP** | **OpenAPI** |
|------|-------------------|---------|-------------|
| **** |  API  |  |  API  |
| **** | OpenAI  |  | Linux  |
| **** |  | MIT  |  |
| **** |  | mcp.spec | openapis.org |
| **** |  LLM | LLM  |  RESTful API |

### 

 API Python 

|                 | FastAPI                         | Django                                |
|-------------------|---------------------------------|---------------------------------------|
| ****          | 2018                           | 2005                                 |
| ****          | Python                          | Python                                |
| ****          |  Starlette  Pydantic     |  ORMAdmin             |
| ****            |  ASGI                |  WSGI                           |
| ****          |  `async`/`await`         |  Django 3.0+          |
| ****          |  Pydantic          |  Forms  DRF  serializers   |
| ****        |  OpenAPI  Swagger UI       |  Django REST Framework (DRF) |
| ****          |                  |                    |
| ****         |                |                     |
| ****          |                 |                     |
| ****        |                         |                                  |
| ****          |  Flask  Django  |                      |
| ****          |  Starlette               |                          |
| ****          |                 |                  |
| **ORM **        |  Tortoise-ORM         |  Django ORM                    |
| **Admin **      |                         |  Admin                  |
| ** Python ** | Python 3.6+                     | Python 3.8+                           |
| ****      |                       |                       |


## FastAPI

`pip install "fastapi[standard]"`

### 

 FlaskFastAPI  2  API http://127.0.0.1:8000/docs  http://127.0.0.1:8000/redoc

```python showLineNumbers
from fastapi import FastAPI, Header, HTTPException, Query, Path
from pydantic import BaseModel
from typing import Optional, Dict

app = FastAPI()

# Pydantic Models
class PostExampleModel(BaseModel):
    title: Optional[str] = ""
    content: Optional[str] = ""

class PutExampleModel(BaseModel):
    name: Optional[str] = ""
    description: Optional[str] = ""

class ApiResourcePostModel(BaseModel):
    key: str

class ApiResourcePutModel(BaseModel):
    field: str

# GET /get_example/{user_id}
@app.get("/get_example/{user_id}")
def get_example(
    user_id: int,
    name: Optional[str] = Query(""),
    user_agent: Optional[str] = Header("")
):
    """
    **** GET

    ****
    http:day3.ipynb
    GET /get_example/123?name=Alice HTTP/1.1
    Host: example.com
    User-Agent: Mozilla/5.0

    ****
    json
    {
        "user_id": 123,
        "name": "Alice",
        "user_agent": "Mozilla/5.0"
    }

    """
    return {"user_id": user_id, "name": name, "user_agent": user_agent}

# POST /post_example
@app.post("/post_example")
def post_example(
    data: PostExampleModel,
    authorization: Optional[str] = Header("")
):
    """
    **** POST

    ****
    http
    POST /post_example HTTP/1.1
    Host: example.com
    Content-Type: application/json
    Authorization: Bearer token

    {
        "title": "",
        "content": ""
    }

    ****
    json
    {
        "title": "",
        "content": "",
        "authorization": "Bearer token"
    }

    """
    return {"title": data.title, "content": data.content, "authorization": authorization}

# PUT /put_example/{item_id}
@app.put("/put_example/{item_id}")
def put_example(
    item_id: int,
    data: PutExampleModel,
    x_custom_header: Optional[str] = Header("")
):
    """
    **** PUT

    ****
    http
    PUT /put_example/456 HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded
    X-Custom-Header: 

    name=&description=

    ****
    json
    {
        "item_id": 456,
        "name": "",
        "description": "",
        "custom_header": ""
    }

    """
    return {
        "item_id": item_id,
        "name": data.name,
        "description": data.description,
        "custom_header": x_custom_header,
    }

# DELETE /delete_example
@app.delete("/delete_example")
def delete_example(
    confirm: bool = Query(False),
    authorization: Optional[str] = Header("")
):
    """
    **** DELETE

    ****
    http
    DELETE /delete_example?confirm=true HTTP/1.1
    Host: example.com
    Authorization: Bearer token

    ****
    json
    {
        "deleted": true,
        "authorization": "Bearer token"
    }


    ****
    http
    DELETE /delete_example HTTP/1.1
    Host: example.com

    ****
    json
    {
        "message": ""
    }

    HTTP 400
    """
    if not confirm:
        raise HTTPException(status_code=400, detail="")
    return {"deleted": confirm, "authorization": authorization}

# GET /api/resource/{resource_id}
@app.get("/api/resource/{resource_id}")
def api_resource_get(
    resource_id: str,
    detail: Optional[str] = Query("basic")
):
    """
    **** GET

    ****
    GET /api/resource/abc123?detail=full HTTP/1.1
    Host: example.com

    ****
    json
    {
        "method": "GET",
        "resource_id": "abc123",
        "detail": "full"
    }

    """
    return {"method": "GET", "resource_id": resource_id, "detail": detail}

# POST /api/resource/{resource_id}
@app.post("/api/resource/{resource_id}")
def api_resource_post(
    resource_id: str,
    data: ApiResourcePostModel
):
    """
    **** POST

    ****
    POST /api/resource/abc123 HTTP/1.1
    Host: example.com
    Content-Type: application/json

    {
        "key": "value"
    }

    ****
    json
    {
        "method": "POST",
        "resource_id": "abc123",
        "data": {
            "key": "value"
        }
    }

    """
    return {"method": "POST", "resource_id": resource_id, "data": data.dict()}

# PUT /api/resource/{resource_id}
@app.put("/api/resource/{resource_id}")
def api_resource_put(
    resource_id: str,
    data: ApiResourcePutModel
):
    """
    **** PUT

    ****
    PUT /api/resource/abc123 HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    field=new%20value

    ****
    json
    {
        "method": "PUT",
        "resource_id": "abc123",
        "data": {
            "field": "new value"
        }
    }

    """
    return {"method": "PUT", "resource_id": resource_id, "data": data.dict()}

# DELETE /api/resource/{resource_id}
@app.delete("/api/resource/{resource_id}")
def api_resource_delete(
    resource_id: str,
    confirm: bool = Query(False)
):
    """
    **** DELETE

    ****
    DELETE /api/resource/abc123?confirm=true HTTP/1.1
    Host: example.com

    ****
    json
    {
        "method": "DELETE",
        "resource_id": "abc123",
        "confirm": true
    }

    """
    return {"method": "DELETE", "resource_id": resource_id, "confirm": confirm}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)

```

 FastAPI 

```python showLineNumbers
from fastapi import FastAPI
from fastapi.responses import StreamingResponse
import asyncio
import random

app = FastAPI()

async def async_range(n):
    for i in range(n):
        yield f"<p>{i}</p>"
        await asyncio.sleep(random.randint(1, 3) * 1)

@app.get("/stream")
async def stream_numbers():
    return StreamingResponse(async_range(5), media_type="html", background=None)

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```


### 

OpenCV 

```python showLineNumbers

import os
from importlib import import_module
from fastapi import FastAPI
from fastapi.responses import HTMLResponse, StreamingResponse
import uvicorn

from io import BytesIO
import cv2
from PIL import ImageGrab, Image
import time
import threading
from threading import get_ident


class CameraEvent(object):
    def __init__(self):
        self.events = {}

    def wait(self):
        ident = get_ident()
        if ident not in self.events:
            self.events[ident] = [threading.Event(), time.time()]
        return self.events[ident][0].wait()

    def set(self):
        now = time.time()
        remove = None
        for ident, event in self.events.items():
            if not event[0].isSet():
                event[0].set()
                event[1] = now
            else:
                if now - event[1] > 5:
                    remove = ident
        if remove:
            del self.events[remove]

    def clear(self):
        self.events[get_ident()][0].clear()


class BaseCamera(object):
    thread = None
    frame = None
    last_access = 0
    event = CameraEvent()

    def __init__(self):
        if BaseCamera.thread is None:
            BaseCamera.last_access = time.time()

            BaseCamera.thread = threading.Thread(target=self._thread)
            BaseCamera.thread.start()

            while self.get_frame() is None:
                time.sleep(0)

    def get_frame(self):
        BaseCamera.last_access = time.time()

        BaseCamera.event.wait()
        BaseCamera.event.clear()

        return BaseCamera.frame

    @staticmethod
    def frames():
        raise RuntimeError('Must be implemented by subclasses.')

    @classmethod
    def _thread(cls):
        print('Starting camera thread.')
        frames_iterator = cls.frames()
        for frame in frames_iterator:
            BaseCamera.frame = frame
            BaseCamera.event.set()
            time.sleep(0)
            if time.time() - BaseCamera.last_access > 10:
                frames_iterator.close()
                print('Stopping camera thread due to inactivity.')
                break
        BaseCamera.thread = None



class Camera(BaseCamera):
    video_source = 0

    @staticmethod
    def set_video_source(source):
        Camera.video_source = source

    @staticmethod
    def frames():
        camera = cv2.VideoCapture(Camera.video_source)
        if not camera.isOpened():
            raise RuntimeError('Error')

        while True:
            image = ImageGrab.grab()  # 
            # w, h = image.size
            image = image.resize((1366, 750), Image.LANCZOS)  # 
            output_buffer = BytesIO()  # 
            image.save(output_buffer, format='JPEG', quality=100)  # quality
            frame = output_buffer.getvalue()  # 
            yield frame  # 

app = FastAPI()


@app.get('/', response_class=HTMLResponse)
async def index():
    """
    
    :return:
    """
    return '''<html>

<head>
    <title></title>
</head>

<body>
    <img src="/video_feed">
</body>

</html>'''


def gen(camera):
    """
    
    """
    while True:
        frame = camera.get_frame()

        yield (b'--frame\r\n'
               b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')


@app.get('/video_feed')
async def video_feed():
    """"""
    return StreamingResponse(gen(Camera()),
                            media_type='multipart/x-mixed-replace; boundary=frame')


if __name__ == '__main__':
    ip_host = '127.0.0.1'  # ip
    ip_host2 = '0.0.0.0'  # ip
    import webbrowser
    webbrowser.open(f'http://{ip_host}:80')
    uvicorn.run(app, host=ip_host2, port=80)
```

## MCP

**Model Context ProtocolMCP** LLM

MCP<Highlight>AI Claude DesktopCursor, MCP </Highlight>

MCP 

- **Resources** 
- **Tools** LLM 
- **Prompts**  LLM 
- **Sampling()** 

Tools

MCPFastMCP  Python FastMCP 

https://github.com/jlowin/fastmcp

### 

```python showLineNumbers title="file_server.py"
"""
FastMCP Echo Server
"""

from fastmcp import FastMCP

# Create server
mcp = FastMCP("Echo Server")


@mcp.tool
def echo_tool(text: str) -> str:
    """Echo the input text"""
    return text


@mcp.resource("echo://static")
def echo_resource() -> str:
    return "Echo!"


@mcp.resource("echo://{text}")
def echo_template(text: str) -> str:
    """Echo the input text"""
    return f"Echo: {text}"


@mcp.prompt("echo")
def echo_prompt(text: str) -> str:
    return text
```

### 

`https://fastmcp.cloud/`cursor

```json showLineNumbers
{
  "mcpServers": {
    "fastmcp": {
      "url": "https://magnificent-crimson-antlion.fastmcp.app/mcp",
      "transport": "http"
    }
  }
}
```

`fastmcp`,

```json showLineNumbers
{
  "mcpServers": {
    "local-echo-server": {
      "command": "fastmcp",
      "args": ["run", "C:\\Users\\allen\\Desktop\\MCP\\server.py"],
      "transport": "stdio"
    }
  }
}
```

 [MCP ](https://modelcontextprotocol.github.io/python-sdk/api/)  [PyPI ](https://pypi.org/project/mcp/)


## Django

### 

Django  urls.py 

 Django  Django 

 Django  Django REST framework

```bash showLineNumbers
pip install django djangorestframework
```



```bash showLineNumbers
django-admin startproject myproject
cd myproject
django-admin startapp apiapp
```



```bash showLineNumbers
myproject/
 apiapp/
    __init__.py
    views.py
    urls.py
    serializers.py
 myproject/
    __init__.py
    settings.py
    urls.py
    wsgi.py
 manage.py
```

 `myproject/settings.py`  `rest_framework`  `apiapp`  `INSTALLED_APPS` 
```python showLineNumbers title=myproject/settings.py
INSTALLED_APPS = [
    ... # 
    'rest_framework',
    'apiapp',
]
```



```python showLineNumbers title="apiapp/serializers.py"
from rest_framework import serializers

class PostExampleSerializer(serializers.Serializer):
    title = serializers.CharField(default="", required=False)
    content = serializers.CharField(default="", required=False)

class PutExampleSerializer(serializers.Serializer):
    name = serializers.CharField(default="", required=False)
    description = serializers.CharField(default="", required=False)

class ApiResourcePostSerializer(serializers.Serializer):
    key = serializers.CharField()

class ApiResourcePutSerializer(serializers.Serializer):
    field = serializers.CharField()
```



```python showLineNumbers title="apiapp/views.py"
from rest_framework import status
from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework.views import APIView

from .serializers import (
    PostExampleSerializer,
    PutExampleSerializer,
    ApiResourcePostSerializer,
    ApiResourcePutSerializer,
)

@api_view(['GET'])
def get_example(request, user_id):
    """
    **** GET

    ****
    GET /get_example/123?name=Alice HTTP/1.1
    Host: example.com
    User-Agent: Mozilla/5.0

    ****    ```json
    {
        "user_id": 123,
        "name": "Alice",
        "user_agent": "Mozilla/5.0"
    }
    """
    name = request.query_params.get('name', '')
    user_agent = request.headers.get('User-Agent', '')
    return Response({"user_id": user_id, "name": name, "user_agent": user_agent})

@api_view(['POST'])
def post_example(request):
    """
    **** POST

    ****
    POST /post_example HTTP/1.1
    Host: example.com
    Content-Type: application/json
    Authorization: Bearer token

    {
        "title": "",
        "content": ""
    }

    ****    ```json
    {
        "title": "",
        "content": "",
        "authorization": "Bearer token"
    }
    """
    serializer = PostExampleSerializer(data=request.data)
    if serializer.is_valid():
        title = serializer.validated_data.get('title', '')
        content = serializer.validated_data.get('content', '')
        auth = request.headers.get('Authorization', '')
        return Response({"title": title, "content": content, "authorization": auth})
    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

@api_view(['PUT'])
def put_example(request, item_id):
    """
    **** PUT

    ****
    PUT /put_example/456 HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded
    X-Custom-Header: 

    name=&description=

    ****    ```json
    {
        "item_id": 456,
        "name": "",
        "description": "",
        "custom_header": ""
    }
    """
    serializer = PutExampleSerializer(data=request.data)
    if serializer.is_valid():
        name = serializer.validated_data.get('name', '')
        description = serializer.validated_data.get('description', '')
        custom_header = request.headers.get('X-Custom-Header', '')
        return Response({
            "item_id": item_id,
            "name": name,
            "description": description,
            "custom_header": custom_header,
        })
    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

@api_view(['DELETE'])
def delete_example(request):
    """
    **** DELETE

    ****
    DELETE /delete_example?confirm=true HTTP/1.1
    Host: example.com
    Authorization: Bearer token

    ****    ```json
    {
        "deleted": true,
        "authorization": "Bearer token"
    }    ```

    ****
    DELETE /delete_example HTTP/1.1
    Host: example.com

    ****    ```json
    {
        "message": ""
    }    ```
    HTTP 400
    """
    confirm = request.query_params.get('confirm', 'false').lower() == 'true'
    auth = request.headers.get('Authorization', '')
    if not confirm:
        return Response({"message": ""}, status=status.HTTP_400_BAD_REQUEST)
    return Response({"deleted": confirm, "authorization": auth})

class ApiResourceView(APIView):
    """
    **** GET, POST, PUT, DELETE

    **GET **
    GET /api/resource/abc123?detail=full HTTP/1.1
    Host: example.com

    **GET **    ```json
    {
        "method": "GET",
        "resource_id": "abc123",
        "detail": "full"
    }
    """

    def get(self, request, resource_id):
        detail = request.query_params.get('detail', 'basic')
        return Response({"method": "GET", "resource_id": resource_id, "detail": detail})

    def post(self, request, resource_id):
        """
        **POST **
        POST /api/resource/abc123 HTTP/1.1
        Host: example.com
        Content-Type: application/json

        {
            "key": "value"
        }

        **POST **        ```json
        {
            "method": "POST",
            "resource_id": "abc123",
            "data": {
                "key": "value"
            }
        }        ```
        """
        serializer = ApiResourcePostSerializer(data=request.data)
        if serializer.is_valid():
            data = serializer.validated_data
            return Response({"method": "POST", "resource_id": resource_id, "data": data})
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

    def put(self, request, resource_id):
        """
        **PUT **
        PUT /api/resource/abc123 HTTP/1.1
        Host: example.com
        Content-Type: application/x-www-form-urlencoded

        field=new%20value

        **PUT **        ```json
        {
            "method": "PUT",
            "resource_id": "abc123",
            "data": {
                "field": "new value"
            }
        }        ```
        """
        serializer = ApiResourcePutSerializer(data=request.data)
        if serializer.is_valid():
            data = serializer.validated_data
            return Response({"method": "PUT", "resource_id": resource_id, "data": data})
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

    def delete(self, request, resource_id):
        """
        **DELETE **
        DELETE /api/resource/abc123?confirm=true HTTP/1.1
        Host: example.com

        **DELETE **        ```json
        {
            "method": "DELETE",
            "resource_id": "abc123",
            "confirm": true
        }        ```
        """
        confirm = request.query_params.get('confirm', 'false').lower() == 'true'
        return Response({"method": "DELETE", "resource_id": resource_id, "confirm": confirm})
```

 `apiapp/urls.py` 

```python showLineNumbers title="apiapp/urls.py"
from django.urls import path
from . import views

urlpatterns = [
    path('get_example/<int:user_id>/', views.get_example, name='get_example'),
    path('post_example/', views.post_example, name='post_example'),
    path('put_example/<int:item_id>/', views.put_example, name='put_example'),
    path('delete_example/', views.delete_example, name='delete_example'),
    path('api/resource/<str:resource_id>/', views.ApiResourceView.as_view(), name='api_resource'),
]
```

 `myproject/urls.py`  `apiapp.urls`

```python showLineNumbers title="myproject/urls.py"
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('apiapp.urls')),
]
```



```bash showLineNumbers
python manage.py runserver
```
