# 

`console.log(fn())`

1. 
2. 
3. 



## 

**AB******`console.log(fn())``fn()`

Node`assert``Chai`

### Node#assert

``` js
import assert from 'assert'

function fn() { 
    return 100
}
assert.strictEqual(fn(), 100) // 
assert.strictEqual(fn(), 200) // 
```

### Chai

`Chai`TDD`assert``BDD``expect``BDD``should`

``` js
import {
    assert,
} from 'chai'

function fn() {
    return 100
}
assert.equal(fn(), 100) // TDD
```

``` js
import {
    expect,
} from 'chai'

function fn() {
    return 100
}
expect(fn()).to.equal(200) // BDD
```

``` js
import {
    should
} from 'chai'

function fn() {
    return 100
}
should()
fn().should.equal(100) // BDD
```

## Mocha

`Mocha``Chai``test`

``` bash
npm i mocha -D
npx mocha
```

``` js
// test/index.js
import { expect } from 'chai'

describe('', () => {
    it('test one', () => {
       // 
    })
    it('test two', () => {
        throw new Error('233') // 
    })

    it('test three', () => {
        expect(100).to.equal(200) // 
    })
})
```

## Jest

`Jest``Facebook``Create-React-App``Jest``Jest``Jest``jsdom``Jest``testEnvironment``node``jsdom`DOM

`__tests__``*.test.js`

``` bash
npm i jest -D
npx jest
# or
npx jest --watch 
```

``` js
// __tests__/index.js
test('1 + 1 equal 2', () => { // test  it
    expect(1 + 1).toBe(2) // Jestexpect
})

test('', () => {
    // 
})

describe('', () => { 
    it('1', () => {
        expect(1 + 1).toBe(2)
    })

    it('2', () => {
        expect(10 / 2).toBe(5)
    })
})
```

### 

``` js
// jest.config.js 
module.exports = {
      testMatch: [ // 
        "**/__tests__/**/*.[jt]s?(x)", 
        "**/?(*.)+(spec|test).[tj]s?(x)"
      ],
      testEnvironment: "node", // nodejsdomDOM
}
```

`jsdom`

``` js
module.exports = {
    testMatch: ['<rootDir>/test/**/*.js'],
    testEnvironment: 'jsdom'
}
```

``` js
it('DOM', () => {
    document.body.innerHTML = `<div class="test">akara</div>`
    const el = document.querySelector('.test')
    expect(el.innerHTML).toBe('akara')
})
```

### Matchers

``` js
// 
toBe
toEqual // 
toBeUndefined
toBeNull

// 
toHaveProperty
toContain
toMatch

// 
toBeTruthy // 1 '1'  truthy
toBeFalsy // 0 ''  falsy
toBeGreaterThan
toBeLessThan

//  .not.
expect(1 + 1).not.toBe(3)
```

### 

``` js
it('', () => {
    setTimeout(() => {
        expect(1 + 1).toBe(3)
    }, 1000)
})
```

`expect`

****`done``Promise``async/await`

``` js
// done
it('', (done) => {
    setTimeout(() => {
        try {
            expect(1 + 1).toBe(3)
            done() 
        } catch(e) {
            done(e)
        }
    }, 1000)
})
```

``` js
// Promise
it('Promise test 1', () => {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            try {
                expect(1 + 1).toBe(3)
                resolve()
            } catch(e) {
                reject(e)
            }
        }, 1000)
    })
})

function sleep() {
    return new Promise((resolve, reject) => {
        setTimeout(resolve, 2000)
    })
}

it('Promise test 1', () => {
    return sleep.then(() => {
        expect(1 + 1).toBe(3) // promise
    })
})
```

``` js
// async + await
function sleep() {
    return new Promise((resolve, reject) => {
        setTimeout(resolve, 2000)
    })
}

it('test', async () => {
    await sleep()
    expect(1 + 1).toBe(3)
})
```

### Setup

`Jest``setupFilesAfterEnv`

``` js
// jest.config.js
module.exports = {
    setupFilesAfterEnv: ['./jest.setup.js']
}
```

``` js
// jest.setup.js
beforeAll(() => {
    // 
})

beforeEach(() => {
    // 
})

afterAll(() => {
    // 
})
```

`Create-React-App``setup``src/setupTests.js`

``` js
// src/setupTests.js
import '@testing-library/jest-dom';
```

`@testing-library/jest-dom``matcher`





### Mock Function

``` js
test('mock fn', () => {
    const arr = [1, 2, 3]
    const fn = jest.fn()
    arr.forEach(fn)
    expect(fn.mock.calls.length).toBe(3) 
    expect(fn.mock.calls[0][0]).toBe(1)
    expect(fn.mock.calls[1][0]).toBe(2)
    expect(fn.mock.calls[2][0]).toBe(3)
})

test('mock fn2', () => {
    const arr = [1, 2, 3]
    const fn = jest.fn(x => x * x)
    arr.forEach(fn)
    expect(fn.mock.calls.length).toBe(3) 
    expect(fn.mock.results[0].value).toBe(1)
    expect(fn.mock.results[1].value).toBe(4)
    expect(fn.mock.results[2].value).toBe(9)
})
```

`jest.fn(x => x * x)``mock``mock`

``` js
// Once
const fn = jest.fn()
fn.mockReturnValueOnce(1).mockReturnValueOnce(2).mockReturnValue(100) 
const result = [1, 1, 1, 1].map(fn)
expect(result).toEqual([1, 2, 100, 100])
```

### Mock Module



- `getUser.js`
- `test`
  - `index.js`
- `node_modules`
- `package.json`

`getUser`

``` js
// getUser.js
const axios = require('axios')

module.exports = async function getUser() {
    const data = await axios.get('localhost:3000/getUsers') // {name: 'akara'}
    return data
}
```



``` js
const getUser = require('../getUser')

it('', () => {
    return getUser().then(data => expect(data).toEqual({name: 'akara'}))
})
```

`axios`

`axios``axios``node_modules``node_modules``__mocks__``axios.js`

``` js
// __mocks__/axios.js
module.exports = {
    get() {
         return new Promise((resolve, reject) => {
            resolve({name: 'akara'}) 
        })
    }
}
```



``` js
const getUser = require('../getUser')
jest.mock('axios') // 

it('', () => {
    return getUser().then(data => expect(data).toEqual({name: 'akara'}))
})
```

`jest.mock('axios')``axios``axios``__mocks__`

****

`axios``node_modules`Node

`lib/ajax.js``lib``__mocks__``__mocks__``ajax.js`



### Mock 

React

``` jsx
import React from 'react'
import './index.css'

export default function App() {
    return <div>hello world</div>
}
```

`import './index.css'``webpack``loader`

`jest``jest``webpack`

Mock`import './index.css'`

``` js
// jest.config.js
module.exports = {
    "moduleNameMapper": {
        "\\.css$": "<rootDir>/__mocks__/styleMock.js"
    }
}
```

`__mocks__``styleMock.js`

``` js
module.exports = {}
```



## 

NodeDOM`jsdom``global-jsdom`NodeDOM

`Jest``jsdom``Jest``testEnvironment``node``jsdom`DOM

``` js
test('JestJSDOM', () => {
    const el = document.createElement('div')
    el.innerHTML = 'akara'
    expect(el.innerHTML).toBe('akara')
})
```

### jsdom

``` js
const jsdom = require('jsdom')
const { JSDOM } = jsdom
const container = new JSDOM(`
    <html>
        <div>akara</div>
    </html>
`) 
console.log(container.window.document.querySelector('div').innerHTML);
```

### global-jsdom

``` bash
npm i -D jsdom global-jsdom
```

``` js
require('global-jsdom/register')

const el = document.createElement('div')
el.innerHTML = 'akara'
console.log(el);
```



### @testing-library

`@testing-library`DOM`@testing-library/dom`DOM****`@testing-library/dom``@testing-library/react``@testing-library/vue`

`Create-React-App``Jest``@testing-library/react`

### @testing-library/dom

`@testing-library/dom`DOM

``` js
const { 
    getByText,
    screen,
    fireEvent,
    waitfor,
} = require('@testing-library/dom')

test('', () => {
    const container = document.createElement('div')
    container.innerHTML = `<div>aka</div>`
    const el = getByText(container, 'akara')
    // screenDOMbody
    // document.body.appendChild(container)
    // const el = screen.getByText('aka')
    el.addEventListener('click', function(e) {
        e.target.innerHTML = 'bkb'
    })
    fireEvent.click(el)
    expect(el.innerHTML).toBe('bkb')
})
```



### @testing-library/react

``` js
//  App.test.js
import { 
	render, 
    screen,
    fireEvent,
    waitfor
} from '@testing-library/react';
import App from './App';

test('renders learn react link', () => {
  	render(<App />);
  	const linkElement = screen.getByText(/learn react/i);
  	expect(linkElement).toBeInTheDocument();
});
```

## Mock Service Worker

`NSW``API Mocking``Mock``Jest`Node`Mock`

`NSW``Service Worker`Node`NSW`

> JestMock ModuleMockMock ModuleNSW



### Mock

[](https://mswjs.io/docs/getting-started/integrate/browser)

### NodeMock

``` js
// src/setupTests.js
const { rest } = require('msw')
const { setupServer } = require('msw/node')

const server = setupServer(
    rest.get('http://localhost:3000/test', (req, res, ctx) => {
        return res(
            ctx.status(200),
            ctx.json({
                name: 'akara'
            })
        )
    })
)

beforeAll(() => server.listen())

afterEach(() => server.resetHandlers())

afterAll(() => server.close())
```

``` js
// index.test.js
const fetch = require('node-fetch')

test('', async () => {
    const data = await fetch('http://localhost:3000/test').then(res => res.json())
    expect(data.name).toBe('akara')
})
```











## 



### Istanbul

Istanbul  JavaScript 

#### 

1. ** (Statement Coverage)**: 
2. ** (Branch Coverage)**: 
3. ** (Function Coverage)**: 
4. ** (Line Coverage)**: 

#### 

```bash
#  nyc (Istanbul )
npm install --save-dev nyc

# 
nyc npm test

#  HTML 
nyc --reporter=html npm test
```

#### 

```json
// package.json
{
  "nyc": {
    "include": ["src/**/*.js"],
    "exclude": ["src/**/*.test.js"],
    "reporter": ["text", "html"],
    "check-coverage": true,
    "lines": 80,
    "functions": 80,
    "branches": 80,
    "statements": 80
  }
}
```


